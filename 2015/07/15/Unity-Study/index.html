
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Unity Study | 走停人生路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Tony Tang">
    

    
    <meta name="description" content="Unity Introduction因为后期发现目录越来越长导致前面的一些代码模块不具可读性，所以在这里加很多…过度符……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity Study">
<meta property="og:url" content="http://tonytang1990.github.io/2015/07/15/Unity-Study/index.html">
<meta property="og:site_name" content="走停人生路">
<meta property="og:description" content="Unity Introduction因为后期发现目录越来越长导致前面的一些代码模块不具可读性，所以在这里加很多…过度符……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Roll_A_Ball_Game_Play.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Roll_A_Ball_Game_Win.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Space_Shooter_Game_Play.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Space_Shooter_Game_Win.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Survival_Shooter_Game.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/2DRogueLike_Game_Start.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/2DRogueLike_Game_Play.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/2DRogueLike_Game_Lose.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Mono.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IL2CPP.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/CSharp/ValueTypeComparerForDictionary.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/CSharp/EmitStudy.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ProtocolBufferMessageValueType.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ProtobufSerializerSerialize.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ProtobufSerializerWrite.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UnityShaderFundamention.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UnityShaderProperty.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderFlowChart.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithAlbedoSetting.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithTexture.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderMaterialEditorWithTexture.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithNormalMap.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithTexture.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithEmssion.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithNegativeExtrusion.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithPositiveExtrusion.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SurfaceShaderWithFinalColorFunction.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ExcelReaderDLL.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AccountPasswordAndGameSettingSheet1.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AccountPasswordAndGameSettingSheet2.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ExcelReaderOutput.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/NGUIUIHierachy.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SpriteControlPanel.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIDrawCall.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/LabelFont.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UICameraPanel.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIEventCall.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/OnSliderChangeBegin.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/OnSliderChangeEnd.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/CheckBoxWithWrongAnswer.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/CheckBoxWithCorrectAnswer.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/InputUsing.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/3DUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AtlasMaker.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIAtlas.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/BMFontMakerFontSetting.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/BMFontExportOptions.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/MyAtlasFont.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/DynamicFont.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/FontMakerProcess.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/LoginScene.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/1024Multiple768.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/800Multiple800.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/960Multiple640.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIRootPanel.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/1024Multiple768SelfAdaption.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/800Multiple800SelfAdaption.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/960Multiple640SelfAdaption.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/960Multiple640BaseOnWidth.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/DOTweenSetting.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Perssistence_PlayerPrefs_Serialization.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorWindow_ScriptableObject.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Unity_Coroutine_LifeTime.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Unity_Coroutine_LifeTime_Monobehaviour.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Coroutine_Study.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ForEachCall.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ForCall.PNG">
<meta property="og:updated_time" content="2016-09-11T10:36:20.344Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity Study">
<meta name="twitter:description" content="Unity Introduction因为后期发现目录越来越长导致前面的一些代码模块不具可读性，所以在这里加很多…过度符……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………………………………..……………………">

    
    <link rel="alternative" href="/atom.xml" title="走停人生路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="走停人生路" title="走停人生路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="走停人生路">走停人生路</a></h1>
				<h2 class="blog-motto">有时候不是习惯了一个人，而是在没有认可自己之前选择了一个人</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:tonytang1990.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/15/Unity-Study/" title="Unity Study" itemprop="url">Unity Study</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Tony Tang" target="_blank" itemprop="author">Tony Tang</a>
		
  <p class="article-time">
    <time datetime="2015-07-15T15:48:26.000Z" itemprop="datePublished"> 發表於 2015-07-15</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity_Introduction"><span class="toc-number">1.</span> <span class="toc-text">Unity Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What_is_Unity?"><span class="toc-number">1.1.</span> <span class="toc-text">What is Unity?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why_should_we_study_Unity?"><span class="toc-number">1.2.</span> <span class="toc-text">Why should we study Unity?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Which_programming_language_are_we_using?"><span class="toc-number">1.3.</span> <span class="toc-text">Which programming language are we using?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity_Tutorial_Study"><span class="toc-number">2.</span> <span class="toc-text">Unity Tutorial Study</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ROLL-A-BALL"><span class="toc-number">2.1.</span> <span class="toc-text">ROLL-A-BALL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPACE_SHOOTER"><span class="toc-number">2.2.</span> <span class="toc-text">SPACE SHOOTER</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2D-ROGUELIKE-TUTORIAL"><span class="toc-number">2.3.</span> <span class="toc-text">2D-ROGUELIKE-TUTORIAL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编辑器界面"><span class="toc-number">3.</span> <span class="toc-text">编辑器界面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#工具"><span class="toc-number">4.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MonoDevelop"><span class="toc-number">4.1.</span> <span class="toc-text">MonoDevelop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ILSpy"><span class="toc-number">4.2.</span> <span class="toc-text">ILSpy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ildasm(安装VS自带的工具)"><span class="toc-number">4.3.</span> <span class="toc-text">ildasm(安装VS自带的工具)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blender"><span class="toc-number">4.4.</span> <span class="toc-text">Blender</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VSTU"><span class="toc-number">4.5.</span> <span class="toc-text">VSTU</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#相关概念学习"><span class="toc-number">5.</span> <span class="toc-text">相关概念学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity_Engine"><span class="toc-number">5.1.</span> <span class="toc-text">Unity Engine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C_Sharp"><span class="toc-number">5.1.1.</span> <span class="toc-text">C Sharp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mono"><span class="toc-number">5.1.2.</span> <span class="toc-text">Mono</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IL2CPP"><span class="toc-number">5.1.3.</span> <span class="toc-text">IL2CPP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Why_do_we_need_IL2CPP?"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">Why do we need IL2CPP?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IL2CPP_Components"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">IL2CPP Components</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mono_and_IL2CPP_compile_and_execution_process"><span class="toc-number">5.1.3.3.</span> <span class="toc-text">Mono and IL2CPP compile and execution process</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOT_&_JIT"><span class="toc-number">5.1.4.</span> <span class="toc-text">AOT & JIT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOT"><span class="toc-number">5.1.4.1.</span> <span class="toc-text">AOT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JIT"><span class="toc-number">5.1.4.2.</span> <span class="toc-text">JIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IOS_AOT_Limitations"><span class="toc-number">5.1.4.3.</span> <span class="toc-text">IOS AOT Limitations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Protocol_Buffers"><span class="toc-number">5.1.4.4.</span> <span class="toc-text">Protocol Buffers</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity_Using"><span class="toc-number">5.2.</span> <span class="toc-text">Unity Using</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#快捷键学习"><span class="toc-number">6.</span> <span class="toc-text">快捷键学习</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#项目编译发布"><span class="toc-number">7.</span> <span class="toc-text">项目编译发布</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PC"><span class="toc-number">7.1.</span> <span class="toc-text">PC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOS"><span class="toc-number">7.2.</span> <span class="toc-text">IOS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Native_Code_Compilation"><span class="toc-number">7.2.1.</span> <span class="toc-text">Native Code Compilation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prepare_XCode_Project"><span class="toc-number">7.2.2.</span> <span class="toc-text">Prepare XCode Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compile_XCode_Project"><span class="toc-number">7.2.3.</span> <span class="toc-text">Compile XCode Project</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#版块学习"><span class="toc-number">8.</span> <span class="toc-text">版块学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UGUI"><span class="toc-number">8.1.</span> <span class="toc-text">UGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Canvas"><span class="toc-number">8.1.1.</span> <span class="toc-text">Canvas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shader"><span class="toc-number">8.2.</span> <span class="toc-text">Shader</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Surface_Shaders"><span class="toc-number">8.2.1.</span> <span class="toc-text">Surface Shaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vertex_and_Fragment_Shaders"><span class="toc-number">8.2.2.</span> <span class="toc-text">Vertex and Fragment Shaders</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Excel数据读取"><span class="toc-number">8.3.</span> <span class="toc-text">Excel数据读取</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Plugins"><span class="toc-number">9.</span> <span class="toc-text">Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NGUI"><span class="toc-number">9.1.</span> <span class="toc-text">NGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tutorials"><span class="toc-number">9.1.1.</span> <span class="toc-text">Tutorials</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Creating_Your_UI"><span class="toc-number">9.1.1.1.</span> <span class="toc-text">Creating Your UI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sprite"><span class="toc-number">9.1.1.2.</span> <span class="toc-text">Sprite</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-Sliced_Sprite"><span class="toc-number">9.1.1.2.1.</span> <span class="toc-text">9-Sliced Sprite</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Tiled_Sprite"><span class="toc-number">9.1.1.2.2.</span> <span class="toc-text">Tiled Sprite</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Label"><span class="toc-number">9.1.1.3.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Button"><span class="toc-number">9.1.1.4.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slider"><span class="toc-number">9.1.1.5.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Checkbox"><span class="toc-number">9.1.1.6.</span> <span class="toc-text">Checkbox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Input"><span class="toc-number">9.1.1.7.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3D"><span class="toc-number">9.1.1.8.</span> <span class="toc-text">3D</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Atlas_Maker"><span class="toc-number">9.1.1.9.</span> <span class="toc-text">Atlas Maker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Font_Maker"><span class="toc-number">9.1.1.10.</span> <span class="toc-text">Font Maker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NGUI_2-7屏幕自适应"><span class="toc-number">9.1.1.11.</span> <span class="toc-text">NGUI 2.7屏幕自适应</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOTween"><span class="toc-number">9.2.</span> <span class="toc-text">DOTween</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween_Instroduction"><span class="toc-number">9.2.1.</span> <span class="toc-text">DOTween Instroduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween_Install"><span class="toc-number">9.2.2.</span> <span class="toc-text">DOTween Install</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween_Nomenclature_and_Prefixes"><span class="toc-number">9.2.3.</span> <span class="toc-text">DOTween Nomenclature and Prefixes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween使用学习"><span class="toc-number">9.2.4.</span> <span class="toc-text">DOTween使用学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2DToolkit"><span class="toc-number">9.3.</span> <span class="toc-text">2DToolkit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C#脚本"><span class="toc-number">10.</span> <span class="toc-text">C#脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Persistence_-_Saving_and_Loading_Data"><span class="toc-number">10.1.</span> <span class="toc-text">Persistence - Saving and Loading Data</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PlayerPrefs"><span class="toc-number">10.1.1.</span> <span class="toc-text">PlayerPrefs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seralization"><span class="toc-number">10.1.2.</span> <span class="toc-text">Seralization</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#What_is_seralization?"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">What is seralization?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C#_Serialization"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">C# Serialization</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity_Editor_Window,_Menu_Item_&_ScriptableObject"><span class="toc-number">10.1.3.</span> <span class="toc-text">Unity Editor Window, Menu Item & ScriptableObject</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Coroutine"><span class="toc-number">10.2.</span> <span class="toc-text">Coroutine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Why_are_we_using_coroutines?"><span class="toc-number">10.2.1.</span> <span class="toc-text">Why are we using coroutines?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What_is_a_coroutine?"><span class="toc-number">10.2.2.</span> <span class="toc-text">What is a coroutine?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How_long_is_the_life_cycle?_&_When_does_coroutine_get_called?"><span class="toc-number">10.2.3.</span> <span class="toc-text">How long is the life cycle? & When does coroutine get called?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How_to_stop_coroutines?"><span class="toc-number">10.2.4.</span> <span class="toc-text">How to stop coroutines?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Go_depth_in_Coroutine"><span class="toc-number">10.2.5.</span> <span class="toc-text">Go depth in Coroutine</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity优化注意事项"><span class="toc-number">11.</span> <span class="toc-text">Unity优化注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Code"><span class="toc-number">11.1.</span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Use_For_or_while_instead_of_foreach"><span class="toc-number">11.1.1.</span> <span class="toc-text">Use For or while instead of foreach</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rendering"><span class="toc-number">11.2.</span> <span class="toc-text">Rendering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Physic"><span class="toc-number">11.3.</span> <span class="toc-text">Physic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Close_Unnecessary_Collision"><span class="toc-number">11.3.1.</span> <span class="toc-text">Close Unnecessary Collision</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory"><span class="toc-number">11.4.</span> <span class="toc-text">Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Avoid_Uneccessary_GC"><span class="toc-number">11.4.1.</span> <span class="toc-text">Avoid Uneccessary GC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C#学习"><span class="toc-number">12.</span> <span class="toc-text">C#学习</span></a></li></ol>
		
		</div>
		
		<h1 id="Unity_Introduction">Unity Introduction</h1><p>因为后期发现目录越来越长导致前面的一些代码模块不具可读性，所以在这里加很多…过度符<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..<br>……………………………………………..</p>
<h2 id="What_is_Unity?">What is Unity?</h2><p>Unity is a cross-platform game engine developed by Unity Technologies and used to develop video games for PC, consoles, mobile devices and websites. First released on June 8, 2005<br>(<a href="https://en.wikipedia.org/wiki/Unity_(game_engine" target="_blank" rel="external">from wiki</a>))</p>
<h2 id="Why_should_we_study_Unity?">Why should we study Unity?</h2><ol>
<li>Cross-platform</li>
<li>Free</li>
<li>Complete SDK documentation</li>
<li>Many free assets</li>
</ol>
<h2 id="Which_programming_language_are_we_using?">Which programming language are we using?</h2><ol>
<li>C# (推荐入门书籍《C#入门经典》，进阶书籍《CLR via C#》)</li>
<li>Javascript</li>
<li>Boo</li>
</ol>
<h1 id="Unity_Tutorial_Study">Unity Tutorial Study</h1><p>Website: <a href="https://unity3d.com/learn/tutorials" target="_blank" rel="external">Unity Tutorials</a></p>
<h2 id="ROLL-A-BALL">ROLL-A-BALL</h2><p><strong>Game Introduction</strong><br>控制小球移动收集场景里的方块，UI会显示当前收集的方块数量，当所有方块通过碰撞收集后游戏UI提示You Win</p>
<p><strong>Code</strong><br>PlayerController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Speed;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Text m_CountText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Text m_WinText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Rigidbody m_RB;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> m_Count;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_RB = GetComponent&lt;Rigidbody&gt; ();</span><br><span class="line">		m_Count = <span class="number">0</span>;</span><br><span class="line">		SetCountText();</span><br><span class="line">		m_WinText.text = <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">float</span> moveHorizontal = Input.GetAxis (<span class="string">"Horizontal"</span>);</span><br><span class="line">		<span class="keyword">float</span> moveVertical = Input.GetAxis (<span class="string">"Vertical"</span>);</span><br><span class="line"></span><br><span class="line">		Vector3 movement = <span class="keyword">new</span> Vector3(moveHorizontal, <span class="number">0.0</span>f, moveVertical);</span><br><span class="line">		m_RB.AddForce (movement * m_Speed);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnTriggerEnter</span>(<span class="params">Collider other</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (other.gameObject.CompareTag (<span class="string">"Pickup"</span>)) </span><br><span class="line">		&#123;</span><br><span class="line">			other.gameObject.SetActive(<span class="keyword">false</span>);</span><br><span class="line">			m_Count++;</span><br><span class="line">			SetCountText();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetCountText</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_CountText.text = <span class="string">"Count: "</span> + m_Count.ToString();</span><br><span class="line">		<span class="keyword">if</span> (m_Count &gt;= <span class="number">12</span>) </span><br><span class="line">		&#123;</span><br><span class="line">			m_WinText.text = <span class="string">"You Win!"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CameraController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CameraController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> GameObject m_Player;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Vector3 m_Offset;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		m_Offset = transform.position - m_Player.transform.position;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">LateUpdate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		transform.position = m_Player.transform.position + m_Offset;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Rotator.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Rotator</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		transform.Rotate (<span class="keyword">new</span> Vector3 (<span class="number">15</span>, <span class="number">35</span>, <span class="number">45</span>) * Time.deltaTime);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Captures</strong><br><em>Game Play</em><br><img src="/img/Unity/Roll_A_Ball_Game_Play.PNG" alt="Roll_A_Ball_Game_Play"><br><em>Win Game</em><br><img src="/img/Unity/Roll_A_Ball_Game_Win.PNG" alt="Roll_A_Ball_Game_Win"></p>
<h2 id="SPACE_SHOOTER">SPACE SHOOTER</h2><p><strong>Game Introduction</strong><br>Top Down Game<br>好比全民打飞机</p>
<p><strong>Code</strong><br>ShipController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line">[System.Serializable]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Boundary</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_MinX,m_MaxX,m_MinZ,m_MaxZ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ShipController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Speed = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Tilt = <span class="number">4</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> fireRate = <span class="number">0.5</span>F;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> nextFire = <span class="number">0.0</span>F;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Boundary m_Boundary;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> GameObject m_Shot;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Transform m_ShotSpawn;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> AudioSource m_FireAudio;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Rigidbody m_ShipRB;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> GameController m_GameController;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		m_ShipRB = GetComponent&lt;Rigidbody&gt; ();</span><br><span class="line">		m_FireAudio = GetComponent&lt;AudioSource&gt; ();</span><br><span class="line">		GameObject gamecontrollerobject = GameObject.FindGameObjectWithTag (<span class="string">"GameController"</span>);</span><br><span class="line">		<span class="keyword">if</span> (gamecontrollerobject != <span class="keyword">null</span>) &#123;</span><br><span class="line">			m_GameController = gamecontrollerobject.GetComponent&lt;GameController&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (m_GameController == <span class="keyword">null</span>) &#123;</span><br><span class="line">			Debug.Log(<span class="string">"m_GameController == null in ShipController::Start()"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (Input.GetKey(KeyCode.J) &amp;&amp; Time.time &gt; nextFire) &#123;</span><br><span class="line">			nextFire = Time.time + fireRate;</span><br><span class="line">			GameObject clone = Instantiate (m_Shot, m_ShotSpawn.position, m_ShotSpawn.rotation) <span class="keyword">as</span> GameObject;</span><br><span class="line">			m_FireAudio.Play();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!m_GameController.IsGameEnd ()) &#123;</span><br><span class="line">			<span class="keyword">float</span> moveHorizontal = Input.GetAxis (<span class="string">"Horizontal"</span>);</span><br><span class="line">			<span class="keyword">float</span> moveVertical = Input.GetAxis (<span class="string">"Vertical"</span>);</span><br><span class="line">			Vector3 movement = <span class="keyword">new</span> Vector3 (moveHorizontal, <span class="number">0.0</span>f, moveVertical);</span><br><span class="line">			m_ShipRB.velocity = movement * m_Speed;</span><br><span class="line"></span><br><span class="line">			m_ShipRB.position = <span class="keyword">new</span> Vector3 (</span><br><span class="line">				Mathf.Clamp (m_ShipRB.position.x, m_Boundary.m_MinX, m_Boundary.m_MaxX),</span><br><span class="line">				<span class="number">0.0</span>f,</span><br><span class="line">				Mathf.Clamp (m_ShipRB.position.z, m_Boundary.m_MinZ, m_Boundary.m_MaxZ)</span><br><span class="line">			);</span><br><span class="line">			m_ShipRB.rotation = Quaternion.Euler (<span class="number">0.0</span>f, <span class="number">0.0</span>f, -m_ShipRB.velocity.x * m_Tilt);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			m_ShipRB.rotation = Quaternion.Euler(<span class="number">0.0</span>f,<span class="number">0.0</span>f,<span class="number">0.0</span>f);</span><br><span class="line">			m_ShipRB.velocity = <span class="keyword">new</span> Vector3(<span class="number">0.0</span>f,<span class="number">0.0</span>f,<span class="number">0.0</span>f);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>GameController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> GameObject m_Hazard;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Vector3 m_SpawnValue = <span class="keyword">new</span> Vector3(<span class="number">5.5</span>f,<span class="number">0.0</span>f,<span class="number">8.0</span>f);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> m_HazardCount = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_SpawnWait = <span class="number">1.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_StartWait = <span class="number">3.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_WaveWait = <span class="number">4.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Text m_ScoreText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Text m_WinText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Button m_RestartButton;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> m_WinningScore = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> m_Score = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> m_IsGameEnd = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> m_RestartGame = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> AudioSource m_BackgroundAudio;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		StartCoroutine (SpawnAsteriod());</span><br><span class="line">		UpdateScore ();</span><br><span class="line">		m_WinText.text = <span class="string">""</span>;</span><br><span class="line">		m_RestartButton.gameObject.SetActive (<span class="keyword">false</span>);</span><br><span class="line">		m_RestartButton.onClick.AddListener (RestartGame);</span><br><span class="line">		m_BackgroundAudio = GetComponent&lt;AudioSource&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (m_RestartGame) &#123;</span><br><span class="line">			Debug.Log(<span class="string">"Restart Game Now"</span>);</span><br><span class="line">			Application.LoadLevel(Application.loadedLevel);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsGameEnd</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> m_IsGameEnd;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RestartGame</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Debug.Log(<span class="string">"Restart Button clicked"</span>);</span><br><span class="line">		m_RestartGame = <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">IEnumerator <span class="title">SpawnAsteriod</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span> (<span class="params">m_StartWait</span>)</span>;</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_HazardCount; i++) &#123;</span><br><span class="line">				Vector3 spawnposition =  <span class="keyword">new</span> Vector3 (Random.Range (-m_SpawnValue.x, m_SpawnValue.x), <span class="number">0.0</span>f, m_SpawnValue.z);</span><br><span class="line">				Quaternion spawnrotation = Quaternion.identity;</span><br><span class="line">				Instantiate(m_Hazard,spawnposition,spawnrotation);</span><br><span class="line">				<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span> (<span class="params">m_SpawnWait</span>)</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span> (<span class="params">m_WaveWait</span>)</span>;</span><br><span class="line">			<span class="keyword">if</span>(m_IsGameEnd)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddScore</span>(<span class="params"><span class="keyword">int</span> score</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_Score += score;</span><br><span class="line">		UpdateScore ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UpdateScore</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_ScoreText.text = <span class="string">"Score: "</span> + m_Score;</span><br><span class="line">		<span class="keyword">if</span> (m_Score &gt;= m_WinningScore) &#123;</span><br><span class="line">			m_WinText.text = <span class="string">"Congratulation! You Win"</span>;</span><br><span class="line">			m_IsGameEnd = <span class="keyword">true</span>;</span><br><span class="line">			m_RestartButton.gameObject.SetActive (<span class="keyword">true</span>);</span><br><span class="line">			m_BackgroundAudio.Stop();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DestroyByContact.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DestroyByContact</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> GameObject m_ExplosionObject;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> GameObject m_PlayerExplosionObject;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> GameController m_GameController;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> m_ScoreValue = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		GameObject gamecontrollerobject = GameObject.FindGameObjectWithTag (<span class="string">"GameController"</span>);</span><br><span class="line">		<span class="keyword">if</span> (gamecontrollerobject != <span class="keyword">null</span>) &#123;</span><br><span class="line">			m_GameController = gamecontrollerobject.GetComponent&lt;GameController&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (m_GameController == <span class="keyword">null</span>) &#123;</span><br><span class="line">			Debug.Log(<span class="string">"m_GameController == null"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnTriggerEnter</span>(<span class="params">Collider other</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (other.tag == <span class="string">"Boundary"</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		Debug.Log (<span class="string">"other.tag = "</span> + other.tag);</span><br><span class="line"></span><br><span class="line">		Instantiate (m_ExplosionObject, transform.position, transform.rotation);</span><br><span class="line">		<span class="keyword">if</span> (other.tag == <span class="string">"Player"</span>) &#123;</span><br><span class="line">			Instantiate (m_PlayerExplosionObject, other.transform.position, other.transform.rotation);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (other.tag == <span class="string">"Bullet"</span>) &#123;</span><br><span class="line">			Debug.Log(<span class="string">"Asteriod is destroied by Bullet"</span>);</span><br><span class="line">			m_GameController.AddScore(m_ScoreValue);</span><br><span class="line">		&#125;</span><br><span class="line">		Destroy(other.gameObject);</span><br><span class="line">		Destroy (gameObject);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DestroyByTime.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DestroyByTime</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_LifeTime = <span class="number">5.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		Destroy (gameObject,m_LifeTime);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>GameBoundary.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameBoundary</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnTriggerExit</span>(<span class="params">Collider other</span>) </span>&#123;</span><br><span class="line">		Destroy(other.gameObject);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Mover.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Mover</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Speed = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Rigidbody m_RigidBody;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> GameController m_GameController;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		m_RigidBody = GetComponent&lt;Rigidbody&gt; ();</span><br><span class="line">		m_RigidBody.velocity = transform.forward * m_Speed;</span><br><span class="line">		GameObject gamecontrollerobject = GameObject.FindGameObjectWithTag (<span class="string">"GameController"</span>);</span><br><span class="line">		<span class="keyword">if</span> (gamecontrollerobject != <span class="keyword">null</span>) &#123;</span><br><span class="line">			m_GameController = gamecontrollerobject.GetComponent&lt;GameController&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (m_GameController == <span class="keyword">null</span>) &#123;</span><br><span class="line">			Debug.Log(<span class="string">"m_GameController == null in ShipController::Start()"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (m_GameController.IsGameEnd ()) </span><br><span class="line">		&#123;</span><br><span class="line">			m_RigidBody.rotation = Quaternion.Euler(<span class="number">0.0</span>f,<span class="number">0.0</span>f,<span class="number">0.0</span>f);</span><br><span class="line">			m_RigidBody.velocity = <span class="keyword">new</span> Vector3(<span class="number">0.0</span>f,<span class="number">0.0</span>f,<span class="number">0.0</span>f);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>RandomRotator.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RandomRotator</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Tumble = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Rigidbody m_Rigidbody;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		m_Rigidbody = GetComponent&lt;Rigidbody&gt; ();</span><br><span class="line">		m_Rigidbody.angularVelocity = Random.insideUnitSphere * m_Tumble;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Captures</strong><br><em>Game Play</em><br><img src="/img/Unity/Space_Shooter_Game_Play.PNG" alt="Space_Shooter_Game_Play"><br><em>Win Game</em><br><img src="/img/Unity/Space_Shooter_Game_Win.PNG" alt="Space_Shooter_Game_Win"></p>
<p>Survival Shooter<br><strong>Game Introduction</strong><br>固定(2.5D — isometric projection)第三人称视角游戏</p>
<p><strong>Code</strong><br>CameraFollow.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CameraFollow</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Transform m_Target;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Smoothing = <span class="number">5.0</span>f;</span><br><span class="line"></span><br><span class="line">	Vector3 m_Offset;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		m_Offset = transform.position - m_Target.position;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		Vector3 targetCamPos = m_Target.position + m_Offset;</span><br><span class="line">		transform.position = Vector3.Lerp (transform.position, targetCamPos, m_Smoothing * Time.deltaTime);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>PlayerShooting.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerShooting</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> damagePerShot = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> timeBetweenBullets = <span class="number">0.15</span>f;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> range = <span class="number">100</span>f;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> timer;</span><br><span class="line">    Ray shootRay;</span><br><span class="line">    RaycastHit shootHit;</span><br><span class="line">    <span class="keyword">int</span> shootableMask;</span><br><span class="line">    ParticleSystem gunParticles;</span><br><span class="line">    LineRenderer gunLine;</span><br><span class="line">    AudioSource gunAudio;</span><br><span class="line">    Light gunLight;</span><br><span class="line">    <span class="keyword">float</span> effectsDisplayTime = <span class="number">0.2</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        shootableMask = LayerMask.GetMask (<span class="string">"Shootable"</span>);</span><br><span class="line">        gunParticles = GetComponent&lt;ParticleSystem&gt; ();</span><br><span class="line">        gunLine = GetComponent &lt;LineRenderer&gt; ();</span><br><span class="line">        gunAudio = GetComponent&lt;AudioSource&gt; ();</span><br><span class="line">        gunLight = GetComponent&lt;Light&gt; ();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        timer += Time.deltaTime;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(Input.GetButton (<span class="string">"Fire1"</span>) &amp;&amp; timer &gt;= timeBetweenBullets &amp;&amp; Time.timeScale != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Shoot ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(timer &gt;= timeBetweenBullets * effectsDisplayTime)</span><br><span class="line">        &#123;</span><br><span class="line">            DisableEffects ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DisableEffects</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        gunLine.enabled = <span class="keyword">false</span>;</span><br><span class="line">        gunLight.enabled = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Shoot</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        timer = <span class="number">0</span>f;</span><br><span class="line"></span><br><span class="line">        gunAudio.Play ();</span><br><span class="line"></span><br><span class="line">        gunLight.enabled = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        gunParticles.Stop ();</span><br><span class="line">        gunParticles.Play ();</span><br><span class="line"></span><br><span class="line">        gunLine.enabled = <span class="keyword">true</span>;</span><br><span class="line">        gunLine.SetPosition (<span class="number">0</span>, transform.position);</span><br><span class="line"></span><br><span class="line">        shootRay.origin = transform.position;</span><br><span class="line">        shootRay.direction = transform.forward;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Physics.Raycast (shootRay, <span class="keyword">out</span> shootHit, range, shootableMask))</span><br><span class="line">        &#123;</span><br><span class="line">            EnemyHealth enemyHealth = shootHit.collider.GetComponent &lt;EnemyHealth&gt; ();</span><br><span class="line">			Debug.Log(<span class="string">"Shootting"</span>);</span><br><span class="line">			Debug.Log(<span class="string">"shootHit.collider.name = "</span> + shootHit.collider.name);</span><br><span class="line">			<span class="keyword">if</span>(enemyHealth != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">				Debug.Log(<span class="string">"enermyHealth != null"</span>);</span><br><span class="line">                enemyHealth.TakeDamage (damagePerShot, shootHit.point);</span><br><span class="line">            &#125;</span><br><span class="line">            gunLine.SetPosition (<span class="number">1</span>, shootHit.point);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">			Debug.Log(<span class="string">"Not shot"</span>);</span><br><span class="line">            gunLine.SetPosition (<span class="number">1</span>, shootRay.origin + shootRay.direction * range);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>PlayerMovement.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerMovement</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> m_Speed = <span class="number">6.0</span>f;</span><br><span class="line"></span><br><span class="line">	Vector3 m_Movement;</span><br><span class="line"></span><br><span class="line">	Animator m_Anim;</span><br><span class="line"></span><br><span class="line">	Rigidbody m_PlayerRigidbody;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> m_FloorMask;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">float</span> m_CamRayLength = <span class="number">100.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_FloorMask = LayerMask.GetMask (<span class="string">"Floor"</span>);</span><br><span class="line"></span><br><span class="line">		m_Anim = GetComponent&lt;Animator&gt; ();</span><br><span class="line"></span><br><span class="line">		m_PlayerRigidbody = GetComponent&lt;Rigidbody&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">float</span> h = Input.GetAxisRaw (<span class="string">"Horizontal"</span>);</span><br><span class="line">		<span class="keyword">float</span> v = Input.GetAxisRaw (<span class="string">"Vertical"</span>);</span><br><span class="line"></span><br><span class="line">		Move (h, v);</span><br><span class="line">		Turning ();</span><br><span class="line">		Animating(h,v);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Move</span>(<span class="params"><span class="keyword">float</span> h, <span class="keyword">float</span> v</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_Movement.Set (h, <span class="number">0.0</span>f, v);</span><br><span class="line">		m_Movement = m_Movement.normalized * m_Speed * Time.deltaTime;</span><br><span class="line">		m_PlayerRigidbody.MovePosition (transform.position + m_Movement);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Turning</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Ray camRay = Camera.main.ScreenPointToRay (Input.mousePosition);</span><br><span class="line"></span><br><span class="line">		RaycastHit floorHit;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(Physics.Raycast(camRay,<span class="keyword">out</span> floorHit,m_CamRayLength, m_FloorMask))</span><br><span class="line">	   &#123;</span><br><span class="line">		Vector3 playerToMouse = floorHit.point - transform.position;</span><br><span class="line">		playerToMouse.y = <span class="number">0.0</span>f;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		Quaternion newRotation = Quaternion.LookRotation(playerToMouse);</span><br><span class="line">		m_PlayerRigidbody.MoveRotation(newRotation);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Animating</span>(<span class="params"><span class="keyword">float</span> h, <span class="keyword">float</span> v</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">bool</span> walking = (h != <span class="number">0.0</span>f || v != <span class="number">0.0</span>f);</span><br><span class="line">		m_Anim.SetBool (<span class="string">"IsWalking"</span>, walking);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>PlayerHealth.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerHealth</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> startingHealth = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> currentHealth;</span><br><span class="line">    <span class="keyword">public</span> Slider healthSlider;</span><br><span class="line">    <span class="keyword">public</span> Image damageImage;</span><br><span class="line">    <span class="keyword">public</span> AudioClip deathClip;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> flashSpeed = <span class="number">5</span>f;</span><br><span class="line">    <span class="keyword">public</span> Color flashColour = <span class="keyword">new</span> Color(<span class="number">1</span>f, <span class="number">0</span>f, <span class="number">0</span>f, <span class="number">0.1</span>f);</span><br><span class="line"></span><br><span class="line">    Animator anim;</span><br><span class="line">    AudioSource playerAudio;</span><br><span class="line">    PlayerMovement playerMovement;</span><br><span class="line">    <span class="comment">//PlayerShooting playerShooting;</span></span><br><span class="line">    <span class="keyword">bool</span> isDead;</span><br><span class="line">    <span class="keyword">bool</span> damaged;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        anim = GetComponent &lt;Animator&gt; ();</span><br><span class="line">        playerAudio = GetComponent &lt;AudioSource&gt; ();</span><br><span class="line">        playerMovement = GetComponent &lt;PlayerMovement&gt; ();</span><br><span class="line">        <span class="comment">//playerShooting = GetComponentInChildren &lt;PlayerShooting&gt; ();</span></span><br><span class="line">        currentHealth = startingHealth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(damaged)</span><br><span class="line">        &#123;</span><br><span class="line">            damageImage.color = flashColour;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            damageImage.color = Color.Lerp (damageImage.color, Color.clear, flashSpeed * Time.deltaTime);</span><br><span class="line">        &#125;</span><br><span class="line">        damaged = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TakeDamage</span> (<span class="params"><span class="keyword">int</span> amount</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        damaged = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        currentHealth -= amount;</span><br><span class="line"></span><br><span class="line">        healthSlider.<span class="keyword">value</span> = currentHealth;</span><br><span class="line"></span><br><span class="line">        playerAudio.Play ();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currentHealth &lt;= <span class="number">0</span> &amp;&amp; !isDead)</span><br><span class="line">        &#123;</span><br><span class="line">            Death ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Death</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        isDead = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//playerShooting.DisableEffects ();</span></span><br><span class="line"></span><br><span class="line">        anim.SetTrigger (<span class="string">"Die"</span>);</span><br><span class="line"></span><br><span class="line">        playerAudio.clip = deathClip;</span><br><span class="line">        playerAudio.Play ();</span><br><span class="line"></span><br><span class="line">        playerMovement.enabled = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//playerShooting.enabled = false;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RestartLevel</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Application.LoadLevel (Application.loadedLevel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EnemyMovement.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnemyMovement</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    Transform player;</span><br><span class="line">    PlayerHealth playerHealth;</span><br><span class="line">    EnemyHealth enemyHealth;</span><br><span class="line">    NavMeshAgent nav;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        player = GameObject.FindGameObjectWithTag (<span class="string">"Player"</span>).transform;</span><br><span class="line">        playerHealth = player.GetComponent &lt;PlayerHealth&gt; ();</span><br><span class="line">        enemyHealth = GetComponent &lt;EnemyHealth&gt; ();</span><br><span class="line">        nav = GetComponent &lt;NavMeshAgent&gt; ();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(enemyHealth.currentHealth &gt; <span class="number">0</span> &amp;&amp; playerHealth.currentHealth &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            nav.SetDestination (player.position);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            nav.enabled = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EnemyHealth.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnemyHealth</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> startingHealth = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> currentHealth;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> sinkSpeed = <span class="number">2.5</span>f;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> scoreValue = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> AudioClip deathClip;</span><br><span class="line"></span><br><span class="line">    Animator anim;</span><br><span class="line">    AudioSource enemyAudio;</span><br><span class="line">    ParticleSystem hitParticles;</span><br><span class="line">    CapsuleCollider capsuleCollider;</span><br><span class="line">    <span class="keyword">bool</span> isDead;</span><br><span class="line">    <span class="keyword">bool</span> isSinking;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        anim = GetComponent &lt;Animator&gt; ();</span><br><span class="line">        enemyAudio = GetComponent &lt;AudioSource&gt; ();</span><br><span class="line">        hitParticles = GetComponentInChildren &lt;ParticleSystem&gt; ();</span><br><span class="line">        capsuleCollider = GetComponent &lt;CapsuleCollider&gt; ();</span><br><span class="line"></span><br><span class="line">        currentHealth = startingHealth;</span><br><span class="line">		isDead = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isSinking)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.Translate (-Vector3.up * sinkSpeed * Time.deltaTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TakeDamage</span> (<span class="params"><span class="keyword">int</span> amount, Vector3 hitPoint</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">		Debug.Log (<span class="string">"isDead = "</span> + isDead);</span><br><span class="line">        <span class="keyword">if</span>(isDead)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        enemyAudio.Play ();</span><br><span class="line"></span><br><span class="line">        currentHealth -= amount;</span><br><span class="line">            </span><br><span class="line">        hitParticles.transform.position = hitPoint;</span><br><span class="line">        hitParticles.Play();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(currentHealth &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Death ();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Death</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        isDead = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        capsuleCollider.isTrigger = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        anim.SetTrigger (<span class="string">"Dead"</span>);</span><br><span class="line"></span><br><span class="line">        enemyAudio.clip = deathClip;</span><br><span class="line">        enemyAudio.Play ();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartSinking</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        GetComponent &lt;NavMeshAgent&gt; ().enabled = <span class="keyword">false</span>;</span><br><span class="line">        GetComponent &lt;Rigidbody&gt; ().isKinematic = <span class="keyword">true</span>;</span><br><span class="line">        isSinking = <span class="keyword">true</span>;</span><br><span class="line">        ScoreManager.score += scoreValue;</span><br><span class="line">        Destroy (gameObject, <span class="number">2</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EnemyAttack.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnemyAttack</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> timeBetweenAttacks = <span class="number">0.5</span>f;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> attackDamage = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> validAttackDistance = <span class="number">1.0</span>f;</span><br><span class="line"></span><br><span class="line">    Animator anim;</span><br><span class="line">    GameObject player;</span><br><span class="line">    PlayerHealth playerHealth;</span><br><span class="line">    EnemyHealth enemyHealth;</span><br><span class="line">    <span class="keyword">bool</span> playerInRange;</span><br><span class="line">    <span class="keyword">float</span> timer;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        player = GameObject.FindGameObjectWithTag (<span class="string">"Player"</span>);</span><br><span class="line">        playerHealth = player.GetComponent &lt;PlayerHealth&gt; ();</span><br><span class="line">        enemyHealth = GetComponent&lt;EnemyHealth&gt;();</span><br><span class="line">        anim = GetComponent &lt;Animator&gt; ();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">    void OnTriggerEnter (Collider other)</span><br><span class="line">    &#123;</span><br><span class="line">        if(other.gameObject == player)</span><br><span class="line">        &#123;</span><br><span class="line">            playerInRange = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void OnTriggerExit (Collider other)</span><br><span class="line">    &#123;</span><br><span class="line">        if(other.gameObject == player)</span><br><span class="line">        &#123;</span><br><span class="line">            playerInRange = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnCollisionEnter</span>(<span class="params">Collision collision</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(collision.gameObject == player)</span><br><span class="line">		&#123;</span><br><span class="line">			playerInRange = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnCollisionExit</span>(<span class="params">Collision collision</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(collision.gameObject == player)</span><br><span class="line">		&#123;</span><br><span class="line">			playerInRange = <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        timer += Time.deltaTime;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(timer &gt;= timeBetweenAttacks &amp;&amp; playerInRange &amp;&amp; enemyHealth.currentHealth &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Attack ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(playerHealth.currentHealth &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            anim.SetTrigger (<span class="string">"PlayerDead"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Attack</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        timer = <span class="number">0</span>f;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(playerHealth.currentHealth &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            playerHealth.TakeDamage (attackDamage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ScoreManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ScoreManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> score;</span><br><span class="line"></span><br><span class="line">    Text text;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        text = GetComponent &lt;Text&gt; ();</span><br><span class="line">        score = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        text.text = <span class="string">"Score: "</span> + score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EnemyManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnemyManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> PlayerHealth playerHealth;</span><br><span class="line">    <span class="keyword">public</span> GameObject enemy;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> spawnTime = <span class="number">3</span>f;</span><br><span class="line">    <span class="keyword">public</span> Transform[] spawnPoints;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        InvokeRepeating (<span class="string">"Spawn"</span>, spawnTime, spawnTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Spawn</span> (<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(playerHealth.currentHealth &lt;= <span class="number">0</span>f)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> spawnPointIndex = Random.Range (<span class="number">0</span>, spawnPoints.Length);</span><br><span class="line"></span><br><span class="line">        Instantiate (enemy, spawnPoints[spawnPointIndex].position, spawnPoints[spawnPointIndex].rotation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>GameOverManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameOverManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> PlayerHealth playerHealth;</span><br><span class="line"></span><br><span class="line">    Animator anim;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        anim = GetComponent&lt;Animator&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">		Debug.Log (<span class="string">"playerHealth.currentHealth = "</span> + playerHealth.currentHealth);</span><br><span class="line">        <span class="keyword">if</span> (playerHealth.currentHealth &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            anim.SetTrigger(<span class="string">"GameOver"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Captures</strong><br><em>Game(因为一些原因没有截图)</em><br><img src="/img/Unity/Survival_Shooter_Game.PNG" alt="Survival_Shooter_Game"><br><a href="https://unity3d.com/learn/tutorials/projects/survival-shooter-project" target="_blank" rel="external">图片来源</a></p>
<h2 id="2D-ROGUELIKE-TUTORIAL">2D-ROGUELIKE-TUTORIAL</h2><p><strong>Game Introduction</strong><br>Over the course of the project will create procedural tile based levels, implement turn based movement, add a hunger system, audio and mobile touch controls. </p>
<p><strong>Code</strong><br>BoardManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Random = UnityEngine.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BoardManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">	[Serializable]</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Count</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">int</span> minimum;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">int</span> maximum;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Count</span>(<span class="params"><span class="keyword">int</span> min, <span class="keyword">int</span> max</span>)</span><br><span class="line">		</span>&#123;</span><br><span class="line">			minimum = min;</span><br><span class="line">			maximum = max;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> columns = <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> rows = <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">public</span> Count wallCount = <span class="keyword">new</span> Count(<span class="number">5</span>,<span class="number">9</span>);</span><br><span class="line">	<span class="keyword">public</span> Count foodCount = <span class="keyword">new</span> Count(<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="keyword">public</span> GameObject exit;</span><br><span class="line">	<span class="keyword">public</span> GameObject[] floorTiles;</span><br><span class="line">	<span class="keyword">public</span> GameObject[] wallTiles;</span><br><span class="line">	<span class="keyword">public</span> GameObject[] foodTiles;</span><br><span class="line">	<span class="keyword">public</span> GameObject[] enemyTiles;</span><br><span class="line">	<span class="keyword">public</span> GameObject[] outerwallTiles;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Transform boardHolder;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Vector3&gt; gridPositions = <span class="keyword">new</span> List&lt;Vector3&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitialiseList</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		gridPositions.Clear ();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt; columns - <span class="number">1</span>; x++) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> y = <span class="number">1</span>; y &lt; rows - <span class="number">1</span>; y++)</span><br><span class="line">			&#123;</span><br><span class="line">				gridPositions.Add(<span class="keyword">new</span> Vector3(x,y,<span class="number">0</span>f));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BoardSetup</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		boardHolder = <span class="keyword">new</span> GameObject (<span class="string">"Board"</span>).transform;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x = -<span class="number">1</span>; x &lt; columns + <span class="number">1</span>; x++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> y = -<span class="number">1</span>; y &lt; rows + <span class="number">1</span>; y++)</span><br><span class="line">			&#123;</span><br><span class="line">				GameObject toInstantiate = floorTiles[Random.Range (<span class="number">0</span>,floorTiles.Length)];</span><br><span class="line">				<span class="keyword">if</span>(x == -<span class="number">1</span> || x == columns || y == -<span class="number">1</span> || y == rows)</span><br><span class="line">				&#123;</span><br><span class="line">					toInstantiate = outerwallTiles[Random.Range(<span class="number">0</span>,outerwallTiles.Length)];</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				GameObject instance = Instantiate (toInstantiate, <span class="keyword">new</span> Vector3(x,y,<span class="number">0</span>f),Quaternion.identity) <span class="keyword">as</span> GameObject;</span><br><span class="line"></span><br><span class="line">				instance.transform.SetParent(boardHolder);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">Vector3 <span class="title">RandomPosition</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> randomIndex = Random.Range (<span class="number">0</span>, gridPositions.Count);</span><br><span class="line">		Vector3 randomPosition = gridPositions [randomIndex];</span><br><span class="line">		gridPositions.RemoveAt(randomIndex);</span><br><span class="line">		<span class="keyword">return</span> randomPosition;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">LayoutObjectAtRandom</span>(<span class="params">GameObject[] tileArray, <span class="keyword">int</span> minimum, <span class="keyword">int</span> maximum</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> objectCount = Random.Range (minimum, maximum + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objectCount; i++) &#123;</span><br><span class="line">			Vector3 randomPosition = RandomPosition();</span><br><span class="line">			GameObject tileChoice = tileArray[Random.Range (<span class="number">0</span>, tileArray.Length)];</span><br><span class="line">			Instantiate(tileChoice, randomPosition, Quaternion.identity);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetupScene</span>(<span class="params"><span class="keyword">int</span> level</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		BoardSetup ();</span><br><span class="line">		InitialiseList ();</span><br><span class="line">		LayoutObjectAtRandom (wallTiles, wallCount.minimum, wallCount.maximum);</span><br><span class="line">		LayoutObjectAtRandom (foodTiles, foodCount.minimum, foodCount.maximum);</span><br><span class="line">		<span class="keyword">int</span> enemyCount = (<span class="keyword">int</span>)Mathf.Log (level, <span class="number">2</span>f);</span><br><span class="line">		LayoutObjectAtRandom (enemyTiles, enemyCount, enemyCount);</span><br><span class="line">		Instantiate (exit, <span class="keyword">new</span> Vector3 (columns - <span class="number">1</span>, rows - <span class="number">1</span>, <span class="number">0</span>f), Quaternion.identity);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>GameManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> levelStartDelay = <span class="number">2</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> turnDelay = <span class="number">0.1</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> GameManager instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> BoardManager boardScript;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> playerFoodPoints = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">	[HideInInspector]<span class="keyword">public</span> <span class="keyword">bool</span> playerTurn = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Text levelText;</span><br><span class="line">	<span class="keyword">private</span> GameObject levelImage;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> level = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> doingSetup;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> List&lt;Enemy&gt; enemies;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> enemiesMoving;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (instance == <span class="keyword">null</span>) </span><br><span class="line">		&#123;</span><br><span class="line">			instance = <span class="keyword">this</span>;</span><br><span class="line">		&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">instance != <span class="keyword">this</span></span>) </span><br><span class="line">		</span>&#123;</span><br><span class="line">			Destroy (gameObject);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		DontDestroyOnLoad(gameObject);</span><br><span class="line"></span><br><span class="line">		enemies = <span class="keyword">new</span> List&lt;Enemy&gt; ();</span><br><span class="line"></span><br><span class="line">		boardScript = GetComponent&lt;BoardManager&gt; ();</span><br><span class="line">		InitGame ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnLevelWasLoaded</span>(<span class="params"><span class="keyword">int</span> index</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		level++;</span><br><span class="line"></span><br><span class="line">		InitGame ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">InitGame</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		doingSetup = <span class="keyword">true</span>;</span><br><span class="line">		levelImage = GameObject.Find (<span class="string">"LevelImage"</span>);</span><br><span class="line">		levelText = GameObject.Find (<span class="string">"LevelText"</span>).GetComponent&lt;Text&gt; ();</span><br><span class="line">		levelText.text = <span class="string">"Day "</span> + level;</span><br><span class="line">		levelImage.SetActive (<span class="keyword">true</span>);</span><br><span class="line">		Invoke (<span class="string">"HideLevelImage"</span>, levelStartDelay);</span><br><span class="line"></span><br><span class="line">		enemies.Clear ();</span><br><span class="line">		boardScript.SetupScene (level);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HideLevelImage</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		levelImage.SetActive (<span class="keyword">false</span>);</span><br><span class="line">		doingSetup = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GameOver</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		levelText.text = <span class="string">"After "</span> + level + <span class="string">" days, you starved."</span>;</span><br><span class="line">		levelImage.SetActive (<span class="keyword">true</span>);</span><br><span class="line">		enabled = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (playerTurn || enemiesMoving || doingSetup ) &#123;</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		StartCoroutine (MoveEnemies ());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddEnemyToList</span>(<span class="params">Enemy script</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		enemies.Add (script);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">IEnumerator <span class="title">MoveEnemies</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		enemiesMoving = <span class="keyword">true</span>;</span><br><span class="line">		<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">turnDelay</span>)</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (enemies.Count == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">turnDelay</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; enemies.Count; i++) &#123;</span><br><span class="line">			enemies[i].MoveEnemy();</span><br><span class="line">			<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">turnDelay</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Debug.Log (<span class="string">"GameManager::MoveEnemies"</span>);</span><br><span class="line">		playerTurn = <span class="keyword">true</span>;</span><br><span class="line">		enemiesMoving = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MovingObject.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>BoardManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">MovingObject</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> moveTime = <span class="number">0.1</span>f;</span><br><span class="line">	<span class="keyword">public</span> LayerMask blockingLayer;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> BoxCollider2D BoxCollider;</span><br><span class="line">	<span class="keyword">private</span> Rigidbody2D rb2D;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> inverseMoveTime;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		BoxCollider = GetComponent&lt;BoxCollider2D&gt; ();</span><br><span class="line">		rb2D = GetComponent&lt;Rigidbody2D&gt; ();</span><br><span class="line">		inverseMoveTime = <span class="number">1</span>f / moveTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">bool</span> <span class="title">Move</span>(<span class="params"><span class="keyword">int</span> xDir, <span class="keyword">int</span> yDir, <span class="keyword">out</span> RaycastHit2D hit</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Vector2 start = transform.position;</span><br><span class="line">		Vector2 end = start + <span class="keyword">new</span> Vector2 (xDir, yDir);</span><br><span class="line"></span><br><span class="line">		BoxCollider.enabled = <span class="keyword">false</span>;</span><br><span class="line">		hit = Physics2D.Linecast (start, end, blockingLayer);</span><br><span class="line">		BoxCollider.enabled = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>( hit.transform == <span class="keyword">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			StartCoroutine(SmoothMovement(end));</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> IEnumerator <span class="title">SmoothMovement</span>(<span class="params">Vector3 end</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">float</span> sqrRemainingDistance = (transform.position - end).sqrMagnitude;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (sqrRemainingDistance &gt; <span class="keyword">float</span>.Epsilon) &#123;</span><br><span class="line">			Vector3 newPosition = Vector3.MoveTowards(rb2D.position, end, inverseMoveTime * Time.deltaTime);</span><br><span class="line">			rb2D.MovePosition(newPosition);</span><br><span class="line">			sqrRemainingDistance = (transform.position - end).sqrMagnitude;</span><br><span class="line">			<span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> AttemptMove&lt;T&gt;(<span class="keyword">int</span> xDir, <span class="keyword">int</span> yDir) <span class="keyword">where</span> T : Component</span><br><span class="line">	&#123;</span><br><span class="line">		RaycastHit2D hit;</span><br><span class="line">		<span class="keyword">bool</span> canMove = Move (xDir, yDir, <span class="keyword">out</span> hit);</span><br><span class="line">		<span class="keyword">if</span> (hit.transform == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		T hitComponent = hit.transform.GetComponent&lt;T&gt; ();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!canMove &amp;&amp; hitComponent != <span class="keyword">null</span>) &#123;</span><br><span class="line">			OnCanMove(hitComponent);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> OnCanMove&lt;T&gt;(T component) <span class="keyword">where</span> T : Component;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Player.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span> : <span class="title">MovingObject</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> wallDamage = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> pointsPerFood = <span class="number">10</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> pointsPerSoda = <span class="number">20</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> restartLevelDelay = <span class="number">1</span>f;</span><br><span class="line">	<span class="keyword">public</span> Text foodText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> AudioClip moveSound1;</span><br><span class="line">	<span class="keyword">public</span> AudioClip moveSound2;</span><br><span class="line">	<span class="keyword">public</span> AudioClip eatSound1;</span><br><span class="line">	<span class="keyword">public</span> AudioClip eatSound2;</span><br><span class="line">	<span class="keyword">public</span> AudioClip drinkSound1;</span><br><span class="line">	<span class="keyword">public</span> AudioClip drinkSound2;</span><br><span class="line">	<span class="keyword">public</span> AudioClip gameOverSound;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Animator animator;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> food;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Vector2 touchOrigin = -Vector2.one;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		foodText.text = <span class="string">"Food:"</span> + food;</span><br><span class="line"></span><br><span class="line">		animator = GetComponent&lt;Animator&gt; ();</span><br><span class="line"></span><br><span class="line">		food = GameManager.instance.playerFoodPoints;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">base</span>.Start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		GameManager.instance.playerFoodPoints = food;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!GameManager.instance.playerTurn) &#123;</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Debug.Log (<span class="string">"Player::Update() called"</span>);</span><br><span class="line">		<span class="keyword">int</span> horizontal = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> vertical = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="preprocessor">#<span class="keyword">if</span> UNITY_EDITOR || UNITY_STANDLONE || UNITY_WEBPLAYER</span></span><br><span class="line">		horizontal = (<span class="keyword">int</span>)Input.GetAxisRaw (<span class="string">"Horizontal"</span>);</span><br><span class="line">		vertical = (<span class="keyword">int</span>)Input.GetAxisRaw (<span class="string">"Vertical"</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (horizontal != <span class="number">0</span>) &#123;</span><br><span class="line">			vertical = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="preprocessor">#<span class="keyword">else</span></span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(Input.touchCount &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			Touch myTouch = Input.touches[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">if</span>(myTouch.phase == TouchPhase.Began)</span><br><span class="line">			&#123;</span><br><span class="line">				touchOrigin = myTouch.position;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">else</span> <span class="title">if</span>(<span class="params">myTouch.phase == TouchPhase.Ended &amp;&amp; touchOrigin.x &gt;= <span class="number">0</span></span>)</span><br><span class="line">			</span>&#123;</span><br><span class="line">				Vector2 touchEnd = myTouch.position;</span><br><span class="line">				<span class="keyword">float</span> x = touchEnd.x - touchOrigin.x;</span><br><span class="line">				<span class="keyword">float</span> y = touchEnd.y - touchOrigin.y;</span><br><span class="line">				touchOrigin.x = -<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span>(Mathf.Abs(x) &gt; Mathf.Abs(y))</span><br><span class="line">				&#123;</span><br><span class="line">					horizontal = x &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					vertical = y &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (horizontal != <span class="number">0</span> || vertical != <span class="number">0</span> ) &#123;</span><br><span class="line">			AttemptMove&lt;Wall&gt;(horizontal, vertical);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> AttemptMove&lt;T&gt;(<span class="keyword">int</span> xDir, <span class="keyword">int</span> yDir)</span><br><span class="line">	&#123;</span><br><span class="line">		food--;</span><br><span class="line">		foodText.text = <span class="string">"Food:"</span> + food;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">base</span>.AttemptMove&lt;T&gt; (xDir, yDir);</span><br><span class="line"></span><br><span class="line">		RaycastHit2D hit;</span><br><span class="line">		<span class="keyword">if</span>(Move (xDir, yDir, <span class="keyword">out</span> hit))</span><br><span class="line">		&#123;</span><br><span class="line">			SoundManager.instance.RandomizeSfx(moveSound1,moveSound2);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		CheckIfGameOver ();</span><br><span class="line"></span><br><span class="line">		GameManager.instance.playerTurn = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTriggerEnter2D</span>(<span class="params">Collider2D other</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (other.tag == <span class="string">"Exit"</span>) &#123;</span><br><span class="line">			Invoke (<span class="string">"Restart"</span>, restartLevelDelay);</span><br><span class="line">			enabled = <span class="keyword">false</span>;</span><br><span class="line">		&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">other.tag == <span class="string">"Food"</span></span>) </span>&#123;</span><br><span class="line">			food += pointsPerFood;</span><br><span class="line">			other.gameObject.SetActive(<span class="keyword">false</span>);</span><br><span class="line">			foodText.text = <span class="string">"+:"</span> + pointsPerFood + <span class="string">"Food: "</span> + food;</span><br><span class="line">			SoundManager.instance.RandomizeSfx(drinkSound1,drinkSound2);</span><br><span class="line">		&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">other.tag == <span class="string">"Soda"</span></span>) </span>&#123;</span><br><span class="line">			food += pointsPerSoda;</span><br><span class="line">			other.gameObject.SetActive(<span class="keyword">false</span>);</span><br><span class="line">			foodText.text = <span class="string">"+:"</span> + pointsPerSoda + <span class="string">"Food: "</span> + food;			</span><br><span class="line">			SoundManager.instance.RandomizeSfx(drinkSound1,drinkSound2);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> OnCanMove&lt;T&gt;(T component)</span><br><span class="line">	&#123;</span><br><span class="line">		Wall hitWall = component <span class="keyword">as</span> Wall;</span><br><span class="line">		hitWall.DamageWall (wallDamage);</span><br><span class="line">		animator.SetTrigger (<span class="string">"PlayerChop"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Application.LoadLevel (Application.loadedLevel);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoseFood</span>(<span class="params"><span class="keyword">int</span> loss</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		animator.SetTrigger (<span class="string">"PlayerHit"</span>);</span><br><span class="line">		food -= loss;</span><br><span class="line">		foodText.text = <span class="string">"-:"</span> + loss + <span class="string">"Food: "</span> + food;</span><br><span class="line">		CheckIfGameOver();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CheckIfGameOver</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (food &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">			SoundManager.instance.PlaySingle(gameOverSound);</span><br><span class="line">			SoundManager.instance.musicSource.Stop();</span><br><span class="line">			GameManager.instance.GameOver();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Enemy.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Enemy</span> : <span class="title">MovingObject</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> playerDamager;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Animator animator;</span><br><span class="line">	<span class="keyword">private</span> Transform target;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> skipMove;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> AudioClip enemyAttack1;</span><br><span class="line">	<span class="keyword">public</span> AudioClip enemyAttack2;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		GameManager.instance.AddEnemyToList (<span class="keyword">this</span>);</span><br><span class="line">		animator = GetComponent&lt;Animator&gt; ();</span><br><span class="line">		target = GameObject.FindGameObjectWithTag (<span class="string">"Player"</span>).transform;</span><br><span class="line">		<span class="keyword">base</span>.Start ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> AttemptMove&lt;T&gt;(<span class="keyword">int</span> xDir, <span class="keyword">int</span> yDir)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (skipMove) &#123;</span><br><span class="line">			skipMove = <span class="keyword">false</span>;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">base</span>.AttemptMove&lt;T&gt; (xDir, yDir);</span><br><span class="line"></span><br><span class="line">		skipMove = <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveEnemy</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> xDir = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> yDir = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (Mathf.Abs (target.position.x - transform.position.x) &lt; <span class="keyword">float</span>.Epsilon) &#123;</span><br><span class="line">			yDir = target.position.y &gt; transform.position.y ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			xDir = target.position.x &gt; transform.position.x ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		AttemptMove&lt;Player&gt; (xDir, yDir);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> OnCanMove&lt;T&gt;(T component)</span><br><span class="line">	&#123;</span><br><span class="line">		Player hitPlayer = component <span class="keyword">as</span> Player;</span><br><span class="line"></span><br><span class="line">		animator.SetTrigger (<span class="string">"enemyAttack"</span>);</span><br><span class="line"></span><br><span class="line">		hitPlayer.LoseFood (playerDamager);</span><br><span class="line"></span><br><span class="line">		SoundManager.instance.RandomizeSfx (enemyAttack1, enemyAttack2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SoundManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SoundManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> AudioSource efxSource;</span><br><span class="line">	<span class="keyword">public</span> AudioSource musicSource;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> SoundManager instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> lowPitchRange = <span class="number">0.95</span>f;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> highPitchRange = <span class="number">1.05</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">			instance = <span class="keyword">this</span>;</span><br><span class="line">		&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">instance != <span class="keyword">this</span></span>) </span>&#123;</span><br><span class="line">			Destroy(gameObject);</span><br><span class="line">		&#125;</span><br><span class="line">		DontDestroyOnLoad (gameObject);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlaySingle</span>(<span class="params">AudioClip clip</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		efxSource.clip = clip;</span><br><span class="line">		efxSource.Play ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RandomizeSfx</span>(<span class="params"><span class="keyword">params</span> AudioClip[] clips</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> randomIndex = Random.Range (<span class="number">0</span>, clips.Length);</span><br><span class="line">		<span class="keyword">float</span> randomPitch = Random.Range (lowPitchRange, highPitchRange);</span><br><span class="line"></span><br><span class="line">		efxSource.pitch = randomPitch;</span><br><span class="line">		efxSource.clip = clips [randomIndex];</span><br><span class="line">		efxSource.Play ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Wall.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Wall</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Sprite dmgSprite;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> hp = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> SpriteRenderer spriteRenderer;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> AudioClip wallChop1;</span><br><span class="line">	<span class="keyword">public</span> AudioClip wallChop2;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		spriteRenderer = GetComponent&lt;SpriteRenderer&gt; ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DamageWall</span>(<span class="params"><span class="keyword">int</span> loss</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		spriteRenderer.sprite = dmgSprite;</span><br><span class="line">		hp -= loss;</span><br><span class="line">		SoundManager.instance.RandomizeSfx (wallChop1, wallChop2);</span><br><span class="line">		<span class="keyword">if</span> (hp &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">			gameObject.SetActive(<span class="keyword">false</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Loder.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Loader</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> GameObject gameManager;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (GameManager.instance == <span class="keyword">null</span>) </span><br><span class="line">		&#123;</span><br><span class="line">			Instantiate (gameManager);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Captures</strong><br><em>Game Start</em><br><img src="/img/Unity/2DRogueLike_Game_Start.PNG" alt="2DRogueLike_Game_Start"><br><em>Game Play</em><br><img src="/img/Unity/2DRogueLike_Game_Play.PNG" alt="2DRogueLike_Game_Play"><br><em>lose Game</em><br><img src="/img/Unity/2DRogueLike_Game_Lose.PNG" alt="2DRogueLike_Game_Lose"></p>
<h1 id="编辑器界面">编辑器界面</h1><ol>
<li><p><strong>Hierachy</strong><br>游戏组成元素(这个tutorial里，好比小球，方块，地面，摄像机，灯光，墙等)<br>主要用于对物件的归类管理</p>
<ol>
<li>Create Empty可以用于层次管理归类</li>
</ol>
</li>
<li><p><strong>Project</strong><br>游戏原件管理（这个tutorial里，好比材质，C#脚本）<br>主要用于对一次性资源的归类管理</p>
<ol>
<li>可通过创建Folder进行资源整理归类</li>
</ol>
</li>
<li><p><strong>Scene</strong><br>编辑场景</p>
<ol>
<li>右上角可以切换视角</li>
<li>可以切换Local和Global模式进行移动物体</li>
</ol>
</li>
<li><p><strong>Game</strong><br>运行时场景（可动态编辑查看物体属性）</p>
</li>
<li><p><strong>Inspector</strong><br>对象属性查看</p>
<ol>
<li>通过物体名字左边的Active勾选框可以决定物体是否在编辑器可见可选</li>
<li>可以通过点击界面的？来打开相应面板的介绍页面</li>
</ol>
</li>
</ol>
<h1 id="工具">工具</h1><h2 id="MonoDevelop">MonoDevelop</h2><p>C#,Js脚本编辑器(也可自己设定编辑器为VS  Edit-&gt;Preference-&gt;External Tools-&gt;External Script Editor)</p>
<h2 id="ILSpy">ILSpy</h2><p><a href="http://ilspy.net/" target="_blank" rel="external">ILSpy is the open-source .NET assembly browser and decompiler.</a><br>可以用于反编译一些Unity项目学习源代码</p>
<h2 id="ildasm(安装VS自带的工具)">ildasm(安装VS自带的工具)</h2><p>IL反编译工具<br>可以通过这个工具查看编译生成的IL中间代码</p>
<h2 id="Blender">Blender</h2><p><a href="https://en.wikipedia.org/wiki/Blender_software" target="_blank" rel="external">Blender is a professional free and open-source 3D computer graphics software product used for creating animated films, visual effects, art, 3D printed models, interactive 3D applications and video games.</a><br>主要用于制作一些3D模型和动画然后到处FBX用于Unity</p>
<h2 id="VSTU">VSTU</h2><p>工具原名UnityVS，由于微软收购了SyntaxTree(制作UnityVS的公司)的公司，微软将UnityVS置入了VS开发套件中。<br>VSTU(Visual Studio Tools For Unity)<br>使Visual Studio支持Unity开发。<br>好处：</p>
<ol>
<li>构建多平台游戏</li>
<li>在Visual Studio中调试</li>
<li>在Visual Studio创建Unity脚本</li>
<li>使用Visual Studio提高工作效率(e.g. 智能提示，高亮，快速查询Unity API，快速查询或插入Unity方法等)</li>
<li>免费获取开发Unity所需的全部内容<br>既然能让我们继续使用熟悉的VS作为开发IDE，那么让我们看看怎么集成安装吧。<br><a href="https://msdn.microsoft.com/en-us/library/dn940025.aspx" target="_blank" rel="external">Unity version 4.0.0 or higher; Unity version 5.2.0 or higher to take advantage of built-in support for Visual Studio Tools for Unity version 2.1 or higher.</a><br>注意Unity 5.2.0及以上版本已经内置支持VSTU了。<br>这里讲讲老版本需要如何安装继承VSTU:</li>
<li><a href="https://msdn.microsoft.com/en-us/library/dn940025.aspx" target="_blank" rel="external">下载对应版本的VSTU</a></li>
<li>导入VSTU到Unity(Assets -&gt; Import Package -&gt; Visual Studio 20** Tools)</li>
<li>设置Unity debug开发环境(File -&gt; Building Setting 下勾选Development Build和Script Debugging)</li>
<li>设定VS 20<strong>作为默认IDE(Edit -&gt; Preference -&gt; External Tools -&gt; External Script Editor设置成VS 20</strong>)</li>
<li><a href="https://msdn.microsoft.com/en-us/library/dn940020.aspx#debugging-your-project-in-a-unity-player" target="_blank" rel="external">支持调试managed dll</a></li>
</ol>
<p>这里使用VSTU有几个快捷和帮助快速开发的小技巧：</p>
<ol>
<li>Ctrl+Shift+M(显示可定义的Monobehavior方法，并帮助自动生成方法定义)</li>
<li>Ctrl+Shift+Q(熟悉了Unity API后，这个可以快速检索方法并生成方法定义)</li>
<li>Alt+Shift+E(查看Unity项目目录结构文件)</li>
<li>F5快速调试Unity Code(首先需要设定Unity debug环境(前面提到过)，然后需要通过Debug -&gt; Attach Unity Debugger(Attach到Unity进程上，最后运行Unity即可))</li>
<li>Unity的错误，警告等信息显示在VS的error list里</li>
</ol>
<h1 id="相关概念学习">相关概念学习</h1><h2 id="Unity_Engine">Unity Engine</h2><p><a href="http://inpla.net/thread-8197-1-1.html" target="_blank" rel="external">参考文章</a></p>
<h3 id="C_Sharp">C Sharp</h3><p>Unity支持C#的作为编程语言，这里不得不了解下C#的历史。<br><a href="https://zh.wikipedia.org/wiki/C%E2%99%AF" target="_blank" rel="external">C#是微软推出的一种基于.NET框架的、面向对象的高级编程语言。C#的发音为“C sharp”，模仿音乐上的音名“C♯”（C调升），是C语言的升级的意思。其正确写法应和音名一样为“C♯”[来源请求]，但大多数情况下“♯”符号被井号“#”所混用；两者差别是：“♯”的笔画是上下偏斜的，而“#”的笔画是左右偏斜。C♯由C语言和C++派生而来，继承了其强大的性能，同时又以.NET框架类库作为基础，拥有类似Visual Basic的快速开发能力。C#由安德斯·海尔斯伯格主持开发，微软在2000年发布了这种语言。</a><br><a href="http://tonytang1990.github.io/2015/08/15/CSharp-Study/">相关C#学习</a></p>
<h3 id="Mono">Mono</h3><p><a href="http://inpla.net/thread-8197-1-1.html" target="_blank" rel="external">C#虽好，但是只能在Windows上运行，微软那时候也没有将其开源，所以总是会有人说不能跨平台，光就这点，C#和Java就不能比呀。微软公司已经向ECMA申请将C#作为一种标准。在2001年12月，ECMA发布了ECMA-334 C#语言规范。C#在2003年成为一个ISO标准（ISO/IEC 23270）。这意味着只要你遵守CLI（Common Language Infrastructure），第三方可以将任何一种语言实现到.Net平台之上。Mono就是在这种环境下诞生的。Mono是一个由Xamarin公司（先前是Novell,最早为Ximian）所主持的自由开放源代码项目。该项目的目标是创建一系列符合ECMA标准（Ecma-334和Ecma-335）的.NET工具，包括C#编译器和通用语言架构。与微软的.NET Framework（共通语言运行平台）不同，Mono项目不仅可以运行于Windows系统上，还可以运行于Linux，FreeBSD，Unix，OS X和Solaris，甚至一些游戏平台，例如：Playstation 3，Wii或XBox 360之上。Mono使得C#这门语言有了很好的跨平台能力。相对于微软的.Net Framework运行时库Mono使用自己的Mono VM作为运行时库。</a></p>
<h3 id="IL2CPP">IL2CPP</h3><p>既然Mono这么好，那么为什么还需要IL2CPP了？</p>
<h4 id="Why_do_we_need_IL2CPP?">Why do we need IL2CPP?</h4><ol>
<li>C# runtime performance still lags behind C/C++(C#运行效率没有C/C++好)</li>
<li>Latest and greatest .NET language and runtime features are not supported in Unity’s current version of Mono.(新版本的.Net语言和运行时特性没有被当前的Unity版本支持)</li>
<li>With around 23 platforms and architecture permutations, a large amount of effort is required for porting, maintaining, and offering feature and quality parity.(Mono VM在跨平台的维护上很费时费力)</li>
<li>Garbage collection can cause pauses while running(Mono VM现有的GC很容易使得游戏卡顿)</li>
</ol>
<h4 id="IL2CPP_Components">IL2CPP Components</h4><ol>
<li>AOT(Ahead of Time) compiler<br><a href="https://en.wikipedia.org/wiki/Ahead-of-time_compilation" target="_blank" rel="external">Ahead-of-time (AOT) compilation is the act of compiling a high-level programming language such as C or C++, or an intermediate language such as Java bytecode or .NET Common Intermediate Language (CIL) code, into a native (system-dependent) machine code with the intention of executing the resulting binary file natively.</a>(预编译IL到系统相关的机器代码。 C# -&gt; IL -&gt; C++ -&gt; Machine code)</li>
<li>IL2CPP Virtual Machine<br>Provide additional services (like a GC, metadata, platform specific resources)(提供运行时的一些功能比如GC,访问平台相关资源等)</li>
</ol>
<h4 id="Mono_and_IL2CPP_compile_and_execution_process">Mono and IL2CPP compile and execution process</h4><p>我们来看看使用Mono和使用IL2CPP时的脚本编译运行过程：<br><a href="http://inpla.net/thread-8197-1-1.html" target="_blank" rel="external">下面两张图来源</a><br>Mono:<br><img src="/img/Unity/Mono.png" alt="Mono"></p>
<p>IL2CPP:<br><img src="/img/Unity/IL2CPP.png" alt="IL2CPP"><br>从上图可以看出编译成IL后，会被IL2CPP再次编译成C++，然后通过Native的C++编译器编译C++代码到相关平台的汇编代码，最后运行在IL2CPP VM里。<br>这样做的好处官网提到了下几点：</p>
<ol>
<li><p>Performance(效率上的优化)，原因如下<br> . C++ compilers and linkers provide a vast array of advanced optimisations previously unavailable.<br> . Static analysis is performed on your code for optimisation of both size and speed.<br> . Unity-focused optimisations to the scripting runtime.</p>
</li>
<li><p>All code generation is done to C++ rather than architecture specific machine code. The cost of porting and maintenance of architecture specific code generation is now more amortised. (因为现在是通过利用现有的C++编译器编译C++而没有直接编译成特定架构的机器代码，这样一来跨平台的移植和维护责任就更分散了)</p>
</li>
<li><p>Feature development and bug fixing proceed much faster. For us, days of mucking in architecture specific files are replaced by minutes of changing C++. Features and bug fixes are immediately available for all platforms. (功能开发和bug修改更容易快捷。通过修改IL2CPP的C++生成就能快速的针对多个平台有效)</p>
</li>
<li><p>IL2CPP is not tied to any one specific garbage collector, instead interacting with a pluggable API(GC导致游戏卡顿的现象也可以通过不同的GC方式来改善)</p>
</li>
</ol>
<p>Note:<br>IL2CPP支持了arm64机器架构(Mono不支持, Apple新出的设备大多基于arm64)</p>
<h3 id="AOT_&amp;_JIT">AOT &amp; JIT</h3><p>之前有讲到过AOT和JIT，那么这里为什么还要再次提他了？<br>主要原因是在IOS平台开发中，Mono .NET只支持AOT(Ahead of Time预编译生成所有对应机器代码)，而不是通过JIT在运行时去编译成对应的机器代码。在IOS上采用full-AOT模式。<br>在这一限制下，我们必须明白什么是AOT什么是JIT，并且要知道哪些特性会使用到JIT导致IOS不支持。</p>
<h4 id="AOT">AOT</h4><p><a href="https://en.wikipedia.org/wiki/Ahead-of-time_compilation" target="_blank" rel="external">AOT详细介绍</a><br>AOT大概意思就是预编译所有的IL到系统相关的机器代码。 C# -&gt; IL -&gt; C++ -&gt; Machine code</p>
<h4 id="JIT">JIT</h4><p>JIT:<br>在<a href="http://tonytang1990.github.io/2015/08/15/CSharp-Study/#Executing_Assembly_Code">C# Study</a>中有讲到JIT是在执行Assembly Code(也就是C#编译的CIL中间程序)运行时编译成本地机器代码。<br>Full-AOT模式可以看出Mono .NET在IOS上不支持动态生成代码。<br>那么具体哪些特性不被IOS支持，哪些用法会触发动态生成代码了？</p>
<h4 id="IOS_AOT_Limitations">IOS AOT Limitations</h4><p><a href="https://developer.xamarin.com/guides/ios/advanced_topics/limitations/#.NET.c2.a0API.c2.a0Limitations" target="_blank" rel="external">IOS AOT limitations</a></p>
<ol>
<li>Profiler</li>
<li>Reflection.Emit</li>
<li>Reflection.Emit.Save functionality</li>
<li>COM bindings</li>
<li>The JIT engine</li>
<li>Metadata verifier (since there is no JIT)</li>
</ol>
<p>在这里我从官网提取几个典型问题来说明：</p>
<ol>
<li><p>P/Invokes in Generic Types<br>P/Invokes in generic classes aren’t supported:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class GenericType&lt;T&gt; &#123;</span><br><span class="line">    [DllImport ("System")]</span><br><span class="line">    public static extern int getpid ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 不支持对泛型类的P/Invoke</p>
</li>
<li><p>Value types as Dictionary Keys<br>值类型作为Dictionary的Key时会有问题，实际上实现了IEquatable<t>的类型都会有此问题，因为Dictionary的默认构造函数会使用EqualityComparer<tkey>.Default作为比较器，而对于实现了IEquatable<t>的类型，EqualityComparer<tkey>.Default要通过反射来实例化一个实现了IEqualityComparer<tkey>的类（可以参考EqualityComparer<t>的实现）。 解决方案是自己实现一个IEqualityComparer<tkey>，然后使用Dictionary<tkey, tvalue="">(IEqualityComparer<tkey>)构造器创建Dictionary实例。<br>讲到如果T实现了IEquatable<t>，那么就会反射实例化一个实现了IEqualityCompareer<tkey>的类，这里通过查看EqaulityCompare<t>源码可以看到确实如此。</t></tkey></t></tkey></tkey,></tkey></t></tkey></tkey></t></tkey></t></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public abstract class EqualityComparer&lt;t&gt; : IEqualityComparer, IEqualityComparer&lt;t&gt; </span><br><span class="line">&#123;</span><br><span class="line">    static EqualityComparer&lt;t&gt; defaultComparer; </span><br><span class="line"></span><br><span class="line">    public static EqualityComparer&lt;t&gt; Default &#123;</span><br><span class="line">        [System.Security.SecuritySafeCritical]  // auto-generated </span><br><span class="line">#if !FEATURE_CORECLR</span><br><span class="line">        [TargetedPatchingOptOut("Performance critical to inline across NGen image boundaries")]</span><br><span class="line">#endif</span><br><span class="line">        get &#123; </span><br><span class="line">            Contract.Ensures(Contract.Result&lt;equalitycomparer&lt;t&gt;&gt;() != null);</span><br><span class="line"></span><br><span class="line">            EqualityComparer&lt;t&gt; comparer = defaultComparer; </span><br><span class="line">            if (comparer == null) &#123;</span><br><span class="line">                comparer = CreateComparer(); </span><br><span class="line">                defaultComparer = comparer;</span><br><span class="line">            &#125;</span><br><span class="line">            return comparer;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [System.Security.SecuritySafeCritical]  // auto-generated </span><br><span class="line">    private static EqualityComparer&lt;t&gt; CreateComparer() &#123;</span><br><span class="line">        Contract.Ensures(Contract.Result&lt;equalitycomparer&lt;t&gt;&gt;() != null); </span><br><span class="line"></span><br><span class="line">        RuntimeType t = (RuntimeType)typeof(T);</span><br><span class="line">        // Specialize type byte for performance reasons</span><br><span class="line">        if (t == typeof(byte)) &#123; </span><br><span class="line">            return (EqualityComparer&lt;t&gt;)(object)(new ByteEqualityComparer());</span><br><span class="line">        &#125; </span><br><span class="line">        // If T implements IEquatable&lt;t&gt; return a GenericEqualityComparer&lt;t&gt; </span><br><span class="line">        if (typeof(IEquatable&lt;t&gt;).IsAssignableFrom(t)) &#123;</span><br><span class="line">            //return (EqualityComparer&lt;t&gt;)Activator.CreateInstance(typeof(GenericEqualityComparer&lt;&gt;).MakeGenericType(t)); </span><br><span class="line">            return (EqualityComparer&lt;t&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)typeof(GenericEqualityComparer&lt;int&gt;), t);</span><br><span class="line">        &#125;</span><br><span class="line">        // If T is a Nullable&lt;u&gt; where U implements IEquatable&lt;u&gt; return a NullableEqualityComparer&lt;u&gt;</span><br><span class="line">        if (t.IsGenericType &amp;&amp; t.GetGenericTypeDefinition() == typeof(Nullable&lt;&gt;)) &#123; </span><br><span class="line">            RuntimeType u = (RuntimeType)t.GetGenericArguments()[0];</span><br><span class="line">            if (typeof(IEquatable&lt;&gt;).MakeGenericType(u).IsAssignableFrom(u)) &#123; </span><br><span class="line">                //return (EqualityComparer&lt;t&gt;)Activator.CreateInstance(typeof(NullableEqualityComparer&lt;&gt;).MakeGenericType(u)); </span><br><span class="line">                return (EqualityComparer&lt;t&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)typeof(NullableEqualityComparer&lt;int&gt;), u);</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        // If T is an int-based Enum, return an EnumEqualityComparer&lt;t&gt;</span><br><span class="line">        // If you update this check, you need to update the METHOD__JIT_HELPERS__UNSAFE_ENUM_CAST case in getILIntrinsicImplementation</span><br><span class="line">        if (t.IsEnum &amp;&amp; Enum.GetUnderlyingType(t) == typeof(int)) </span><br><span class="line">        &#123;</span><br><span class="line">            return (EqualityComparer&lt;t&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)typeof(EnumEqualityComparer&lt;int&gt;), t); </span><br><span class="line">        &#125; </span><br><span class="line">        // Otherwise return an ObjectEqualityComparer&lt;t&gt;</span><br><span class="line">        return new ObjectEqualityComparer&lt;t&gt;(); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 注意下面这个分支</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If T implements IEquatable&lt;t&gt; return a GenericEqualityComparer&lt;t&gt; </span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span>(IEquatable&lt;t&gt;).IsAssignableFrom(t)) &#123;</span><br><span class="line">    <span class="comment">//return (EqualityComparer&lt;t&gt;)Activator.CreateInstance(typeof(GenericEqualityComparer&lt;&gt;).MakeGenericType(t)); </span></span><br><span class="line">    <span class="keyword">return</span> (EqualityComparer&lt;t&gt;)RuntimeTypeHandle.CreateInstanceForAnotherGenericParameter((RuntimeType)<span class="keyword">typeof</span>(GenericEqualityComparer&lt;<span class="keyword">int</span>&gt;), t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 当我们的的T也就是我们的Dictionary<tkey,tvalue>里面的TKey实现了IEquatable<t>接口的话，里面的代码实现看不太懂，大概是动态创建实现了IEqualityComparer<tkey>的类，然后实例化返回了一个作为TKey的EqualityComparer。<br> “This works for reference types (as the reflection+create a new type step is skipped)”<br> 当我们传递的TKey是reference types的时候不会触发创建实现了IEqualityCompareer<tkey>的类，直接返回ObjectEqualityComparer<t>()。<br> 解决方案：<br> 如果我们一定要在IOS上把value type作为Dictionary的Key的话，我们需要自己实现一个实现了IEqualityCompareer<tkey>的类，然后作为TKey的EqualityComparer传递给Dictionary<tkey,tvlue>的构造函数。<br> 比如我们要给int添加我们自己的比较方法，那么按如下方式写即可。</tkey,tvlue></tkey></t></tkey></tkey></t></tkey,tvalue></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class ValueTypeComparer : EqualityComparer&lt;int&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public override bool Equals(int a, int b)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine("ValueTypeComparer:Equals() called");</span><br><span class="line">        if (a == b)</span><br><span class="line">        &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override int GetHashCode(int a)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine("ValueTypeComparer:GetHashCode() called");</span><br><span class="line">        return a.GetHashCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Program</span><br><span class="line">&#123;</span><br><span class="line">	static void Main(string[] args)</span><br><span class="line">	&#123;</span><br><span class="line">	    ValueTypeComparer valuetypecomparer = new ValueTypeComparer();</span><br><span class="line">	    int vt1 = 1;</span><br><span class="line">	    Dictionary&lt;int, bool&gt; mydictionary1 = new Dictionary&lt;int, bool&gt;(valuetypecomparer);</span><br><span class="line">	    mydictionary1.Add(vt1, true);</span><br><span class="line">	    mydictionary1.ContainsKey(vt1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="/img/CSharp/ValueTypeComparerForDictionary.PNG" alt="ValueTypeComparerForDictionary"></p>
</li>
<li>System.Reflection.Emit<br><a href="https://msdn.microsoft.com/en-us/library/system.reflection.emit(v=vs.110" target="_blank" rel="external">The System.Reflection.Emit namespace contains classes that allow a compiler or tool to emit metadata and Microsoft intermediate language (MSIL) and optionally generate a PE file on disk.</a>.aspx)<br>可以看出System.Reflection.Emit是用于动态生成代码，这一点明显违背了Full-AOT的原则。<br>在了解Emit是如何动态生成代码之前，可以先了解一下<a href="http://tonytang1990.github.io/2015/08/15/CSharp-Study/#Platform_Invoke">AppDomain的概念</a><br>AppDomain负责Assebmly的加载和隔离，代码是加载在AppDomain里执行的。<br>接下来让我们看看System.Reflection.Emit是如何动态生成代码的：<br>先来看下MSDN官网介绍<br><a href="https://msdn.microsoft.com/en-us/library/system.reflection.emit(v=vs.110" target="_blank" rel="external">The System.Reflection.Emit namespace contains classes that allow a compiler or tool to emit metadata and Microsoft intermediate language (MSIL) and optionally generate a PE file on disk.</a>.aspx)</li>
</ol>
<p>可以看出System.Reflection.Emit包含了很多可以动态创建程序集，类，方法的类。<br>以下学习主要参考<a href="http://www.cnblogs.com/hui088/p/4571484.html" target="_blank" rel="external">C#反射发出System.Reflection.Emit学习</a><br>这位博主对Emit研究的很透侧，讲解的也通熟易懂。<br>Emit生成代码的基本流程：</p>
<ol>
<li><p>构建程序集</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AssemblyName aname = <span class="keyword">new</span> AssemblyName(<span class="string">"DynamicgAssembly"</span>);</span><br><span class="line">AssemblyBuilder ab = AppDomain.CurrentDomain.DefineDynamicAssembly(aname, AssemblyBuilderAccess.RunAndSave);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模块</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ModuleBuilder mb = ab.DefineDynamicModule(aname.Name, aname.Name + <span class="string">".dll"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义类</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeBuilder tb = mb.DefineType(<span class="string">"DynamicType"</span>, TypeAttributes.Public);</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义类成员(方法，属性等)</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 创建方法签名</span></span><br><span class="line">   MethodBuilder methodb = tb.DefineMethod(<span class="string">"Hello"</span>,MethodAttributes.Public);</span><br><span class="line">   <span class="comment">// 定义方法实现</span></span><br><span class="line">   <span class="comment">// 这里比较重要，可以把这里理解成代码反编译之后的函数调用操作的代码化</span></span><br><span class="line">   ILGenerator il = methodb.GetILGenerator();</span><br><span class="line">   <span class="comment">//OpCodes包含所有的Microsoft Intermediate Language (MSIL) instructions </span></span><br><span class="line">	<span class="comment">//OpCodes.Ldstr表示加载一个字符串到evaluation stack。</span></span><br><span class="line">il.Emit(OpCodes.Ldstr, <span class="string">"Hello, World!"</span>);</span><br><span class="line">   <span class="comment">//OpCodes.Call表示调用方法</span></span><br><span class="line">il.Emit(OpCodes.Call, <span class="keyword">typeof</span>(Console).GetMethod(<span class="string">"WriteLine"</span>, <span class="keyword">new</span> Type[] &#123; <span class="keyword">typeof</span>(<span class="keyword">string</span>) &#125;));</span><br><span class="line">   <span class="comment">//OpCodes.Ret表示返回，当evaluation stack有值时会返回栈顶值。</span></span><br><span class="line">il.Emit(OpCodes.Ret);</span><br><span class="line"></span><br><span class="line">tb.CreateType();</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Assembly</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab.Save(<span class="string">"DynamicAssemble.dll"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/img/CSharp/EmitStudy.PNG" alt="EmitStudy"><br>结合反编译我们生成的DynamicAssemble.dll可以看出，我们是通过Emit把函数定义用IL指令定义出来了。<br>毫无疑问这是动态生成了程序集，方法等，所以在Full-AOT面前，IOS是不支持的。<br>让我们来看个实际的问题：<br><a href="https://docs.unity3d.com/Manual/TroubleShootingIPhone.html" target="_blank" rel="external">The game crashes with the error message “ExecutionEngineException: Attempting to JIT compile method ‘SometType`1<somevaluetype>:.ctor ()’ while running with –aot-only.</somevaluetype></a><br>这里是由于在序列化的时候使用了泛型方法导致的。<br><a href="https://docs.unity3d.com/Manual/TroubleShootingIPhone.html" target="_blank" rel="external">The Mono .NET implementation for iOS is based on AOT. It compiles only those generic type methods (where a value type is used as a generic parameter) which are explicitly used by other code. When such methods are used only via reflection or from native code (ie, the serialization system) then they get skipped during AOT compilation.The AOT compiler can be hinted to include code by adding a dummy method somewhere in the script code. This can refer to the missing methods and so get them compiled ahead of time.</a><br>可以看出在Full-AOT下，如果我们在反射和序列化中使用泛型方法，该方法会被AOT过滤掉，不预编译，要想使该泛型方法参与预编译，我们需要定义一个不使用的方法去显示调用该类去通知AOT去预编译该方法。<br>本人遇到这个问题是：<br>ExecutionEngineException: Attempting to JIT compile method ‘**TypeMetadata:.ctor ()’ while running with –aot-only<br><a href="http://answers.unity3d.com/questions/30930/why-did-my-binaryserialzer-stop-working.html" target="_blank" rel="external">Why did my BinarySerialzer stop working?</a><br>根据上面的说法是BinaryFormatter里的ObjectWriter去动态生成了我们自定义的value type类导致的JIT。<br>通过下面代码可以使ObjectWriter采用反射去实现而非JIT生成动态类。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Environment.SetEnvironmentVariable(<span class="string">"MONO_REFLECTION_SERIALIZER"</span>, <span class="string">"yes"</span>);</span><br></pre></td></tr></table></figure></p>
<p>但是反射很慢，如果频繁进行序列化反序列化的话，在IOS上并不是一种好的解决办法。<br><a href="http://forum.unity3d.com/threads/protobuf-net-unity-is-it-worth-it.288007/" target="_blank" rel="external">根据这里的讨论</a>，可以看出Google Protocol Buffers是一个不错的解决方案(当然我们得绕过默认使用JIT)。</p>
<h4 id="Protocol_Buffers">Protocol Buffers</h4><p>Protocol Buffers是Google发布出来的开源项目。<br><a href="https://developers.google.com/protocol-buffers/docs/overview" target="_blank" rel="external">Protocol Buffers - a language-neutral, platform-neutral, extensible way of serializing structured data for use in communications protocols, data storage, and more. </a><br>从官网介绍可以看出Google Protocol Buffers(平台无关，语言无关)是针对序列化数据的存储和传输协议等。<br>既然都是用于数据存储，那么Protocol buffers相比传统的二进制和XML序列化有什么优势了？<br>相比XML序列化，Protocol buffers更高效，更灵活，更快，更小，更简单。<br>更方便简单在于 — PB只需定义一次data的数据结构就能自动生成对应语言的解析该数据结构的代码类。<br>更高效更小在于 — XML存储的数据量大，XML在解析的时候，空间开销大，内容多速度慢。(XML的好处 — 具有可读性)<br>更灵活在于 — 只需更新数据结构定义然后编译出对应语言的代码就能无缝衔接以前的版本。<br>既然Protocol buffers这么好，那么让我们看看他是怎么工作的？</p>
<ol>
<li>定义出我们需要序列化的数据结构，保存在.proto文件里。</li>
<li><p>运用Protocol buffer编译器编译出我们对应语言的解析该数据结构的代码类。<br>首先下载对应语言的<a href="https://github.com/google/protobuf/releases/tag/v3.0.0" target="_blank" rel="external">Protocol buffer编译器</a><br>“There are two NuGet packages: Google.Protobuf (the support library) and Google.Protobuf.Tools (containing protoc)”<br>根据上面写的，C#现在貌似有两个版本支持Protocol Buffer，但原生的Protobuf版本支持的.NET版本很高，所以不适合Unity(Unity是基于Mono的，Mono现在对.NET的支持还停留在.NET 2.0和.NET 2.0 subset)。<br>所以通过Google，我找到了以下两个开源项目：</p>
<ol>
<li><a href="https://github.com/jskeet/protobuf-csharp-port" target="_blank" rel="external">Protobuf-csharp-port</a></li>
<li><p><a href="https://github.com/mgravell/protobuf-net" target="_blank" rel="external">Protobuf-net</a><br>前者在Git上的描述不多，所以这里就以下面引用的话来了解两者之间的区别。<br><a href="http://www.ben-morris.com/protocol-buffers-protobuf-net-vs-protobuf-csharp-port/" target="_blank" rel="external">Protobuf-csharp-port is written by Jon Skeet and is a faithful port of Google’s java implementation that uses similar command-line tooling. You create the data definitions in text-based .proto files and use a code generation tool to create the C# classes.</a><br>Protobuf-csharp-port是由Jon Skeet编写，利用原生工具去port的版本。在编译创建上都沿用了Protocol buffer的原始方式(通过编译.proto文件生成解析定义的Message数据结构的C#代码类)<br><a href="http://www.ben-morris.com/protocol-buffers-protobuf-net-vs-protobuf-csharp-port/" target="_blank" rel="external">Protobuf-net is written by Marc Gravell and will be more familiar to .Net developers. The implementation uses .Net classes and attributes to define data rather than .proto files. Overall, the code resembles existing .Net serializers such as the DataContractSerializer.</a><br>Protobuf-net是由Marc Gravell编写，支持.NET的类和attributes去定义数据结构，也支持.proto文件预编译生成对应代码类。可以说是.NET风格的Protobuf。<br>同时Github写明了支持：<br>.net 2.0/3.0/3.5/4.0<br>Mono 2.x<br>所以这里就决定使用Protobuf-net作为Unity C#序列化数据的存储和协议传输的库来学习。</p>
<ol>
<li><p>安装Protobuf-net<br>VS -&gt; Tools -&gt; Nuget Package Manager -&gt; Package Manager Console<br>在Package Manager Console窗口输入下列命令就会自动去下载Protobuf-net包并安装了。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Package protobuf-net</span><br></pre></td></tr></table></figure>
<p>也可以直接下载<a href="https://code.google.com/archive/p/protobuf-net/downloads" target="_blank" rel="external">Down load link of Protobuf-net</a><br>把Protobuf-net.dll放到Assets/Plugins目录下</p>
</li>
<li>定义可序列化的类<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> ProtoBuf;</span><br><span class="line"></span><br><span class="line">[ProtoContract]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerData</span> &#123;</span><br><span class="line">    [ProtoMember(<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> SceneName</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span>;</span><br><span class="line">        <span class="keyword">set</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [ProtoMember(<span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> Scores</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span>;</span><br><span class="line">        <span class="keyword">set</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [ProtoMember(<span class="number">3</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> SpeedLevel</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span>;</span><br><span class="line">        <span class="keyword">set</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
</li>
<li><p>通过C#(对应语言)protocol buffer API去读写存储的数据。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">   ......</span><br><span class="line"></span><br><span class="line">    mPlayerData = <span class="keyword">new</span> PlayerData();</span><br><span class="line"></span><br><span class="line">    mProfilePath =  Application.persistentDataPath + <span class="string">"/PlayerProile.bin"</span>;</span><br><span class="line">    Debug.Log(<span class="string">"mProfilePath = "</span> + mProfilePath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SavePlayerData</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">//Do serialization for player data</span></span><br><span class="line">    FileStream profile;</span><br><span class="line">    <span class="keyword">if</span>(File.Exists(mProfilePath))</span><br><span class="line">    &#123;</span><br><span class="line">        profile = File.Open(mProfilePath, FileMode.Open);</span><br><span class="line">        Serializer.Serialize(profile, mPlayerData);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        profile = File.Create(mProfilePath);</span><br><span class="line">        Serializer.Serialize(profile, mPlayerData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadPlayerData</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    FileStream profile;</span><br><span class="line">    <span class="keyword">if</span>(File.Exists(mProfilePath))</span><br><span class="line">    &#123;</span><br><span class="line">        profile = File.OpenRead(mProfilePath);</span><br><span class="line">        mPlayerData = Serializer.Deserialize&lt;PlayerData&gt;(profile);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        mPlayerData = <span class="keyword">new</span> PlayerData();</span><br><span class="line">        mPlayerData.SceneName = Application.productName;</span><br><span class="line">        mPlayerData.Scores = <span class="number">0</span>;</span><br><span class="line">        mPlayerData.SpeedLevel = <span class="number">1</span>;</span><br><span class="line">        SavePlayerData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>但只是这样的话，会报如下错误：<br>NotSupportException： …… System.Reflection.Emit is not supported<br>这里出现了Emit类的使用，显然是用到了动态生成代码，根据我们之前讲到的IOS是在Full-AOT模式下运行不允许动态生成代码的。<br>所以直接使用.NET风格的Attribute会触发动态代码生成，那么我们就需要想办法提前生成，这里就需要使用.proto文件然后通过预编译的方式生成对应的代码类。<br>所以现在我们需要先定义.proto文件(Protobuf-net只支持Proto2)，所以编写<a href="https://developers.google.com/protocol-buffers/docs/proto" target="_blank" rel="external">proto2参考</a><br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PlayerData.proto</span></span><br><span class="line">syntax = <span class="string">"proto2"</span>;</span><br><span class="line"></span><br><span class="line">package NGUI2DGame;</span><br><span class="line"></span><br><span class="line">message PlayerData&#123;</span><br><span class="line">	optional <span class="keyword">string</span> SceneName = <span class="number">1</span>;</span><br><span class="line">	optional int32 Scores = <span class="number">2</span>;</span><br><span class="line">	optional int32 SpeedLevel = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后通过Protogen.exe帮我们生成对应解析该数据结构所需要的代码类<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protogen -i:PlayerData.proto -o:PlayerData.cs -ns:NGUI2DGame</span><br></pre></td></tr></table></figure></p>
<p>-i是指明输入，这里可以通过-i指定多个输入proto文件。-o是指定输出文件，最终生成的对应信息的代码类。-ns是指定namespace<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">//PlayerData.cs</span><br><span class="line">//------------------------------------------------------------------------------</span><br><span class="line">// &lt;auto-generated&gt;</span><br><span class="line">//     This code was generated by a tool.</span><br><span class="line">//</span><br><span class="line">//     Changes to this file may cause incorrect behavior and will be lost if</span><br><span class="line">//     the code is regenerated.</span><br><span class="line">// &lt;/auto-generated&gt;</span><br><span class="line">//------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">// Generated from: PlayerData.proto</span><br><span class="line">namespace NGUI2DGame</span><br><span class="line">&#123;</span><br><span class="line">  [global::System.Serializable, global::ProtoBuf.ProtoContract(Name=@"PlayerData")]</span><br><span class="line">  public partial class PlayerData : global::ProtoBuf.IExtensible</span><br><span class="line">  &#123;</span><br><span class="line">    public PlayerData() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    private string _SceneName = "";</span><br><span class="line">    [global::ProtoBuf.ProtoMember(1, IsRequired = false, Name=@"SceneName", DataFormat = global::ProtoBuf.DataFormat.Default)]</span><br><span class="line">    [global::System.ComponentModel.DefaultValue("")]</span><br><span class="line">    public string SceneName</span><br><span class="line">    &#123;</span><br><span class="line">      get &#123; return _SceneName; &#125;</span><br><span class="line">      set &#123; _SceneName = value; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    private int _Scores = default(int);</span><br><span class="line">    [global::ProtoBuf.ProtoMember(2, IsRequired = false, Name=@"Scores", DataFormat = global::ProtoBuf.DataFormat.TwosComplement)]</span><br><span class="line">    [global::System.ComponentModel.DefaultValue(default(int))]</span><br><span class="line">    public int Scores</span><br><span class="line">    &#123;</span><br><span class="line">      get &#123; return _Scores; &#125;</span><br><span class="line">      set &#123; _Scores = value; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    private int _SpeedLevel = default(int);</span><br><span class="line">    [global::ProtoBuf.ProtoMember(3, IsRequired = false, Name=@"SpeedLevel", DataFormat = global::ProtoBuf.DataFormat.TwosComplement)]</span><br><span class="line">    [global::System.ComponentModel.DefaultValue(default(int))]</span><br><span class="line">    public int SpeedLevel</span><br><span class="line">    &#123;</span><br><span class="line">      get &#123; return _SpeedLevel; &#125;</span><br><span class="line">      set &#123; _SpeedLevel = value; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    private global::ProtoBuf.IExtension extensionObject;</span><br><span class="line">    global::ProtoBuf.IExtension global::ProtoBuf.IExtensible.GetExtensionObject(bool createIfMissing)</span><br><span class="line">      &#123; return global::ProtoBuf.Extensible.GetExtensionObject(ref extensionObject, createIfMissing); &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来把我们生成的代码通过VS编译成DLL</p>
<ol>
<li>新建C# Library工程</li>
<li>删掉原始cs添加刚才生成的PlayerData.cs</li>
<li>添加Protobuf-net库引用(用CoreOnly/ios/protobuf-net.dll)</li>
<li>编译出dll<br>最后我们需要通过上一步生成的信息类dll来编译出专门序列化该信息的类库。(添加precompile.exe的路径到环境变量确保找得到，这里要注意的是dll项目的.NET target设置成2.0，因为Unity Mono现在只支持到2.0)<br>在之前生成的PlayerData.dll目录下执行下列命令：<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">precompile PlayerData.dll -o:ProtobufSerializer.dll -t:com.TonyTang.ProtobufSerializer</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>-o指明输出文件 -t指明生成的序列化类的类名<br>最后利用生成的PlayerData.dll和ProtobufSerializer.dll到Unity里进行测试，编写对应代码即可，写法和之前的区别就是用我们生成好的类来完成序列化和反序列化。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Serialization</span></span><br><span class="line">ProtobufSerializer serializer = <span class="keyword">new</span> ProtobufSerializer();       </span><br><span class="line">profile = File.Open(mProfilePath, FileMode.Open);</span><br><span class="line">serializer.Serialize(profile, mPlayerData);</span><br><span class="line"><span class="comment">//Deserialization</span></span><br><span class="line">profile = File.OpenRead(mProfilePath);</span><br><span class="line">mPlayerData = serializer.Deserialize(profile,<span class="keyword">null</span>,<span class="keyword">typeof</span>(PlayerData)) <span class="keyword">as</span> PlayerData;</span><br></pre></td></tr></table></figure></p>
<p>因为需要编写.proto文件后编译生成对应的Serialization类的dll，所以最好通过shell脚本写成自动化。<br>还有一种方式是使用Probobuf-net源码的形式(貌似需要设定-unsafe和.NET 2 subset)，这里我没有尝试，下面给出链接：<br><a href="http://www.ceeger.com/forum/read.php?tid=14359&amp;fid=27" target="_blank" rel="external">在ios android设备上使用 Protobuf (使用源码方式) </a></p>
<p>了解了什么(What)是Protobuf，如何(How)使用Protobuf，那么我们也应该大概了解下为什么(Why)Protobuf高效，更小，更快，更简单…..<br>参考下面两篇文章：<br><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-gpb/" target="_blank" rel="external">Google Protocol Buffer 的使用和原理</a><br><a href="https://developers.google.com/protocol-buffers/docs/encoding" target="_blank" rel="external">官网讲到的Protocol buffer的Encode技术</a><br>从上面可以看出，更小更快是因为Protocol buffer采用了巧妙的Encoding方法。<br>而这个Encoding方法利用了Varint技术，那么什么是Varint了？<br>“Varints are a method of serializing integers using one or more bytes. Smaller numbers take a smaller number of bytes. “<br>Varints通过更少的字节来表达准确的数据，比如0-127只需要1个字节就能表示。<br>当需要多个字节表达的时候，通过利用1byte里的first bit来区分，如果first bit是1表示后续的7个bit都表示数据，如果first bit是0表示这是最后一个字节用于表示数据。<br>同时Protocol buffer在Encode的时候通过key和value来存储数据。key只包含filed的名字和类型，value包含数据。<br>类型数据映射<br><img src="/img/Unity/ProtocolBufferMessageValueType.PNG" alt="ProtocolBufferMessageValueType"><br>当Decode的时候，如果遇到不识别的key值，只需要skip即可，保证了程序的老版本兼容。<br>更方便在于，我们只需通过编写简单易懂的.proto文件然后通过ProtoGen，Precompile工具就能生成对应的Message，Encode和Decode类。<br>结合前面的事例，让我们窥探一下到底Protocol-net是如何实现编写.proto文件结合编译生成Message类和序列化类来实现数据的Encode和Decode的。<br>首先反编译的ProtovufSerializer.dll，查看Serialize方法<br><img src="/img/Unity/ProtobufSerializerSerialize.PNG" alt="ProtobufSerializerSerialize"><br>可以看到ProtobufSerializer调用了Write方法，接下来查看Write方法<br><img src="/img/Unity/ProtobufSerializerWrite.PNG" alt="ProtobufSerializerWrite"><br>可以看到我们ProtobufSerializer实际是通过调用ProtoBuf.ProtoWriter::WriteFieldHeader(Protobuf-net库)实现数据的Encode的。同时因为ProtobufSerializer是根据PlayerData.dll编译而成，所以Write方法里的实现针对每一个需要Encode的Message成员进行数据Encode写入。<br>这样一来就完成了通过编写.proto文件定义Message，然后生成对应的Message类和序列化类再结合Protocol-net库实现了自定义Message的Encode和Decode了，而最终数据的Encode，Decode实现就落实到Protocol-net的实现了。</p>
<p>那么为什么要用Protocol buffer了？<br>参考文章：<br><a href="http://www.oschina.net/translate/choose-protocol-buffers" target="_blank" rel="external">使用 Protocol Buffers 代替 JSON 的五个原因</a><br>Protocol buffer因为是存储在二进制文件，相比XML，Jason等技术不具可读性。</p>
<p>Note:<br>最初的Protocol Buffers只开发了针对Java,C++,Python的版本。后来开园后有了C#，Go等语言的支持。<br>Protocol Buffer存储的数据是以二进制的形式。<br>Protocol-net只支持<a href="https://developers.google.com/protocol-buffers/docs/proto" target="_blank" rel="external">proto2的语言编写规范</a>。</p>
<p>待续……</p>
<p>Note:<br>IOS只支持static code, Unlike traditional Mono/.NET, code on the iPhone is statically compiled ahead of time instead of being compiled on demand by a JIT compiler(IOS只支持full aot，不支持JIT).所以有些动态特性没法被Full AOT支持。<br>But the entire Reflection API, including Type.GetType (“someClass”), listing methods, listing properties, fetching attributes and values works just fine.(反射依然在IOS可用)</p>
<h2 id="Unity_Using">Unity Using</h2><ol>
<li><strong>Layout</strong> — 排版，可用于存储我们在Unity里面的面板排版设置，通过制定layout使用特定排版</li>
<li><strong>Prefab</strong> — 原件，可在场景里重复利用，而且Prefab的改变可以通过点击Inspector界面的Apply影响到所有从该Prefab里创建出的对象</li>
<li><strong>Tag</strong>  — Scene里面所有物体的唯一标识，用于确保正确识别物体，通过对物体添加tag可以在程序里用于身份判别</li>
<li><strong>Static collider</strong> — will not be affected by collision (not cause collide). Unity keep static collider mesh in cach</li>
<li><strong>Dynamic collider</strong> — will be affected by collision</li>
<li><strong>Is Trigger</strong> — when no collide caused(e.g. static collider), we can use trigger to enter collide event(只有没有物理碰撞的物体才会触发Trigger的)</li>
<li><strong>Rigibody body</strong> — Moved by using physical force, use dynamic collider</li>
<li><strong>Kinematic body</strong> — Moved by using the transform instead of physical force</li>
<li><strong>Mesh Collider</strong> — Use Model mesh as collider mesh (一般只用于简单的三角形数量少的mesh)</li>
<li><strong>AudioSource</strong> — 声音在Unity里也是组件的形式存在</li>
<li><strong>C# Script</strong> — 每个物体可以绑定多个脚本用于不同逻辑，特别是用于原件一些特有的逻辑特性</li>
<li><strong>2.5D</strong> — 在3D的世界里通过平行投影(Orthographic Projection - isometric projection)实现</li>
<li><strong>Raycast</strong> — 射线碰撞检测（Physics.Raycast()在物体是is triiger on的时候不会触发）</li>
<li><strong>LayerMask</strong> — 可以用于选择和射线检测过滤</li>
<li><strong>NavMeshAgent</strong> — Unity的Navigation system可以提供最基本的路径AI寻址(只需要指定agent相关参数，在代码里设定跟踪目标) — 添加后需要Bake Navigation</li>
<li><strong>Animation Controller</strong> — 动画管理，通过给物体添加Animator并设定动画状态机之间的切换规则来实现动画状态切换管理(通过给UI添加Animator我们也可以在Anmation面板设置简单动画)</li>
<li><strong>LineRenderer</strong> — 可以用于在3D世界里绘制线条，实现可视化一些射线检测物体碰撞等</li>
<li><strong>Select icon</strong> — 可以给没有实际物体或透明物体一个颜色标记(容易看到3D世界位置)</li>
<li><strong>Canvas</strong> — 画布是所有UI所应该在的区域(UI的层级关系会影响渲染顺序) — 通过设定Render Mode实现不同的效果(Screen Space - Overlay不会受Camera的投影方式影响，永远在场景上. Screen Space - Camera会受Camera的投影方式影响，比如在透视投影里就会有近大远小的效果. World Space会把UI当做3D空间里的物体来对待，有深度概念会被遮挡 ))</li>
<li><strong>Physics2D.Linecast</strong> — 可用于检测特定layer的射线检测</li>
<li><p><em>**Input</em> — 不同平台要使用不同平台的AIP<br>e.g.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">if</span> UNITY_EDITOR || UNITY_STANDLONE || UNITY_WEBPLAYER</span></span><br><span class="line">	horizontal = (<span class="keyword">int</span>)Input.GetAxisRaw (<span class="string">"Horizontal"</span>);</span><br><span class="line">	vertical = (<span class="keyword">int</span>)Input.GetAxisRaw (<span class="string">"Vertical"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (horizontal != <span class="number">0</span>) &#123;</span><br><span class="line">		vertical = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="keyword">if</span>(Input.touchCount &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		Touch myTouch = Input.touches[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">if</span>(myTouch.phase == TouchPhase.Began)</span><br><span class="line">		&#123;</span><br><span class="line">			touchOrigin = myTouch.position;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">else</span> <span class="title">if</span>(<span class="params">myTouch.phase == TouchPhase.Ended &amp;&amp; touchOrigin.x &gt;= <span class="number">0</span></span>)</span><br><span class="line">		</span>&#123;</span><br><span class="line">			Vector2 touchEnd = myTouch.position;</span><br><span class="line">			<span class="keyword">float</span> x = touchEnd.x - touchOrigin.x;</span><br><span class="line">			<span class="keyword">float</span> y = touchEnd.y - touchOrigin.y;</span><br><span class="line">			touchOrigin.x = -<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(Mathf.Abs(x) &gt; Mathf.Abs(y))</span><br><span class="line">			&#123;</span><br><span class="line">				horizontal = x &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				vertical = y &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>DontDestroyOnLoad()</strong> — 加载新的scene的时候保证对象不会被销毁</p>
</li>
<li><strong>Invoke()</strong> — 延时调用方法</li>
</ol>
<h1 id="快捷键学习">快捷键学习</h1><p>F — 在Scene界面选中对象后可以快速聚焦到该物体<br>Ctrl + ‘ — 打开脚本的类Reference page<br>Ctrl + D — Duplicated（复制）物体</p>
<h1 id="项目编译发布">项目编译发布</h1><h2 id="PC">PC</h2><ol>
<li>File -&gt; Build Setting 设置平台PC</li>
<li>Drag Scene file to Scenes to build 选择要编译的场景</li>
<li>点击Build 编译游戏</li>
</ol>
<h2 id="IOS">IOS</h2><h3 id="Native_Code_Compilation">Native Code Compilation</h3><p>PC平台使用C++编写的库的时候是通过lib或者dll的静态和动态链接<br>但在IOS移动平台使用的时候，这些代码必须以插件的形式调用，以静态方式链接。<br><a href="http://docs.unity3d.com/Manual/Plugins.html" target="_blank" rel="external">Managed plugins and Native Plugins</a></p>
<p>Note:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">if</span> UNITY_IPHONE || UNITY_XBOX360</span></span><br><span class="line"><span class="comment">//On iOS and Xbox 360 plugins are statically linked into</span></span><br><span class="line"><span class="comment">//the executable, so we have to use **Internal as the</span></span><br><span class="line"><span class="comment">//library name.</span></span><br><span class="line">[DllImport (<span class="string">"**Internal"</span>)]</span><br><span class="line"><span class="preprocessor">#<span class="keyword">else</span></span></span><br><span class="line"><span class="comment">// Other platforms load plugins dynamically, so pass the name</span></span><br><span class="line"><span class="comment">// of the plugin's dynamic library.</span></span><br><span class="line">[DllImport (<span class="string">"PluginName"</span>)]</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p>在真正编译到IOS上使用之前，我们必须通过cross compile把Native code编译成.a的文件，然后静态链接到项目中使用。（需要在Mac电脑上cross compile）</p>
<p>以下以开源工具Zlib为例：<br><a href="http://www.zlib.net/" target="_blank" rel="external">Zlib Download</a></p>
<p><a href="http://blog.karmadust.com/category/ios/" target="_blank" rel="external">参考文章:Building Universal Binaries for iOS</a></p>
<p>解压打开文件夹后会发现，目录下有MakeFile, .configure, MakeFile.in等文件。<a href="https://en.wikipedia.org/wiki/Makefile" target="_blank" rel="external">MakeFile</a>是编写了编译规则的文件用于自动编译的工具(在Unix，Linux系统上广泛运用)。而configure和MakeFile.in是通过<a href="https://zh.wikipedia.org/wiki/Autoconf" target="_blank" rel="external">Autoconf</a>和<a href="https://zh.wikipedia.org/wiki/Automake" target="_blank" rel="external">Automake</a>工具生成，用于编写高阶语言来生成makefile而无需手动编写复杂的makefie.。通过调用.configure并传入参数，.configure就会以MakeFile.in为模板产生我们预期的MakeFile。（这里我对MakeFile,autoconf,automake都不熟悉，现阶段的认识是这样的）</p>
<p>我们将会通过.configure生成我们需要的Makefile用于编译程序:</p>
<ol>
<li>.configure —prefix=${PWD}/installdir(用于生成makefile，—prefix用于指定make install后的文件夹)</li>
<li>unset CC(先重置一次CC编译设定，避免出问题) </li>
<li>export CC=”xcrun -sdk iphoneos clang -arch armv7”(这里很重要，在调用makefile之前，我们通过设置环境变量CC的值来指定make的编译设定，比如编译工具，编译架构等，-sdk 指定SDK路径用于搜索相关工具(比如编译工具等) -arch 用于指定编译出的文件架构类型)</li>
<li>make clean(清理make生成的文件)</li>
<li>make(执行makefile进行编译)</li>
<li>make install(安装make生成的相关文件到对应目录)</li>
<li>lipo -info libz.a(通过lipo工具来查看生成的libz.a文件是基于什么架构的)</li>
</ol>
<p>上述有几个概念需要提一下：<br><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/xcrun.1.html" target="_blank" rel="external">xcrum</a>(个人理解是，通过这个工具可以在不改makefile的前提下，通过命令行指定开发工具的一些信息) properties.<br>clang — <a href="https://zh.wikipedia.org/wiki/Clang" target="_blank" rel="external">clang是 是一个C、C++、Objective-C和Objective-C++编程语言的编译器前端。它采用了底层虚拟机（LLVM）作为其后端。它的目标是提供一个GNU编译器套装（GCC）的替代品。Clang是LLVM编译器工具集的前端（front-end），目的是输出代码对应的抽象语法树（Abstract Syntax Tree, AST），并将代码编译成LLVM Bitcode。接着在后端（back-end）使用LLVM编译成平台相关的机器语言 。Clang支持C、C++、Objective C。</a>(可以理解成Mac上的编译工具，支持多种语言编译生成多种平台相关的机器语言)<br>Universal binary — 可以理解成multiarchitecture binary，支持多种架构的二进制文件（比如我们这里针对IOS生成的armv7架构的libz.a，我们也可以再生成一个针对simulator的i386架构的libz.a，然后通过执行lipo -create -arch i386 libz.a(386) -arch armv7 libz.a(armv7) -output libz_fatbinary.a生成同时支持simulator和IOS的.a文件）<br>lipo — 苹果上用于生成Universal binary的工具(lipo -info libz.a用于查看.a文件支持的架构信息)</p>
<p>Note:<br>Simulator（模拟器）使用的.a文件是基于i386的，而IOS真机使用的.a文件是基于armv7 or armv8的。</p>
<h3 id="Prepare_XCode_Project">Prepare XCode Project</h3><ol>
<li>File -&gt; Build Setting 设置平台IOS</li>
<li>Drag Scene file to Scenes to build 选择要编译的场景</li>
<li>点击Build </li>
</ol>
<p>这样一来XCode项目就生成了。</p>
<h3 id="Compile_XCode_Project">Compile XCode Project</h3><p>条件：</p>
<ol>
<li>需要苹果开发者账号<br>待续……</li>
</ol>
<p>Note:<br><a href="https://cmake.org/" target="_blank" rel="external">跨平台自动化编译工具CMake</a></p>
<h1 id="版块学习">版块学习</h1><h2 id="UGUI">UGUI</h2><p>在Unity 4.6版本后推出的官方的GUI</p>
<h3 id="Canvas">Canvas</h3><p><a href="http://docs.unity3d.com/Manual/UICanvas.html" target="_blank" rel="external">The Canvas is the area that all UI elements should be inside.(所有的UI元素都必须处于Canvas里)</a></p>
<p>Pivot(枢轴):<br>物体的transform变化，比如scale,position,size都会一这个点为基准来变化</p>
<p>Anchors(锚点):<br>主要用于UI的layout排版，根据Anchors的位置设置不同，Rect Transform会在父节点变化的时候做出适当的变化</p>
<p>Note:<br><a href="http://docs.unity3d.com/Manual/UICanvas.html" target="_blank" rel="external">UI elements in the Canvas are drawn in the same order they appear in the Hierarchy.(UI成员的绘制顺序和UI在Canvas下的顺序一致) </a></p>
<h2 id="Shader">Shader</h2><p>首先让我们通过官网的一张图来看看Unity Shader里面占据重要地位的3D Model,Material,Shader之间的关系：<br><img src="/img/Unity/UnityShaderFundamention.PNG" alt="UnityShaderFundamention"><br>可以看出Material会决定使用哪些Texture和Shader去渲染Model。<br>Shader是针对Texture和Model去做运算的地方。</p>
<p>Unity Shader分为两种：</p>
<ol>
<li><p>Surface shader<br>Time to use — “Whenever the material you want to simulate needs to be affected by lights in a realistic way, chances are you’ll need a surface shader. Surface shaders hide the calculations of how light is reflected and allows to specify “intuitive” properties such as the albedo, the normals, the reflectivity and so on in a function called surf.”<br>可以看出Unity的Surface Shader帮我们把光照对物体的影响的计算抽象了出来。我们只需设定一些控制系数，然后通过Surface Shader的surf方法就能触发光照作用对表面的运算。<br>下面简单看下官网给出的Surface Shader Code：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CGPROGRAM</span><br><span class="line"><span class="comment">// Uses the Lambertian lighting model</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> surface surf Lambert</span></span><br><span class="line"></span><br><span class="line">sampler2D _MainTex; <span class="comment">// The input texture</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Input &#123;</span><br><span class="line">    float2 uv_MainTex;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutput o</span>) </span>&#123;</span><br><span class="line">    o.Albedo = tex2D (_MainTex, IN.uv_MainTex).rgb;</span><br><span class="line">&#125;</span><br><span class="line">ENDCG</span><br></pre></td></tr></table></figure>
<p> Note:<br> 必须使用#pragma surface去表示是surface shader<br> Surface Shader的Code是包含在SubShader里的并且必须写在CGPROGRAM和ENDCG标识之间。</p>
</li>
<li>Fragment and Vertex Shaders<br>Fragment and Vertex Shaders就跟OpenGL里差不多，model的vertex会经历完整的Shader Pipeline，最终通过计算得出最终的颜色。<br>让我们来看看官网给出的Fragment and Vertex Shaders Code:<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Pass &#123;</span><br><span class="line">    CGPROGRAM</span><br><span class="line"></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">pragma</span> vertex vert             </span></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> vertInput &#123;</span><br><span class="line">        float4 pos : POSITION;</span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> vertOutput &#123;</span><br><span class="line">        float4 pos : SV_POSITION;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function">vertOutput <span class="title">vert</span>(<span class="params">vertInput input</span>) </span>&#123;</span><br><span class="line">        vertOutput o;</span><br><span class="line">        o.pos = mul(UNITY_MATRIX_MVP, input.pos);</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">half4 <span class="title">frag</span>(<span class="params">vertOutput output</span>) : COLOR </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> half4(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    ENDCG</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>可以看出vert方法好比OpenGL里vertex shader的main函数入口。<br>frag方法好比OpenGL里fragment shader的main函数入口。<br>这里frag方法return的half4相当于OpenGL FS里的FragColor。<br>可以看出我们还是需要在VS里先将vertex变换到透视投影坐标系，然后最后传递给FS，FS计算出最终的颜色。<br>Note：<br>这里需要注意的一点是，在VS和FS Shader里，code是包含在Pass {…..}里的。</p>
<p>让我们来看看官网给出的Shader的大体结构：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"MyShader"</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The properties of your shaders</span></span><br><span class="line">        <span class="comment">// - textures</span></span><br><span class="line">        <span class="comment">// - colours</span></span><br><span class="line">        <span class="comment">// - parameters</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The code of your shaders</span></span><br><span class="line">        <span class="comment">// - surface shader</span></span><br><span class="line">        <span class="comment">//    OR</span></span><br><span class="line">        <span class="comment">// - vertex and fragment shader</span></span><br><span class="line">        <span class="comment">//    OR</span></span><br><span class="line">        <span class="comment">// - fixed function shader</span></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Properties:<br>“The properties of your shader are somehow equivalent to the public fields in a C# script; they’ll appear in the inspector of your material, giving you the chance to tweak them.”<br>从这里看出Properties在Unity里相当于OPENGL Shader里定义的Uniform，Sampler，全局变量等，用于作为可控的输入。<br>让我们来看看官网给出的例子<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Properties</span><br><span class="line">&#123;</span><br><span class="line">    _MyTexture (<span class="string">"My texture"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125;</span><br><span class="line">    _MyNormalMap (<span class="string">"My normal map"</span>, <span class="number">2</span>D) = <span class="string">"bump"</span> &#123;&#125;  <span class="comment">// Grey</span></span><br><span class="line"></span><br><span class="line">    _MyInt (<span class="string">"My integer"</span>, Int) = <span class="number">2</span></span><br><span class="line">    _MyFloat (<span class="string">"My float"</span>, Float) = <span class="number">1.5</span></span><br><span class="line">    _MyRange (<span class="string">"My range"</span>, Range(<span class="number">0.0</span>, <span class="number">1.0</span>)) = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    _MyColor (<span class="string">"My colour"</span>, Color) = (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)    <span class="comment">// (R, G, B, A)</span></span><br><span class="line">    _MyVector (<span class="string">"My Vector4"</span>, Vector) = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>) <span class="comment">// (x, y, z, w)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>让我们先看看对应显示在Unity面板是什么模样：<br><img src="/img/Unity/UnityShaderProperty.PNG" alt="UnityShaderProperty"><br>2D代表_MyTexture,_MyNormalMap是texture类型.Color代表颜色。Range代表范围值……<br>可以看到Properties里定义的变量都显示在了Unity面板里用于控制。但是真正通过Shader去访问，我们还需要在SubShader里重新定义对应的变量。<br>SubShader：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SubShader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Code of the shader</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    sampler2D _MyTexture;</span><br><span class="line">    sampler2D _MyNormalMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> _MyInt;</span><br><span class="line">    <span class="keyword">float</span> _MyFloat;</span><br><span class="line">    <span class="keyword">float</span> _MyRange;</span><br><span class="line">    half4 _MyColor;</span><br><span class="line">    float4 _MyVector;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Code of the shader</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看出Texture在Unity Shader里面的定义和在OpenGL Shader里差不多，也是通过sampler2D，只是不再需要加uniform修饰了。<br>这里值得注意的是Color对应的不是Vector4而是half4。<br>还有就是在Properties里定义的变量名在SubShader要一一对应。</p>
<p>接下来让我们看看官网给出的SubShader里Shader具体是怎样的格式：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SubShader</span><br><span class="line">&#123;</span><br><span class="line">    Tags</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Queue"</span> = <span class="string">"Geometry"</span></span><br><span class="line">        <span class="string">"RenderType"</span> = <span class="string">"Opaque"</span></span><br><span class="line">    &#125;</span><br><span class="line">    CGPROGRAM</span><br><span class="line">    <span class="comment">// Cg / HLSL code of the shader</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    ENDCG</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>真正的Shader Code是在CGPROGRAM和ENGCG里。<br>这里需要先提一下Tags的作用，Tags是为了告诉Unity我们Shader的特定属性(比如RenderType-渲染类型，Queue—渲染顺序)。</p>
<h3 id="Surface_Shaders">Surface Shaders</h3><p>让我们看看Surface Shader的大体流程：<br><a href="http://www.alanzucconi.com/2015/06/17/surface-shaders-in-unity3d/" target="_blank" rel="external">下图来源</a><br><img src="/img/Unity/SurfaceShaderFlowChart.PNG" alt="SurfaceShaderFlowChart"><br>从上图可以看出，Surace Shader通过Surface function生成最终参与光照计算所需的数据(rendering properties — e.g. texture……)。</p>
<p>让我们来看看Surface Shader里的关键组成部分：</p>
<ol>
<li>Surface function<br>Surface function把model data作为输入，把rendering properties作为输出，这些rendering properties最后会参与光照的计算得到最终颜色。</li>
<li>Input<br>Input structure一般包含了texture相关的信息(比如 UV坐标信息)，也可以包含一些额外信息(<a href="https://docs.unity3d.com/Manual/SL-SurfaceShaders.html" target="_blank" rel="external">参见</a>)<br>Note:<br>定义texture coordinate的时候必须以uv或者uv2开头加texture名字。</li>
<li><p>SurfaceOutput<br>SurfaceOutput描述了surface的属性，这些属性最终会参与光照计算。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> SurfaceOutput</span><br><span class="line">&#123;</span><br><span class="line">    fixed3 Albedo;  <span class="comment">// diffuse color</span></span><br><span class="line">    fixed3 Normal;  <span class="comment">// tangent space normal, if written</span></span><br><span class="line">    fixed3 Emission;</span><br><span class="line">    half Specular;  <span class="comment">// specular power in 0..1 range</span></span><br><span class="line">    <span class="keyword">fixed</span> Gloss;    <span class="comment">// specular intensity</span></span><br><span class="line">    <span class="keyword">fixed</span> Alpha;    <span class="comment">// alpha for transparencies</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> 我们可以通过Shader去计算上面参与光照计算的属性去影响Surface的最终效果，从而达到Surface Shader的真正目的。</p>
</li>
<li>Light Model<br>Light Model是真正通过SurfaceOutput属性去计算光照的地方，通过使用或编写不同的Light Model我们可以实现不同的光照影响效果。<br>那么如何定义光照运算函数了？<ol>
<li>half4 Lighting<name> (SurfaceOutput s, half3 lightDir, half atten);<br>因为没有viewDir所以这里是用于不需要知道观察点的Ambient光照计算</name></li>
<li>half4 Lighting<name> (SurfaceOutput s, half3 lightDir, half3 viewDir, half atten);<br>因为有了viewDir，知道了观察点信息，我们可以计算出需要知道观察点的Diffuse和Specular光照。</name></li>
<li>half4 Lighting<name>_PrePass (SurfaceOutput s, half4 light);<br>这个用于Deferer Shading(但这里我比较好奇的是如果要计算Diffuse和Specular光照还是需要知道lightDir和viewDir等信息才对。)<br>Note：<br>自定义光照模型的时候，我们不需要定义所有的光照函数，只需定义我们需要的即可。</name></li>
</ol>
</li>
<li><p>Vertex Function<br>Provide the ability to change vertices before sending them to surf.<br>定义方式如下：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vert</span>(<span class="params">inout appdata_full v</span>)</span>&#123;......&#125;</span><br></pre></td></tr></table></figure>
<p> appdata_full包含了所有vertex相关的信息</p>
</li>
<li>Finalcolor Function<br>用于对经过Surface Shader处理后的pixel进行最后的处理。<br>格式如下：<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> surface surf Lambert finalcolor:mycolor</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mycolor</span> (<span class="params">Input IN, SurfaceOutput o, inout fixed4 color</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    color *= _ColorTint;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>接下来让我们通过创建自己的Surface Shader来感受下Surface Shader实际运用效果(这里我拿了SurviveShooter里的模型做输入)：</strong><br>我们删掉默认创建的Shader Code，只简单输出Albedo(Diffuse Color)看看效果:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Custom/TonyShader"</span> &#123;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">	    <span class="comment">// 定义渲染顺序 - RenderType</span></span><br><span class="line">		Tags &#123; <span class="string">"RenderType"</span>=<span class="string">"Opaque"</span> &#125;</span><br><span class="line">		</span><br><span class="line">		CGPROGRAM</span><br><span class="line">		<span class="comment">// #pragma surface指明是surface shader</span></span><br><span class="line">		<span class="comment">// surf Lambert指明用的光照模式是Lambert(会决定光照是如何计算的)</span></span><br><span class="line">		<span class="preprocessor">#<span class="keyword">pragma</span> surface surf Lambert</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">struct</span> Input &#123;</span><br><span class="line">			float2 color : COLOR;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutput o</span>) </span>&#123;</span><br><span class="line">			o.Albedo = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		ENDCG</span><br><span class="line">	&#125; </span><br><span class="line">	FallBack <span class="string">"Diffuse"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/SurfaceShaderWithAlbedoSetting.PNG" alt="SurfaceShaderWithAlbedoSetting"><br><strong>接下来让我们给Hellephant加上纹理图案：</strong><br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Custom/TonyShader"</span> &#123;</span><br><span class="line">    Properties&#123;</span><br><span class="line">        <span class="comment">// 为了在编辑器里提供控制纹理输入，Properties必须和struct Input里的uv_MainTex对应</span></span><br><span class="line">        _MainTex(<span class="string">"Texture"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	SubShader&#123;</span><br><span class="line">        Tags&#123; <span class="string">"RenderType"</span> = <span class="string">"Opaque"</span>&#125;</span><br><span class="line">        CGPROGRAM</span><br><span class="line">        <span class="preprocessor">#<span class="keyword">pragma</span> surface surf Lambert</span></span><br><span class="line">	    <span class="comment">// 提供纹理输入</span></span><br><span class="line">	    <span class="keyword">struct</span> Input&#123;</span><br><span class="line">	        float2 uv_MainTex</span><br><span class="line">	    &#125;;</span><br><span class="line">	    sampler2D _MainTex;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutputStandard o</span>) </span>&#123;</span><br><span class="line">			o.Albedo = tex2D(_MainTex, IN.uv_MainTex).rgb;</span><br><span class="line">		&#125;</span><br><span class="line">		ENDCG</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback <span class="string">"Diffuse"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/SurfaceShaderWithTexture.PNG" alt="SurfaceShaderWithTexture"><br>让我们看看现在对应的Unity Material Editor：<br><img src="/img/Unity/SurfaceShaderMaterialEditorWithTexture.PNG" alt="SurfaceShaderMaterialEditorWithTexture"><br><strong>图像看起来还不真实，没有深度感，接下来我们添加<a href="http://tonytang1990.github.io/2015/08/26/OpenGL-Study/#Light_and_Shadow">Normal Mapping 参见</a>：</strong><br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Custom/TonyShader"</span> &#123;</span><br><span class="line">    Properties&#123;</span><br><span class="line">        .....</span><br><span class="line">        _BumpMap(<span class="string">"Bumpmap"</span>, <span class="number">2</span>D) = <span class="string">"bump"</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	SubShader&#123;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="keyword">struct</span> Input&#123;</span><br><span class="line">	        ......</span><br><span class="line">	        float2 uv_BumpMap;</span><br><span class="line">	    &#125;;</span><br><span class="line">	    ......</span><br><span class="line">	    sampler2D _BumpMap;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutputStandard o</span>) </span>&#123;</span><br><span class="line">            ......</span><br><span class="line">			o.Normal = UnpackNormal(tex2D(_BumpMap, IN.uv_Bumpmap));</span><br><span class="line">		&#125;</span><br><span class="line">		ENDCG</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback <span class="string">"Diffuse"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>UnpackNormal接受一个fixed4的输入，并将其转换为所对应的法线值（fixed3）<br>比较有无Normal map的效果，见如下：<br><img src="/img/Unity/SurfaceShaderWithNormalMap.PNG" alt="SurfaceShaderWithNormalMap"><br><img src="/img/Unity/SurfaceShaderWithTexture.PNG" alt="SurfaceShaderWithTexture"><br><strong>接下来让我们通过计算Normal和Viedir的情况去高亮物体：</strong><br>这里需要用到build-in variable viewDir(代表观察者看顶点的方向)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Custom/TonyShader"</span> &#123;</span><br><span class="line">	Properties&#123;</span><br><span class="line">        ......</span><br><span class="line">		_RimColor(<span class="string">"Rim Color"</span>, Color) = (<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>)</span><br><span class="line">		_RimPower(<span class="string">"Rim Power"</span>, Range(<span class="number">0.5</span>, <span class="number">8.0</span>)) = <span class="number">3.0</span></span><br><span class="line">	&#125;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">        ......</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">struct</span> Input &#123;</span><br><span class="line">		    .....</span><br><span class="line">		  	float3 viewDir;</span><br><span class="line">		&#125;;</span><br><span class="line">        ......</span><br><span class="line">		float4 _RimColor;</span><br><span class="line">		<span class="keyword">float</span> _RimPower;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutput o</span>) </span>&#123;</span><br><span class="line">            ......</span><br><span class="line">			half rim = <span class="number">1.0</span> - saturate(dot(normalize(IN.viewDir), o.Normal));</span><br><span class="line">			o.Emission = _RimColor.rgb * pow(rim, _RimPower);</span><br><span class="line">		&#125;</span><br><span class="line">		ENDCG</span><br><span class="line">	&#125; </span><br><span class="line">	FallBack <span class="string">"Diffuse"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>saturate的作用是把观察者方向和顶点法线夹角Cos值限定在[0,1]，再用1减去这个值，表明观察者方向和顶点法线夹角越小rim值越小，当夹角大于等于90度的时候达到rim最大值。从而实现高亮边缘的效果(周边和观察者角度往往比较大)。<br><img src="/img/Unity/SurfaceShaderWithEmssion.PNG" alt="SurfaceShaderWithEmssion"><br><strong>接下来我们看看通过vertex function去动态计算新vertex值的效果(这里我们根据顶点法线方向去收缩顶点postion)：</strong><br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Custom/TonyShader"</span> &#123;</span><br><span class="line">	Properties&#123;</span><br><span class="line">        ......</span><br><span class="line">		_Amount(<span class="string">"Extrusion Amount"</span>, Range(-<span class="number">0.5</span>,<span class="number">0.5</span>)) = <span class="number">0.0</span></span><br><span class="line">	&#125;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">   		CGPROGRAM</span><br><span class="line">   		<span class="comment">// vertex:vert定义了vert方法名</span></span><br><span class="line">		<span class="preprocessor">#<span class="keyword">pragma</span> surface surf Lambert vertex:vert</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">float</span> _Amount;</span><br><span class="line">		<span class="comment">// vert方法定义，根据顶点法线去计算新的顶点位置</span></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">vert</span>(<span class="params">inout appdata_full v</span>)</span>&#123;</span><br><span class="line">			v.vertex.xyz += v.normal * _Amount;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutput o</span>) </span>&#123;</span><br><span class="line">		    ......</span><br><span class="line">	    &#125;</span><br><span class="line">		ENDCG</span><br><span class="line">	&#125; </span><br><span class="line">	FallBack <span class="string">"Diffuse"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/SurfaceShaderWithNegativeExtrusion.PNG" alt="SurfaceShaderWithNegativeExtrusion"><br><img src="/img/Unity/SurfaceShaderWithPositiveExtrusion.PNG" alt="SurfaceShaderWithPositiveExtrusion"><br>在vert function里我们也可以自定义一些成员在surface shader里传递，但这样的话vert必须有两个参数，一个inout appdata_full v,一个out Input o，这里的out Input o回座位surf function的Input IN参数作为输入。<a href="http://docs.unity3d.com/Manual/SL-SurfaceShaderExamples.html" target="_blank" rel="external">Custom Input Member详细用法参见</a><br><strong>接下来让我们看看Light Model对于最终颜色计算的影响：</strong><br>待学习了解<br><strong>最后我们来看看Final Color Function是如何影响最终颜色计算的：</strong><br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Custom/TonyShader"</span> &#123;</span><br><span class="line">	Properties&#123;</span><br><span class="line">        ......</span><br><span class="line">		_ColorTint(<span class="string">"Tint"</span>, Color) = (<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">		Tags &#123; <span class="string">"RenderType"</span>=<span class="string">"Opaque"</span> &#125;</span><br><span class="line">		</span><br><span class="line">		CGPROGRAM</span><br><span class="line">		<span class="comment">// finalcolor:mycolor定义final function name</span></span><br><span class="line">		<span class="preprocessor">#<span class="keyword">pragma</span> surface surf Lambert vertex:vert finalcolor:mycolor</span></span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">		fixed4 _ColorTint;</span><br><span class="line">		<span class="comment">// final color function格式， color会影响所有lightmaps,light probes等的颜色信息</span></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">mycolor</span>(<span class="params">Input IN, SurfaceOutput o, inout fixed4 color</span>)</span><br><span class="line">		</span>&#123;</span><br><span class="line">			color *= _ColorTint;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">surf</span> (<span class="params">Input IN, inout SurfaceOutput o</span>) </span>&#123;</span><br><span class="line">		    ......</span><br><span class="line">	    &#125;</span><br><span class="line">		ENDCG</span><br><span class="line">	&#125; </span><br><span class="line">	FallBack <span class="string">"Diffuse"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/SurfaceShaderWithFinalColorFunction.PNG" alt="SurfaceShaderWithFinalColorFunction"></p>
<h3 id="Vertex_and_Fragment_Shaders">Vertex and Fragment Shaders</h3><p>Note：<br>Unity里Shader是用Cg/HLSL编写。</p>
<h2 id="Excel数据读取">Excel数据读取</h2><p>Unity官网给出TextAsset类用于读取下列格式的文件：<br>.txt, .html, .htm, .xml, .bytes, .json, .csv(<a href="http://baike.baidu.com/link?url=k66qCiCo7dQ2gA3bS09xk_ZhFBldafez_7Ux64tJvvwAx2HcsLW3cFIaKoGua_HnlHV3nnDgHL5NdqwSKHEV_KHhRVEm-B0mYguaAcxSFDm" target="_blank" rel="external">逗号分隔值（Comma-Separated Values，CSV，有时也称为字符分隔值，因为分隔字符也可以不是逗号），其文件以纯文本形式存储表格数据（数字和文本）</a>), .yaml, .fnt<br>从上面可以看出并不支持直接对excel(.xlsx，.xls等格式)的解析。<br>通过官网可以看出TextAsset是针对文本和二进制类型文件的读取，具体的解析还得自己去写。<br>所以并不是我想找的Excel解析的解决方案。<br>让我们来看看这篇文章<a href="http://www.mamicode.com/info-detail-494944.html" target="_blank" rel="external">Unity3D游戏开发之当游戏开发遇上Excel</a>。<br>作者对Excel解析下了不少功夫。<br>从上面可以看出，针对Excel解析作者找到了三中解决方案：</p>
<ol>
<li>Microsoft.Office.Interop.Excel<br><a href="http://www.mamicode.com/info-detail-494944.html" target="_blank" rel="external">基于微软提供的Office API,这组API以COM组件的形式给出，我们可以通过调用该API实现对Excel文件的解析。微软的Office API特点是使用起来方便，可以使用C#、Visual Basic等语言进行相关开发。可是这种解决方案的的缺点同样很明显，因为COM组件主要依赖于系统，因此使用COM组件需要在系统中注册，这将对代码的可移植性产生影响，而且受制于COM技术，这种解决方案只能运行在Windows平台上，无法实现跨平台，加之解析速度较慢，因此这种方案通常只适合在解析速度要求不高，运行环境为Windows平台的应用场景。</a><br>关键词：<br>不跨平台</li>
<li>ExcelReader<br>ExcelRead就是跨平台目标下解析Excel文件的首选方案。<br><a href="http://exceldatareader.codeplex.com/" target="_blank" rel="external">ExcelRead website</a><br>从描述来看支持Windows和OS X，Linux等(注意不包含移动端IOS和Android)。但就PC端来看已经足够作为解析Excel的方式了。<br>Note：<br>针对移动端的时候可以采用先在PC端把数据读取出来写到单独的数据文件，然后再到移动端去读取解析。</li>
<li>FastExcel<br>FastExcel是一个在开源世界里的一个java编写的工具。<a href="http://fastexcel.sourceforge.net/" target="_blank" rel="external">FastExcel Website</a>。官网上有简单demo方便快速集成。</li>
</ol>
<p>接下来我选择以ExcelReader为解决方案，尝试使用ExcelReader来解析Excel。</p>
<ol>
<li>下载Dll，官网的建议是直接下载DLL来用<br><a href="http://exceldatareader.codeplex.com/" target="_blank" rel="external">ExcelReader DLL Download</a><br>可以看到主要有两个DLL(Excel.4.5.dll &amp; ICSharpCode.SharpZiplib.dll)<br><img src="/img/Unity/ExcelReaderDLL.PNG" alt="ExcelReaderDLL"></li>
<li>导入DLL到Unity(Unity对Managed Plugins支持很方便，直接在Asset下创建一个目录copy进去即可)<br>Note:<br>这里要注意的一点，需要采用基于.net 2.0的dll而非基于.net 4.5的(我想是由于mono还不支持所有.net的特性导致的)</li>
<li>通过导入命名空间就可以正常使用ExcelReader库了<br>以下是根据代码参考<a href="http://www.mamicode.com/info-detail-494944.html" target="_blank" rel="external">Unity3D游戏开发之当游戏开发遇上Excel</a>和<a href="http://www.xuanyusong.com/archives/2429" target="_blank" rel="external">Unity3D研究院之MAC&amp;Windows跨平台解析Excel（六十五）</a>和<a href="http://exceldatareader.codeplex.com/" target="_blank" rel="external">Excel Data Reader - Read Excel files in .NET</a>：<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> Excel;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameConfigurationManager</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> GameConfigurationManager mLMInstance = <span class="keyword">new</span> GameConfigurationManager();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> ConfigurationPath</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            mConfigurationPath = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> mConfigurationPath = <span class="string">"/Configuration/AccountPasswordAndGameSetting.xlsx"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mIsConfigurationComplete = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">GameConfigurationManager</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!mIsConfigurationComplete)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">               ReadConfiguration();</span><br><span class="line">                mIsConfigurationComplete = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                mIsConfigurationComplete = <span class="keyword">false</span>;</span><br><span class="line">                Debug.Log(<span class="string">"Exception "</span> + e.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ReadConfiguration</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">"Application.dataPath = "</span> + Application.dataPath);</span><br><span class="line">        Debug.Log(<span class="string">"mConfigurationPath = "</span> + mConfigurationPath);</span><br><span class="line"></span><br><span class="line">        FileStream stream = File.Open(Application.dataPath + mConfigurationPath, FileMode.Open, FileAccess.Read);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Reading from a excel file</span></span><br><span class="line">        IExcelDataReader excelreader = ExcelReaderFactory.CreateOpenXmlReader(stream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// DataSet -- the result of each spreadsheet will be created in the result tables</span></span><br><span class="line">        DataSet result = excelreader.AsDataSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> sheetcount = result.Tables.Count;</span><br><span class="line">        Debug.Log(<span class="string">"sheetcount = "</span> + sheetcount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; sheetcount; m++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> rows = result.Tables[m].Rows.Count;</span><br><span class="line">            <span class="keyword">int</span> columns = result.Tables[m].Columns.Count;</span><br><span class="line">            Debug.Log(<span class="keyword">string</span>.Format(<span class="string">"Table[&#123;0&#125;] with row = &#123;1&#125; columns = &#123;2&#125;"</span>, m, rows, columns));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; columns; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">string</span> <span class="keyword">value</span> = result.Tables[m].Rows[i][j].ToString();</span><br><span class="line">                    Debug.Log(<span class="keyword">string</span>.Format(<span class="string">"result.Tables[&#123;0&#125;].Rows[&#123;1&#125;][&#123;2&#125;] = &#123;3&#125;"</span>,m,i,j,<span class="keyword">value</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        excelreader.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>通过上述方法我成功的打印出了AccountPasswordAndGameSetting.xlsx里2个sheet的数据，见下图：<br><img src="/img/Unity/AccountPasswordAndGameSettingSheet1.PNG" alt="AccountPasswordAndGameSettingSheet1"><br><img src="/img/Unity/AccountPasswordAndGameSettingSheet2.PNG" alt="AccountPasswordAndGameSettingSheet2"><br><img src="/img/Unity/ExcelReaderOutput.PNG" alt="ExcelReaderOutput"><br>Note:<br>上面有用到DataSet，DataSet类是属于System.Data.dll里的，所以我们还必须Copy存放在**\Unity\Editor\Data\Mono\lib\mono\2.0下的System.Data.dll到我们的Dlls目录。</p>
<h1 id="Plugins">Plugins</h1><h2 id="NGUI">NGUI</h2><p>NGUI是C#写的第三方插件，堪称Unity 4.6之前最完美的GUI解决方案(NGUI 2.7及之前貌似是免费)，复杂的UI都能在一个Draw Call完成渲染。<br>出于学习目的下载NGUI 2.7试试：<br><a href="http://forum.unity3d.com/threads/ngui-free-edition.124032/" target="_blank" rel="external">NGUI 2.7 Download</a><br>一下学习都是基于NGUI 2.7版本学习的，新的版本特性这里没有涉及到。</p>
<h3 id="Tutorials">Tutorials</h3><p><a href="http://www.tasharen.com/?page_id=197" target="_blank" rel="external">以下学习参考</a></p>
<h4 id="Creating_Your_UI">Creating Your UI</h4><p>这里就不再一一讲述步骤了，主要记录一些重要的概念。<br>先来看看我们创建出UI之后的UI层次结构：<br><img src="/img/Unity/NGUIUIHierachy.PNG" alt="NGUIUIHierachy"><br>看看各组成部分的作用：</p>
<ol>
<li>UI Root<br>上面挂载UIRoot Script，这个脚本的主要目的是把所有挂载在UI Root下的object 所在屏幕比例根据屏幕大小变化而变化<br><a href="http://www.tasharen.com/?page_id=619" target="_blank" rel="external">When attached to the root object of the UI, it will scale that object by the inverse of the screen’s height, thus maintaining a 1 pixel = 1 unit ratio, ensuring pixel-perfect UIs.</a><br>UIStretch — <a href="http://www.tasharen.com/?page_id=619" target="_blank" rel="external">This script is capable of stretching the widget relative to the size of the screen (or, if specified — panel or widget size).</a><br>UIStretch是自适应的关键，根据屏幕或特定panel长宽变化去做适应。但后来的NGUI版本好像对自适应这一块做了很大修改，UIStretch貌似不再支持。</li>
<li>Camera<br>上面挂载了UICamera Script，这个脚本的主要目的是”contains NGUI’s event system”，至于消息是如何传递的这里先暂时不管，以后会深入学习。</li>
<li>Anchor<br>上面挂载了UIAnchor Script，这个脚本的主要目的是”apply a half-pixel offset on Windows machines, for pixel-perfect results.”(把UI限定在窗口特定位置，当窗口变化的时候会依然处于相对窗口的位置)</li>
<li>Panel<br>上面挂载了UIPanel，这个脚本的主要目的是”container that will collect all UI widgets under it and will combine them into as few draw calls as possible.”(这里相当于UI的管理容器，负责以最少的draw call去管理UI)</li>
</ol>
<h4 id="Sprite">Sprite</h4><p>创建了UI，那么接下来就是增加我们的UI组件。<br>通过Widget Tool可以创建一系列不同类型的组件，这里有两个概念比较重要。<br>Atlas(图集) — Atlas好比我们的图片库，因为组件会需要选择图案，而Atlas定义了切割好的图集可供选择<br>Font(字体库) — 正如其名，字体库，至于字体库是怎么制作的这里暂时不得而知(待学习)<br>让我们简单看一下创建一个Sprite后的显示面板：<br><img src="/img/Unity/SpriteControlPanel.PNG" alt="SpriteControlPanel"><br>这里Sprite有深度的概念，通过调节Depth我们可以实现层次排序。<br>还值得注意的一点是Sprite有个属性Sprite Type，这里的Sprite Type不仅可以决定Sprite如何显示，还会影响Sprite如何去适应显示区域。</p>
<h5 id="9-Sliced_Sprite">9-Sliced Sprite</h5><p>Sliced技术会决定如何去拉伸图案去适应显示区域而不至于看起来变形。<br><a href="http://www.unityrealm.com/unity-9-slice-advantages/" target="_blank" rel="external">9-Sliced详解</a></p>
<h5 id="Tiled_Sprite">Tiled Sprite</h5><p>Tiled Sprite是用原始sprite大小去铺满显示区域</p>
<p>Note:<br>这里有一个官网说是显示Debug Info的东西，通过把Panel的Debug Info设置成Geometry，场景里会增加一个叫_UIDrawCall的对象。<br><img src="/img/Unity/UIDrawCall.PNG" alt="UIDrawCall"><br>(这里还不太明白是什么，但看起来是把UI更新整合到一个Draw Call里了)</p>
<h4 id="Label">Label</h4><p>Lable里的字来源于我们之前选的字库。<br>在Label里填写文本有个比较方便的设定，可以通过[hex color]改变后续文本的颜色e.g. [FF0000]代表红色。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FF0000]NGUI's [FFFFFF]lables can have [00FF00]embedded </span><br><span class="line">[0000FF]colors.</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/LabelFont.PNG" alt="LabelFont"></p>
<h4 id="Button">Button</h4><p>当我们添加了Button后，如何响应事件了？<br>“anything with a collider on it will receive all of the events.”</p>
<p>还记得之前说UICamera负责发送所有事件吗？所有在Camera(绑定了UICamera)下的UI都会接受到Event(前提是设置了event发送到UI层)。<br>让我们来看下UICamera的一些public可控变量：<br><img src="/img/Unity/UICameraPanel.PNG" alt="UICameraPanel"><br>让我们关注一些比较重要的点：<br>Event Receive Mask — 控制了接受events的layer层<br>Debug — debug模式下可以让我们看到哪一个game objec<br>t接收到了event<br>Range Distance — 控制raycast的有效范围<br>Scroll Axis Name — 设定横向控制来源<br>Vertical Axis Name — 设定纵向控制来源<br>……</p>
<p>接下来让我们看看UICamera都负责发送哪些事件？(具体可以参见UICamera源码)<br>    OnHover (isOver) is sent when the mouse hovers over a collider or moves away.<br>    OnPress (isDown) is sent when a mouse button gets pressed on the collider.<br>    OnSelect (selected) is sent when a mouse button is first pressed on a game object. Repeated presses on the same object won’t result in a new OnSelect.<br>    OnClick () is sent with the same conditions as OnSelect, with the added check to see if the mouse has not moved much. UICamera.currentTouchID tells you which button was clicked.<br>    OnDoubleClick () is sent when the click happens twice within a fourth of a second. UICamera.currentTouchID tells you which button was clicked.<br>    OnDragStart () is sent to a game object under the touch just before the OnDrag() notifications begin.<br>    OnDrag (delta) is sent to an object that’s being dragged.<br>    OnDragOver (draggedObject) is sent to a game object when another object is dragged over its area.<br>    OnDragOut (draggedObject) is sent to a game object when another object is dragged out of its area.<br>    OnDragEnd () is sent to a dragged object when the drag event finishes.<br>    OnInput (text) is sent when typing (after selecting a collider by clicking on it).<br>    OnTooltip (show) is sent when the mouse hovers over a collider for some time without moving.<br>    OnScroll (float delta) is sent out when the mouse scroll wheel is moved.<br>    OnKey (KeyCode key) is sent when keyboard or controller input is used.</p>
<p>那么知道了发送哪些事件，那么我们如何通过添加的控件去响应事件了？</p>
<ol>
<li>控件要处于Camera(含UICamera脚本)之下</li>
<li>Layer处于UICamera的Event Receiver Mask</li>
<li>接受事件的控件必须包含Collider</li>
<li><p>自定义响应方法</p>
<ol>
<li><p>定义对应事件响应的方法并挂载到需要响应的Game Object上</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnPress</span>(<span class="params"><span class="keyword">bool</span> isPressed</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"Exit button is pressed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"Exit button is unpressed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过UIListener，直接添加delegate去监听事件<br>首先现在需要实现delegate监听事件的控件上添加一个UIListener脚本(Component -&gt; NGUI -&gt; Internal -&gt; Event Listener)。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIListener Soure Code</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">//            NGUI: Next-Gen UI kit</span></span><br><span class="line"><span class="comment">// Copyright © 2011-2013 Tasharen Entertainment</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Event Hook class lets you easily add remote event listener functions to an object.</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Example usage: UIEventListener.Get(gameObject).onClick += MyClickFunction;</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"></span><br><span class="line">[AddComponentMenu(<span class="string">"NGUI/Internal/Event Listener"</span>)]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIEventListener</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">VoidDelegate</span> (<span class="params">GameObject go</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">BoolDelegate</span> (<span class="params">GameObject go, <span class="keyword">bool</span> state</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">FloatDelegate</span> (<span class="params">GameObject go, <span class="keyword">float</span> delta</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">VectorDelegate</span> (<span class="params">GameObject go, Vector2 delta</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">StringDelegate</span> (<span class="params">GameObject go, <span class="keyword">string</span> text</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">ObjectDelegate</span> (<span class="params">GameObject go, GameObject draggedObject</span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">KeyCodeDelegate</span> (<span class="params">GameObject go, KeyCode key</span>)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">object</span> parameter;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> VoidDelegate onSubmit;</span><br><span class="line">	<span class="keyword">public</span> VoidDelegate onClick;</span><br><span class="line">	<span class="keyword">public</span> VoidDelegate onDoubleClick;</span><br><span class="line">	<span class="keyword">public</span> BoolDelegate onHover;</span><br><span class="line">	<span class="keyword">public</span> BoolDelegate onPress;</span><br><span class="line">	<span class="keyword">public</span> BoolDelegate onSelect;</span><br><span class="line">	<span class="keyword">public</span> FloatDelegate onScroll;</span><br><span class="line">	<span class="keyword">public</span> VectorDelegate onDrag;</span><br><span class="line">	<span class="keyword">public</span> ObjectDelegate onDrop;</span><br><span class="line">	<span class="keyword">public</span> StringDelegate onInput;</span><br><span class="line">	<span class="keyword">public</span> KeyCodeDelegate onKey;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnSubmit</span> (<span class="params"></span>)				</span>&#123; <span class="keyword">if</span> (onSubmit != <span class="keyword">null</span>) onSubmit(gameObject); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnClick</span> (<span class="params"></span>)					</span>&#123; <span class="keyword">if</span> (onClick != <span class="keyword">null</span>) onClick(gameObject); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnDoubleClick</span> (<span class="params"></span>)			</span>&#123; <span class="keyword">if</span> (onDoubleClick != <span class="keyword">null</span>) onDoubleClick(gameObject); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnHover</span> (<span class="params"><span class="keyword">bool</span> isOver</span>)		</span>&#123; <span class="keyword">if</span> (onHover != <span class="keyword">null</span>) onHover(gameObject, isOver); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnPress</span> (<span class="params"><span class="keyword">bool</span> isPressed</span>)	</span>&#123; <span class="keyword">if</span> (onPress != <span class="keyword">null</span>) onPress(gameObject, isPressed); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnSelect</span> (<span class="params"><span class="keyword">bool</span> selected</span>)	</span>&#123; <span class="keyword">if</span> (onSelect != <span class="keyword">null</span>) onSelect(gameObject, selected); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnScroll</span> (<span class="params"><span class="keyword">float</span> delta</span>)		</span>&#123; <span class="keyword">if</span> (onScroll != <span class="keyword">null</span>) onScroll(gameObject, delta); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnDrag</span> (<span class="params">Vector2 delta</span>)		</span>&#123; <span class="keyword">if</span> (onDrag != <span class="keyword">null</span>) onDrag(gameObject, delta); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnDrop</span> (<span class="params">GameObject go</span>)		</span>&#123; <span class="keyword">if</span> (onDrop != <span class="keyword">null</span>) onDrop(gameObject, go); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnInput</span> (<span class="params"><span class="keyword">string</span> text</span>)		</span>&#123; <span class="keyword">if</span> (onInput != <span class="keyword">null</span>) onInput(gameObject, text); &#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnKey</span> (<span class="params">KeyCode key</span>)		</span>&#123; <span class="keyword">if</span> (onKey != <span class="keyword">null</span>) onKey(gameObject, key); &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="xmlDocTag">///</span> Get or add an event listener to the specified game object.</span></span><br><span class="line">	<span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">public</span> UIEventListener <span class="title">Get</span> (<span class="params">GameObject go</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		UIEventListener listener = go.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">		<span class="keyword">if</span> (listener == <span class="keyword">null</span>) listener = go.AddComponent&lt;UIEventListener&gt;();</span><br><span class="line">		<span class="keyword">return</span> listener;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<p>可以看出通过UIListener，该控件已经具备了响应UI Event的能力，而且每一个UI Event都定义了对应的delegate，这样一来我们就可以通过动态的添加修改每一个UI event的delegate实现控制UI Event响应了。<br>那么接下来我们只需在任何一个Game Object挂载下列代码就能响应特定控件的特定UI事件了。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RemoveExitButtonListener</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        GameObject exitbutton = GameObject.Find(<span class="string">"UI Root (2D)/Camera/Anchor/Panel/Exit"</span>);</span><br><span class="line">        <span class="comment">// 这里的回调方法要和delegate签名一致</span></span><br><span class="line">        UIEventListener.Get(exitbutton).onPress = RemoteExitButtonClick;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RemoteExitButtonClick</span>(<span class="params">GameObject go, <span class="keyword">bool</span> state</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"RemoteExitButtonClick button is pressed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"RemoteExitButtonClick button is unpressed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/UIEventCall.PNG" alt="UIEventCall"><br>同时NGUI还为Button控制添加了很多可自定义的脚本：</p>
<ol>
<li>UIButton — 自定义控件被点击或处于控件之上等颜色信息</li>
<li>UIButtonScale — 自定义焦点处于控件之上时的scale变换</li>
<li>UIButtonOffset — 自定义控件被点击后的位移</li>
<li>UIButtonSound — 自定义控件被点击时播放的声音</li>
<li>UIButtonMessage — 自定义控件触发事件</li>
<li>UIButtonTween — 自定义控件触发tween</li>
<li>UIButtonPlayAnimation — 自定义控件触发动画</li>
</ol>
<h4 id="Slider">Slider</h4><p>通过传递接受Slider Event的Game Object，我们可以去对应物体上定义OnSliderChange(float stepvalue)去响应slider事件，这样一来响应了Slider Event的物体就可以根据Slider的拖拽去做对应的事情了。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DisplayTextListener</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector3 m_OriginalPosition;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	    <span class="comment">// 这里获取的postion不是世界坐标系的，不知道为什么</span></span><br><span class="line">	    m_OriginalPosition = transform.position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnSliderChange</span>(<span class="params"><span class="keyword">float</span> stepvalue</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Vector3 temp = m_OriginalPosition;</span><br><span class="line">        temp.y *= stepvalue;</span><br><span class="line">        transform.position = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/OnSliderChangeBegin.PNG" alt="OnSliderChangeBegin"><br><img src="/img/Unity/OnSliderChangeEnd.PNG" alt="OnSliderChangeEnd"></p>
<h4 id="Checkbox">Checkbox</h4><p>通过把一组Checkbox放到同一个Game Object，然后设定所有UICheckbox的Radio Button Root到同一个Game Object可以实现一组单选按钮。<br>然后通过添加UICheckboxControlledComponent到Checkbox上，我们可以指定当该Checkbox激活或未激活时去enable的Game Object(做到根据Checkbox状态响应)。<br><img src="/img/Unity/CheckBoxWithWrongAnswer.PNG" alt="CheckBoxWithWrongAnswer"><br><img src="/img/Unity/CheckBoxWithCorrectAnswer.PNG" alt="CheckBoxWithCorrectAnswer"></p>
<h4 id="Input">Input</h4><p>Label要具有而输入的特性需要确保以下几点：</p>
<ol>
<li>父节点或自身包含Box Collider</li>
<li>父节点或自身包含UIInput Script(所有的Input相关的东西都抽象到这里了e.g. IME，键盘弹出，平台相关输入等)</li>
<li>指定需要增加Input功能的Laybel到UIInput的Laybel属性<br>Note：<br>两者必须都在同一个Game Object上才能起作用，因为UIInput要通过Box Collider去接收OnSelect等事件。</li>
</ol>
<p>NGUI为我们提供了方便的控件类，Input — 直接用于创建可接收输入的Laybel模板<br><img src="/img/Unity/InputUsing.PNG" alt="InputUsing"></p>
<h4 id="3D">3D</h4><p>将2D UI变换到3D UI很容易。<br>步骤如下：</p>
<ol>
<li>去掉Anchor，直接把panel挂载在UIRoot(2D)上<br>还记得最初创建NGUI UI的时候Anchor上面挂载的UIAnchor Script的作用吗？因为变换到3D后我们不需要在控制相对窗口的位置，所以不需要UIAnchor了。</li>
<li>设置Camera的投影方式到Perspective(为了3D显示)<br>就这么简单，通过这样设置后，UI就完全当做3D Game Object显示在scene里了。<br><img src="/img/Unity/3DUI.PNG" alt="3DUI"></li>
</ol>
<h4 id="Atlas_Maker">Atlas Maker</h4><p>声明：后续用到的UI素材来源于COC，仅用于学习目的。<br>首先要知道为什么要使用图集？<br>减少纹理的使用，比如当多个材质只是纹理不同的时候，我们可以合并纹理到一个大的纹理，给材质指定对应的UV坐标即可。另外合并多个小的纹理到大的纹理图集也可以减少Memory使用。详情见<a href="https://en.wikipedia.org/wiki/Texture_atlas" target="_blank" rel="external">Texture atlas</a>。<br>这一节讲一下图集的制作。</p>
<ol>
<li>准备好所有图片素材(可以通过PS等工具制作)</li>
<li>打开NGUI Atlas Maker<br>NGUI -&gt; Open the Altas Maker</li>
<li>设置一个Atlas名字，点击Create，选中要放到一张图集里的所有纹理图片，然后等Altas Maker切割完成后点击Add/Update All<br><img src="/img/Unity/AtlasMaker.PNG" alt="AtlasMaker"><br><img src="/img/Unity/UIAtlas.PNG" alt="UIAtlas"><br>Note:<br>NGUI也支持导入Texture Packer导出的文件<br>NGUI Atlas Maker支持多种图片格式(e.g. PNG, psd……)<br>一旦Sprite导入并生成UI Atlas后，我们可以直接在Atlas Maker里添加并更新该Atlas即可。</li>
</ol>
<h4 id="Font_Maker">Font Maker</h4><p>Font Maker里的字体是由什么制作而来的了？<br>“All fonts are created using the free BMFont program, or the more advanced Glyph Designer.”(NGUI使用的Font是由BMFont program或Glyph Designer制作的)</p>
<p>那么BMFont program又是什么了？<br><a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="external">This program will allow you to generate bitmap fonts from TrueType fonts. The application generates both image files and character descriptions that can be read by a game for easy rendering of fonts.</a>BMFont program通过TrueType fonts生成bitmap fonts(一个是Font的image file文件，一个是描述了每一个字符渲染所需的信息文件))</p>
<p>那么这里提到了两个概念：</p>
<ol>
<li><p>TrueType Font<br><a href="https://en.wikipedia.org/wiki/TrueType" target="_blank" rel="external">TrueType is an outline font</a><br><a href="https://en.wikipedia.org/wiki/Computer_font#OUTLINE" target="_blank" rel="external">Outline fonts (also called vector fonts) use Bézier curves, drawing instructions and mathematical formulae to describe each glyph, which make the character outlines scalable to any size.</a><br>可以看出TrueType是outline font，outline font是一种vector font(可以理解成矢量字体，放大缩小不会出现锯齿和模糊。之所以称作vector font是因为TrueType记录每一个字符的轮廓信息，通过这些信息可以计算出如何绘制字符)<br>以下引用至<a href="http://computer.howstuffworks.com/question460.htm" target="_blank" rel="external">What are TrueType fonts?</a><br>TrueType technology actually involves two parts:<br>The TrueType Rasterizer<br>TrueType fonts — “The fonts themselves contain data that describes the outline of each character in the typeface. “</p>
</li>
<li><p>Bitmap Font<br><a href="https://en.wikipedia.org/wiki/Computer_font#OUTLINE" target="_blank" rel="external">Bitmap fonts consist of a matrix of dots or pixels representing the image of each glyph in each face and size.</a><br>可以看出Bitmap Font是记录的每一个字符的像素和位置等信息。<br>以下引用至<a href="https://71squared.com/blog/what-is-a-bitmap-font" target="_blank" rel="external">What is a Bitmap Font?</a><br>A bitmap font is essentially an image file containing a bunch of characters and a control file detailing the size and location of each character within the image. Each character is represented by a number of dots or pixels, rendered in a particular font and size.<br>可以看出Bitmap Font包含两部分：</p>
</li>
<li>Image file — 包含了所有文字的纹理图片</li>
<li>Control file — 包含了字体大小，每一个字符所在位置等信息<br>Bitmap Font因为不是outline font(vector font)，所以在字体拉伸变换的时候会出现失真的情况。<br>既然这样我们为什么还要使用Bitmap Font了？<br><a href="https://71squared.com/blog/what-is-a-bitmap-font" target="_blank" rel="external">OpenGL itself doesn’t even understand fonts(e.g. vector font), so in order to display text in your game you would need to use whats known as a bitmap font.</a><br>当计算去利用vector font渲染字体的时候，不会失真。但是在游戏里，如果我们还想对vector font做进一步的处理就显得心有余而力不足了。<br><a href="https://71squared.com/blog/what-is-a-bitmap-font" target="_blank" rel="external">The major benefit of using bitmap fonts is that each character can be pre-rendered using multiple effects, loaded into OpenGL as a texture, and rendered to the screen using very little resources.</a><br>但Bitmap Font不一样，Bitmap Font存储的就是字体的纹理图片，纹理图片在OpenGL里做额外的效果处理就容易的多了。</li>
</ol>
<p>说了这么多让我们看看BMFon program是如何制作Bitmap Font的？</p>
<ol>
<li>下载BitMap Font Program<br><a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="external">Bitmap Font Program Download Link</a></li>
<li>通过Font Settings我可以选择我们要导入的ttf字库，是否采用unicode编码等。</li>
<li>然后选中我们要导出的字符集(这里主要选择了英文和中文字符集)<br><img src="/img/Unity/BMFontMakerFontSetting.PNG" alt="BMFontMakerFontSetting"></li>
<li>设置export option，为导出的文件设置相关配置<br><img src="/img/Unity/BMFontExportOptions.PNG" alt="BMFontExportOptions"><br>Note：<br><a href="http://www.angelcode.com/products/bmfont/doc/export_options.html" target="_blank" rel="external">If you’re importing colored icons, or planning on using post processing to add colors to the characters, then you’ll want to choose the 32bit format, otherwise the 8bit format may be sufficient.</a><br>官网提到如果要后期再对字符做颜色等处理，需要选择32bit的存储模式(应该是为了能存储颜色信息)<br>同时File Format会决定我们导出的字符集纹理图片和Font descriptor的格式。<br>为了将字符都导出到一张纹理图片我们需要定义合适的Texture Size。</li>
<li>最后点击存储为Bitmap导出字符集(Option -&gt; Save Bitmap Font As)<br>这里就会生成对应的字符集纹理图片和Font Descriptor文件。<br><img src="/img/Unity/MyAtlasFont.PNG" alt="MyAtlasFont"><br>Note:<br>但我发现由于包含了大量中文字符，字符纹理比较大，包括中文和英文就有10M了，如果文字比较多比如做本地化，静态字体(我们这里提前生成字符集纹理就是静态字体)不适合。</li>
</ol>
<p>NGUI支持动态字体的生成：<br>让我们先看看什么是动态字体？<br>“When you set the Characters drop-down in the Import Settings to Dynamic, Unity will not pre-generate a texture with all font characters. Instead, it will use the FreeType font rendering engine to create the texture on the fly.”(<a href="https://docs.unity3d.com/Manual/class-Font.html" target="_blank" rel="external">https://docs.unity3d.com/Manual/class-Font.html</a>)<br>可以看出动态字体不需提前生成字符集纹理，而是通过导入的ttf动态的在游戏里生成对应字体纹理。这样做的好处就是减少了像静态字体这样的纹理内存开销，我们只需指定使用哪些ttf并确保用户包含了该ttf就能正确显示所有语言。<br>个人认为动态字体是本地化的一个解决方案。<br>动态字体直接从ttf文件生成。<br><img src="/img/Unity/DynamicFont.PNG" alt="DynamicFont"><br>Note:<br>值得注意的是动态字体下写的那个警告”Please note that dynamic fonts can’t be made a part of an atlas, and they will always be draw in a speparate draw call. You will need to adjust transform position’s Z rather than depth.”<br>使用动态字体后会增加一个draw call，而且动态字体的深度不再是有depth来控制而是z值。</p>
<p>Bitmap Font制作好了，那么接下来我就应该用制作好的Bitmap Font去通过Font Maker制作我们的字符集(Atlas)了。</p>
<ol>
<li>打开Font Maker</li>
<li>选定我们刚才制作的Font Texture和Font Descriptor作为输入，指定生成的字符集名字</li>
<li>点击创建<br><img src="/img/Unity/FontMakerProcess.PNG" alt="FontMakerProcess"></li>
</ol>
<p>这里看一下用自己制作的字体集和UI图片集做的登陆界面：<br><img src="/img/Unity/LoginScene.PNG" alt="LoginScene"></p>
<h4 id="NGUI_2-7屏幕自适应">NGUI 2.7屏幕自适应</h4><p>下文主要参考：<br><a href="http://dsqiu.iteye.com/blog/1964679" target="_blank" rel="external">NGUI所见即所得之UIRoot</a><br><a href="http://www.cnblogs.com/cqgreen/p/3348154.html" target="_blank" rel="external">Unity3d + NGUI 的多分辨率适配</a><br><a href="http://blog.csdn.net/onerain88/article/details/11713299" target="_blank" rel="external">Unity3D开发（一）：NGUI之UIRoot屏幕分辨率自适应 </a><br><a href="http://www.xuanyusong.com/archives/2536" target="_blank" rel="external">NGUI研究院之自适应屏幕（十）</a><br><a href="http://www.cnblogs.com/cqgreen/p/3348154.html" target="_blank" rel="external">Unity3d + NGUI 的多分辨率适配</a><br>屏幕自适应是UI在所难免会遇到的问题。<br>那么为什么需要做屏幕自适应了？<br>美术在做UI的时候，程序需要确定我们资源的最基本的分辨率，比如我们是基于1024<em>768（1.3333比例）。<br>在屏幕分辨率为1024</em>768(1.333比例)的时候完美显示如下：<br><img src="/img/Unity/1024Multiple768.PNG" alt="1024Multiple768"><br>当我们把屏幕分辨率设置成800<em>800(1.0比例)的时候显示如下：<br><img src="/img/Unity/800Multiple800.PNG" alt="800Multiple800"><br>当我们把屏幕分辨率设置成960</em>640(1.5比例)的时候显示如下：<br><img src="/img/Unity/960Multiple640.PNG" alt="960Multiple640"><br>Note:<br>UIRoot的Manual Height设置为768，Scaling Stype为FixedSize(后续会讲到UIRoot的缩放自适应原理)<br>从上面可以看出当分辨率比例降低的时候，会出现图像显示不全，这是因为NGUI是基于高度去缩放的。(后续会详细讲解)<br>所以当比例从1.33变到1.0的时候，768/800=0.96的缩放比例，宽度应该是1024/0.96=1066.66大于800这也就是为什么会出现图像显示不全的原因了。<br>再来看看从1.33变到1.5的时候，同理768/640=1.2缩放比例，宽度应该是1024/1.2=853.33小于960这也就是为什么会出现宽度铺不满的情况。<br>所以在这个时候为了不去做多套不同分辨率的资源去适应各种分辨率的机型，我们需要使用NGUII里的自适应。<br>当下移动设备的主流分辨率，数据来源<a href="http://djt.qq.com/article/view/399" target="_blank" rel="external">腾讯分析移动设备屏幕分辨率分析报告</a>：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">iOS设备的分辨率主要有：</span><br><span class="line">宽　 	高 	宽高比</span><br><span class="line"><span class="number">960</span> 	<span class="number">640</span> 	<span class="number">1.5</span></span><br><span class="line"><span class="number">1136</span> 	<span class="number">640</span> 	<span class="number">1.775</span></span><br><span class="line"><span class="number">1024</span> 	<span class="number">768</span> 	<span class="number">1.3333</span></span><br><span class="line"><span class="number">2048</span> 	<span class="number">1536</span> 	<span class="number">1.3333</span></span><br><span class="line"> </span><br><span class="line">Android设备的分辨率则相对纷杂，主流的分辨率有：</span><br><span class="line">宽 	高 	宽高比</span><br><span class="line"><span class="number">800</span> 	<span class="number">480</span> 	<span class="number">1.6667</span></span><br><span class="line"><span class="number">854</span> 	<span class="number">480</span> 	<span class="number">1.7792</span></span><br><span class="line"><span class="number">1280</span> 	<span class="number">720</span> 	<span class="number">1.7778</span></span><br><span class="line"><span class="number">960</span> 	<span class="number">540</span> 	<span class="number">1.7778</span></span><br><span class="line"><span class="number">1280</span> 	<span class="number">800</span> 	<span class="number">1.6</span></span><br><span class="line"><span class="number">960</span> 	<span class="number">640</span> 	<span class="number">1.5</span></span><br><span class="line"><span class="number">1184</span> 	<span class="number">720</span> 	<span class="number">1.6444</span></span><br><span class="line"><span class="number">1920</span> 	<span class="number">1080</span> 	<span class="number">1.7778</span></span><br></pre></td></tr></table></figure></p>
<p>那么让我们进入正题，NGUI是如何实现屏幕自适应的了？<br>这里有三个最重要的脚本需要学习：</p>
<ol>
<li>UIRoot</li>
<li>UIStretch</li>
<li>Anchor<br>让我们先来看看UIRoot的界面：<br><img src="/img/Unity/UIRootPanel.PNG" alt="UIRootPanel"><br>还记得之前提到UIRoot的功能吗？<br><a href="http://www.tasharen.com/?page_id=185" target="_blank" rel="external">This script rescales the object it’s on to be 2/ScreenHeight in size, letting you specify widget coordinates in pixels and still have them be relatively small when compared to the rest of your game world.</a><br>可以看出UIRoot通过scale UIRoot到2/ScreenHeight比例后，使得所有控件的坐标与像素一一对应。那么为什么这样能实现控件坐标与像素一一对应了？这个问题后面会讲到。<br>让我们先分别看看具体参数的含义:<br>Scaling Style<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Scaling</span><br><span class="line">&#123;</span><br><span class="line">	PixelPerfect,</span><br><span class="line">	FixedSize,</span><br><span class="line">	FixedSizeOnMobiles,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>而已看出NGUI 2.7给我们提供了3种scale方式。<br>那么三种方式是如何起作用的了？<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> activeHeight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">get</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> height = Mathf.Max(<span class="number">2</span>, Screen.height);</span><br><span class="line">		<span class="keyword">if</span> (scalingStyle == Scaling.FixedSize) <span class="keyword">return</span> manualHeight;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> UNITY_IPHONE || UNITY_ANDROID</span></span><br><span class="line">		<span class="keyword">if</span> (scalingStyle == Scaling.FixedSizeOnMobiles)</span><br><span class="line">			<span class="keyword">return</span> manualHeight;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line">		<span class="keyword">if</span> (height &lt; minimumHeight) <span class="keyword">return</span> minimumHeight;</span><br><span class="line">		<span class="keyword">if</span> (height &gt; maximumHeight) <span class="keyword">return</span> maximumHeight;</span><br><span class="line">		<span class="keyword">return</span> height;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mTrans != <span class="keyword">null</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">float</span> calcActiveHeight = activeHeight;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (calcActiveHeight &gt; <span class="number">0</span>f )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">float</span> size = <span class="number">2</span>f / calcActiveHeight;</span><br><span class="line">			</span><br><span class="line">			Vector3 ls = mTrans.localScale;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (!(Mathf.Abs(ls.x - size) &lt;= <span class="keyword">float</span>.Epsilon) ||</span><br><span class="line">				!(Mathf.Abs(ls.y - size) &lt;= <span class="keyword">float</span>.Epsilon) ||</span><br><span class="line">				!(Mathf.Abs(ls.z - size) &lt;= <span class="keyword">float</span>.Epsilon))</span><br><span class="line">			&#123;</span><br><span class="line">				mTrans.localScale = <span class="keyword">new</span> Vector3(size, size, size);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面可以看出PixelPerfect，FixedSize(FixedSizeOnMobile是移动平台的FixedSize设置)主要是缩放标准的选取。<br>当设置为PixelPerfect的时候会根据ScreenHeight与minmumHeight和maxmumHeight的比较来决定是以ScreenHeight为基准按2/ScreenHeight比例缩放还是2/minmumHeight or 2/maxmumHeight为比例缩放。<br>当设置FixedSize的时候只根据我们设定的manualHeight作为参考标准去缩放UIRoot，缩放比例为2/manualHeight。<br>根据缩放标准的选取去设定UIRoot localScale的值以实现UI缩放。<br>那么这里就有个疑问，为什么是2/manualHeight而不是1/manualHeight了？<br>要明白2这个常数的含义，我们先要看看Camera设定为Orthographic类型中的Orthographic Size的含义。<br><a href="https://docs.unity3d.com/ScriptReference/Camera-orthographicSize.html" target="_blank" rel="external">Camera’s half-size when in orthographic mode. This is half of the vertical size of the viewing volume. Horizontal viewing size varies depending on viewport’s aspect ratio. Orthographic size is ignored when camera is not orthographic (see orthographic). See Also: camera component.</a><br>可以看出Orthographic Size是指摄像机所观察垂直区域的一半。(前提是设置了orthographic camera)。如果Size设置为1，那么Camera所看到的高度为2 Unit。摄像机所看到的垂直区域一半也就是屏幕高度的一半,Orthographic Size所指示的1个Unit的高度为Screen.Height/2。(结合Orthographic Size和Pixel Per Unit设置，我们可以实现Sprite的Pixels Perfect显示)<br><a href="http://dsqiu.iteye.com/blog/1964679" target="_blank" rel="external">如果屏幕高度为1000个像素，Size设置的值为1表示1000/2=500个像素。所以，我们通过整个关系计算UIRoot下的GameObject的实际对应屏幕的高度：从GameObject向上一直到UIRoot，将它们的loaclScal相乘得到的乘积除以Size乘以屏幕高度的一半，即（localScale<em>….localScale)/Size</em>Screen.height/2。</a><br>如果屏幕分辨率为1024<em>768，那么如果我们把Size设置为1，那么1 Unit就对应屏幕分辩率高度的一半即384，也就是说UIRoot下Gameobject实际对应屏幕的高度应该按照384来计算即Screen.height/2来计算，因为Size的大小会使物体所占比例成倍缩小，所以我们还需要除以Size。<br>最终得出UIRoot下GameObject的实际对应屏幕的高度计算如下：<br>(localScale </em>…….<em>localScale)</em>Screen.height/2/Size<br>(这也就是为什么UIRoot缩放比例是2/manuaHeight里常数为2的原因，这样一来localScale的值就和屏幕所占比例一一对应了(前提是Size为1))<br><a href="http://dsqiu.iteye.com/blog/1964679" target="_blank" rel="external">这可以解释UIRoot的localStyle为啥都是很小的小数，因为这样可以保证UIRoot的子节点都可以以原来的大小作为localScale，比如一张图片是20*20的，我们可以直接设置localScale为（20,20,1）不用进行换算，直观方便。（NGUI3.0（or 2.7)以后的版本已经不再使用localScale来表示UISprite ，UILable（UIWidget的子类）的大小了，而是在UIWidget的width和height来设置，这样做的好处就是一个gameObject节点可以挂多个UISprite或UILabel了，而不会受localScale的冲突影响    2013/11/16增补）。</a><br>这样一来控件坐标与像素一一对应了。这也就是为什么在缩放UIRoot的时候采用2f / calcActiveHeight的原因。<br>那么如何让我们的制作的Sprite的像素完美一一对应显示在屏幕上了？<br>我们知道了屏幕分辨率为1024*768且Orthographic Size设置为1时，1个Unit对应的高度是384，那么也就是说要想让Sprite像素完美一一对应屏幕显示，我们要确保Sprite的Pixel Per Unit设定为Screen.height/2/Size。<br>之前提到当我们的常数是2来除以Screen.height的时候需要把Camera的Orthographic Size设置成1才能实现控件坐标与像素的一一对应，让我们看看UIRoot的源码：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>)  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    UIOrthoCamera oc = GetComponentInChildren&lt;UIOrthoCamera&gt;();  </span><br><span class="line">    <span class="keyword">if</span> (oc != <span class="keyword">null</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">        Debug.LogWarning(<span class="string">"UIRoot should not be active at the same time as UIOrthoCamera. Disabling UIOrthoCamera."</span>, oc);  </span><br><span class="line">        Camera cam = oc.gameObject.GetComponent&lt;Camera&gt;();  </span><br><span class="line">        oc.enabled = <span class="keyword">false</span>;  </span><br><span class="line">        <span class="keyword">if</span> (cam != <span class="keyword">null</span>) cam.orthographicSize = <span class="number">1</span>f;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">else</span> <span class="title">Update</span>(<span class="params"></span>)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>看得出NGUI并没有为我们强制设置为1，只是警告我们不能把UIRoot和UIOrthoCamera一起使用，如果使用了会自动剔除UIOrthoCamera，并设置orthographicSize为1。我们可以去设置orthographicSize实现不同的效果。<br>了解了UIRoot的实现，那么回到我们原始的话题，如何通过UIRoot实现屏幕自适应了？<br>当屏幕分辨率变化的时候UIRoot下的UI会出现显示不全或者两边有黑边的问题，因为FixedSize结合Manual Height而已控制UIRoot的按比例缩放，所以我们只需把两边未能显示全的UI以宽为基准按比例缩放即可(通过动态计算Manual Height的值)。<br><a href="http://www.ceeger.com/forum/read.php?tid=9230&amp;ds=1" target="_blank" rel="external">UIRoot分辨率自适应代码</a><br>ManualWidth和ManualHeight是我们最初美术设计所针对的分辨率，修改到对应的即可。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIRootExtend</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ManualWidth = <span class="number">640</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ManualHeight = <span class="number">960</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> UIRoot _UIRoot;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        _UIRoot = <span class="keyword">this</span>.GetComponent&lt;UIRoot&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (System.Convert.ToSingle(Screen.height) / Screen.width &gt; System.Convert.ToSingle(ManualHeight) / ManualWidth)</span><br><span class="line">            _UIRoot.manualHeight = Mathf.RoundToInt(System.Convert.ToSingle(ManualWidth) / Screen.width * Screen.height);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            _UIRoot.manualHeight = ManualHeight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>自适应后在屏幕分辨率为1024<em>768(1.333比例)的时候完美显示如下：<br><img src="/img/Unity/1024Multiple768SelfAdaption.PNG" alt="1024Multiple768SelfAdaption"><br>自适应后在屏幕分辨率为800</em>800(1.0比例)的时候显示如下：<br><img src="/img/Unity/800Multiple800SelfAdaption.PNG" alt="800Multiple800SelfAdaption"><br>自适应后在屏幕分辨率设置为960*640(1.5比例)的时候显示如下：<br><img src="/img/Unity/960Multiple640SelfAdaption.PNG" alt="960Multiple640SelfAdaption"><br>这样一来就实现了保持比例自适应。因为UIRoot是基于高度来缩放的，所以在低分辨率变到高分辨率的时候会出现左右黑边，这在横版游戏里是肯定不行的，所以我们需要做到以宽为基准的自适应。<br>那么基于宽度缩放的代码如下：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> activeHeight</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">get</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> height = Mathf.Max(<span class="number">2</span>, Screen.height);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Base on width instead of height</span></span><br><span class="line">        manualHeight = Screen.height * UIRootExtend.ManualWidth / Screen.width;</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">if</span> (scalingStyle == Scaling.FixedSize) <span class="keyword">return</span> manualHeight;</span><br><span class="line"></span><br><span class="line">		<span class="preprocessor">#<span class="keyword">if</span> UNITY_IPHONE || UNITY_ANDROID</span></span><br><span class="line">		<span class="keyword">if</span> (scalingStyle == Scaling.FixedSizeOnMobiles)</span><br><span class="line">			<span class="keyword">return</span> manualHeight;</span><br><span class="line">		<span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line">		<span class="keyword">if</span> (height &lt; minimumHeight) <span class="keyword">return</span> minimumHeight;</span><br><span class="line">		<span class="keyword">if</span> (height &gt; maximumHeight) <span class="keyword">return</span> maximumHeight;</span><br><span class="line">		<span class="keyword">return</span> height;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但上述在低分辨率变到高分辨率的时候会因为以宽为基准导致高度的自适应超出范围，见下图：<br><img src="/img/Unity/960Multiple640BaseOnWidth.PNG" alt="960Multiple640BaseOnWidth"><br>这种情况只能通过拉伸背景来铺满屏幕，但会失去原始比例(UIStretch可以实现基于屏幕或容器的自适应，不建议使用，后续NGUI都放弃了)。<br>我们肯定不希望我们的主要的UI都被拉伸变形，所以这里需要提到的是UIAnchor，<br>让我们在回忆下UIAnchor的作用：<br>“apply a half-pixel offset on Windows machines, for pixel-perfect results.”(把UI限定在窗口特定位置，当窗口变化的时候会依然处于相对窗口的位置)<br>待续……</p>
<p>关于UI制作尺寸的选择：</p>
<h2 id="DOTween">DOTween</h2><h3 id="DOTween_Instroduction">DOTween Instroduction</h3><p><a href="http://dotween.demigiant.com/" target="_blank" rel="external">DOTween is a fast, efficient, fully type-safe object-oriented animation engine for Unity, optimized for C# users, free and open-source, with tons of advanced features</a></p>
<p>简单看一下官网提到的Features(这里只Copy一部分)：<br>Speed and efficiency:<br>    Not only very fast, but also very efficient: everything is cached and reused to avoid useless GC allocations.<br>Shortcuts:<br>    Shortcut extensions that directly extend common objects<br>Extremely accurate:<br>    Time is calculated in a very precise way. This means that 1000 loops of 1 second each will play exactly as long as a single loop of 1000 seconds.<br>Animate everything (almost)<br>    DOTween can animate every numeric value and also some non-numeric ones. It can even animate strings, with support for rich-text.<br>Full control<br>    Play, Pause, Rewind, Restart, Complete, Goto and tons of other useful methods to control your tweens.<br>Grouping<br>    Combine tweens into Sequences to create complex animations (which don’t need to be in a, uh, sequence: they can also overlap each other).<br>Blendable tweens<br>    Some tweens can blend between each other in realtime, thanks to powerful DOBlendable shortcuts.<br>Paths<br>    Animate stuff along both linear and curved paths, with additional options for the orientation of your traveling agents.<br>Change values and duration while playing<br>    Change a tween’s start/end values or duration at any moment, even while playing.<br>Yield for coroutines<br>    Various “WaitFor…” methods to use inside coroutines, that allow you to wait for a tween to be completed, killed, started, or for it to reach a given position or loops.<br>Plugins<br>    DOTween is built with an extensible architecture in mind, which allows you to create your own tween plugins as separate files.<br>Extras<br>    Extra virtual methods to do stuff like calling a function after a given delay.<br>…….<br>总的来说DOTween可以满足我们做动画的任何要求且高效快速方便使用。</p>
<h3 id="DOTween_Install">DOTween Install</h3><p>看得出DOTween的定位是一个动画引擎。<br>首先是<a href="http://dotween.demigiant.com/download.php#download" target="_blank" rel="external">DOTween下载</a><br>其次是DOTween加入到我们的工程项目里(Assets下)，然后DOTween被自动加载。<br>DOTween加载进来后会弹出设置界面：<br><img src="/img/Unity/DOTweenSetting.PNG" alt="DOTweenSetting"><br>点击Setup DOTween进行设置，设置DOTween好使DOTween根据我们的Unity版本去导入一些特定库。<br>接下来我们就可以使用DOTween里的库函数做动画了。</p>
<h3 id="DOTween_Nomenclature_and_Prefixes">DOTween Nomenclature and Prefixes</h3><p>深入学习DOTween之前，让我们先了解下DOTween里的命名方式和一些关键术语：<br>以下学习源于<a href="http://dotween.demigiant.com/documentation.php#globalSettings" target="_blank" rel="external">DOTween官网</a><br><strong>Nomenclature</strong>:<br><em>Tweener</em> — A tween that takes control of a value and animates it.(Tweener是控制动画细节参数和播放的)<br><em>Sequence</em> — A special tween that, instead of taking control of a value, takes control of other tweens and animates them as a group.(Sequence可以理解成负责对tweens进行动画而非对属性比如position做动画)<br><em>Tween</em> — A generic word that indicates both a Tweener and a Sequence.<br><em>Nested tween</em> — A tween contained inside a Sequence.</p>
<p><strong>Prefixes</strong>:<br><em>DO</em> — Prefix for all tween shortcuts (operations that can be started directly from a known object, like a transform or a material). Also the prefix of the main DOTween class.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">transform.DOMoveX(<span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line">transform.DORestart();</span><br><span class="line">DOTween.Play();</span><br></pre></td></tr></table></figure></p>
<p><em>Set</em> — Prefix for all settings that can be chained to a tween (except for From, since it’s applied as a setting but is not really a setting).(tween的setting函数)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myTween.SetLoops(<span class="number">4</span>, LoopType.Yoyo).SetSpeedBased();</span><br></pre></td></tr></table></figure></p>
<p><em>On</em> — Prefix for all callbacks that can be chained to a tween.(tween的一些回调设定函数)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myTween.OnStart(myStartFunction).OnComplete(myCompleteFunction);</span><br></pre></td></tr></table></figure></p>
<h3 id="DOTween使用学习">DOTween使用学习</h3><p>在使用DOTween之前，我们需要在项目添加命名空间并对DOTween的初始化(初始化这一步不是必须的，不手动初始化也会自动初始化，官网推荐手动初始化设定)：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> DG.Tweening;</span><br><span class="line"></span><br><span class="line">DOTween.Init();</span><br></pre></td></tr></table></figure></p>
<p>让我们来看看DOTween里的函数定义：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Tweener <span class="title">DOMove</span>(<span class="params"><span class="keyword">this</span> Transform target, Vector3 endValue, <span class="keyword">float</span> duration, <span class="keyword">bool</span> snapping = <span class="keyword">false</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sequence <span class="title">DOJump</span>(<span class="params"><span class="keyword">this</span> Transform target, Vector3 endValue, <span class="keyword">float</span> jumpPower, <span class="keyword">int</span> numJumps, <span class="keyword">float</span> duration, <span class="keyword">bool</span> snapping = <span class="keyword">false</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">DOKill</span>(<span class="params"><span class="keyword">this</span> Component target, <span class="keyword">bool</span> complete = <span class="keyword">false</span></span>)</span>;</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>可以看出DOTween里面的大量方法都是通过C#里extend method的方式添加进去的。<br>所以我们要使用特定DOTween方法，我只需要在对应类的实例调用扩展方法即可。<br>接下来看看我们如何创建自定义的Tween。<br>有三中方式可供选择：</p>
<ol>
<li><p>The generic way<br> DOTween.TO(getter, setter, to float duration)<br> Changes the given property from its current value to the given one.<br> getter A delegate that returns the value of the property to tween. Can be written as a lambda like this: ()=&gt; myValue<br> where myValue is the name of the property to tween.<br> setter A delegate that sets the value of the property to tween. Can be written as a lambda like this: x=&gt; myValue = x<br> where myValue is the name of the property to tween.<br> to The end value to reach.<br> duration The duration of the tween. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tween a Vector3 called myVector to 3,4,8 in 1 second</span></span><br><span class="line">DOTween.To(()=&gt; myVector, x=&gt; myVector = x, <span class="keyword">new</span> Vector3(<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>), <span class="number">1</span>);</span><br><span class="line"><span class="comment">// Tween a float called myFloat to 52 in 1 second</span></span><br><span class="line">DOTween.To(()=&gt; myFloat, x=&gt; myFloat = x, <span class="number">52</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>The shortcuts way(Extension method)</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>), <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p> 在shortcuts方法后面调用From()的话，就会初始位置当做dest，把dest当做初始绘制来做动画。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>), <span class="number">1</span>).From();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Additional generic ways<br>这种没太看明白</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> DOTween.Punch(getter, setter, Vector3 direction, <span class="keyword">float</span> duration, <span class="keyword">int</span> vibrato, <span class="keyword">float</span> elasticity)</span><br><span class="line"><span class="keyword">static</span> DOTween.Shake(getter, setter, <span class="keyword">float</span> duration, <span class="keyword">float</span>/Vector3 strength, <span class="keyword">int</span> vibrato, <span class="keyword">float</span> randomness, <span class="keyword">bool</span> ignoreZAxis)</span><br><span class="line"><span class="keyword">static</span> DOTween.ToAlpha(getter, setter, <span class="keyword">float</span> to, <span class="keyword">float</span> duration)</span><br><span class="line"><span class="keyword">static</span> DOTween.ToArray(getter, setter, <span class="keyword">float</span> to, <span class="keyword">float</span> duration)</span><br><span class="line"><span class="keyword">static</span> DOTween.ToAxis(getter, setter, <span class="keyword">float</span> to, <span class="keyword">float</span> duration, AxisConstraint axis)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>貌似是会对Tween做特殊的限制，比如DOTween.Shake延axis轴变化vector3。</p>
<p>接下来让我们看看如何使用Sequence：<br>The sequenced tweens don’t have to be one after each other. You can overlap tweens with the Insert method.(sequence可包含其他sequence，可以通过Insert把tween插入到特定时间执行)<br>A tween (Sequence or Tweener) can be nested only inside a single other Sequence, meaning you can’t reuse the same tween in multiple Sequences. (同一个tween不能被多个sequence使用)<br>创建一个Sequence:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOTween.Sequence();</span><br></pre></td></tr></table></figure></p>
<p>我们可以通过添加tweens，callback到sequence里去做一些特别的动画。<br>Note:<br>“ all these methods need to be applied before the Sequence starts (usually the next frame after you create it, unless it’s paused), or they won’t have any effect.”(添加tweens，callback这些都必须在Sequence开始之前，可以理解为同一帧里)</p>
<p>接下来我们看看Tween的一些设置：<br>这些设置分为针对全局，tweens，sequence，tweener设置。<br>举个简单的例子，比如我们在初始化DOTween的时候设置了tween在同一时刻激活的最大数量。我超过这个数量后想要修改，我们而已通过:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOTween.SetTweensCapacity(***);</span><br></pre></td></tr></table></figure></p>
<p>上述这个方法就是针对全局设置的</p>
<p>接下来我们看看如何动态的控制tween动画的：<br>有三种方式：</p>
<ol>
<li><p>Via Static methods and filters<br>DOTween class给我们提供了大量的静态方法去控制tween动画。<br>比如我们想暂停某个tween动画或暂停所有tween：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DOTween.Pause(tweenname);</span><br><span class="line">DOTween.PauseAll();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Directly from the tween<br>我们也可以通过保存的tween动画引用去调用控制相关的动画</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myTween.Pause();</span><br></pre></td></tr></table></figure>
</li>
<li><p>From a shortcut-enhanced reference<br>直接通过扩展方法去停止对应的物体上的tween(这里要注意的是，所有控制tween的扩展方法都带DO前缀)</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transfrom.DOPause();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Note:<br>“IMPORTANT: remember that to use these methods on a tween after it has ended, you have to disable its autoKill behaviour, otherwise a tween is automatically killed at completion.”(对tween设置的时候一定要disable automatically kill，否则在tween完成的时候tween会被销毁)<br>同时DOTween还给我们提供了很多静态方法去获取tween的信息(比如Delay(),Duration()等)</p>
<p>Tween结合Coroutines的使用：<br>Tween提供了一些YieldInstructions的方法，可以让我们结合Coroutines去方便快速的实现一些对调用时机有讲究的动画:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要等到tween结束</span></span><br><span class="line"><span class="function">IEnumerator <span class="title">SomeCoroutine</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	Tween myTween = transform.DOMoveX(<span class="number">45</span>, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">yield</span> <span class="keyword">return</span> myTween.WaitForCompletion();</span><br><span class="line">	<span class="comment">// This log will happen after the tween has completed</span></span><br><span class="line">	Debug.Log(<span class="string">"Tween completed!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>总结：<br>给我的感觉，DOTween是一个基于Unity扩展的强大的数学动画库。<br>通过DOTween我们可以快速的去针对Unity里的一些属性比如位置，材质，UI等做动画，可以说是属于程序员的动画制作工具。</p>
<h2 id="2DToolkit">2DToolkit</h2><h1 id="C#脚本">C#脚本</h1><p>public成员 — 编辑器可见可编辑<br>[System.Serializable] — 标志该类可以被序列化到Inspector<br>[HideInInspector] — 标志该成员在编辑器不可见<br>StartCoroutine（Function()） &amp;&amp;  yield &amp;&amp; WaitForSeconds — 联合使用可以实现对游戏逻辑的等待判断（多线程访问控制）<br>GameObject.FindGameObjectWithTag(Name) — 用于寻找特定tag的对象<br>Virtual Method — Virtual Method使该方法可以被重写<br>abstract — 定义该类是抽象类 &amp;&amp; 该方法是抽象方法（需要被子类实现）</p>
<h2 id="Persistence_-_Saving_and_Loading_Data">Persistence - Saving and Loading Data</h2><h3 id="PlayerPrefs">PlayerPrefs</h3><p>Stores and accesses player preferences between game sessions. (用于存储一些不重要的用户设定的数据，比如游戏分辨率，游戏难度等)</p>
<p>IOS里面的.plist文件，Andoid里面的Preference(程序数据文件)</p>
<h3 id="Seralization"><a href="http://docs.unity3d.com/Manual/script-Serialization.html" target="_blank" rel="external">Seralization</a></h3><h4 id="What_is_seralization?">What is seralization?</h4><p>serialization is the process of converting the state an object to a set of bytes in order to store (or transmit) the object into memory, a database or a file.</p>
<h4 id="C#_Serialization">C# Serialization</h4><p>GameController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization.Formatters.Binary;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> GameController mController;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> PlayerData mPlayerData;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> mPreferenceHealth = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">string</span> mPlayerSavePath;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (mController == <span class="keyword">null</span>) &#123;</span><br><span class="line">			DontDestroyOnLoad (gameObject);</span><br><span class="line">			mController = <span class="keyword">this</span>;</span><br><span class="line">		&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">mController != <span class="keyword">this</span></span>) </span>&#123;</span><br><span class="line">			Destroy(gameObject);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		mPlayerData = <span class="keyword">new</span> PlayerData ();</span><br><span class="line"></span><br><span class="line">		mPlayerSavePath = Application.persistentDataPath + <span class="string">"/playerInfo.dat"</span>;</span><br><span class="line">		Debug.Log (<span class="string">"mPlayerSavePath = "</span> + mPlayerSavePath);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		GUI.Label (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">10</span>, <span class="number">200</span>, <span class="number">30</span>), <span class="string">"Preference Health: "</span> + mPreferenceHealth);</span><br><span class="line">		GUI.Label (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">30</span>), <span class="string">"mPlayerData.mHealth: "</span> + mPlayerData.mHealth);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">90</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Increase Health"</span>)) &#123;</span><br><span class="line">			mPreferenceHealth += <span class="number">10</span>;</span><br><span class="line">			mPlayerData.mHealth += <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">130</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Decrease Health"</span>)) &#123;</span><br><span class="line">			mPreferenceHealth -= <span class="number">10</span>;</span><br><span class="line">			mPlayerData.mHealth -= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">170</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Save File"</span>)) &#123;</span><br><span class="line">			Save ();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">210</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Load File"</span>)) &#123;</span><br><span class="line">			Load ();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">250</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Save Preference"</span>)) &#123;</span><br><span class="line">			SavePreference ();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">290</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Load Preference"</span>)) &#123;</span><br><span class="line">			LoadPreference ();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Debug.Log (<span class="string">"Application.persistentDataPath = "</span> + Application.persistentDataPath);</span><br><span class="line">		<span class="keyword">if</span> (!File.Exists (mPlayerSavePath)) &#123;</span><br><span class="line">			FileStream fsc = File.Create(mPlayerSavePath);</span><br><span class="line">			fsc.Close();</span><br><span class="line">		&#125;</span><br><span class="line">		BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter ();</span><br><span class="line">		FileStream fs = File.Open (mPlayerSavePath, FileMode.Open);</span><br><span class="line">		</span><br><span class="line">		bf.Serialize (fs, mPlayerData);</span><br><span class="line">		fs.Close ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Load</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(File.Exists(mPlayerSavePath))</span><br><span class="line">	    &#123;</span><br><span class="line">			BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">			FileStream fs = File.Open(mPlayerSavePath,FileMode.Open);</span><br><span class="line">			mPlayerData = (PlayerData)bf.Deserialize(fs);</span><br><span class="line">			fs.Close();</span><br><span class="line">			Debug.Log(<span class="string">"Load: mPlayerData.mHealth = "</span> + mPlayerData.mHealth);</span><br><span class="line">			Debug.Log(<span class="string">"Load: mPlayerData.mB.BuildingType = "</span> + mPlayerData.mB.mBT);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SavePreference</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="comment">//Player preference</span></span><br><span class="line">		PlayerPrefs.SetFloat (<span class="string">"Health"</span>, mPreferenceHealth);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadPreference</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Debug.Log(<span class="string">"Pre Health = "</span> + PlayerPrefs.GetFloat(<span class="string">"Health"</span>));</span><br><span class="line">		mPreferenceHealth = PlayerPrefs.GetFloat (<span class="string">"Health"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Serializable]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerData</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> mHealth = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Building mB = <span class="keyword">new</span> Building();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Serializable]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BuildingType</span><br><span class="line">&#123;</span><br><span class="line">	E_WALL = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Serializable]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Building</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> BuildingType mBT = BuildingType.E_WALL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/Perssistence_PlayerPrefs_Serialization.PNG" alt="Screnn Shot"></p>
<p>Note:<br>Cross Platform except Web</p>
<h3 id="Unity_Editor_Window,_Menu_Item_&amp;_ScriptableObject">Unity Editor Window, Menu Item &amp; ScriptableObject</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"></span><br><span class="line">[Serializable]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyScriptableObject</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">string</span> mID = <span class="string">"1"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Use Editor Window to edit ScriptObject data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> mValue = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	[MenuItem(<span class="string">"Window/MyEditorWindow"</span>)]</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		MyEditorWindow window = (MyEditorWindow)EditorWindow.GetWindow (<span class="keyword">typeof</span>(MyEditorWindow));</span><br><span class="line">		window.Show ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		MyScriptableObject asset = ScriptableObject.CreateInstance&lt;MyScriptableObject&gt; ();</span><br><span class="line">		asset = AssetDatabase.LoadAssetAtPath(<span class="string">"Assets/MyScriptableObject.asset"</span>,<span class="keyword">typeof</span>(MyScriptableObject)) <span class="keyword">as</span> MyScriptableObject;</span><br><span class="line">		mValue = asset.mID;</span><br><span class="line">		Debug.Log (<span class="string">"mValue = "</span> + mValue);</span><br><span class="line"></span><br><span class="line">		Debug.Log(<span class="string">"OnGUI"</span>);</span><br><span class="line">		GUILayout.Label (<span class="string">"mID"</span>, EditorStyles.boldLabel);</span><br><span class="line">		<span class="keyword">string</span> value2 = EditorGUILayout.TextField (<span class="string">"ID"</span>,mValue);</span><br><span class="line">		<span class="keyword">if</span> (GUILayout.Button (<span class="string">"Save"</span>, EditorStyles.miniButton)) &#123;</span><br><span class="line">			Debug.Log(<span class="string">"Save Button Clicked"</span>);</span><br><span class="line">			MyScriptableObject asset2 = ScriptableObject.CreateInstance&lt;MyScriptableObject&gt; ();</span><br><span class="line">			asset2.mID = value2;</span><br><span class="line">			AssetDatabase.CreateAsset (asset2, <span class="string">"Assets/MyScriptableObject.asset"</span>);</span><br><span class="line">			AssetDatabase.SaveAssets ();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Menu Item Study</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyMenuItems</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//Normal Menu Item</span></span><br><span class="line">	[MenuItem(<span class="string">"Tools/CreateScriptableAssets %q"</span>)]</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Save</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		MyScriptableObject asset = ScriptableObject.CreateInstance&lt;MyScriptableObject&gt; ();</span><br><span class="line">		asset.mID = <span class="string">"2"</span>;</span><br><span class="line">		AssetDatabase.CreateAsset (asset, <span class="string">"Assets/MyScriptableObject.asset"</span>);</span><br><span class="line">		AssetDatabase.SaveAssets ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	[MenuItem(<span class="string">"Tools/LoadScriptableAssets %w"</span>)]</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Load</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Context Menu Item</span></span><br><span class="line">	[MenuItem(<span class="string">"Assets/ContextMenuItem"</span>)]</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ContextMenuItem</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">		Debug.Log(<span class="string">"ContextMenuItem()"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	[MenuItem(<span class="string">"CONTEXT/Transform/ContextMenuItem"</span>)]</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ContextMenuItem2</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Debug.Log (<span class="string">"ContextMenuItem2"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	[MenuItem(<span class="string">"Assets/Create/ContextMenuItem"</span>)]</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ContextMenuItem3</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		Debug.Log (<span class="string">"ContextMenuItem3"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过自定义Menu Item的功能，我们可以快速创建一些我们所需要的原件</p>
<p>通过自定义Editor Window，我们可以用于制作特定数据的编辑框</p>
<p>ScriptableObject主要用于存储一些不重要的数据，和Monobehaviour的主要区别就是不用attach到游戏对象上，需要通过CreateInstance的方式来创建</p>
<p>结合自定义Editor Window和ScriptableObject的存储，我们可以通过自定义编辑框自定义数据并使用</p>
<p><img src="/img/Unity/EditorWindow_ScriptableObject.PNG" alt="Screnn Shot"></p>
<h2 id="Coroutine">Coroutine</h2><p><a href="https://unitygem.wordpress.com/coroutines/" target="_blank" rel="external">Reference Website</a></p>
<h3 id="Why_are_we_using_coroutines?">Why are we using coroutines?</h3><ol>
<li>Making things happen step by step</li>
<li>Writing routines that need to happen over time</li>
<li>Writing routines that have to wait for another operation to complete</li>
</ol>
<h3 id="What_is_a_coroutine?">What is a coroutine?</h3><p>Coroutines are not threads and coroutines are not asynchronous.</p>
<p>A coroutine is a function that is executed partially and, presuming suitable conditions are met, will be resumed at some point in the future until its work is done.<br>The start of a coroutine corresponds to the creation of an object of type coroutine. That object is tied to the MonoBehaviour component that hosted the call.</p>
<h3 id="How_long_is_the_life_cycle?_&amp;_When_does_coroutine_get_called?">How long is the life cycle? &amp; When does coroutine get called?</h3><p>The lifetime of the Coroutine object is bound to the lifetime of the MonoBehaviour object, so if the latter gets destroyed during process, the coroutine object is also destroyed. <em>Whenever game object that is bound to coroutine is destroyed or inactive(e.g. gameobject.SetActive(false), Destroy(gameobject)), the coroutine will stop to be called. Coroutine is run until a yield is found.</em></p>
<p>GameController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization.Formatters.Binary;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment">//For Menu Item</span></span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> GameController mController;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> GameObject mCoroutineObject;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> mInputTimer = <span class="number">0.0</span>f;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> mValidInputDeltaTime = <span class="number">0.5</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (mController == <span class="keyword">null</span>) &#123;</span><br><span class="line">			DontDestroyOnLoad (gameObject);</span><br><span class="line">			mController = <span class="keyword">this</span>;</span><br><span class="line">		&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">mController != <span class="keyword">this</span></span>) </span>&#123;</span><br><span class="line">			Destroy(gameObject);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		mInputTimer += Time.deltaTime;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (mInputTimer &gt; mValidInputDeltaTime) &#123;</span><br><span class="line">			<span class="keyword">if</span> (Input.GetKey (KeyCode.C)) &#123;</span><br><span class="line">				mInputTimer = <span class="number">0.0</span>f;</span><br><span class="line">				Debug.Log (<span class="string">"Ative Coroutine Game Object"</span>);</span><br><span class="line">				mCoroutineObject.SetActive (<span class="keyword">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mInputTimer &gt; mValidInputDeltaTime) &#123;</span><br><span class="line">			<span class="keyword">if</span> (Input.GetKey (KeyCode.U)) &#123;</span><br><span class="line">				mInputTimer = <span class="number">0.0</span>f;</span><br><span class="line">				Debug.Log (<span class="string">"UnAtive Coroutine Game Object"</span>);</span><br><span class="line">				mCoroutineObject.SetActive (<span class="keyword">false</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mInputTimer &gt; mValidInputDeltaTime) &#123;</span><br><span class="line">			<span class="keyword">if</span> (Input.GetKey (KeyCode.E)) &#123;</span><br><span class="line">				mInputTimer = <span class="number">0.0</span>f;</span><br><span class="line">				Debug.Log (<span class="string">"Enable Coroutine MonoBehaviour"</span>);</span><br><span class="line">				mCoroutineObject.GetComponent&lt;CoroutineStudy&gt;().enabled = <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mInputTimer &gt; mValidInputDeltaTime) &#123;</span><br><span class="line">			<span class="keyword">if</span> (Input.GetKey (KeyCode.D)) &#123;</span><br><span class="line">				mInputTimer = <span class="number">0.0</span>f;</span><br><span class="line">				Debug.Log (<span class="string">"Desable Coroutine MonoBehaviour"</span>);</span><br><span class="line">				mCoroutineObject.GetComponent&lt;CoroutineStudy&gt;().enabled = <span class="keyword">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (mInputTimer &gt; mValidInputDeltaTime) &#123;</span><br><span class="line">			<span class="keyword">if</span> (Input.GetKey (KeyCode.K)) &#123;</span><br><span class="line">				mInputTimer = <span class="number">0.0</span>f;</span><br><span class="line">				Debug.Log (<span class="string">"Destroy Coroutine Game Object"</span>);</span><br><span class="line">				Destroy(mCoroutineObject);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>CoroutineStudy.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoroutineStudy</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">string</span> mCoroutineText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> isFixedCall = <span class="keyword">false</span>;  <span class="comment">//Makesure Update() and LateUpdate() and FixedUpdate() Log only once  </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> isUpdateCall = <span class="keyword">false</span>;  </span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> isLateUpdateCall = <span class="keyword">false</span>;  </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		mCoroutineText = <span class="string">""</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		GUI.Label (<span class="keyword">new</span> Rect (<span class="number">10</span>, <span class="number">10</span>, <span class="number">200</span>, <span class="number">30</span>), <span class="string">"Coroutine Text: "</span> + mCoroutineText);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (GUI.Button (<span class="keyword">new</span> Rect (<span class="number">400</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">30</span>), <span class="string">"Start Coroutine"</span>)) &#123;</span><br><span class="line">			mCoroutineText = <span class="string">""</span>;</span><br><span class="line">			StartCoroutine (CoroutineCall ());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!isFixedCall)  </span><br><span class="line">		&#123;  </span><br><span class="line">			Debug.Log(<span class="string">"FixedUpdate Call Begin"</span>);  </span><br><span class="line">			StartCoroutine(FixedCoutine());  </span><br><span class="line">			Debug.Log(<span class="string">"FixedUpdate Call End"</span>);  </span><br><span class="line">			isFixedCall = <span class="keyword">true</span>;  </span><br><span class="line">		&#125;  </span><br><span class="line">	&#125;  </span><br><span class="line">	</span><br><span class="line">	<span class="function">IEnumerator <span class="title">FixedCoutine</span>(<span class="params"></span>)  </span><br><span class="line">	</span>&#123;  </span><br><span class="line">		Debug.Log(<span class="string">"This is Fixed Coroutine Call Before"</span>);  </span><br><span class="line">		<span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">		Debug.Log(<span class="string">"This is Fixed Coroutine Call After"</span>);  </span><br><span class="line">	&#125;  </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!isUpdateCall)  </span><br><span class="line">		&#123;  </span><br><span class="line">			Debug.Log(<span class="string">"Update Call Begin"</span>);  </span><br><span class="line">			StartCoroutine(UpdateCoutine());  </span><br><span class="line">			Debug.Log(<span class="string">"Update Call End"</span>);  </span><br><span class="line">			isUpdateCall = <span class="keyword">true</span>;  </span><br><span class="line">		&#125;  </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">IEnumerator <span class="title">UpdateCoutine</span>(<span class="params"></span>)  </span><br><span class="line">	</span>&#123;  </span><br><span class="line">		Debug.Log(<span class="string">"This is Update Coroutine Call Before"</span>);  </span><br><span class="line">		<span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">		Debug.Log(<span class="string">"This is Update Coroutine Call After"</span>);  </span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">LateUpdate</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!isLateUpdateCall)  </span><br><span class="line">		&#123;  </span><br><span class="line">			Debug.Log(<span class="string">"LateUpdate Call Begin"</span>);  </span><br><span class="line">			StartCoroutine(LateCoutine());  </span><br><span class="line">			Debug.Log(<span class="string">"LateUpdate Call End"</span>);  </span><br><span class="line">			isLateUpdateCall = <span class="keyword">true</span>;  </span><br><span class="line">		&#125;  </span><br><span class="line">	&#125;  </span><br><span class="line"></span><br><span class="line">	<span class="function">IEnumerator <span class="title">LateCoutine</span>(<span class="params"></span>)  </span><br><span class="line">	</span>&#123;  </span><br><span class="line">		Debug.Log(<span class="string">"This is Late Coroutine Call Before"</span>);  </span><br><span class="line">		<span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">		Debug.Log(<span class="string">"This is Late Coroutine Call After"</span>);  </span><br><span class="line">	&#125;  </span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> IEnumerator <span class="title">CoroutineCall</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">			mCoroutineText = i.ToString();</span><br><span class="line">			Debug.Log(<span class="string">"Coroutine Text: "</span> + mCoroutineText);</span><br><span class="line">			<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">1.0</span>f</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		mCoroutineText = <span class="string">"Finished"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure></p>
<p>ScreenShots<br><img src="/img/Unity/Unity_Coroutine_LifeTime.PNG" alt="The relationship between Coroutine Life Time and Monobehaviour &amp; GameObejct"></p>
<p><img src="/img/Unity/Unity_Coroutine_LifeTime_Monobehaviour.PNG" alt="The relationship between Coroutine Life Time and Monobehaviour"></p>
<p>Note:<br>Diable Monobehaviour(e.g. Monobehaviour.enabled = false) will not influence coroutine.</p>
<p>Coroutine with yiled return null will get called after LateUpdate()(仅根据上面的测试结果)<br>通过返回WaitForSeconds() || WaitForEndOfFrame() || WaitForFixedUpdate() 等yield return 支持的返回类型可以实现coroutine在特定时刻继续调用</p>
<p>StartCoroutine()支持嵌套调用用于实现特定等待特定运算后继续执行特定代码</p>
<h3 id="How_to_stop_coroutines?">How to stop coroutines?</h3><p>IEnumerator coroutine = WaitForSeconds(3.0f);<br>StartCoroutine(coroutine);<br>StopCoroutine(coroutine);</p>
<p>Note:<br>注意如果gameobject处于InActive或则has been destroyed,Coroutine不会再被调用，可以通过Monobehaviour.enabled = false来实现使物体不可见但会出发coroutine的效果</p>
<h3 id="Go_depth_in_Coroutine">Go depth in Coroutine</h3><p>参考文章:<a href="http://blog.csdn.net/tkokof1/article/details/11842673" target="_blank" rel="external">Coroutine，你究竟干了什么？</a></p>
<p>在更深入了解coroutine之前让我们先了解下什么是IEnumerator和yield？<br><em>IEnumrator</em><br><a href="https://msdn.microsoft.com/en-us/library/system.collections.ienumerator(v=vs.110" target="_blank" rel="external">Supports a simple iteration over a non-generic collection.</a>.aspx)<br>在C#里IEnumerator组要是为了自定义类型支持迭代器访问.</p>
<p><em>yield</em><br>yield是C# 2.0引入的特性,表明调用yield的方法是iterator.每一次的迭代访问该方法，都会调用MoveNext()方法，而调用MoveNext()方法的时候就会执行该方法代码，但如果执行IEnumerator方法到yield的时候，该方法就会返回并且记录下yield的位置，并在下一次调用该方法的时候继续执行。</p>
<p>通过yield break我们可以结束方法迭代。</p>
<p>为什么要提IEnumerator和yield了？<br>因为Coroutine其实就是一个IEnumerator的迭代器。</p>
<p>在我们调用StartCoroutine的时候迭代器就被我们添加到了coroutine列表中<br>而Coroutine管理者会每一帧去迭代访问判断每一个coroutine是否达到条件可以删除并继续执行</p>
<p>CoroutineManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoroutineYieldInstruction</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">IsDone</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoroutineWaitForSeconds</span> : <span class="title">CoroutineYieldInstruction</span>&#123;</span><br><span class="line">	<span class="keyword">float</span> m_WaitTime;</span><br><span class="line">	<span class="keyword">float</span> m_StartTime;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CoroutineWaitForSeconds</span>(<span class="params"><span class="keyword">float</span> waittime</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_WaitTime = waittime;</span><br><span class="line">		m_StartTime = -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">bool</span> <span class="title">IsDone</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (m_StartTime &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			m_StartTime = Time.time;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//check elapsed time</span></span><br><span class="line">		<span class="keyword">return</span> (Time.time - m_StartTime) &gt;= m_WaitTime;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoroutineManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> CoroutineManager Instance &#123;</span><br><span class="line">		<span class="keyword">get</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">set</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	List&lt;System.Collections.IEnumerator&gt; m_Enumerators = <span class="keyword">new</span> List&lt;System.Collections.IEnumerator&gt;();</span><br><span class="line"></span><br><span class="line">	List&lt;System.Collections.IEnumerator&gt; m_EnumeratorsBuffer = <span class="keyword">new</span> List&lt;System.Collections.IEnumerator&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (Instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">			Instance = <span class="keyword">this</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Debug.Log (<span class="string">"Multi-instances of CouroutineManager"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">LateUpdate</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_Enumerators.Count; i++) &#123;</span><br><span class="line">			<span class="comment">//handle special enumerator</span></span><br><span class="line">			<span class="keyword">if</span>(m_Enumerators[i].Current <span class="keyword">is</span> CoroutineYieldInstruction)</span><br><span class="line">			&#123;</span><br><span class="line">				CoroutineYieldInstruction yiledinstruction = m_Enumerators[i] .Current <span class="keyword">as</span> CoroutineYieldInstruction;</span><br><span class="line">				<span class="keyword">if</span>(!yiledinstruction.IsDone())&#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//Do normal move next</span></span><br><span class="line">			<span class="keyword">if</span>(!m_Enumerators[i].MoveNext())&#123;</span><br><span class="line">				m_EnumeratorsBuffer.Add(m_Enumerators[i]);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//remove end enumerator</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m_EnumeratorsBuffer.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			m_Enumerators.Remove(m_EnumeratorsBuffer[i]);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		m_EnumeratorsBuffer.Clear ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartCoroutineSimple</span>(<span class="params">System.Collections.IEnumerator enumerator</span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		m_Enumerators.Add (enumerator);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ScreenShots<br><img src="/img/Unity/Coroutine_Study.PNG" alt="My Own Coroutine"></p>
<h1 id="Unity优化注意事项">Unity优化注意事项</h1><h2 id="Code">Code</h2><h3 id="Use_For_or_while_instead_of_foreach">Use For or while instead of foreach</h3><p>Foreach在通过Mono编译后会造成额外的内存分配（通过VS编译好像不会 — 这个未测试）<br><a href="https://www.zhihu.com/question/30334270" target="_blank" rel="external">参考网站</a></p>
<p>ForEachAndFor.cs<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;&#10;using System.Collections;&#10;using System.Collections.Generic;&#10;&#10;public class ForEachAndFor : MonoBehaviour &#123;&#10;&#10;    private List&#60;int&#62; mTestList;&#10;&#10;&#9;// Use this for initialization&#10;&#9;void Start () &#123;&#10;        mTestList = new List&#60;int&#62;(1000);&#10;        for(int i = 0; i &#60; mTestList.Count; i++)&#10;        &#123;&#10;            mTestList[i] = i;&#10;        &#125;&#10;&#9;&#125;&#10;&#9;&#10;&#9;// Update is called once per frame&#10;&#9;void Update () &#123;&#10;&#9;   &#10;        foreach(var it in mTestList)&#10;        &#123;&#10;&#10;        &#125;&#10;        /*&#10;        for(int i = 0; i &#60; mTestList.Count; i++)&#10;        &#123;&#10;&#10;        &#125;&#10;        */&#10;&#9;&#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ScreenShorts:<br><img src="/img/Unity/ForEachCall.PNG" alt="ForeachCall"><br><img src="/img/Unity/ForCall.PNG" alt="ForCall"></p>
<p>从上面的测试结果可以看出foreach确实分配了额外40B的内存开销</p>
<p>让我们看看foreach代码反编译后的样子(我用的ILSpy)：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using System;&#10;using System.Collections.Generic;&#10;using UnityEngine;&#10;&#10;public class ForEachAndFor : MonoBehaviour&#10;&#123;&#10;&#9;private List&#60;int&#62; mTestList;&#10;&#10;&#9;private void Start()&#10;&#9;&#123;&#10;&#9;&#9;this.mTestList = new List&#60;int&#62;(1000);&#10;&#9;&#9;for (int i = 0; i &#60; this.mTestList.get_Count(); i++)&#10;&#9;&#9;&#123;&#10;&#9;&#9;&#9;this.mTestList.set_Item(i, i);&#10;&#9;&#9;&#125;&#10;&#9;&#125;&#10;&#10;&#9;private void Update()&#10;&#9;&#123;&#10;&#9;&#9;using (List&#60;int&#62;.Enumerator enumerator = this.mTestList.GetEnumerator())&#10;&#9;&#9;&#123;&#10;&#9;&#9;&#9;while (enumerator.MoveNext())&#10;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;int current = enumerator.get_Current();&#10;&#9;&#9;&#9;&#125;&#10;&#9;&#9;&#125;&#10;&#9;&#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面看看不出为什么会有内存分配<br>让我们通过IL反编译工具看生成的IL底层内容（通过IL反编译工具，安装VS就自带的）<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.method private hidebysig instance void  Update() cil managed&#10;&#123;&#10;  // &#20195;&#30721;&#22823;&#23567;       55 (0x37)&#10;  .maxstack  8&#10;  .locals init (int32 V_0,&#10;           valuetype [mscorlib]System.Collections.Generic.List`1/Enumerator&#60;int32&#62; V_1)&#10;  IL_0000:  ldarg.0&#10;  IL_0001:  ldfld      class [mscorlib]System.Collections.Generic.List`1&#60;int32&#62; ForEachAndFor::mTestList&#10;  IL_0006:  callvirt   instance valuetype [mscorlib]System.Collections.Generic.List`1/Enumerator&#60;!0&#62; class [mscorlib]System.Collections.Generic.List`1&#60;int32&#62;::GetEnumerator()&#10;  IL_000b:  stloc.1&#10;  .try&#10;  &#123;&#10;    IL_000c:  br         IL_0019&#10;    IL_0011:  ldloca.s   V_1&#10;    IL_0013:  call       instance !0 valuetype [mscorlib]System.Collections.Generic.List`1/Enumerator&#60;int32&#62;::get_Current()&#10;    IL_0018:  stloc.0&#10;    IL_0019:  ldloca.s   V_1&#10;    IL_001b:  call       instance bool valuetype [mscorlib]System.Collections.Generic.List`1/Enumerator&#60;int32&#62;::MoveNext()&#10;    IL_0020:  brtrue     IL_0011&#10;    IL_0025:  leave      IL_0036&#10;  &#125;  // end .try&#10;  finally&#10;  &#123;&#10;    IL_002a:  ldloc.1&#10;    IL_002b:  box        valuetype [mscorlib]System.Collections.Generic.List`1/Enumerator&#60;int32&#62;&#10;    IL_0030:  callvirt   instance void [mscorlib]System.IDisposable::Dispose()&#10;    IL_0035:  endfinally&#10;  &#125;  // end handler&#10;  IL_0036:  ret&#10;&#125; // end of method ForEachAndFor::Update</span><br></pre></td></tr></table></figure></p>
<p>可以看出Mono编译出来的代码在finally进行了一次将valuetype的Enumerator，boxing的过程（这里并不是非常明白底层代码对应的代码，但看大概意思应该是using那里编译后导致的boxing）</p>
<p><a href="https://msdn.microsoft.com/en-us/library/yz2be5wk.aspx" target="_blank" rel="external">关于Box和Unbox参考</a><br>从官网可以看出在Boxing Value type的时候会将信息临时存储在Heap上从而造成的额外内存开销</p>
<h2 id="Rendering">Rendering</h2><p>减少渲染的物体数量和精度</p>
<h2 id="Physic">Physic</h2><h3 id="Close_Unnecessary_Collision">Close Unnecessary Collision</h3><p>(Edit -&gt; Project Settings -&gt; Physics)<br>只打开需要碰撞检测的Layer之间的碰撞检测</p>
<h2 id="Memory">Memory</h2><h3 id="Avoid_Uneccessary_GC">Avoid Uneccessary GC</h3><p>尽量重复使用申请的内存，不要每一次都重新申请</p>
<h1 id="C#学习">C#学习</h1><p>Book down load link: <a href="http://download.csdn.net/detail/baiyu9821179/4282298" target="_blank" rel="external">c#入门经典第五版</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Game-Engine/">Game_Engine</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Unity/">Unity</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://tonytang1990.github.io/2015/07/15/Unity-Study/" data-title="Unity Study | 走停人生路" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/08/15/CSharp-Study/" title="C# Study">
  <strong>上一篇：</strong><br/>
  <span>
  C# Study</span>
</a>
</div>


<div class="next">
<a href="/2015/07/11/Sort-Algorithm/"  title="Sort Algorithm">
 <strong>下一篇：</strong><br/> 
 <span>Sort Algorithm
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/07/15/Unity-Study/" data-title="Unity Study" data-url="http://tonytang1990.github.io/2015/07/15/Unity-Study/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity_Introduction"><span class="toc-number">1.</span> <span class="toc-text">Unity Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What_is_Unity?"><span class="toc-number">1.1.</span> <span class="toc-text">What is Unity?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why_should_we_study_Unity?"><span class="toc-number">1.2.</span> <span class="toc-text">Why should we study Unity?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Which_programming_language_are_we_using?"><span class="toc-number">1.3.</span> <span class="toc-text">Which programming language are we using?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity_Tutorial_Study"><span class="toc-number">2.</span> <span class="toc-text">Unity Tutorial Study</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ROLL-A-BALL"><span class="toc-number">2.1.</span> <span class="toc-text">ROLL-A-BALL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPACE_SHOOTER"><span class="toc-number">2.2.</span> <span class="toc-text">SPACE SHOOTER</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2D-ROGUELIKE-TUTORIAL"><span class="toc-number">2.3.</span> <span class="toc-text">2D-ROGUELIKE-TUTORIAL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编辑器界面"><span class="toc-number">3.</span> <span class="toc-text">编辑器界面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#工具"><span class="toc-number">4.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MonoDevelop"><span class="toc-number">4.1.</span> <span class="toc-text">MonoDevelop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ILSpy"><span class="toc-number">4.2.</span> <span class="toc-text">ILSpy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ildasm(安装VS自带的工具)"><span class="toc-number">4.3.</span> <span class="toc-text">ildasm(安装VS自带的工具)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blender"><span class="toc-number">4.4.</span> <span class="toc-text">Blender</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VSTU"><span class="toc-number">4.5.</span> <span class="toc-text">VSTU</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#相关概念学习"><span class="toc-number">5.</span> <span class="toc-text">相关概念学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity_Engine"><span class="toc-number">5.1.</span> <span class="toc-text">Unity Engine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C_Sharp"><span class="toc-number">5.1.1.</span> <span class="toc-text">C Sharp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mono"><span class="toc-number">5.1.2.</span> <span class="toc-text">Mono</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IL2CPP"><span class="toc-number">5.1.3.</span> <span class="toc-text">IL2CPP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Why_do_we_need_IL2CPP?"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">Why do we need IL2CPP?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IL2CPP_Components"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">IL2CPP Components</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mono_and_IL2CPP_compile_and_execution_process"><span class="toc-number">5.1.3.3.</span> <span class="toc-text">Mono and IL2CPP compile and execution process</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOT_&_JIT"><span class="toc-number">5.1.4.</span> <span class="toc-text">AOT & JIT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOT"><span class="toc-number">5.1.4.1.</span> <span class="toc-text">AOT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JIT"><span class="toc-number">5.1.4.2.</span> <span class="toc-text">JIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IOS_AOT_Limitations"><span class="toc-number">5.1.4.3.</span> <span class="toc-text">IOS AOT Limitations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Protocol_Buffers"><span class="toc-number">5.1.4.4.</span> <span class="toc-text">Protocol Buffers</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity_Using"><span class="toc-number">5.2.</span> <span class="toc-text">Unity Using</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#快捷键学习"><span class="toc-number">6.</span> <span class="toc-text">快捷键学习</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#项目编译发布"><span class="toc-number">7.</span> <span class="toc-text">项目编译发布</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PC"><span class="toc-number">7.1.</span> <span class="toc-text">PC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOS"><span class="toc-number">7.2.</span> <span class="toc-text">IOS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Native_Code_Compilation"><span class="toc-number">7.2.1.</span> <span class="toc-text">Native Code Compilation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prepare_XCode_Project"><span class="toc-number">7.2.2.</span> <span class="toc-text">Prepare XCode Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compile_XCode_Project"><span class="toc-number">7.2.3.</span> <span class="toc-text">Compile XCode Project</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#版块学习"><span class="toc-number">8.</span> <span class="toc-text">版块学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UGUI"><span class="toc-number">8.1.</span> <span class="toc-text">UGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Canvas"><span class="toc-number">8.1.1.</span> <span class="toc-text">Canvas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shader"><span class="toc-number">8.2.</span> <span class="toc-text">Shader</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Surface_Shaders"><span class="toc-number">8.2.1.</span> <span class="toc-text">Surface Shaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vertex_and_Fragment_Shaders"><span class="toc-number">8.2.2.</span> <span class="toc-text">Vertex and Fragment Shaders</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Excel数据读取"><span class="toc-number">8.3.</span> <span class="toc-text">Excel数据读取</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Plugins"><span class="toc-number">9.</span> <span class="toc-text">Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NGUI"><span class="toc-number">9.1.</span> <span class="toc-text">NGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tutorials"><span class="toc-number">9.1.1.</span> <span class="toc-text">Tutorials</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Creating_Your_UI"><span class="toc-number">9.1.1.1.</span> <span class="toc-text">Creating Your UI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sprite"><span class="toc-number">9.1.1.2.</span> <span class="toc-text">Sprite</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-Sliced_Sprite"><span class="toc-number">9.1.1.2.1.</span> <span class="toc-text">9-Sliced Sprite</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Tiled_Sprite"><span class="toc-number">9.1.1.2.2.</span> <span class="toc-text">Tiled Sprite</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Label"><span class="toc-number">9.1.1.3.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Button"><span class="toc-number">9.1.1.4.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Slider"><span class="toc-number">9.1.1.5.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Checkbox"><span class="toc-number">9.1.1.6.</span> <span class="toc-text">Checkbox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Input"><span class="toc-number">9.1.1.7.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3D"><span class="toc-number">9.1.1.8.</span> <span class="toc-text">3D</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Atlas_Maker"><span class="toc-number">9.1.1.9.</span> <span class="toc-text">Atlas Maker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Font_Maker"><span class="toc-number">9.1.1.10.</span> <span class="toc-text">Font Maker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NGUI_2-7屏幕自适应"><span class="toc-number">9.1.1.11.</span> <span class="toc-text">NGUI 2.7屏幕自适应</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOTween"><span class="toc-number">9.2.</span> <span class="toc-text">DOTween</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween_Instroduction"><span class="toc-number">9.2.1.</span> <span class="toc-text">DOTween Instroduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween_Install"><span class="toc-number">9.2.2.</span> <span class="toc-text">DOTween Install</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween_Nomenclature_and_Prefixes"><span class="toc-number">9.2.3.</span> <span class="toc-text">DOTween Nomenclature and Prefixes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween使用学习"><span class="toc-number">9.2.4.</span> <span class="toc-text">DOTween使用学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2DToolkit"><span class="toc-number">9.3.</span> <span class="toc-text">2DToolkit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C#脚本"><span class="toc-number">10.</span> <span class="toc-text">C#脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Persistence_-_Saving_and_Loading_Data"><span class="toc-number">10.1.</span> <span class="toc-text">Persistence - Saving and Loading Data</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PlayerPrefs"><span class="toc-number">10.1.1.</span> <span class="toc-text">PlayerPrefs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Seralization"><span class="toc-number">10.1.2.</span> <span class="toc-text">Seralization</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#What_is_seralization?"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">What is seralization?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C#_Serialization"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">C# Serialization</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity_Editor_Window,_Menu_Item_&_ScriptableObject"><span class="toc-number">10.1.3.</span> <span class="toc-text">Unity Editor Window, Menu Item & ScriptableObject</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Coroutine"><span class="toc-number">10.2.</span> <span class="toc-text">Coroutine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Why_are_we_using_coroutines?"><span class="toc-number">10.2.1.</span> <span class="toc-text">Why are we using coroutines?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What_is_a_coroutine?"><span class="toc-number">10.2.2.</span> <span class="toc-text">What is a coroutine?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How_long_is_the_life_cycle?_&_When_does_coroutine_get_called?"><span class="toc-number">10.2.3.</span> <span class="toc-text">How long is the life cycle? & When does coroutine get called?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How_to_stop_coroutines?"><span class="toc-number">10.2.4.</span> <span class="toc-text">How to stop coroutines?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Go_depth_in_Coroutine"><span class="toc-number">10.2.5.</span> <span class="toc-text">Go depth in Coroutine</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity优化注意事项"><span class="toc-number">11.</span> <span class="toc-text">Unity优化注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Code"><span class="toc-number">11.1.</span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Use_For_or_while_instead_of_foreach"><span class="toc-number">11.1.1.</span> <span class="toc-text">Use For or while instead of foreach</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rendering"><span class="toc-number">11.2.</span> <span class="toc-text">Rendering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Physic"><span class="toc-number">11.3.</span> <span class="toc-text">Physic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Close_Unnecessary_Collision"><span class="toc-number">11.3.1.</span> <span class="toc-text">Close Unnecessary Collision</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Memory"><span class="toc-number">11.4.</span> <span class="toc-text">Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Avoid_Uneccessary_GC"><span class="toc-number">11.4.1.</span> <span class="toc-text">Avoid Uneccessary GC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C#学习"><span class="toc-number">12.</span> <span class="toc-text">C#学习</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Game-Engine/" title="Game_Engine">Game_Engine<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Language/" title="Programming Language">Programming Language<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Rendering/" title="Rendering">Rendering<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Unity/" title="Unity">Unity<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/OpenGL/" title="OpenGL">OpenGL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Sort/" title="Sort">Sort<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Shader/" title="Shader">Shader<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Programming/" title="Programming">Programming<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Tony Tang. <br/>
			This is my new blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Tony Tang">Tony Tang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"TonyTang1990"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
