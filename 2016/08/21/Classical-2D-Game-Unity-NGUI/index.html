
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Classical 2D Game(Unity &amp; NGUI) | 走停人生路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Tony Tang">
    

    
    <meta name="description" content="Introduction这一章节主要是为了实战学习Unity和NGUI的使用而写的。
Game Introduction开发环境：游戏引擎：UnityUI插件：NGUI 2.7
游戏内容：容纳多个经典2D红白机和手机游戏：

2D赛车躲避(原始名字想不起来了)
贪吃蛇
坦克大战待添加

平台：支持Android，IOS多设备。
PreparationIOS Account Setup
Apple">
<meta property="og:type" content="article">
<meta property="og:title" content="Classical 2D Game(Unity & NGUI)">
<meta property="og:url" content="http://tonytang1990.github.io/2016/08/21/Classical-2D-Game-Unity-NGUI/index.html">
<meta property="og:site_name" content="走停人生路">
<meta property="og:description" content="Introduction这一章节主要是为了实战学习Unity和NGUI的使用而写的。
Game Introduction开发环境：游戏引擎：UnityUI插件：NGUI 2.7
游戏内容：容纳多个经典2D红白机和手机游戏：

2D赛车躲避(原始名字想不起来了)
贪吃蛇
坦克大战待添加

平台：支持Android，IOS多设备。
PreparationIOS Account Setup
Apple">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IOSAppDistributionWorkflows.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UnityCloudBuild.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SpriteEditor.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/TagsAndLayers.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/OffsetScrollBackground.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/InputPanelHierachy.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/InputPanelUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/InputControlWithScrollBackground.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/FPSDisplay.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/PlayerCarSprite.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/PlayerCarTurnLeft4.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/PlayerCarTurnRight4.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/NormalAnimation.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/TurnLeftAnimation.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/TurnRightAnimation.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/CrashAnimator.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AnimationController.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AnimatorParameters.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/StateTranslationConditionSetting.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/LoginUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/LoadingUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/GameSetting1.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/GameSetting2.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/GameSetting3.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IpadScreenShot.jpg">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SnakeGame1024768.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Snake960640.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/Snake800800.PNG">
<meta property="og:updated_time" content="2016-09-27T08:12:49.262Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Classical 2D Game(Unity & NGUI)">
<meta name="twitter:description" content="Introduction这一章节主要是为了实战学习Unity和NGUI的使用而写的。
Game Introduction开发环境：游戏引擎：UnityUI插件：NGUI 2.7
游戏内容：容纳多个经典2D红白机和手机游戏：

2D赛车躲避(原始名字想不起来了)
贪吃蛇
坦克大战待添加

平台：支持Android，IOS多设备。
PreparationIOS Account Setup
Apple">

    
    <link rel="alternative" href="/atom.xml" title="走停人生路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="走停人生路" title="走停人生路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="走停人生路">走停人生路</a></h1>
				<h2 class="blog-motto">有时候不是习惯了一个人，而是在没有认可自己之前选择了一个人</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:tonytang1990.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/21/Classical-2D-Game-Unity-NGUI/" title="Classical 2D Game(Unity &amp; NGUI)" itemprop="url">Classical 2D Game(Unity &amp; NGUI)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Tony Tang" target="_blank" itemprop="author">Tony Tang</a>
		
  <p class="article-time">
    <time datetime="2016-08-21T06:50:28.000Z" itemprop="datePublished"> 發表於 2016-08-21</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Game_Introduction"><span class="toc-number">1.1.</span> <span class="toc-text">Game Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparation"><span class="toc-number">1.2.</span> <span class="toc-text">Preparation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IOS_Account_Setup"><span class="toc-number">1.2.1.</span> <span class="toc-text">IOS Account Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity_IOS_build_process"><span class="toc-number">1.2.2.</span> <span class="toc-text">Unity IOS build process</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cloud_Build"><span class="toc-number">1.2.3.</span> <span class="toc-text">Cloud Build</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UI库选择"><span class="toc-number">1.2.4.</span> <span class="toc-text">UI库选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#游戏实战开发"><span class="toc-number">1.3.</span> <span class="toc-text">游戏实战开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#赛车躲避"><span class="toc-number">1.3.1.</span> <span class="toc-text">赛车躲避</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏说明"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">游戏说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#相关概念学习"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">相关概念学习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏制作过程"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">游戏制作过程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Project_Mode选择"><span class="toc-number">1.3.1.3.1.</span> <span class="toc-text">Project Mode选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#美术图片分辨率选择"><span class="toc-number">1.3.1.3.2.</span> <span class="toc-text">美术图片分辨率选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游戏背景循环移动实现方式选择"><span class="toc-number">1.3.1.3.3.</span> <span class="toc-text">游戏背景循环移动实现方式选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游戏控制方式选择"><span class="toc-number">1.3.1.3.4.</span> <span class="toc-text">游戏控制方式选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#可视化重要信息"><span class="toc-number">1.3.1.3.5.</span> <span class="toc-text">可视化重要信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2D动画抉择"><span class="toc-number">1.3.1.3.6.</span> <span class="toc-text">2D动画抉择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游戏内GameObject数量的思考"><span class="toc-number">1.3.1.3.7.</span> <span class="toc-text">游戏内GameObject数量的思考</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#贪吃蛇"><span class="toc-number">1.3.2.</span> <span class="toc-text">贪吃蛇</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏说明-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">游戏说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏要点思考"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">游戏要点思考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#坦克大战"><span class="toc-number">1.3.3.</span> <span class="toc-text">坦克大战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏说明-2"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">游戏说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏要点思考-1"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">游戏要点思考</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题记录"><span class="toc-number">1.4.</span> <span class="toc-text">问题记录</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="Introduction">Introduction</h1><p>这一章节主要是为了实战学习Unity和NGUI的使用而写的。</p>
<h2 id="Game_Introduction">Game Introduction</h2><p>开发环境：<br>游戏引擎：Unity<br>UI插件：NGUI 2.7</p>
<p>游戏内容：<br>容纳多个经典2D红白机和手机游戏：</p>
<ol>
<li>2D赛车躲避(原始名字想不起来了)</li>
<li>贪吃蛇</li>
<li>坦克大战<br>待添加</li>
</ol>
<p>平台：<br>支持Android，IOS多设备。</p>
<h2 id="Preparation">Preparation</h2><h3 id="IOS_Account_Setup">IOS Account Setup</h3><ol>
<li>Apple Account(发布到IOS设备上需要)<br>任何账号都可以发布到自己的设备测试，但是如果要使用GC or In-App Purchases或者发布到App Store的话需要注册Apple Developer Program。</li>
<li>Xcode(up-to-date version)<br>因为Xcode是Mac上的软件，所以这里需要Mac电脑或者是黑苹果。(开发所需的SDK，IDE套装都在这)</li>
<li>Adding your Apple ID to Xcode<br>Open Xcode -&gt; Xcode -&gt; Preferences -&gt; Account -&gt; </li>
<li>在开发之前，Mac需要获得IOS Certificartes(用于对Mac开发授权，程序签名等)<br>登陆Apple Developer Program -&gt; Certificates ,identifiers &amp; Profiles -&gt; Certificate Signing Request<br>Create CSR(Certificate Signing Request):<ol>
<li>Folder -&gt; Utilities Folder -&gt; Keychain Access</li>
<li>Keychain Access -&gt; Certificate Assistant -&gt; Request a Certificate from a Certificate Authority -&gt; 填完内容存储到本地<br>CSR里包含了public key和private key。<br>当CSR创建以后，需要使用CSR去请求一个Certificate:</li>
<li>上传CSR</li>
<li>下载Certificate</li>
<li>运行安装Certificate<br>安装Certificate后public和private key pair就生成了(在Keychain Access下可以查看)<a href="http://www.cnblogs.com/zhaoyang/p/3582436.html" target="_blank" rel="external">而我们的应用程序签名是使用私钥来签名用公钥来进行验证,  而苹果生成的Certificate 只包含了公钥,当你用自己的私钥签名后,苹果会用公钥来进行验证,确保是你自己对程序签名而不是别人冒充的</a><br>通过导出共享公钥和私钥，可以实现共同开发(Mac开发授权，程序签名等)。</li>
</ol>
</li>
<li>设置App ID(相当于Android包名，用于识别App)<br>App ID包含以下组成部分：<ol>
<li>Prefix — 作为Team ID</li>
<li>Suffix — 作为Build ID的搜索字符串(可指定通配符)</li>
<li>AppServices — 指定包含的Service(比如Game Center， IAP， iCloud等服务)，只有指定了这些，使用包含了此APP ID的Provision Profile才能使用特定服务</li>
</ol>
</li>
<li>添加设备列表(只有被添加了的设备列表才能用于安装和测试程序)<br>需要通过Itunes查看UDID，然后添加到设备列表。</li>
<li><p>用上述我们创建的Certificate, Apple ID, Devices List等生成我们的Provision Profile(Unity Cloud Build的时候需要指定)<br>不同的Provision Profile有不同的用处，比如iPhone Developer证书用于测试设备上运行，iPhone Distribution证书用于提交应用到App Store。<br>让我们来理解一些相关概念，下文引用至<a href="http://www.cnblogs.com/zhaoyang/p/3582436.html" target="_blank" rel="external">IOS开发 证书总结</a><br> Identifier:<br> 顾名思义App ID（application id, not apple id）, 对于你的一个或者一组app他们的唯一标识, 这个App ID跟你Xcode中的Targets ——-&gt; General——-&gt; Identity中的Bundle Identifier是匹配的,(其余的那些推送服务啊什么的都是配置在APP ID下面的) 如下图:</p>
<p> Provisioning Profile<br> 一个Provisioning Profile包含了上述所有内容 Certificate &amp;&amp; App ID &amp;&amp; Device, 这个Provisioning Profile文件会在打包时嵌入到.ipa的包里,如下图: </p>
<p> 所以一台设备上运行应用程序的过程如下(以Developer Provisioning Profile为例):<br> 1 检查app 的 bunld ID 是否 matches Provisioning Profile 的 App ID<br> 2 检查 app 的 entitements 是否 matches Provisioning Profile 的 entitements<br> 3 用Certificate来验证签名签名<br> 4 检查此设备的UDID是否存在于 Provisioning Profiles中 （仅在 非发布证书中）</p>
<p> 如何创建?<br> 在 Provisioning Profiles 中点加号,然后依次选择App ID, Certificate, Devices(development),再指定名称,最后下载, 双击则安装到Xcode中</p>
<p> Xcode中的配置<br> Project &amp;&amp; Target 的 build settings 中搜索Code sign…<br> 然后分别选好对应的证书,如果选择列表中没有刚才创建的证书可以双击直接复制名字上去 </p>
<p> 关于推送服务<br> 基于上面的操作，如果需要推送服务我们还需要申请一个推送证书<br> 依次进入 Certificates —&gt;Production —&gt;Apple Push Notification service SSL (Production)<br> 然后选择需要推送服务的App ID<br> 再选择前面创建的.cerSigningRequest文件<br> 最后点击generated生成推送证书<br>IOS开发流程大致如下：<br><img src="/img/Unity/IOSAppDistributionWorkflows.PNG" alt="IOSAppDistributionWorkflows"></p>
</li>
</ol>
<h3 id="Unity_IOS_build_process">Unity IOS build process</h3><ol>
<li>XCode project is generated by Unity with all the required libraries, precompiled .NET code and serialized assets.(打包所有需要的库和资源生成XCode项目)<br>第一步是通过Unity的Building Settings设定IOS平台点击Build生成</li>
<li>XCode project is built by XCode and deployed and run on the actual device.(编译Xcode项目安装到设备上)<br>第二部必须在Mac上执行(或者黑苹果)，因为需要用到IOS SDK和XCode编译器</li>
</ol>
<h3 id="Cloud_Build">Cloud Build</h3><p>关于Cloud Build让我们直接看看官网的介绍吧：<br>What is Unity Cloud Build?<br>A service that automates the build pipeline for Unity games.(自动化编译打包服务 — Build Machine)</p>
<p>Why Should I Use Cloud Build?<br>By using Cloud Build automation services, you will - Save Time. Builds are compiled and distributed automatically, minimizing manual work and intervention. Games with multiple platforms can be consolidated into a single build process.</p>
<ul>
<li>Improve Quality. Games are built continuously as changes are detected (“Continuous Integration”), enabling detection of issues as they are introduced to the project. - Distribute Faster. Cloud-based infrastructure compiles builds; in parallel if for multi platform projects. Completed builds are available to download by anyone on the team through Cloud Build’s website.(快捷方便，自动化检测变化进行编译打包。每个人都可以自己去下载安装对应的版本)</li>
</ul>
<p>How does Unity Cloud Build work?<br>Unity Cloud Build monitors your source control repository (e.g. Git, Subversion, Mercurial, Perforce). When a change is detected, a build is automatically generated by Cloud Build. When the build is completed, you and your team are notified via email. Your build is hosted by Unity for you and your team mates. If the build is not successful, you’re also notified and provided with logs to begin troubleshooting.(通过检测Git等工具上传变化，自动触发编译打包流程，完成或出错的时候有邮件提醒和log)</p>
<p>What do I need to use Unity Cloud Build?<br>使用Unity Cloud Build我们必须先选择一个版本管理器<br>Git, Subversion, Mercurial, Perforce<br>这里我使用Git。</p>
<ol>
<li>github上创建Repository</li>
<li>Clone到本地目录(git clone repo)</li>
<li>上传XCode项目<br>创建Cloud Build Project:<br><a href="https://build.cloud.unity3d.com/" target="_blank" rel="external">Unity Cloud Build</a></li>
<li>Create New Project</li>
<li>添加Git repository地址</li>
<li>选择platform(这里我选的IOS)</li>
<li>最后设置项目打包发布相关的Certificate，bundle ID， Xcode版本设置等(注意Provision Profile里的Certificate和我们导出上传的Certificate要一致)，后续还有一堆关于Build的控制(比如定义宏，编译Development版本)<br>这样一来就可以通过访问<a href="https://build.cloud.unity3d.com/" target="_blank" rel="external">Unity Cloud Build</a>去查看自动化打包编译的详细情况了。<br><img src="/img/Unity/UnityCloudBuild.PNG" alt="UnityCloudBuild"><br>这样一来每一次提交Git后只需在Cloud Build点击build就会触发更新编译打包了。<br>如果打包没有错误的话，我们只需去Cloud Buid上取打包好的包安装即可。</li>
</ol>
<h3 id="UI库选择">UI库选择</h3><p>在Unity 4.6以后UI主要是有两种选择：</p>
<ol>
<li>UGUI(Unity 自带UI)</li>
<li>NGUI(成熟的第三方UI插件)<br>这里处于学习NGUI目的，我选择采用NGUI 2.7版本作为UI库。</li>
</ol>
<h2 id="游戏实战开发">游戏实战开发</h2><h3 id="赛车躲避">赛车躲避</h3><h4 id="游戏说明">游戏说明</h4><p>这是一款在2D竖版的赛车躲避类游戏，场景里有三条道可供行驶，玩家操控当前赛车(上下左右移动以及跳跃来躲避迎面而来的赛车)来回在三条道之间切换以躲避随机从三条道上出现的赛车，每躲过一个赛车就会增加得分，赛车移动游戏速度会随着游戏的进行越来越快已达到更快速度，最终躲避最多赛车得分最高者创造新纪录。</p>
<p>操控：<br>上下左右移动，圆形按钮跳跃(通过单独制作的控制面板，通过点击对应按钮响应)</p>
<h4 id="相关概念学习">相关概念学习</h4><p>首先作为2D游戏，这里要讲一下Project 2D Mode和Editor 2D Mode这两个概念。<br>Project 2D Mode：<br>Project 2D Mode会去决定Unity Editor的一些设置。<br><a href="https://docs.unity3d.com/Manual/2DAnd3DModeSettings.html" target="_blank" rel="external">Unity Editor Settings influence by mode settings</a><br>下列以官网将的2D Mode为例，看看分别会影响些什么？</p>
<ol>
<li>Any images you import are assumed to be 2D images (Sprites) and set to Sprite mode.(2D模式下默认导入的图片都是2D Sprite而不是Texture)</li>
<li>The Sprite Packer is enabled.(Sprite Packer默认开启，Sprite Packager是为了高效的渲染并节约内存，用于打包图集(Atlas)的工具)</li>
<li>The Scene View is set to 2D.(默认设置Scene view为2D mode，当然也可以切到Scene 3D mode)</li>
<li>The default game objects do not have real time, directional light.(默认不创建方向光)</li>
<li>The camera’s default position is at 0,0,–10. (It is 0,1,–10 in 3D Mode.)(Camera默认位置0,0,-10)</li>
<li>The camera is set to be Orthographic. (In 3D Mode it is Perspective.)(Camera默认是Orthographic(正交)投影)</li>
<li>Skybox is disabled for new scenes.(天空盒默认disable)</li>
<li>Ambient Source is set to Color. (With the color set as a dark grey: RGB: 54, 58, 66.)(环境光默认设置为54,58,66)</li>
<li>Precomputed Realtime GI is set to off.(预计算的全局光默认关闭)</li>
<li>Baked GI is set to off.(烘焙全局观默认关闭)</li>
<li>Lighting Auto-Building set to off.(光照的自动编译默认关闭)<br>Editor 2D Mode：<br>Editor 2D Mode只是决定了Scene窗口是以2D还是3D的形式显示。<br>从上面可以看出Project的2D Mode会帮助我们设置一些对于2D游戏不需要或重要的设定，帮助我们快速开发2D游戏。</li>
</ol>
<p>在2D游戏里，有个很重要的概念就是Sprite：<br>Sprite — Sprites are 2D Graphic objects.<br>提到Sprite就不得不提Sprite制作，优化相关的工具和一些相关的重要概念：</p>
<ol>
<li>Sprite Editor<br>主要用于指明Sprite的一些重要属性，比如：<br>Texture Type — 指明纹理类型(Sprite 2D)<br>Sprite Mode — 指明这个Sprite是单独显示还是和其他Sprite一起显示(有利于Texture Packer去做图集的切割)<br>Packing Tag — 指明Sprite所在图集<br>…….</li>
<li>Sprite Creator<br>Unity提供的创建临时的sprite placeholder.(后期替换成我们想要的Sprite)<br>也可以帮助我们去切割包含多个Sprite的图片到多个单独的Sprite(前提是包含多个Sprite的图片Sprite Mode要设置成Multiple。通过设置Slice或者Grid方式，可以快速帮助我们切割包含多个图片的Sprite)<br><img src="/img/Unity/SpriteEditor.PNG" alt="SpriteEditor"></li>
<li>Sprite Packer<br>Unity提供的自动制作图集(Atlas)的工具，为了节约内存高效渲染，把多个Sprite打包到一个大的纹理图片里，然后通过记录对应的UV信息去访问，这样只需加载一张纹理图片就能去渲染多个Sprite。<br>Edit -&gt; Project Settings -&gt; Editor -&gt; Sprite Packer Mode</li>
<li>Sprite Renderer<br>这里需要区别一下Sprite Renderer和Mesh Renderer。<br>Sprite Renderer是以2D Sprite作为输入通过Color，Material等属性去渲染出最终颜色。(默认的Sprite-Default Material是不计算光照的，因为2D游戏一般不考虑光照，当然我们也可用其他的Material去计算光照的影响)<br>Mesh Renderer是以geometry from the Mesh Filter(模型数据)作为输入通过Material和光照方面的设置渲染出最终颜色。<br>Sprite Renderer里值得一提的是Layer，因为2D游戏里没有深度的概念，所以通过Layer和Layer Order去决定Sprite的渲染顺序，同时Layer属性也被Camera和Ray Cast用作过滤的条件之一。(我们可以自定义Layer且设定Layer所处顺序(Edit -&gt; Project Setting -&gt; Tags and Layers)，然后通过设定Sprite在Layer里的Layer Order去决定在同一Layer里的顺序)<br><img src="/img/Unity/TagsAndLayers.PNG" alt="TagsAndLayers"></li>
</ol>
<h4 id="游戏制作过程">游戏制作过程</h4><h5 id="Project_Mode选择">Project Mode选择</h5><p>通过上面概念学习，我们知道了设置Project Mode 2D会帮助我们快速开发2D游戏，所以这里我们选择2D Mode。<br>Edit-&gt;Project Settings-&gt;Editor-&gt;Default Behavior Mode -&gt; 2D<br>然后再创建我们的CarDodge Scene:<br>File -&gt; New Scene</p>
<h5 id="美术图片分辨率选择">美术图片分辨率选择</h5><p>每个游戏制作都需要指定美术图片大小标准。<br>考虑到不同屏幕分辨率适应的问题，结合<a href="http://tonytang1990.github.io/2015/07/15/Unity-Study/#IL2CPP">Unity Study里NGUI 2.7屏幕自适应的学习</a>，我选择了1024*768也就是4:3的比例作为标准，这样一来在高分辨率的机器上(大部分主流机器都高于4:3)，只是两边会多显示一部分而不至于背景或游戏场景被裁减，多出来的一部分我们可以把背景放大来覆盖。(作为2D竖版游戏这样是完全可以接受的)<br>为了使我们的Sprite的像素完美显示在屏幕上(1个Sprite像素对应屏幕的一个pixel)，要做到这一点我们只需保证Screen.height/2/Size = PPU(Pixel Per Unit)即可，所以因为我们设定Sprite的100 Pixel对应一个Unit，Size = 768/2/100 = 3.84，所以我们把Orthographic Camera的Size设置为3.84，这样一来Sprite的像素就和屏幕意义对应了。</p>
<h5 id="游戏背景循环移动实现方式选择">游戏背景循环移动实现方式选择</h5><p>通过官网<a href="https://unity3d.com/cn/learn/tutorials/topics/2d-game-creation/2d-scrolling-backgrounds?playlist=17093" target="_blank" rel="external">2D Scrolling Backgrounds</a>的学习，了解到有下列两种方式可以实现背景循环移动。</p>
<ol>
<li>用一张Sprite作为背景，通过动态计算(循环)transform.position的值去实现背景移动。<br>这种方式的缺点是多分辨率适应问题，且当我们循环的时候，Sprite明显衔接不对，出现画面跳动。</li>
<li>设置3D Quad，添加Material去控制显示，通过动态控制(循环texture offset)Texture的显示实现背景移动。<br>这种方式的好处是可以通过Tile Texture和设置Offset实现不拉伸背景实现铺满屏幕的效果。<br>第一种方式游戏体验明显不行，所以这里我们采取第二种方式实现背景循环滚动。(这里使用的是Texture而非Sprite)<br>OffsetScroller.cs<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OffsetScroller</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> mScrollSpeed = <span class="number">0.2</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector2 mStartOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MeshRenderer mBackgroundMeshRender;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mBackgroundMeshRender = gameObject.GetComponent&lt;MeshRenderer&gt;();</span><br><span class="line">        <span class="keyword">if</span>(mBackgroundMeshRender != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mStartOffset = mBackgroundMeshRender.material.mainTextureOffset;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> y = Mathf.Repeat(Time.time * mScrollSpeed, <span class="number">1</span>);</span><br><span class="line">        Vector2 offset = <span class="keyword">new</span> Vector2(<span class="number">0.0</span>f, y);</span><br><span class="line">        <span class="keyword">if</span>(mBackgroundMeshRender != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mBackgroundMeshRender.material.mainTextureOffset = offset;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"This script only works with Gameobject that contains MeshRenderer and Material."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mBackgroundMeshRender != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mBackgroundMeshRender.material.mainTextureOffset = mStartOffset;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/img/Unity/OffsetScrollBackground.PNG" alt="OffsetScrollBackground"><br>上述代码实现了通过根据时间和设定的速度来调整Background Material的Offset值实现背景循环滚动效果。</p>
<h5 id="游戏控制方式选择">游戏控制方式选择</h5><p>Assets Store有一些付费的成熟控制插件，但考虑到控制上没太大的需求(上下左右和个别按钮即可)，这里选择自己制作。(提供上下左右和一个单独的按钮交互界面)<br><img src="/img/Unity/InputPanelHierachy.PNG" alt="InputPanelHierachy"><br><img src="/img/Unity/InputPanelUI.PNG" alt="InputPanelUI"><br>我在Panel上挂载了UIAnchor和InputControlerManager脚本，前者用于在场景里设置位置，后者是我自己写来用于通过单一接口去传递相应回调。<br>InputControllerManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InputControllerManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> InputControllerManager mInputControllerManager = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject mControlButton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject mLeftButton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject mRightButton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject mUpButton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject mDownButton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UIEventListener mControlButtonUIEL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UIEventListener mLeftButtonUIEL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UIEventListener mRightButtonUIEL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UIEventListener mUpButtonUIEL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UIEventListener mDownButtonUIEL;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">InputControllerManager</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mInputControllerManager == <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mInputControllerManager = <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">mInputControllerManager != <span class="keyword">this</span></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Destroy(mInputControllerManager);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mControlButton != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mControlButtonUIEL = mControlButton.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mLeftButton != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mLeftButtonUIEL = mLeftButton.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mRightButton != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mRightButtonUIEL = mRightButton.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mUpButton != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mUpButtonUIEL = mUpButton.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mDownButton != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mDownButtonUIEL = mDownButton.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ControlButtonClickDelegate</span>(<span class="params">UIEventListener.VoidDelegate oncontrolbuttonclick</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mControlButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mControlButtonUIEL.onClick = oncontrolbuttonclick;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ControlButtonOnPressDelegat</span>(<span class="params">UIEventListener.BoolDelegate oncontrolbuttononpress</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mControlButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mControlButtonUIEL.onPress = oncontrolbuttononpress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LeftButtonClickDelegate</span>(<span class="params">UIEventListener.VoidDelegate onleftbuttonclick</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mLeftButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123; </span><br><span class="line">            mLeftButtonUIEL.onClick = onleftbuttonclick;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LeftButtonOnPressDelegat</span>(<span class="params">UIEventListener.BoolDelegate onleftbuttononpress</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mLeftButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mLeftButtonUIEL.onPress = onleftbuttononpress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RightButtonClickDelegate</span>(<span class="params">UIEventListener.VoidDelegate onrightbuttonclick</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mRightButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mRightButtonUIEL.onClick = onrightbuttonclick;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RightButtonOnPressDelegat</span>(<span class="params">UIEventListener.BoolDelegate onrightbuttononpress</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mRightButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mRightButtonUIEL.onPress = onrightbuttononpress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpButtonClickDelegate</span>(<span class="params">UIEventListener.VoidDelegate onupbuttonclick</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mUpButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mUpButtonUIEL.onClick = onupbuttonclick;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpButtonOnPressDelegat</span>(<span class="params">UIEventListener.BoolDelegate onupbuttononpress</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mUpButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mUpButtonUIEL.onPress = onupbuttononpress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DownButtonClickDelegate</span>(<span class="params">UIEventListener.VoidDelegate ondownbuttonclick</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mDownButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mDownButtonUIEL.onClick = ondownbuttonclick;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DownButtonOnPressDelegat</span>(<span class="params">UIEventListener.BoolDelegate ondownbuttononpress</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mDownButtonUIEL != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mDownButtonUIEL.onPress = ondownbuttononpress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后把做好的InputPanel作为Prefab存起来。上述代码只提供了按钮的OnClick和OnPress回调设置。<br>当前游戏界面如下：<br><img src="/img/Unity/InputControlWithScrollBackground.PNG" alt="InputControlWithScrollBackground"><br>游戏完成时只会有三条道会显示，但玩家需要移动8次来实现从最左边移动到最右边，这里显示九条是为了方便确认位置。</p>
<h5 id="可视化重要信息">可视化重要信息</h5><p>这里主要是为了可视化的看出我们在制作游戏的过程中是否用了一些导致性能或内存消耗很高的方法。<br>关于性能消耗：<br>我们采用在<a href="http://tonytang1990.github.io/2016/03/13/Unity-COC-Study/#Optimization">Unity_COC_Study</a>里打印FPS的方式来可视化。<br>关于内存消耗：<br>之前使用过Memroy Profiler，很直观的显示了各方面的内存消耗和运行时间，性能消耗也能在这里看的一清二楚。<br>这里为了不每次都链接电脑开Memory Profiler，我采用打印FPS的方式查看性能上的消耗。<br>FPSDisplay.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FPSDisplay</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> UILabel mFPSText;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> mDeltaTime = <span class="number">0.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> mFPS = <span class="number">0.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span><br><span class="line">	</span>&#123;</span><br><span class="line">		mDeltaTime += (Time.deltaTime - mDeltaTime) * <span class="number">0.1</span>f;</span><br><span class="line">		<span class="keyword">float</span> msec = mDeltaTime * <span class="number">1000.0</span>f;</span><br><span class="line">		mFPS = <span class="number">1.0</span>f / mDeltaTime;</span><br><span class="line">		mFPSText.text = <span class="keyword">string</span>.Format(<span class="string">"&#123;0:0.0&#125; ms (&#123;1:0.&#125; fps)"</span>, msec, mFPS);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/FPSDisplay.PNG" alt="FPSDisplay"></p>
<h5 id="2D动画抉择">2D动画抉择</h5><p>一个游戏如果都是静态的图片移动，那么看起来肯定很无聊。<br>所以这里我们必须知道如何去制作动画。<br>首先我们确定的是我们使用的是2D Sprite，那么这里就确定了我们需要制作Sprite Animation。<br>在执着2D Sprite Animation之前，我们需要了解一些重要的概念：</p>
<ol>
<li>Animation — 基于关键帧的动画</li>
<li>Animation Controller — 动画管理，通过给物体添加Animator并设定动画状态机之间的切换规则来实现动画状态切换管理(通过给UI添加Animator我们也可以在Anmation面板设置简单动画)<br>接下来看看制作2D Animation步骤：<br>这里由于我下载的资源都只有一整张赛车的Sprite，见下图:<br><img src="/img/Unity/PlayerCarSprite.PNG" alt="PlayerCarSprite"><br>因为原始图片是463*1010的，对于我们来说像素太大了，需要缩小，所以我首先通过PS把图片缩小。<br>如果要想做更细致的动画，比如控车里的人做动画，轮子转弯的时候做动画，那么我就需要制作多张关键帧的Sprite。<br>关键帧图片制作(下面只列举最后一帧，就不多放图片了这里)：<br><img src="/img/Unity/PlayerCarTurnLeft4.png" alt="PlayerCarTurnLeft4"><br><img src="/img/Unity/PlayerCarTurnRight4.png" alt="PlayerCarTurnRight4"><br>接下来我们把制作好的关键帧图片导入Unity作为2D Sprite。<br>然后在Animation面板创建并制作Turn Right，Turn Left，Normal和Crash四种动画。<br><img src="/img/Unity/NormalAnimation.PNG" alt="NormalAnimation"><br><img src="/img/Unity/TurnLeftAnimation.PNG" alt="TurnLeftAnimation"><br><img src="/img/Unity/TurnRightAnimation.PNG" alt="TurnRightAnimation"><br><img src="/img/Unity/CrashAnimator.PNG" alt="CrashAnimator"><br>动画制作完成后，我们需要通过Animation Controller去控制四个动画之间的状态转换规则(Unity里可视化的状态机)。(除了默认的Sprite创建的动画，我们还可以在Aniamtor里通过修改scale，position等属性制作帧动画)<br>首先在Animation Controller里我的赛车有四中状态，Normal，TurnRight，TurnLeft，Crash：<br><img src="/img/Unity/AnimationController.PNG" alt="AnimationController"><br>设置了四种状态之间的转换后，我们需要添加转换条件，添加转换条件，需要通过Animator-&gt;Parameters面板添加，这里我添加了四个trigger类型的条件变量(Trigger的设置只会触发一次状态)：<br><img src="/img/Unity/AnimatorParameters.PNG" alt="AnimatorParameters"><br>创建了状态切换条件后我们需要在状态切换的条件那里设置触发条件：<br>首先选中特定状态切换的带三尖角的线，然后在Inspector设置触发条件和一些状态转换之间的设置，见下图：<br><img src="/img/Unity/StateTranslationConditionSetting.PNG" alt="StateTranslationConditionSetting"><br>这样一来我们在代码里只需获取特定对象身上的Animator，然后调用Animator.SetTrigger(“IsTurningNormal”)就能触发到Normal的状态切换了，同时触发动画效果。</li>
</ol>
<p>除了Unity自带的帧动画，我们还可以通过Animation插件去实现一些动画效果。<br>让我们来看看下面DOTween官网对于各个Tween插件的比较<a href="http://dotween.demigiant.com/#enginesComparison" target="_blank" rel="external">Comparison with other engines</a>。<br>因为我一个都没有用过，就直接按上面的理论使用方便快速的DOTween作为这一次学习使用的对象。<br>具体的DOTween学习参见<a href="http://tonytang1990.github.io/2015/07/15/Unity-Study/#2D-ROGUELIKE-TUTORIAL">Unity_Study_Plugins_DOTween</a></p>
<p>这样一来车子的左右平滑移动和Jump动画效果就通过DOTween实现了。<br>而车子的上下移动结合Coroutine来实现(使用Coroutine的好处是可以实现避免每帧都判断是否需要向上或向下移动)。<br>具体代码如下：<br>PlayerCarController.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> DG.Tweening;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerCarController</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> mMoveTweenTime = <span class="number">0.3</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> mIntervalTimeToKeepMovingUPOrDown = <span class="number">0.025</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Vector3 mHorizontalOffset = <span class="keyword">new</span> Vector3(<span class="number">0.9</span>f, <span class="number">0.0</span>f, <span class="number">0.0</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Vector3 mVerticalOffset = <span class="keyword">new</span> Vector3(<span class="number">0.0</span>f, <span class="number">0.08</span>f, <span class="number">0.0</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LayerMask mBolockingLayer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">int</span> mLimitTopDownMoving = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector3 mTargetPosition;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mIsTweenComplete = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mIsJumpComplete = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mIsKeepMovingUp = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mIsKeepMovingDown = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mUpdateJumpAnimationLater = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Animator mPlayerCarAnimator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">bool</span> mIsCrash = <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Jump tween</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> mJumpDuration = <span class="number">0.4</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mOriginalJumpDuration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Vector3 mJumpEndScale = <span class="keyword">new</span> Vector3(<span class="number">0.6</span>f, <span class="number">0.6</span>f, <span class="number">1.0</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector3 mOriginalScale;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Sequence mJumpSequence;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Box2D</span></span><br><span class="line">    <span class="keyword">private</span> BoxCollider2D mPlayerCarBox2D;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mTargetPosition = gameObject.transform.position;</span><br><span class="line"></span><br><span class="line">        mPlayerCarAnimator = gameObject.GetComponent&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">        mOriginalScale = transform.localScale;</span><br><span class="line"></span><br><span class="line">        mPlayerCarBox2D = gameObject.GetComponent&lt;BoxCollider2D&gt;();</span><br><span class="line"></span><br><span class="line">        mOriginalJumpDuration = mJumpDuration;</span><br><span class="line"></span><br><span class="line">        mJumpSequence =  DOTween.Sequence();</span><br><span class="line"></span><br><span class="line">        mJumpSequence.Append(transform.DOScale(mJumpEndScale, mJumpDuration));</span><br><span class="line">        mJumpSequence.Append(transform.DOScale(mOriginalScale, mJumpDuration));</span><br><span class="line">        mJumpSequence.SetAutoKill(<span class="keyword">false</span>);</span><br><span class="line">        mJumpSequence.OnComplete(OnJumpComplete);</span><br><span class="line">        mJumpSequence.Pause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        InputControllerManager.mInputControllerManager.RightButtonClickDelegate(MoveRight);</span><br><span class="line">        InputControllerManager.mInputControllerManager.LeftButtonClickDelegate(MoveLeft);</span><br><span class="line">        InputControllerManager.mInputControllerManager.UpButtonClickDelegate(MoveUp);</span><br><span class="line">        InputControllerManager.mInputControllerManager.UpButtonOnPressDelegat(KeepMoveUp);</span><br><span class="line">        InputControllerManager.mInputControllerManager.DownButtonClickDelegate(MoveDown);</span><br><span class="line">        InputControllerManager.mInputControllerManager.DownButtonOnPressDelegat(KeepMoveDown);</span><br><span class="line">        InputControllerManager.mInputControllerManager.ControlButtonClickDelegate(Jump);</span><br><span class="line"></span><br><span class="line">        StartCoroutine(MoveUpCoroutine());</span><br><span class="line">        StartCoroutine(MoveDownCoroutine());</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveRight</span>(<span class="params">GameObject go</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mIsTweenComplete == <span class="keyword">true</span> &amp;&amp; mIsCrash == <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Vector2 start = <span class="keyword">new</span> Vector2(transform.position.x, transform.position.y);</span><br><span class="line">            mTargetPosition = transform.position + mHorizontalOffset;</span><br><span class="line">            Vector2 end = <span class="keyword">new</span> Vector2(mTargetPosition.x, mTargetPosition.y);</span><br><span class="line">            RaycastHit2D hit = Physics2D.Linecast(start, end, mBolockingLayer);</span><br><span class="line">            <span class="keyword">if</span>(hit.transform == <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (mPlayerCarAnimator != <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    mPlayerCarAnimator.SetTrigger(<span class="string">"IsTurningRight"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                mIsTweenComplete = <span class="keyword">false</span>;</span><br><span class="line">                transform.DOMove(mTargetPosition, mMoveTweenTime).OnComplete(OnTweenComplete);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveLeft</span>(<span class="params">GameObject go</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mIsTweenComplete == <span class="keyword">true</span> &amp;&amp; mIsCrash == <span class="keyword">false</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            Vector2 start = <span class="keyword">new</span> Vector2(transform.position.x, transform.position.y);</span><br><span class="line">            mTargetPosition = transform.position - mHorizontalOffset;</span><br><span class="line">            Vector2 end = <span class="keyword">new</span> Vector2(mTargetPosition.x, mTargetPosition.y);</span><br><span class="line">            RaycastHit2D hit = Physics2D.Linecast(start, end, mBolockingLayer);</span><br><span class="line">            <span class="keyword">if</span> (hit.transform == <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (mPlayerCarAnimator != <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    mPlayerCarAnimator.SetTrigger(<span class="string">"IsTurningLeft"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                mIsTweenComplete = <span class="keyword">false</span>;</span><br><span class="line">                mTargetPosition = transform.position - mHorizontalOffset;</span><br><span class="line">                transform.DOMove(mTargetPosition, mMoveTweenTime).OnComplete(OnTweenComplete);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveUp</span>(<span class="params">GameObject go</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">KeepMoveUp</span>(<span class="params">GameObject go, <span class="keyword">bool</span> state</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(state)</span><br><span class="line">        &#123;</span><br><span class="line">            mIsKeepMovingUp = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            mIsKeepMovingUp = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">IEnumerator <span class="title">MoveUpCoroutine</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (mIsKeepMovingUp &amp;&amp; mIsCrash == <span class="keyword">false</span> &amp;&amp; mIsJumpComplete == <span class="keyword">true</span>)</span><br><span class="line">            &#123;  </span><br><span class="line">                Vector2 start = <span class="keyword">new</span> Vector2(transform.position.x, transform.position.y);</span><br><span class="line">                mTargetPosition = transform.position + mVerticalOffset * mLimitTopDownMoving;</span><br><span class="line">                Vector2 end = <span class="keyword">new</span> Vector2(mTargetPosition.x, mTargetPosition.y);</span><br><span class="line">                RaycastHit2D hit = Physics2D.Linecast(start, end, mBolockingLayer);</span><br><span class="line">                <span class="keyword">if</span> (hit.transform == <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    mTargetPosition = transform.position + mVerticalOffset;</span><br><span class="line">                    transform.position = mTargetPosition;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">mIntervalTimeToKeepMovingUPOrDown</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveDown</span>(<span class="params">GameObject go</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">KeepMoveDown</span>(<span class="params">GameObject go, <span class="keyword">bool</span> state</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state)</span><br><span class="line">        &#123;</span><br><span class="line">            mIsKeepMovingDown = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            mIsKeepMovingDown = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">IEnumerator <span class="title">MoveDownCoroutine</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (mIsKeepMovingDown &amp;&amp; mIsCrash == <span class="keyword">false</span> &amp;&amp; mIsJumpComplete == <span class="keyword">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Vector2 start = <span class="keyword">new</span> Vector2(transform.position.x, transform.position.y);</span><br><span class="line">                mTargetPosition = transform.position - mVerticalOffset * mLimitTopDownMoving;</span><br><span class="line">                Vector2 end = <span class="keyword">new</span> Vector2(mTargetPosition.x, mTargetPosition.y);</span><br><span class="line">                RaycastHit2D hit = Physics2D.Linecast(start, end, mBolockingLayer);</span><br><span class="line">                <span class="keyword">if</span> (hit.transform == <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    mTargetPosition = transform.position - mVerticalOffset;</span><br><span class="line">                    transform.position = mTargetPosition;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params">mIntervalTimeToKeepMovingUPOrDown</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Jump</span>(<span class="params">GameObject go</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mIsJumpComplete == <span class="keyword">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mIsJumpComplete = <span class="keyword">false</span>;</span><br><span class="line">            mPlayerCarBox2D.enabled = <span class="keyword">false</span>;</span><br><span class="line">            mJumpSequence.Restart();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CrashCallBack</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        SceneManager.LoadScene(<span class="string">"Game"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnTriggerEnter2D</span>(<span class="params">Collider2D collision</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(collision.tag == <span class="string">"EnemyCar"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="keyword">string</span>.Format(<span class="string">"Collision with EnemyCar.name &#123;0&#125;"</span>,collision.name));</span><br><span class="line">            mIsCrash = <span class="keyword">true</span>;</span><br><span class="line">            mPlayerCarAnimator.SetTrigger(<span class="string">"IsCrash"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnTriggerExit2D</span>(<span class="params">Collider2D collision</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (collision.tag == <span class="string">"EnemyCar"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="keyword">string</span>.Format(<span class="string">"Collision with EnemyCar.name &#123;0&#125;"</span>, collision.name));</span><br><span class="line">            mIsCrash = <span class="keyword">true</span>;</span><br><span class="line">            mPlayerCarAnimator.SetTrigger(<span class="string">"IsCrash"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTweenComplete</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mIsTweenComplete = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(mIsCrash == <span class="keyword">false</span>)</span><br><span class="line">        &#123; </span><br><span class="line">            mPlayerCarAnimator.SetTrigger(<span class="string">"IsTurningNormal"</span>);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnJumpComplete</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mIsJumpComplete = <span class="keyword">true</span>;</span><br><span class="line">        mPlayerCarBox2D.enabled = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(mUpdateJumpAnimationLater)</span><br><span class="line">        &#123;</span><br><span class="line">            mUpdateJumpAnimationLater = <span class="keyword">false</span>;</span><br><span class="line">            UpdateJumpAnimation();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateJumpAnimation</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mIsJumpComplete == <span class="keyword">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mUpdateJumpAnimationLater = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        	<span class="comment">//Reset Sequence to adjust tween's duration</span></span><br><span class="line">            mJumpSequence.Kill(<span class="keyword">true</span>);</span><br><span class="line">            mJumpSequence = DOTween.Sequence();</span><br><span class="line">            mJumpDuration = mOriginalJumpDuration - CarDodgeGame.mCarDodgeGameInstance.GameLevel / <span class="number">15.0</span>f;</span><br><span class="line">            Debug.Log(<span class="string">"mJumpDuration = "</span> + mJumpDuration);</span><br><span class="line">            mJumpSequence.Append(transform.DOScale(mJumpEndScale, mJumpDuration));</span><br><span class="line">            mJumpSequence.Append(transform.DOScale(mOriginalScale, mJumpDuration));</span><br><span class="line">            mJumpSequence.SetAutoKill(<span class="keyword">false</span>);</span><br><span class="line">            mJumpSequence.OnComplete(OnJumpComplete);</span><br><span class="line">            mJumpSequence.Pause();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过调节给出的public变量，可控制movetween的duration时间和coroutine的执行时间间隔，还有垂直和水平方向的移动位移等。</p>
<h5 id="游戏内GameObject数量的思考">游戏内GameObject数量的思考</h5><p>因为2D赛车躲避小游戏同一时间不会有太多的GameObject处于场景里，通过<a href="http://tonytang1990.github.io/2016/03/13/Unity-COC-Study/#Optimization">Unity_COC_Study</a>的学习，我知道了我们可以通过Object Pool的方式来预创建一定数量的GameObject，然后在适当的时机active or deactive他们来减少Instantiate的调用，即节约内存又性能损耗低。<br>ObjectPoolManager .cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPoolManager</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ObjectPoolManager mObjectPoolManagerInstance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject[] mEnemyCar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> mAmountForEachEnemyCar = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;GameObject&gt;&gt; mEnemyCarTwoDimensionList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> mWillGrow = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mObjectPoolManagerInstance == <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mObjectPoolManagerInstance = <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">mObjectPoolManagerInstance != <span class="keyword">this</span></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mEnemyCarTwoDimensionList = <span class="keyword">new</span> List&lt;List&lt;GameObject&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mEnemyCar.Length; i++)</span><br><span class="line">        &#123; </span><br><span class="line">            List&lt;GameObject&gt; enemycarlist = <span class="keyword">new</span> List&lt;GameObject&gt;(mAmountForEachEnemyCar);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mAmountForEachEnemyCar; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                GameObject enemycarobj = Instantiate(mEnemyCar[i]) <span class="keyword">as</span> GameObject;</span><br><span class="line">                enemycarobj.SetActive(<span class="keyword">false</span>);</span><br><span class="line">                enemycarlist.Add(enemycarobj);</span><br><span class="line">            &#125;</span><br><span class="line">            mEnemyCarTwoDimensionList.Add(enemycarlist);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetEnemyCarObject</span>(<span class="params"><span class="keyword">int</span> carindex</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mEnemyCarTwoDimensionList[carindex].Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!mEnemyCarTwoDimensionList[carindex][i].activeInHierarchy)</span><br><span class="line">            &#123;</span><br><span class="line">                mEnemyCarTwoDimensionList[carindex][i].SetActive(<span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">return</span> mEnemyCarTwoDimensionList[carindex][i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mWillGrow)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject enemycar = Instantiate(mEnemyCar[carindex]) <span class="keyword">as</span> GameObject;</span><br><span class="line">            mEnemyCarTwoDimensionList[carindex].Add(enemycar);</span><br><span class="line">            <span class="keyword">return</span> enemycar;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上述代码写的比较死，是针对CarDodge这个游戏而言，因为有多种车子，所以用到了List<list<gameobject>&gt;这样的双重List来存储对应车子所与生成的GameObject。</list<gameobject></p>
<p>最终游戏截图(大部分游戏UI素材选至COC)：<br><img src="/img/Unity/LoginUI.PNG" alt="LoginUI"><br>出于是学习使用旧版的NGUI，所以上述UI并没有实际的账号注册检查，只实现了简单的输入文字要求和账号对错(账号暂时是硬代码写的，PC上是通过读取Excel(使用的是ExcelReader，参考<a href="http://exceldatareader.codeplex.com/" target="_blank" rel="external">ExcelRead website</a>)，真机对应功能还没做)检查。<br><img src="/img/Unity/LoadingUI.PNG" alt="LoadingUI"><br>这一个主要是尝试Scroll Bar<br><img src="/img/Unity/GameSetting1.PNG" alt="GameSetting1"><br><img src="/img/Unity/GameSetting2.PNG" alt="GameSetting2"><br><img src="/img/Unity/GameSetting3.PNG" alt="GameSetting3"><br>这三个主要是尝试UIBUtton，UIPopupList，UIISlider，UIDraggable Panel的使用和TweenPosition制作简单UI动画(包含了对背景音乐和音量的设置功能，存储采取PlayerPrefs写入程序文件)。<br><img src="/img/Unity/IpadScreenShot.jpg" alt="IpadScreenShot"><br>最后这一个是本章2D赛车躲避的最终真机(Ipad mini 1)游戏截图，主要实现了赛车跳跃，前后左右移动，随着赛车数量躲避增加游戏速度增加，限制了移动范围。</p>
<h3 id="贪吃蛇">贪吃蛇</h3><h4 id="游戏说明-1">游戏说明</h4><p>这个游戏我想没什么好说的了，直接移步<a href="https://zh.wikipedia.org/wiki/%E8%B4%AA%E9%A3%9F%E8%9B%87" target="_blank" rel="external">贪吃蛇维基百科</a></p>
<h4 id="游戏要点思考">游戏要点思考</h4><ol>
<li>2D or 3D？<br>标准的传统2D游戏，所以这里可以用纯2D来做(这里采用纯NGUI来做，看看NGUI的自适应效果)。</li>
<li>游戏素材大小<br>依然以1024<em>768(4:3)为标准，因为之前在<a href="http://tonytang1990.github.io/2015/07/15/Unity-Study/#NGUI_2-7%E5%B1%8F%E5%B9%95%E8%87%AA%E9%80%82%E5%BA%94">NGUI 2.7屏幕自适应</a>已经提到了，把UIRoot的Scaling Style设置为Fixed Size，然后通过动态修改ManuaHeight已经实现了基于高度的自适应，所以我们在创建地图的时候只需考虑把Grid创建在基于1024</em>768的分辨率对应位置即可(当然这样会出现在不同分辨率机器上自适应后铺不满屏幕，但这样做我们可以无需考虑机器分辨率)。准备设计宽40<em>30(4:3)个单元格，单元格以20乘以20像素为基准，这样一来游戏地图占据800</em>600像素，高度腾出来的像素768-600=168用于控制UI面板显示。<br>这个游戏实现没什么特别的，这里主要看看不同分辨率的显示情况。<br>1024-768：<br><img src="/img/Unity/SnakeGame1024768.PNG" alt="SnakeGame1024768"><br>960-640：<br><img src="/img/Unity/Snake960640.PNG" alt="Snake960640"><br>800-800：<br><img src="/img/Unity/Snake800800.PNG" alt="Snake800800"></li>
</ol>
<h3 id="坦克大战">坦克大战</h3><h4 id="游戏说明-2">游戏说明</h4><p><a href="https://zh.wikipedia.org/wiki/%E5%9D%A6%E5%85%8B%E5%A4%A7%E6%88%98" target="_blank" rel="external">坦克大战（英语：Battle City）是一款平面射击游戏</a></p>
<h4 id="游戏要点思考-1">游戏要点思考</h4><ol>
<li><p>2D or 3D?<br>以纯2D的形式来制作坦克大战游戏。</p>
</li>
<li><p>UI选择<br>这里为了熟悉UGUI，进而和NGUI相比较，这里采用UGUI来学习。<br><a href="http://tonytang1990.github.io/2015/07/15/Unity-Study/#UGUI">UGUI相关知识学习</a></p>
</li>
<li><p>UI自适应<br>UI Render Space — Screen Space(Camera)(设置Main Camera作为渲染Camera)<br>UI Scale Mode — Scale With Screen Size(设置MatchWidthOrHeight = 0.5确保按宽度和高度变化同时变化去适应)<br>Background UI Scale Mode — Scale with Screen Size(设置MatchWidthOrHeight = 1确保游戏背景是高度铺满，Anchor设置在中心保持1:1比例)</p>
</li>
<li><p>Pixel Perfect 2D?素材选择？地图大小？地图在不同分辨率上的显示？<br>为了实现Pixel Perfect 2D，我们需要确保1 Unit所代表的像素 = PPU。<br>我以1024 X 768为基准，Orthographic Size设置为6，PPU为64。(这样一来屏幕高度被分为12 Unit，每个Unit代表768 / 2 / 6 = 64 pixel)<br>2D素材采用64 X 64的Tile(每一个Tile占一个Unit)<br>游戏区域为704 X 704大小(占11 X 11个Unit，四周多出来的用于UI显示)<br>UI Sprite采用64 X 64。<br>因为地图是基于Tile的，所以在不同分辨率上，地图的大小(Tile数量)应该是一致的，这里地图大小默认设定为11 X 11个Tile(704 X 704)(基于1024 X 768，高度顶部留1个Unit)。<br>要想Tile在不同分辨率机器上都Pixel Perfect显示，动态修改Orthographic Size会导致Size Change(屏幕高度的Unit数量也会改变)，以PPU = 64且Tile像素为64 * 64去显示12个Tile是没法恰好铺满屏幕高度的。所以这里采用保持Orthographic Size不变保持6，制作多套PPU去适应屏幕分辨率的方案(通过Assetbundle动态替换)。(出于学习目的这里只针对1024 X 768(PPU = 64)和1920 X 1080(PPU = 1080 / 2 / 6 = 90)来做两套PPU实验)<br>Note:<br>这方案会导致做很多套不同PPU的资源去适应不同屏幕分辨率。</p>
</li>
<li><p>Sprite Setting?<br>Sprite Type — Sprite(2D and UI) 因为用于纯2D游戏<br>Sprite Mode — Single or Multiple 根据我们的图片是否需要切割成单独的Sprite而定<br>Packing Tag — 用于Unity Sprite Packer打包Spite图集<br>Pixels Per Unit — 64(Pixel Perfect显示，PPU = Screen.height / Orthographic Size(6) / 2)。<br>Generate Mip Maps — No(因为是纯2D游戏，摄像机与Sprite距离保持不变(当然其实Camera设置成Screen Space(Camera)而言是可以变的，但这里我们设置Orthographic投影，所以距离对于显示大小没有意义，并且我们还保证了Pixel Perfet显示，所以就游戏里的Sprite而言Mipmap是没有必要的。(前面的前提是使用多套Asset资源并保证Pixel Perfect显示))<br>后面三个参数学习参考<a href="http://blog.csdn.net/candycat1992/article/details/22794773" target="_blank" rel="external">调整画质（贴图）质量</a><br>Filter Mode — Bilinear(Filter Mode用于纹理图片这里的Sprite拉伸后如何插值计算(抗锯齿计算)，Bilinear会进行双线性插值，效果和运算开销在Point，Biinear，Trilinear里最能够接受。)<br>Max Size — 2048(导入纹理的最大尺寸，默认2048，设置过小会导致大图片被压缩，质量变得很差(当然也要考虑内存的使用降低了))<br>Format — Compressed(纹理压缩格式，大小和质量的权衡。采用默认的Compressed即可。)</p>
</li>
<li><p>物理？<br>不使用物理控制(Transform移动)，使用Trigger做触发，纯2D游戏，使用Physical2D和Rigibody2D。</p>
</li>
<li><p>控制方式<br>因为之前的控制面板是基于NGUI制作的，所以这里就混合UGUI和NGUI来作为控制面板。</p>
</li>
<li><p>游戏特性<br> 坦克特性：</p>
<ol>
<li>占据一个Tile，1 Unit(1 Tile被细分成16 * 16的网格)</li>
<li>Tank以0.5个Unit的单位的移动，只要前方0.5 Unit单位内有不可通行物，就不能前进</li>
<li>多个Tank不能占据同一位置</li>
<li>Tank只能上下左右移动</li>
<li>坦克只能发射出有限数量的子弹，在子弹数量达到上限时需要等待子弹消失。</li>
<li>不同的坦克的移动速度和子弹数量上限和子弹速度不一样<br>子弹特性：</li>
<li>子弹拥有不同等级的威力，根据威力不同可消灭的小块数量和小块类型不同</li>
<li>子弹不能击中友方队员(友方队员子弹也不行)</li>
<li>子弹只有上下左右四个固定的方向，一旦射出子弹，方向不会改变<br>Tile特性：</li>
<li>Tile可以被攻击切割成多个小块(Normal Tile这里假设可切割成16)，<br>每个小块具备完整的特性(占据单元格阻碍前进，能被攻击)。</li>
<li>小块Tile被子弹击中会根据子弹伤害和周围Tile小块情况来决定是消灭单独一个小块还是2个或多个。</li>
<li>不同类型的Tile有不同的特性(能否通过，能否破坏等)</li>
</ol>
</li>
<li><p>敌人AI<br> 敌军坦克特性：</p>
<ol>
<li>移动方向只有上下左右</li>
<li>单次移动单位0.5 Unit</li>
<li>撞到障碍物(不可通行的地方(不包括友军坦克))后重新选择方向</li>
<li>方向选择(避开之前行进方向随机选取一个方向)</li>
<li>多个坦克相遇的时候不立刻重新选择方向而是开始累计坦克无法移动的时间<br>(直到坦克达到坦克停止时间限制时重新选择，这里不同速度的坦克所忍耐的停止时间不一样，这样一来就可以实现，速度快的追着速度慢的跑)</li>
<li>子弹随机隔一段时间发射，但不会发射超过子弹数量上限。</li>
</ol>
</li>
<li><p>地图编辑器制作<br>做一个地图编辑模式，提供多种Tile模型选择，通过序列化存储起来。(可用于制作关卡)</p>
</li>
<li><p>多人网络游戏(学习多人网络游戏开发)<br>支持多人联网进行(通过Unity High Level API去开发)</p>
</li>
<li><p>地图存储方式<br>地图信息很简单，主要存储地图里每一个Tile的类型信息(同时存储地图名称，坦克出生地点信息)，这里采用序列化的方式。(因为我们保持了Orthographic Size为6，通过动态切换不同PPU的Assets去保证Pixel Perfect显示，所以Screen高度一直都是12个Unit，同时设置了PPU = Screen.height / 2 / 6，Tile素材PPU <em> PPU，所以1个Tile对应1个Unit。地图存储的信息是11 </em> 1(704 * 704)个Tile相关的信息(高度顶部留3个Unit用作UI显示)。</p>
</li>
<li><p>地图数据加密<br>待思考</p>
</li>
<li><p>游戏地图数据结构？如何实现Tile可以被多个方向打击切割成小块效果？<br>参考前面游戏特性：</p>
</li>
</ol>
<p>地图存储数据信息(MapInfo)：</p>
<pre><code><span class="number">1</span>. 地图被细分成多个Tile<span class="params">(MapSize.Row * MapSize.Column大小)</span>，存储所有Tile相关信息<span class="params">(用于构建地图)</span>
<span class="number">2</span>. 记录玩家Tank出生点和敌军坦克出生点信息。<span class="params">(用于获取Spawn玩家坦克和敌军坦克的位置信息)</span>
<span class="number">3</span>. 记录是否包含基地和基地位置信息。<span class="params">(用于确保只有一个基地)</span>
<span class="number">4</span>. 存储地图名字<span class="params">(用于地图存储)</span>
</code></pre><p>游戏地图数据(TankMap)：</p>
<pre><code><span class="bullet">1. </span>记录所有细分后是否被占用信息和对应占用的类型(用于Tank移动判断)
占用类型好比Tile or Tank，通过占用类型知道该单元格是被Tile占用还是Tank占用。
地图应该被细分成所有 Tile数量 * Tile最小切割数的网格
(这里假设Tile最多被切割成16，那么地图应该被细分到MapSize.Row <span class="bullet">* MapSize.Column *</span> 16的BitArray)
<span class="bullet">2. </span>每个细分的Tile记录自身包含细分后的索引信息
(e.g. 最大细分16，Iron Tile细分为2 * 2 = 4，那么每个细分的Iro Tile所记录的细分后的索引信息数量为16 / 4 = 4个) 
这样一来每个小的Tile被破坏后支持快速改写该小块占有地图网格的占用信息)。 
<span class="bullet">3. </span>坦克存储自身所占用的所有indexs作为移动索引信息
<span class="bullet">3. </span>包含前面地图存储的信息(用于构建游戏地图数据)
</code></pre><p>Note：<br>不同类型的Tile的细分程度不同(16 <em> 16 or 4 </em> 4 or 2 <em> 2 or 1 </em> 1)，但游戏地图数据细分以细分程度最大的为准。(细分程度不同会影响Tile在子弹撞击时的效果判定)</p>
<p>待续……</p>
<h2 id="问题记录">问题记录</h2><ol>
<li>编译打包XCode项目出问题<br>Failed to Copy File / Directory from ‘**\Unity\Editor\Data\Tools/MapFileParser/MapFileParser’ to ‘Temp/StagingArea\Trampoline\MapFileParser’.<br>这是Unity 5.1版本的一个bug。<br><a href="http://answers.unity3d.com/questions/990499/error-building-player-ioexception-failed-to-copy.html" target="_blank" rel="external">解决方案</a><br>修改.\Unity\Editor\Data\Tools\MapFileParser\MapFileParser.exe到MapFileParser然后打包XCode项目，然后在XCode项目里把MapFileParser改回MapFileParser.exe<br>或者使用新版本Unity</li>
<li>编译打包XCode项目时库找不到的问题<br>ArgumentException: The Assembly System.Configuration is referenced by System.Data. But the dll is not allowed to be included or could not be found.<br><a href="http://answers.unity3d.com/questions/485085/dll-is-not-allowed-to-be-included-or-could-not-be.html" target="_blank" rel="external">解决方案</a><br>Change it from .NET sub 2.0 to .NET</li>
<li>Git不支持超过100M文件上传<br><a href="https://git-lfs.github.com/" target="_blank" rel="external">解决方案Git Large File Storage (LFS)</a></li>
<li>Cloud Build显示Bitcode错误<br>又是Unity5.1.1的一个bug<br>解决方案：<br>可以打开XCode项目，项目属性设置bitcode enale<br>由于遇到太多Unity bug，个人建议采用新版本Unity为佳。我个人最后去下载了最新版本的Unity5.4.0版本。</li>
<li>MapParser.sh acess Permission denied<br>貌似又是Unity bug，Unity 5.4.0<br>解决方案:<br>需要在Mac电脑上修改MapParser.sh的执行权限(chmod +x MapParser.sh)，然后提交到Git后再触发编译。然后用修改后的MapParser.sh覆盖引擎目录下的Editor\Data\PlaybackEngines\iOSSupport\Trampoline\MapParser.sh以确保每次生成的XCode Project里的MapParser.sh有可执行权限。</li>
<li>指定Android NDK的时候报错”Unable to detect NDK version, please pick a different folder”<br>解决方案：<br>需要下载特定版本的NDK 10r<br>Edit -&gt; Preference -&gt; External Tool -&gt; NDK download<br>或者<br>自己去下载后指定目录</li>
<li>XCode编译项目报错：MapParser.sh: bin/sh^M: bad interpreter: no such file or directory<br><a href="http://www.cnblogs.com/pipelone/archive/2009/04/17/1437879.html" target="_blank" rel="external">解决方案</a><br>这是不同系统编码格式引起的：在windows系统中编辑的.sh文件可能有不可见字符，所以在Linux系统下执行会报以上异常信息。<br>使用dos2unix工具转换字符编码后放到Xcode项目里。(为了避免XCode生成每次都出这个问题，我们替换字符编码为Unix位于Unity引擎里的Editor-&gt;Data-&gt;PlaybackEngines-&gt;iOSSupport-&gt;Trampoline-&gt;MapFileParser.sh)</li>
<li>Unity Cloud Build error:”2015-12-10 17:21:27.407 xcodebuild[7363:75765] Failed to locate a valid instance of CoreSimulatorService in the bootstrap.  Adding it now.<br>Could not find service “com.apple.CoreSimulator.CoreSimulatorService” in domain for uid: 502<br>2015-12-10 17:21:27.431 xcodebuild[7363:75765] launchctl print returned an error code: 28928”<br><a href="https://trac.macports.org/wiki/ProblemHotlist#xcode7.2" target="_blank" rel="external">解决方案</a><br>从上面链接发现这是Xcode 7.2的一个bug，我们需要用Xcode 7.3，所以我们只需要把Unity Cloud Build设置到Xcode 7.3即可。</li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://tonytang1990.github.io/2016/08/21/Classical-2D-Game-Unity-NGUI/" data-title="Classical 2D Game(Unity &amp; NGUI) | 走停人生路" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2016/07/25/Shader-Toy/"  title="Shader Toy">
 <strong>下一篇：</strong><br/> 
 <span>Shader Toy
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/08/21/Classical-2D-Game-Unity-NGUI/" data-title="Classical 2D Game(Unity & NGUI)" data-url="http://tonytang1990.github.io/2016/08/21/Classical-2D-Game-Unity-NGUI/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Game_Introduction"><span class="toc-number">1.1.</span> <span class="toc-text">Game Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparation"><span class="toc-number">1.2.</span> <span class="toc-text">Preparation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IOS_Account_Setup"><span class="toc-number">1.2.1.</span> <span class="toc-text">IOS Account Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity_IOS_build_process"><span class="toc-number">1.2.2.</span> <span class="toc-text">Unity IOS build process</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cloud_Build"><span class="toc-number">1.2.3.</span> <span class="toc-text">Cloud Build</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UI库选择"><span class="toc-number">1.2.4.</span> <span class="toc-text">UI库选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#游戏实战开发"><span class="toc-number">1.3.</span> <span class="toc-text">游戏实战开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#赛车躲避"><span class="toc-number">1.3.1.</span> <span class="toc-text">赛车躲避</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏说明"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">游戏说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#相关概念学习"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">相关概念学习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏制作过程"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">游戏制作过程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Project_Mode选择"><span class="toc-number">1.3.1.3.1.</span> <span class="toc-text">Project Mode选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#美术图片分辨率选择"><span class="toc-number">1.3.1.3.2.</span> <span class="toc-text">美术图片分辨率选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游戏背景循环移动实现方式选择"><span class="toc-number">1.3.1.3.3.</span> <span class="toc-text">游戏背景循环移动实现方式选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游戏控制方式选择"><span class="toc-number">1.3.1.3.4.</span> <span class="toc-text">游戏控制方式选择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#可视化重要信息"><span class="toc-number">1.3.1.3.5.</span> <span class="toc-text">可视化重要信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2D动画抉择"><span class="toc-number">1.3.1.3.6.</span> <span class="toc-text">2D动画抉择</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#游戏内GameObject数量的思考"><span class="toc-number">1.3.1.3.7.</span> <span class="toc-text">游戏内GameObject数量的思考</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#贪吃蛇"><span class="toc-number">1.3.2.</span> <span class="toc-text">贪吃蛇</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏说明-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">游戏说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏要点思考"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">游戏要点思考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#坦克大战"><span class="toc-number">1.3.3.</span> <span class="toc-text">坦克大战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏说明-2"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">游戏说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#游戏要点思考-1"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">游戏要点思考</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题记录"><span class="toc-number">1.4.</span> <span class="toc-text">问题记录</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Game-Engine/" title="Game_Engine">Game_Engine<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Language/" title="Programming Language">Programming Language<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Rendering/" title="Rendering">Rendering<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Unity/" title="Unity">Unity<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/OpenGL/" title="OpenGL">OpenGL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Sort/" title="Sort">Sort<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Shader/" title="Shader">Shader<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Programming/" title="Programming">Programming<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Tony Tang. <br/>
			This is my new blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Tony Tang">Tony Tang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"TonyTang1990"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
