
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Unity原生 | 走停人生路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Tony Tang">
    

    
    <meta name="description" content="原生知识Plugins分类Unity Plugins主要分为两类：  Managed Plugins Native Plugins  Managed PluginsManaged plugins are managed .NET assemblies created with tools like Visual Studio or MonoDevelop. They contain only .N">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity原生">
<meta property="og:url" content="http://tonytang1990.github.io/2016/12/11/Unity%E5%8E%9F%E7%94%9F/index.html">
<meta property="og:site_name" content="走停人生路">
<meta property="og:description" content="原生知识Plugins分类Unity Plugins主要分为两类：  Managed Plugins Native Plugins  Managed PluginsManaged plugins are managed .NET assemblies created with tools like Visual Studio or MonoDevelop. They contain only .N">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFFileStructure.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFFileCommand.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFFileStructureDetail.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFHeaderReadelfCommand.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SectionHeadersInfo.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/StripSectionsAfter.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AndroidSupportedArchitectures.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IOSMonoSupportedArchitectures.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IOSIL2CPPSupportedArchitectures.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidBuildFlowChart.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioAndroidProjectStucture.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStuidoAndroidModule.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioAndroidModule.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioAndroidMudleImportCode.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioGradleProjectView.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioGraduleBuildProccess.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidModuleJar.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/UnityAndroidFolderStructure.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/UnityJNICall.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidAAROutput.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidGradleLibsFolderStructure.png">
<meta property="article:published_time" content="2016-12-11T15:46:11.000Z">
<meta property="article:modified_time" content="2022-07-31T07:13:33.046Z">
<meta property="article:author" content="Tony Tang">
<meta property="article:tag" content="Native">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tonytang1990.github.io/img/Unity/ELFFileStructure.PNG">

    
    <link rel="alternative" href="/atom.xml" title="走停人生路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="走停人生路" title="走停人生路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="走停人生路">走停人生路</a></h1>
				<h2 class="blog-motto">做着独立游戏梦，坚持走在游戏开发道路上的人</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:tonytang1990.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/11/Unity原生/" title="Unity原生" itemprop="url">Unity原生</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Tony Tang" target="_blank" itemprop="author">Tony Tang</a>
		
  <p class="article-time">
    <time datetime="2016-12-11T15:46:11.000Z" itemprop="datePublished"> 发表于 2016-12-11</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">原生知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Plugins%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.</span> <span class="toc-text">Plugins分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Managed-Plugins"><span class="toc-number">1.1.1.</span> <span class="toc-text">Managed Plugins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Natiev-Plugins"><span class="toc-number">1.1.2.</span> <span class="toc-text">Natiev Plugins</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Plugins%E6%96%87%E4%BB%B6%E6%89%A9%E5%B1%95%E5%90%8D%E5%92%8C%E6%94%AF%E6%8C%81%E5%B9%B3%E5%8F%B0"><span class="toc-number">1.2.</span> <span class="toc-text">Plugins文件扩展名和支持平台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%99%A8%E4%B8%8EPlugins"><span class="toc-number">1.2.1.</span> <span class="toc-text">处理器与Plugins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">.so文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E4%B8%8EELF"><span class="toc-number">1.2.3.</span> <span class="toc-text">.so与ELF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%92%8C%E4%BD%BF%E7%94%A8-so"><span class="toc-number">1.2.4.</span> <span class="toc-text">编译和使用.so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E6%9E%B6%E6%9E%84%E7%9A%84%E6%8A%89%E6%8B%A9"><span class="toc-number">1.2.5.</span> <span class="toc-text">.so架构的抉择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity-Android-IOS-Plugin"><span class="toc-number">1.2.6.</span> <span class="toc-text">Unity Android &amp; IOS Plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Android%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">Android实战</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Android-Studio"><span class="toc-number">1.2.6.1.1.</span> <span class="toc-text">Android Studio</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JNI-Java%E4%BA%A4%E4%BA%92"><span class="toc-number">1.2.6.1.2.</span> <span class="toc-text">JNI(Java交互)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.6.1.3.</span> <span class="toc-text">Android项目相关概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E5%BA%93%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.6.1.4.</span> <span class="toc-text">Android库模块实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Gradle"><span class="toc-number">1.2.6.1.4.1.</span> <span class="toc-text">Gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Android%E5%BA%93%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.6.1.4.2.</span> <span class="toc-text">Android库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Jar%E5%BA%93%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.6.1.4.3.</span> <span class="toc-text">Jar库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#AAR%E5%BA%93%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.6.1.4.4.</span> <span class="toc-text">AAR库模块</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOS%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.7.</span> <span class="toc-text">IOS实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Objective-C%E8%AF%AD%E6%B3%95"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">Objective-C语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unity%E4%B8%8EIOS%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">Unity与IOS的交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">引用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">2.</span> <span class="toc-text">Reference</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity-Official-Website-Part"><span class="toc-number">2.1.</span> <span class="toc-text">Unity Official Website Part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knowledge-Part"><span class="toc-number">2.2.</span> <span class="toc-text">Knowledge Part</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="原生知识"><a href="#原生知识" class="headerlink" title="原生知识"></a>原生知识</h1><h2 id="Plugins分类"><a href="#Plugins分类" class="headerlink" title="Plugins分类"></a>Plugins分类</h2><p>Unity Plugins主要分为两类：</p>
<ol>
<li>Managed Plugins</li>
<li>Native Plugins</li>
</ol>
<h3 id="Managed-Plugins"><a href="#Managed-Plugins" class="headerlink" title="Managed Plugins"></a>Managed Plugins</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/Plugins.html">Managed plugins are managed .NET assemblies created with tools like Visual Studio or MonoDevelop. They contain only .NET code which means that they can’t access any features that are not supported by the .NET libraries</a><br>可以看出Managed Plugins是基于.NET的，只含有.NET code(因为Unity只支持.net 2.0，所以并非所有的.NET库和特性都支持)。</p>
<h3 id="Natiev-Plugins"><a href="#Natiev-Plugins" class="headerlink" title="Natiev Plugins"></a>Natiev Plugins</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/Plugins.html">Native plugins are platform-specific native code libraries. They can access features like OS calls and third-party code libraries that would otherwise not be available to Unity.</a><br>Native Plugins可以理解成.NET以外的平台相关的本地代码库(比如c++(unmanaged code),java等等编写的库)，通过编译使用这些平台相关的bendi 代码我们可以去得到一些Unity不支持的一些功能特性，同时Native Plugins允许我们去重用那些平台相关的库。</p>
<p>Note:<br><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/Plugins.html">if you forget to add a managed plugin file to the project, you will get standard compiler error messages. If you do the same with a native plugin, you will only see an error report when you try to run the project.</a>(Managed Plugin是基于.NET的，Unity<br>直接识别，所以在编译时就会报错。而Native Plugin只会在运行时报错。)</p>
<h2 id="Plugins文件扩展名和支持平台"><a href="#Plugins文件扩展名和支持平台" class="headerlink" title="Plugins文件扩展名和支持平台"></a>Plugins文件扩展名和支持平台</h2><p>Unity支持的Plugins文件扩展名如下：<br>.dll(这里要分Managed还是Native，支持多个平台)<br>.so(Android上使用的代码库文件类型)<br>.a(IOS上使用的代码库文件类型)<br>.jar(java文件打包(不包含Android资源文件)<br>.swift(IOS上新语言swift)<br>.aar(打包Android包含代码文件和所有Android资源文件)<br>.framework<br>.bundle<br>.plugin<br>……(这里只列举了比较典型的一些插件文件扩展名)</p>
<p>Unity支持的平台：<br>Unity是支持多平台的：</p>
<ol>
<li>Editor(Unity Editor)</li>
<li>Windows</li>
<li>IOS</li>
<li>Android<br>……(上述只列举了一部分)</li>
</ol>
<p>那么为什么需要了解这么多不同扩展名和不同的支持平台了？<br>因为不同的文件扩展名是针对不同的平台而运用的。<br>比较典型的就是:<br>.dll(多平台)<br>.so .jar .aar(Android)<br>.a .m .mm .swift .framework(IOS)</p>
<p>那么是不是只要随便编译一个.so文件就能在所有的Android机器上运行了了？<br>答案是否定的。因为不同的CPU处理器所支持的指令集是不一样的</p>
<h3 id="处理器与Plugins"><a href="#处理器与Plugins" class="headerlink" title="处理器与Plugins"></a>处理器与Plugins</h3><p>不同的CPU处理器所支持的指令集是不一样的，也就是说要想我们编译的Plugins要在对应机器上运行起来，我们必须确保我们编译的Plugins支持该设备处理器所支持的指令集。</p>
<p>接下来以Android平台.so为例来学习：<br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/cb05698a1968">Android系统目前支持以下七种不同的CPU架构：ARMv5，ARMv7 (从2010年起)，x86 (从2011年起)，MIPS (从2012年起)，ARMv8，MIPS64和x86_64 (从2014年起)，每一种都关联着一个相应的ABI。</a><br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/cb05698a1968">应用程序二进制接口（Application Binary Interface）定义了二进制文件（尤其是.so文件）如何运行在相应的系统平台上，从使用的指令集，内存对齐到可用的系统函数库。在Android系统上，每一个CPU架构对应一个ABI：armeabi，armeabi-v7a，x86，mips，arm64-v8a，mips64，x86_64。</a></p>
<p>从上面的引用可以看出，要想在编译的.so文件在不同的Android处理器上运行起来，我们必须保证编译的.so支持该设备的指令集。</p>
<p>但有一点要注意，并不是说每一种CPU都只支持一种架构：<br><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/abis.html#sa">armeabi. By contrast, a typical, ARMv7-based device would define the primary ABI as armeabi-v7a and the secondary one as armeabi, since it can run application native binaries generated for each of them.</a>(ARMv7的机器的第一选择是armabi-v7a,但ARMv7也同时支持armeabi(第二选择))</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/abis.html#sa">Many x86-based devices can also run armeabi-v7a and armeabi NDK binaries. For such devices, the primary ABI would be x86, and the second one, armeabi-v7a.</a>(大部分x86机器都支持armeabi-v7a和armeabi，但x86的第一选择是x86)</p>
<p>那么接下来我们通过学习编译和使用.so来加深理解。</p>
<h3 id="so文件"><a href="#so文件" class="headerlink" title=".so文件"></a>.so文件</h3><p>首先让我们认识一下什么是.so文件？<br><a target="_blank" rel="noopener" href="http://linux-wiki.cn/wiki/zh-hans/%E5%8A%A8%E6%80%81%E5%BA%93(.so)/">Linux中的.so文件类似于Windows中的DLL，是动态链接库，也有人译作共享库</a></p>
<p>为什么我们需要编译成.so文件？<br><a target="_blank" rel="noopener" href="http://linux-wiki.cn/wiki/zh-hans/%E5%8A%A8%E6%80%81%E5%BA%93(.so)/">当多个程序使用同一个动态链接库时，既能节约可执行文件的大小，也能减少运行时的内存占用。</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/index.html">Squeeze extra performance out of a device to achieve low latency or run computationally intensive applications, such as games or physics simulations. </a>(压榨机器性能)<br><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/index.html">Reuse your own or other developers’ C or C++ libraries. </a>(重用C和C++库)</p>
<h3 id="so与ELF"><a href="#so与ELF" class="headerlink" title=".so与ELF"></a>.so与ELF</h3><p>在了解.so文件结构之前，我们需要了解一下什么是ELF文件？<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html">ELF(Executable and Linking Format)是一种对象文件的格式，用于定义不同类型的对象文件(Object files)中都放了什么东西、以及都以什么样的格式去放这些东西。它自最早在 System V 系统上出现后，被 xNIX 世界所广泛接受，作为缺省的二进制文件格式来使用</a></p>
<p>ELF文件主要分为三类：</p>
<ol>
<li>Relocatable file(可重定位对象文件 e.g. 汇编生成的.o文件)</li>
<li>Executable file(可执行文件)</li>
<li>Shared object file(动态库文件 e.g. .so文件)</li>
</ol>
<p>接下来让我们看看ELF Object file的构成：<br><img src="/img/Unity/ELFFileStructure.PNG" alt="ELFFileStructure"><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html">为什么会有左右两个很类似的图来说明ELF的组成格式？这是因为ELF格式需要使用在两种场合：</a><br>a) <a target="_blank" rel="noopener" href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html">组成不同的可重定位文件，以参与可执行文件或者可被共享的对象文件的链接构建；</a><br>b) <a target="_blank" rel="noopener" href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html">组成可执行文件或者可被共享的对象文件，以在运行时内存中进程映像的构建。</a></p>
<p>如果想知道ELF文件属于哪一类ELF，并且采用了大端还是小段模式，以及支持的架构等信息的话可以通过fiel命令(貌似属于Linux上的命令，Windows上可以通过Cygwin来模拟Linux环境)<br><img src="/img/Unity/ELFFileCommand.PNG" alt="ELFFileCommand"><br>可以看到libBugly.so是属于shared objectt，target架构是ARM，是小端(LSB)32位结构</p>
<p>接下来我们关注一下ELF文件具体的组成部分：<br><img src="/img/Unity/ELFFileStructureDetail.PNG" alt="ELFFileStructureDetail"></p>
<p>主要由三部分组成：</p>
<ol>
<li>the ELF header</li>
<li>the Program Header Table</li>
<li>the Section Header Table</li>
</ol>
<p>ELF header除了包含前面file命令打印出的一些信息外，还包括更多描述ELF各文件部分的相关信息。<br>我们可以通过readelf命令来查看(Windows上除了通过Cygwin，这里我们还可以使用NDK里的arm-linux-androideabi-readelf.exe来查看ELF Header信息)<br><img src="/img/Unity/ELFHeaderReadelfCommand.PNG" alt="ELFHeaderReadelfCommand"><br>具体每一个字段的含义可以查看<a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man5/elf.5.html">ELF</a><br>这里我比较关注的是：<br>Machine  – 表示当前的ELF文件支持的架构。从上面可以看出libBugly.so支持ARM架构<br>Entry point address – 描述程序入口的虚拟地址，如果没有入口则为0x0(这里因为libBugly.so是提供再链接，所以不存在入口点)<br>Start of *** – 描述了特定headers内容的内存偏移<br>Size of *** – 描述了特定header所占字节大小<br>……</p>
<p>从上面的readelf输出结果可以看出libBugly.so包含了9个program headers，25个section headers。</p>
<p>这里暂时不深入去了解ELF文件了，如需了解，可以查看下面给出的链接。<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html">可执行文件（ELF）格式的理解</a>:</p>
<p>这里因为我在Android 7.0(API 24)遇到了一个问题：<br>Missing Section Headers<br>后来了解到在Android 7.0开始，Google做了很多改动和要求，包括下面这一项：<br>Missing Section Headers (Enforced since API 24)<br>而因为Section Headers在.so中被移除了所以报出了这个问题。(好像是为了增加破解难度)</p>
<p>这里让我们来了解一个命令工具strip – 用于移除ELF文件中一些不必要的信息。(比如 debug symbol, section headers……)</p>
<p>首先让我们通过readelf –section-headers查看section headers的信息：<br><img src="/img/Unity/SectionHeadersInfo.PNG" alt="SectionHeadersInfo"><br>可以看到libSubly.so有24个section headers</p>
<p>然后通过strip –remove-sections&#x3D;.* libBugly.so尝试移除所有sections(这里注意Cygwin strip无法识别.so，但NDK strip却可以，不知道是不是需要)<br><img src="/img/Unity/StripSectionsAfter.PNG" alt="StripSectionsAfter"><br>可以看到我们成功的移除了所有section header(除了.shstrtab)。</p>
<p>我想这应该就是前面遇到Missing Section Headers的原因，Android 7.0上强制要求不能Missing Section Header。(待确认)</p>
<p>这里主要知道如何去查看.so文件的架构等信息以及ELF文件的大概组成以及如何通过strip命令去移除一些ELF文件里不必要的信息即可。</p>
<h3 id="编译和使用-so"><a href="#编译和使用-so" class="headerlink" title="编译和使用.so"></a>编译和使用.so</h3><p>结合以前学习的一些知识：<br><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_8c7d49f20102v7t7.html">JNI和NDK交叉编译进阶学习</a><br><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_8c7d49f20102vazu.html">NDK&amp;JNI&amp;Java&amp;Android初步学习总结归纳</a></p>
<p>要想在Windows上编译出在Android处理器使用的.so文件，我需要通过<a target="_blank" rel="noopener" href="https://developer.android.com/ndk/downloads/index.html">NDK</a>(一系列工具的集合，帮助开发者快速开发C(或C++)的动态库。集成了交叉编译器)或者Android Studio配合CMake进行编译。</p>
<p>待续…..</p>
<h3 id="so架构的抉择"><a href="#so架构的抉择" class="headerlink" title=".so架构的抉择"></a>.so架构的抉择</h3><p>还记得前面提到的关于.so架构兼容的问题吗。<br>按照前面的理论是不是说我们只需要支持armeabi或者armeabi-v7架构，就能在大部分机器上跑了了？<br>答案是肯定的，这也是为什么有些人通过减少.so的种类来达到减少APK大小。但值得注意的一点是兼容并不是说100%不会出问题，同时兼容的.so并不一定能使使用性能达到最佳。</p>
<p>所以最好的方法还是通过想办法使用正确架构的.so才是上上之策。</p>
<p>至于即想减少APK大小又想完美使用正确的.so架构的方式，可以参考下面这位博主的一些提议：<br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000005646078">ANDROID动态加载 使用SO库时要注意的一些问题</a></p>
<h3 id="Unity-Android-IOS-Plugin"><a href="#Unity-Android-IOS-Plugin" class="headerlink" title="Unity Android &amp; IOS Plugin"></a>Unity Android &amp; IOS Plugin</h3><p>接下来让我们结合Unity对Android和IOS平台架构的支持来学习理解CPU架构与Unity之间的关系。<br>Android:<br><img src="/img/Unity/AndroidSupportedArchitectures.PNG" alt="AndroidSupportedArchitectures"></p>
<p>IOS(mono):<br><img src="/img/Unity/IOSMonoSupportedArchitectures.PNG" alt="IOSMonoSupportedArchitectures"></p>
<p>IOS(IL2CPP):<br><img src="/img/Unity/IOSIL2CPPSupportedArchitectures.PNG" alt="IOSIL2CPPSupportedArchitectures"></p>
<p>可以看到Android上只支持ARMv7和x86<br>IOS上支持的情况要根据编译后端设置而定(这里提一下Mac上查看.a文件架构的命令是lipo)：<br>Mono只支持IOS ARMv7<br>IL2CPP支持IOS ARMv7和ARM64</p>
<p>Android因为前面提到的armeabi-v7和x86几乎兼容了所有Android机器，所以只支持这两个是说的过去的。</p>
<p>armv7支持了IOS 4 - 5的大部分机器<br>但IOS 5之后基本都要求arm64，也就是说要支持IOS新机器我们必须使用IL2CPP作为后端编译工具(Unity 4.6之后开始支持的)</p>
<p>对应平台的Plugin需要放到对应文件目录下。<br>Android:<br>Assets&#x2F;Plugins&#x2F;Android<br>IOS:<br>Assets&#x2F;Plugins&#x2F;IOS<br>Windows:<br>Assets&#x2F;Plugins</p>
<h4 id="Android实战"><a href="#Android实战" class="headerlink" title="Android实战"></a>Android实战</h4><p>实战Android前，让我们先了解下Android重要的IDE以及代码相关知识。</p>
<h5 id="Android-Studio"><a href="#Android-Studio" class="headerlink" title="Android Studio"></a>Android Studio</h5><p>以前设计到Android开发的时候，都是使用的Eclipse配合ADT插件来弄得。但Eclipse已经被Google放弃了，Google推出了Android Studio作为新一代Android的IDE，所以学习Android Studio用于Android开发是有必要的。</p>
<p>先让我们来了解下什么是Android Studio:<br><a target="_blank" rel="noopener" href="https://developer.android.com/studio/intro/">Android Studio 是基于 IntelliJ IDEA 的官方 Android 应用开发集成开发环境 (IDE)。</a></p>
<p>这里本人使用Android Studio的需求是为了做移动平台游戏开发时用于Android原生开发。<br>接下来以使用Android Studio配合Unity开发Android为例来学习。</p>
<p>这里放一张Android官网的Android构建流程图加深印象:<br><img src="/img/Android/AndroidBuildFlowChart.png" alt="AndroidBuildFlowChart"></p>
<h5 id="JNI-Java交互"><a href="#JNI-Java交互" class="headerlink" title="JNI(Java交互)"></a>JNI(Java交互)</h5><p>Unity开发搞Android原生开发，主要是通过JNI(Java Native Interface)去访问JVM和Java代码交互。(更多内容见后面的实战学习)<br>详细的JNI，JVM，Java，Android，NDK等概念学习，参考以前的学习:<br><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_8c7d49f20102v7t7.html">JNI和NDK交叉编译进阶学习</a><br><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_8c7d49f20102vazu.html">NDK&amp;JNI&amp;Java&amp;Android初步学习总结归纳</a></p>
<h5 id="Android项目相关概念"><a href="#Android项目相关概念" class="headerlink" title="Android项目相关概念"></a>Android项目相关概念</h5><p>接下来让我们看看Android Studio创建Android工程之后的基本结构:<br><img src="/img/Android/AndroidStudioAndroidProjectStucture.png" alt="AndroidStudioAndroidProjectStucture"></p>
<p>接下来我们需要理解一个Android Studio里很重要的同一个概念:<br><strong>模块</strong><br><a target="_blank" rel="noopener" href="https://developer.android.com/studio/projects/">模块是源文件和构建设置的集合，允许您将项目分成不同的功能单元。您的项目可以包含一个或多个模块，并且一个模块可以将其他模块用作依赖项。每个模块都可以独立构建、测试和调试。</a></p>
<p>Android Studio提供了一下集中不同类型的模块：</p>
<ol>
<li>Android应用模块(就是上面我们创建Android Project时看到的app就是我们的Android应用模块)</li>
<li>库模块(unityandroidlib就是我单独创建的Android库模块–目的是为了单独导出jar或者aar)</li>
<li>Google Cloud模块</li>
</ol>
<h5 id="Android库模块实战"><a href="#Android库模块实战" class="headerlink" title="Android库模块实战"></a>Android库模块实战</h5><p>在通过Android库模块导出AAR或者Jar前，我们需要弄学习了解一个自动化构建工具：Gradle</p>
<h6 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h6><p><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/userguide.html">Gradle is an open-source build automation tool focused on flexibility and performance. Gradle build scripts are written using a Groovy or Kotlin DSL.</a></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Gradle">Gradle是一个基于Apache Ant和Apache Maven概念的项目自动化建构工具。</a></p>
<p>这里直接引用别人的对Gradle的总结，来简单了解下Gradle:<br><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/30432152">Gradle是一种构建工具,它可以帮你管理项目中的差异,依赖,编译,打包,部署……,你可以定义满足自己需要的构建逻辑,写入到build.gradle中供日后复用.</a></p>
<p>这里暂时需要了解知道的是，Gradle有两大概念:</p>
<ol>
<li>Project<br><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html">Every Gradle build is made up of one or more projects. What a project represents depends on what it is that you are doing with Gradle. For example, a project might represent a library JAR or a web application. It might represent a distribution ZIP assembled from the JARs produced by other projects. </a></li>
<li>Tasks<br><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html">Each project is made up of one or more tasks. A task represents some atomic piece of work which a build performs. This might be compiling some classes, creating a JAR, generating Javadoc, or publishing some archives to a repository.</a></li>
</ol>
<p>详细的Gradle学习，参考官网内容:<br><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html">Build Script Basics</a></p>
<h6 id="Android库模块"><a href="#Android库模块" class="headerlink" title="Android库模块"></a>Android库模块</h6><p><a target="_blank" rel="noopener" href="https://developer.android.com/studio/projects/android-library">Android 库在结构上与 Android 应用模块相同。它可以提供构建应用所需的一切内容，包括源代码、资源文件和 Android 清单。不过，Android 库将编译到您可以用作 Android 应用模块依赖项的 Android 归档 (AAR) 文件，而不是在设备上运行的 APK。</a></p>
<p>这里简单理解下aar和jar的区别就是，AAR是带了所有资源(包括res，AndroidManifest.xml等APK需要的资源+代码Jar的集合)。</p>
<h6 id="Jar库模块"><a href="#Jar库模块" class="headerlink" title="Jar库模块"></a>Jar库模块</h6><p>Studio如何导出库模块作为学习对象，因为我们的目标就是通过Android Studio导出AAR或者Jar给Unity使用:<br>来看看Android库模块是如何新建的：<br>Project右键-&gt;New-&gt;Module-&gt;Android Library<br><img src="/img/Android/AndroidStuidoAndroidModule.png" alt="AndroidStuidoAndroidModule"></p>
<p>通过查看Android应用模块和Android库模块的build.gradle，我们可以通过Gradle是如何定义的：<br>Android应用模块:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;com.android.application&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Android库模块:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;com.android.library&#x27;</span></span><br></pre></td></tr></table></figure>

<p>接下来我们目标是在如何把我们想要的java代码通过Android模块导出成Jar：<br>让我们看下Android模块的结构：<br><img src="/img/Android/AndroidStudioAndroidModule.png" alt="AndroidStudioAndroidModule"><br>把相关jar和java代码导入到我们的：<br><img src="/img/Android/AndroidStudioAndroidMudleImportCode.png" alt="AndroidStudioAndroidMudleImportCode"></p>
<p>我们现在需要做的就是通过编写我们unityandroidlib这个Android库模块下的build.gradle去支持导出我们想要的jar:<br>在写出我们需要的Android模块build.gradle构建文件之前，我们先来了解下Android模块构建的build.gradle里每一个标签的意义：<br><a target="_blank" rel="noopener" href="https://developer.android.com/studio/build/#module-level">详细的Android模块构建gradle标签学习</a><br><a target="_blank" rel="noopener" href="http://google.github.io/android-gradle-dsl/current/index.html">详细的Android DSL标签参考</a><br><a target="_blank" rel="noopener" href="https://guides.gradle.org/building-android-apps/?_ga=2.32380022.931589262.1533988091-1402562034.1533988091">Android Gradle的详细学习参考Building Android Apps</a></p>
<p>实战Android模块的build.gradle：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 表示使用Android插件进行gradle的Android自动化构建</span></span><br><span class="line"><span class="comment"> * com.android.library表示是构建成一个Android模块</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">apply plugin: <span class="string">&#x27;com.android.library&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// android &#123;&#125;指定如何配置android相关编译构建</span></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">// 指定Android API编译版本</span></span><br><span class="line">    compileSdkVersion <span class="number">27</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//defaultConfig &#123;&#125;指定Android部分默认设置，可以通过这里的指定覆盖AndroidManifest.xml里的部分内容</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion <span class="number">15</span>            <span class="comment">// 最低支持的Android API版本</span></span><br><span class="line">        targetSdkVersion <span class="number">27</span>         <span class="comment">// 目标Android API版本</span></span><br><span class="line">        versionCode <span class="number">1</span>               <span class="comment">// App的version number</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span>           <span class="comment">// App的version name</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// buildTypes &#123;&#125;指定编译类型的详细信息，比如release和debug的详细编译设定</span></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        <span class="comment">// release的编译设定</span></span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span>                                                                         <span class="comment">// 是否开启代码精简</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span>    <span class="comment">// 代码混淆相关设置</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dependencies &#123;&#125;指定编译依赖信息(比如我们的项目需要依赖unity的classes.jar库)</span></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// fileTree - 指定目录(libs)下符合条件(*.jar)的文件添加到编译路径下</span></span><br><span class="line">    implementation <span class="keyword">fileTree</span>(<span class="keyword">include</span>: [<span class="string">&#x27;*.jar&#x27;</span>], dir: <span class="string">&#x27;libs&#x27;</span>)</span><br><span class="line">    <span class="comment">// com.android.support:appcompat-v7:27.1.1 - 添加Android兼容模式库到项目，用于支持更多的theme和兼容老的部分功能</span></span><br><span class="line">    implementation <span class="string">&#x27;com.android.support:appcompat-v7:27.1.1&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;junit:junit:4.12&#x27;</span></span><br><span class="line">    androidTestImplementation <span class="string">&#x27;com.android.support.test:runner:1.0.2&#x27;</span></span><br><span class="line">    androidTestImplementation <span class="string">&#x27;com.android.support.test.espresso:espresso-core:3.0.2&#x27;</span></span><br><span class="line">    <span class="comment">// files - 猜测是指定需要依赖的jar库(没找到官方解释)</span></span><br><span class="line">    implementation files(<span class="string">&#x27;libs/classes.jar&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// task - 添加自定义的构建任务</span></span><br><span class="line"><span class="comment">// 这里是增加一个删除旧的jar的任务</span></span><br><span class="line"><span class="comment">// type:指定任务的类型delete删除</span></span><br><span class="line"><span class="keyword">task</span> deleteOldJar(type: <span class="keyword">Delete</span>) &#123;</span><br><span class="line">    <span class="comment">// 指定删除release/AndroidPlugin.jar文件</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="string">&#x27;build/libs/classes.jar&#x27;</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="string">&#x27;release/AndroidPlugin.jar&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// task - 添加自定义的构建任务</span></span><br><span class="line"><span class="comment">// 这里增加一个从新打包jar的任务，目的是为了去除默认build里打包的BuildConfig.class(会导致Unity使用jar时报错)</span></span><br><span class="line"><span class="comment">// type: 指定任务类型是Jar打包</span></span><br><span class="line"><span class="keyword">task</span> makeJar(type: Jar) &#123;</span><br><span class="line">    <span class="comment">// 指定jar来源(文件或者目录)</span></span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">file</span>(<span class="string">&#x27;build/intermediates/classes/release&#x27;</span>)</span><br><span class="line">    <span class="comment">// 指定需要重新打包后的jar名字</span></span><br><span class="line">    archiveName = <span class="string">&#x27;classes.jar&#x27;</span></span><br><span class="line">    <span class="comment">// 输出目录</span></span><br><span class="line">    <span class="keyword">destinationDir</span> = <span class="keyword">file</span>(<span class="string">&#x27;build/libs/&#x27;</span>)</span><br><span class="line">    <span class="comment">// 过滤不需要的class文件</span></span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">&#x27;com/tonytang/unityandroidproject/BuildConfig.class&#x27;</span>)</span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">&#x27;com/tonytang/unityandroidproject/BuildConfig\$*.class&#x27;</span>)</span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">&#x27;com/tonytang/unityandroidproject/R.class&#x27;</span>)</span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">&#x27;com/tonytang/unityandroidproject/R\$*.class&#x27;</span>)</span><br><span class="line">    <span class="comment">// 需要包含打包到jar中的文件</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&#x27;com/tonytang/unityandroidproject/**&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定makeJar任务依赖的任务build(依赖的任务先执行)</span></span><br><span class="line">makeJar.dependsOn(build)</span><br><span class="line"></span><br><span class="line"><span class="comment">// task - 添加自定义的构建任务</span></span><br><span class="line"><span class="comment">// 这里是增加一个到处jar的任务</span></span><br><span class="line"><span class="comment">// type:指定任务类型为Copy复制</span></span><br><span class="line"><span class="keyword">task</span> exportJar(type: <span class="keyword">Copy</span>) &#123;</span><br><span class="line">    <span class="comment">// 从哪里复制</span></span><br><span class="line">    <span class="keyword">from</span>(<span class="string">&#x27;build/libs/&#x27;</span>)</span><br><span class="line">    <span class="comment">// 复制到哪里</span></span><br><span class="line">    <span class="keyword">into</span>(<span class="string">&#x27;release/&#x27;</span>)</span><br><span class="line">    <span class="comment">/// 重命名文件</span></span><br><span class="line">    rename(<span class="string">&#x27;classes.jar&#x27;</span>, <span class="string">&#x27;AndroidPlugin.jar&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定exportJar任务依赖的任务deleteOldJar,build,makeJar(依赖的任务先执行)</span></span><br><span class="line">exportJar.dependsOn(deleteOldJar, makeJar)</span><br></pre></td></tr></table></figure>
<p>完成build.gradle编写后，我们打开Gradle Project就可以选中我们新写的exportJar任务，双击执行:<br><img src="/img/Android/AndroidStudioGradleProjectView.png" alt="AndroidStudioGradleProjectView"><br><img src="/img/Android/AndroidStudioGraduleBuildProccess.png" alt="AndroidStudioGraduleBuildProccess"></p>
<p>上面的注释很详细了，就不过多描述了，直接来看下我们在release下生成的新得AndroidPlugin.jar吧：<br><img src="/img/Android/AndroidModuleJar.png" alt="AndroidModuleJar"><br>我们成功得到了过滤掉BuildConfig.class,R.class等文件的jar代码包。<br>得到jar包后，我们还需要把我们的Android相关的资源以及jar包放到我们的Unity对应项目目录才行（Plugins&#x2F;Android&#x2F;）:<br><img src="/img/Android/UnityAndroidFolderStructure.png" alt="UnityAndroidFolderStructure"></p>
<p>接下来我们需要的是通过Unity封装的JNI去访问Java代码：<br>AndroidNativeManager.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Description:             AndroidNativeManager.cs</span></span><br><span class="line"><span class="comment"> * Author:                  TONYTANG</span></span><br><span class="line"><span class="comment"> * Create Date:             2018/08/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> UNITY_ANDROID</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> AndroidNativeManager.cs</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Android原生管理类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AndroidNativeManager</span> : <span class="title">NativeManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Android主Activity对象</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> AndroidJavaObject mAndroidActivity;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 初始化</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">init</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.<span class="keyword">init</span>();</span><br><span class="line">        Debug.Log(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (Application.platform == RuntimePlatform.Android)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里使用using的目的是确保AndroidJavaClass对象尽快被删除</span></span><br><span class="line">            <span class="keyword">using</span> (AndroidJavaClass jc = <span class="keyword">new</span> AndroidJavaClass(<span class="string">&quot;com.unity3d.player.UnityPlayer&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//获得当前Activity(这里是为了获得MainActivity)</span></span><br><span class="line">                mAndroidActivity = jc.GetStatic&lt;AndroidJavaObject&gt;(<span class="string">&quot;currentActivity&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (mAndroidActivity == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.Log(<span class="string">&quot;获取UnityMainActivity::mAndroidActivity成员失败！&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.Log(<span class="string">&quot;获取UnityMainActivity::mAndroidActivity成员成功!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 调用原生方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">callNativeMethod</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.callNativeMethod();</span><br><span class="line">        Debug.Log(<span class="string">&quot;callNativeMethod()&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (mAndroidActivity != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mAndroidActivity.Call(<span class="string">&quot;javaMethod&quot;</span>, <span class="string">&quot;cs param&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>NativeMessageHandler.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Description:             NativeMessageHandler.cs</span></span><br><span class="line"><span class="comment"> * Author:                  TONYTANG</span></span><br><span class="line"><span class="comment"> * Create Date:             2018/08/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> NativeMessageHandler.cs</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 原生消息相应处理器</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NativeMessageHandler</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 接收原生消息</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;msg&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resUnityMsg</span>(<span class="params"><span class="built_in">string</span> msg</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="built_in">string</span>.Format(<span class="string">&quot;resUnityMsg : &#123;0&#125;&quot;</span>, msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tonytang.unityandroidproject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.res.Configuration;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.DisplayMetrics;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.unity3d.player.UnityPlayer;</span><br><span class="line"><span class="keyword">import</span> com.unity3d.player.UnityPlayerActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">UnityPlayerActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unity那一侧相应Java回调的GameObject名字</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">mUnityCallBackHandler</span> <span class="operator">=</span> <span class="string">&quot;GameLauncher&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Android上下文</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">Context</span> <span class="variable">mContext</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">Activity</span> <span class="variable">mCurrentActivity</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        Log.d(<span class="string">&quot;JNI&quot;</span>, <span class="string">&quot;onCreate()&quot;</span>);</span><br><span class="line">        mContext = <span class="built_in">this</span>.getApplicationContext();</span><br><span class="line">        mCurrentActivity = <span class="built_in">this</span>;</span><br><span class="line">        ******</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ******</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Unity call part</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">javaMethod</span><span class="params">(String csparam)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;JNI&quot;</span>, <span class="string">&quot;javaMethod() with parameter:&quot;</span> + csparam);</span><br><span class="line">        UnityPlayer.UnitySendMessage(mUnityCallBackHandler,<span class="string">&quot;resUnityMsg&quot;</span>, <span class="string">&quot;java param&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/Android/UnityJNICall.png" alt="UnityJNICall"></p>
<p>至此我们成功完成了使用Android Studio通过编写Gradule导出我们需要的jar代码包，然后通过Unity封装的JNI访问java方法并通过Unity的方法UnityPlayer.UnitySendMessage()方法成功返回调用了CS代码。</p>
<p>关于Unity使用AAR的学习:<br>待续……</p>
<p>详细的Android DSL标签学习:<br><a target="_blank" rel="noopener" href="http://google.github.io/android-gradle-dsl/current/index.html">Android Plugin DSL Reference</a><br>详细的Gradle task学习：<br><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.Task.html">Gradle Task</a></p>
<p>待续……</p>
<h6 id="AAR库模块"><a href="#AAR库模块" class="headerlink" title="AAR库模块"></a>AAR库模块</h6><p>这里再次说一下AAR和Jar的区别：<br>AAR是带了所有资源(包括res，AndroidManifest.xml等APK需要的资源+代码Jar的集合)。</p>
<p>Unity是可以使用AAR作为资源的使用的，导出AAR和Jar没有太多区别，这里注重讲下Unity使用Android Studio导出的Jar需要注意的地方和坑点。</p>
<p>导出Jar的同时其实已经导出了AAR，AAR存在下面这个目录:<br><img src="/img/Android/AndroidAAROutput.png" alt="AndroidAAROutput"></p>
<p>但如果我们直接把res和aar以及AndroidManifest拷贝到Plugins插件目下，打包会发现报错：<br>错误的意思大致是classes.jar代码已存在有重复。</p>
<p>classes.jar代码重复是因为我们前面导出jar的build.gradle配置了:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dependencies &#123;&#125;指定编译依赖信息(比如我们的项目需要依赖unity的classes.jar库)</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// fileTree - 指定目录(libs)下符合条件(*.jar)的文件添加到编译路径下</span></span><br><span class="line">    <span class="function">implementation <span class="title">fileTree</span>(<span class="params">include: [<span class="string">&#x27;*.jar&#x27;</span>], dir: <span class="string">&#x27;libs&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    ******</span></span><br><span class="line"><span class="function">    <span class="comment">// files - 指定需要依赖的库文件(没找到官方解释)</span></span></span><br><span class="line"><span class="function">    implementation <span class="title">files</span>(<span class="params"><span class="string">&#x27;libs/classes.jar&#x27;</span></span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这里的两句implementation，前者是表示libs下的jar作为引用并一起打包输出到aar里，后者表示要引用并一起打包classes.jar库。</p>
<p>所以这里就是导致我们的AAR里有一份classes.jar库代码存在的原因。</p>
<p>改写build.gradle避免classes.jar被一起打包到AAR里:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dependencies &#123;&#125;指定编译依赖信息(比如我们的项目需要依赖unity的classes.jar库)</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// fileTree - 指定目录(libs)下符合条件(*.jar)的文件添加到编译路径下</span></span><br><span class="line">    <span class="comment">// 因为项目依赖了Unity的class.jar但又不希望classes.jar跟着aar一起导出(会导致unity打包报错 -- classes.jar包重复问题)</span></span><br><span class="line">    <span class="comment">// 所以这里不能使用fileTree包含lib目录下所有jar，需要修改成不包含classes.jar的形式</span></span><br><span class="line">    <span class="function">implementation <span class="title">fileTree</span>(<span class="params">include: [<span class="string">&#x27;*.jar&#x27;</span>], dir: <span class="string">&#x27;libs/include&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    ******</span></span><br><span class="line"><span class="function">    <span class="comment">// files - 猜测是显示指定依赖文件(没找到官方解释)</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 这里专门用compileOnly是为了避免classes.jar进aar包</span></span></span><br><span class="line"><span class="function">    compileOnly <span class="title">files</span>(<span class="params"><span class="string">&#x27;libs/exclude/classes.jar&#x27;</span></span>)</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>implementation – Gradle 会将依赖项添加到编译类路径，并将依赖项打包到构建输出<br>compileOnly – Gradle 只会将依赖项添加到编译类路径（即不会将其添加到构建输出）<br>通过修改build.gradle和调整目录：<br><img src="/img/Android/AndroidGradleLibsFolderStructure.png" alt="AndroidGradleLibsFolderStructure"><br>我们避免了classes.jar被打进AAR里，这样一来就不会在Unity打包时有classes.jar代码重复的问题了。</p>
<p>Note:<br><strong>AAR可以通过修改后缀成.zip通过解压软件插件内部详情</strong><br><a target="_blank" rel="noopener" href="https://developer.android.com/studio/build/dependencies">dependencies模块详细说明参考</a></p>
<h3 id="IOS实战"><a href="#IOS实战" class="headerlink" title="IOS实战"></a>IOS实战</h3><p>IOS实战学习前，我们需要了解IOS的开发语言，以前是Objective-C，后来苹果推出了switf。<br>这里针对Unity而言，我们主要用到的还是以Objective-C为主。</p>
<h4 id="Objective-C语法"><a href="#Objective-C语法" class="headerlink" title="Objective-C语法"></a>Objective-C语法</h4><p>*.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">///所需其他头文件</span><br><span class="line">#import &quot;*.h&quot;</span><br><span class="line"></span><br><span class="line">//&lt;Protocol&gt; OC里的Protocol相当于Interface，需要实现接口方法</span><br><span class="line">//但有一点不同的是Protocol里并不是所有的接口方法都必须实现</span><br><span class="line">//@required -- 必须实现的部分</span><br><span class="line">//@optional -- 可选实现的部分</span><br><span class="line">@interface *:NSObject&lt;*&gt;&#123;</span><br><span class="line"></span><br><span class="line">    // 类变量声明</span><br><span class="line">    //......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//类属性声明</span><br><span class="line">@property (nonatomic, strong) * *属性名;</span><br><span class="line">//Unity回调GameObject名字</span><br><span class="line">@property (nonatomic, strong) NSString *mGameObjectHandler;</span><br><span class="line"></span><br><span class="line">//类方法声明</span><br><span class="line">//+代表属于类方法，相当于静态</span><br><span class="line">//-代表属于对象，相当于类成员</span><br><span class="line">//方法定义格式如下:</span><br><span class="line">//(+ or -)(return 返回类型)方法名:(参数1类型) 参数1名 : (参数2类型) 参数2名;</span><br><span class="line">+(类型*) Instance;</span><br><span class="line"></span><br><span class="line">-(void)方法名;</span><br><span class="line"></span><br><span class="line">-(void)方法名:(参数类型 *)参数名;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>*.mm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;*.h&quot;</span><br><span class="line"></span><br><span class="line">//定义全局的静态变量</span><br><span class="line">static 类型名* 变量名 = nil;</span><br><span class="line"></span><br><span class="line">//声明UnitySendMessage为外部方法，用于native code和C＃发消息交互</span><br><span class="line">#if defined(__cpluscplus)</span><br><span class="line">//确保函数的编译方式</span><br><span class="line">//确保找到正确的函数名</span><br><span class="line">//这一点好比C++指定不同的调用约定(stdcall(C++默认使用)和cdecl(C默认使用))</span><br><span class="line">//会决定函数名生成，参数入栈顺序，堆栈维护等</span><br><span class="line">//在读取的时候也需要指定同样编译方式</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">#endif  </span><br><span class="line">    extern void UnitySendMessage(const char *, const char *, const char *);</span><br><span class="line"></span><br><span class="line">#if defined(__cpluscplus)</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">//指定实现的类型</span><br><span class="line">@implementation 类型名</span><br><span class="line"></span><br><span class="line">//获取单例对象</span><br><span class="line">+(返回类型*) Instance</span><br><span class="line">&#123;</span><br><span class="line">    return *;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)方法名</span><br><span class="line">&#123;</span><br><span class="line">    //方法实现</span><br><span class="line">    NSLog(@&quot;initSDK&quot;);</span><br><span class="line">    self.mGameObjectHandler = @&quot;响应原生消息的GameObejct名字&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)方法名:(参数1类型 *)key value:(参数2类型 *)value</span><br><span class="line">&#123;</span><br><span class="line">    //Log打印方式</span><br><span class="line">    NSLog(@&quot;参数设置：key = %@ value = %@&quot;, key,value);</span><br><span class="line">    //字符串拼接方式</span><br><span class="line">    NSString *msg = [NSString stringWithFormat:@&quot;%@ %@ %s&quot;, key, value, issuccess ? &quot;true&quot; : &quot;false&quot;];</span><br><span class="line">    //原生发送消息给CS一侧</span><br><span class="line">    UnitySendMessage([self.mGameObjectHandler UTF8String], &quot;CS回调响应方法名&quot;, [msg UTF8String]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//用于C#和Objective C交互的代码</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">    void CS方法名()</span><br><span class="line">    &#123;</span><br><span class="line">        [[类型名 类型静态变量] 成员方法];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void CS方法名(char* key, char* value)</span><br><span class="line">    &#123;</span><br><span class="line">        //CS char*到NSString转换方式</span><br><span class="line">        NSString* parameterkey = [NSString stringWithUTF8String:key];</span><br><span class="line">        NSString* parametervalue = [NSString stringWithUTF8String:value];</span><br><span class="line">        [[类型名 类型静态变量] 成员方法:参数1值 参数2名字:参数2值];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<h4 id="Unity与IOS的交互"><a href="#Unity与IOS的交互" class="headerlink" title="Unity与IOS的交互"></a>Unity与IOS的交互</h4><p>了解Unity与IOS交互前，让我们先了解部分IOS相关概念：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lixiaojian/p/3336653.html">UIView是一个视图,UIViewController是一个控制器,每一个viewController管理着一个view。</a></p>
<p>IOS和UIViewController的交互就好比Android里和Activity的交互。</p>
<p>结合Unity官方讲解:<br><a target="_blank" rel="noopener" href="https://docs.unity3d.com/2017.4/Documentation/Manual/StructureOfXcodeProject.html">Customizing an iOS Splash Screen Other Versions Leave feedback Structure of a Unity XCode Project</a></p>
<p>我们可以知道IOS里，UnityAppController.mm是整个程序的入口。如果我们想要自定义入口，我们需要继承至UnityAppController。<br>AppController.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 自定义Unity AppCOntroller</span><br><span class="line">//导入Unity的UnityAppController.h，自定义AppController需要继承至UnityAppController</span><br><span class="line">#import &quot;UnityAppController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface AppController : UnityAppController</span><br><span class="line">@property(nonatomic,strong) UINavigationController *naVC;</span><br><span class="line">-(void) createUI;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>AppController.mm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//自身的头文件</span><br><span class="line">#import &quot;AppController.h&quot;</span><br><span class="line">//导入我们自己写接口的类的.h文件，用于实现自定义的UIViewController</span><br><span class="line">#import &quot;UnityViewController.h&quot;</span><br><span class="line">//其他文件</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation AppController</span><br><span class="line">-(void) createUI</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;AppController:createUI()&quot;);</span><br><span class="line">    _rootController = [[UIViewController alloc]init];</span><br><span class="line">    _rootView = [[UIView alloc]initWithFrame:[UIScreen mainScreen].bounds];</span><br><span class="line">    _rootController.view = _rootView;</span><br><span class="line">        </span><br><span class="line">    //自定义viewcontroller添加到现有的viewcontroller上</span><br><span class="line">    UnityViewController *vc = [[UnityViewController alloc]init];</span><br><span class="line">    self.naVC =[[UINavigationController alloc]initWithRootViewController:vc];</span><br><span class="line">    </span><br><span class="line">    //添加自定义view到rootView上</span><br><span class="line">    [_rootView addSubview:self.naVC.view];</span><br><span class="line"></span><br><span class="line">    _window.rootViewController = _rootController;</span><br><span class="line">    [_window bringSubviewToFront:_rootView];</span><br><span class="line">    [_window makeKeyAndVisible];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//这是一个固定写法，因为这个代码，所以启动界面是从这里启动</span><br><span class="line">IMPL_APP_CONTROLLER_SUBCLASS(AppController);</span><br></pre></td></tr></table></figure>
<p>通过上面的代码，我们完成了下面两件事：</p>
<ol>
<li>自定义Unity IOS程序入口</li>
<li>添加了自定义的View(绑定到自定义UIViewController上)到rootView上</li>
</ol>
<p>成功绑定到自定义UIViewController上后，我们就能通过自定义的UIViewController去和IOS打交道了。<br>接下来看看自定义的UIViewController是如何定义的，结合权限申请实战学习：<br>UnityViewController.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//自定义的UIViewController</span><br><span class="line">#import &quot;UnityAppController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface UnityViewController : UIViewController</span><br><span class="line">//权限申请</span><br><span class="line">- (void)audioAuthAction;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>UnityViewController.mm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//包含自身头文件</span><br><span class="line">#import &quot;UnityViewController.h&quot;</span><br><span class="line"></span><br><span class="line">//其他头文件</span><br><span class="line">#import &quot;UnityAppController+ViewHandling.h&quot;</span><br><span class="line">#import &lt;UI/UnityView.h&gt;</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation UnityViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;UnityViewController:viewDidLoad()&quot;);</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    [self.view addSubview:GetAppController().unityView];</span><br><span class="line">    GetAppController().unityView.frame = self.view.frame;</span><br><span class="line">    </span><br><span class="line">    // Do any additional setup after loading the view.</span><br><span class="line">    // 权限申请相关</span><br><span class="line">    [self audioAuthAction];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//权限申请</span><br><span class="line">- (void)audioAuthAction</span><br><span class="line">&#123;</span><br><span class="line">    //麦克风权限申请</span><br><span class="line">    NSLog(@&quot;UnityViewController:audioAuthAction()&quot;);</span><br><span class="line">    [AVCaptureDevice requestAccessForMediaType:AVMediaTypeAudio completionHandler:^(BOOL granted) &#123;</span><br><span class="line">       NSLog(@&quot;%@&quot;,granted ? @&quot;麦克风准许&quot;:@&quot;麦克风不准许&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)viewWillAppear:(BOOL)animated&#123;</span><br><span class="line">    //隐藏导航条view</span><br><span class="line">    NSLog(@&quot;UnityViewController:viewWillAppear()&quot;);</span><br><span class="line">    self.navigationController.navigationBar.hidden = YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)viewDidDisappear:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    NSLog(@&quot;UnityViewController:viewDidDisappear()&quot;);</span><br><span class="line">    self.navigationController.navigationBar.hidden = NO;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>可以看到通过自定义的UIViewController，我们就可以直接编写对应原生功能(e.g. 权限申请)代码了。</p>
<h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/2017.4/Documentation/Manual/StructureOfXcodeProject.html">Customizing an iOS Splash Screen Other Versions Leave feedback Structure of a Unity XCode Project</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/vsirWaiter/p/8383408.html">Unity-IOS交互整理</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bd944258105f">iOS 系统权限</a></p>
<p>待续……</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h2 id="Unity-Official-Website-Part"><a href="#Unity-Official-Website-Part" class="headerlink" title="Unity Official Website Part"></a>Unity Official Website Part</h2><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/Plugins.html">Unity Plugin</a></p>
<h2 id="Knowledge-Part"><a href="#Knowledge-Part" class="headerlink" title="Knowledge Part"></a>Knowledge Part</h2><p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/cb05698a1968">关于Android的.so文件你所需要知道的</a><br><a target="_blank" rel="noopener" href="http://linux-wiki.cn/wiki/zh-hans/%E5%8A%A8%E6%80%81%E5%BA%93(.so)">动态库(.so)</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/index.html">Getting Started with the NDK</a><br><a target="_blank" rel="noopener" href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/readelf.html">readelf elf文件格式分析</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/abis.html">ABI Management</a><br><a target="_blank" rel="noopener" href="https://android-developers.googleblog.com/2016/06/android-changes-for-ndk-developers.html">Android changes for NDK developers </a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html">可执行文件（ELF）格式的理解</a><br><a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/topic/com.arm.doc.dui0101a/DUI0101A_Elf.pdf">ARM ELF File Format</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Native/">Native</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Native/">Native</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://tonytang1990.github.io/2016/12/11/Unity%E5%8E%9F%E7%94%9F/" data-title="Unity原生 | 走停人生路" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/12/20/Unity-Shader/" title="Unity Shader">
  <strong>上一篇：</strong><br/>
  <span>
  Unity Shader</span>
</a>
</div>


<div class="next">
<a href="/2016/12/11/Unity第三方插件/"  title="Unity第三方插件">
 <strong>下一篇：</strong><br/> 
 <span>Unity第三方插件
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">原生知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Plugins%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.</span> <span class="toc-text">Plugins分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Managed-Plugins"><span class="toc-number">1.1.1.</span> <span class="toc-text">Managed Plugins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Natiev-Plugins"><span class="toc-number">1.1.2.</span> <span class="toc-text">Natiev Plugins</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Plugins%E6%96%87%E4%BB%B6%E6%89%A9%E5%B1%95%E5%90%8D%E5%92%8C%E6%94%AF%E6%8C%81%E5%B9%B3%E5%8F%B0"><span class="toc-number">1.2.</span> <span class="toc-text">Plugins文件扩展名和支持平台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%99%A8%E4%B8%8EPlugins"><span class="toc-number">1.2.1.</span> <span class="toc-text">处理器与Plugins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">.so文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E4%B8%8EELF"><span class="toc-number">1.2.3.</span> <span class="toc-text">.so与ELF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%92%8C%E4%BD%BF%E7%94%A8-so"><span class="toc-number">1.2.4.</span> <span class="toc-text">编译和使用.so</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#so%E6%9E%B6%E6%9E%84%E7%9A%84%E6%8A%89%E6%8B%A9"><span class="toc-number">1.2.5.</span> <span class="toc-text">.so架构的抉择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity-Android-IOS-Plugin"><span class="toc-number">1.2.6.</span> <span class="toc-text">Unity Android &amp; IOS Plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Android%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">Android实战</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Android-Studio"><span class="toc-number">1.2.6.1.1.</span> <span class="toc-text">Android Studio</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JNI-Java%E4%BA%A4%E4%BA%92"><span class="toc-number">1.2.6.1.2.</span> <span class="toc-text">JNI(Java交互)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E9%A1%B9%E7%9B%AE%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.6.1.3.</span> <span class="toc-text">Android项目相关概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android%E5%BA%93%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.6.1.4.</span> <span class="toc-text">Android库模块实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Gradle"><span class="toc-number">1.2.6.1.4.1.</span> <span class="toc-text">Gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Android%E5%BA%93%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.6.1.4.2.</span> <span class="toc-text">Android库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Jar%E5%BA%93%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.6.1.4.3.</span> <span class="toc-text">Jar库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#AAR%E5%BA%93%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.6.1.4.4.</span> <span class="toc-text">AAR库模块</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOS%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.7.</span> <span class="toc-text">IOS实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Objective-C%E8%AF%AD%E6%B3%95"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">Objective-C语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unity%E4%B8%8EIOS%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">Unity与IOS的交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">引用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">2.</span> <span class="toc-text">Reference</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity-Official-Website-Part"><span class="toc-number">2.1.</span> <span class="toc-text">Unity Official Website Part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knowledge-Part"><span class="toc-number">2.2.</span> <span class="toc-text">Knowledge Part</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Art/" title="Art">Art<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Automation/" title="Automation">Automation<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Collision/" title="Collision">Collision<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Database/" title="Database">Database<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Editor/" title="Editor">Editor<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Excel/" title="Excel">Excel<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Game/" title="Game">Game<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/HotUpdate/" title="HotUpdate">HotUpdate<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Lua/" title="Lua">Lua<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Math/" title="Math">Math<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Native/" title="Native">Native<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Network/" title="Network">Network<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Optimization/" title="Optimization">Optimization<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Other/" title="Other">Other<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Plugin/" title="Plugin">Plugin<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming/" title="Programming">Programming<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Language/" title="Programming Language">Programming Language<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Rendering/" title="Rendering">Rendering<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Resource/" title="Resource">Resource<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Unity/" title="Unity">Unity<sup>7</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Unity/" title="Unity">Unity<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Editor/" title="Editor">Editor<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Other/" title="Other">Other<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Math/" title="Math">Math<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Resource/" title="Resource">Resource<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/OpenGL/" title="OpenGL">OpenGL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Rendering/" title="Rendering">Rendering<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Programming/" title="Programming">Programming<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Art/" title="Art">Art<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/UI/" title="UI">UI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C#">C#<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Database/" title="Database">Database<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Shader/" title="Shader">Shader<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SubmlineText3/" title="SubmlineText3">SubmlineText3<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Native/" title="Native">Native<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Prefab/" title="Prefab">Prefab<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Plugin/" title="Plugin">Plugin<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2026 
		
		<a href="/about" target="_blank" title="Tony Tang">Tony Tang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
