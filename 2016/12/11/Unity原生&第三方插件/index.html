
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Unity原生&amp;第三方插件 | 走停人生路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Tony Tang">
    

    
    <meta name="description" content="Unity Plugins本章节主要讲解学习Unity Plugins这一部分。这一部分主要分为两个部分来学习:

Plugin(代码插件)
第三方工具插件(比如NGUI，Dotween，2DToolkit……)。

原生知识Plugins分类Unity Plugins主要分为两类：

Managed Plugins
Native Plugins

Managed PluginsManaged p">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity原生&第三方插件">
<meta property="og:url" content="http://tonytang1990.github.io/2016/12/11/Unity原生&第三方插件/index.html">
<meta property="og:site_name" content="走停人生路">
<meta property="og:description" content="Unity Plugins本章节主要讲解学习Unity Plugins这一部分。这一部分主要分为两个部分来学习:

Plugin(代码插件)
第三方工具插件(比如NGUI，Dotween，2DToolkit……)。

原生知识Plugins分类Unity Plugins主要分为两类：

Managed Plugins
Native Plugins

Managed PluginsManaged p">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFFileStructure.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFFileCommand.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFFileStructureDetail.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/ELFHeaderReadelfCommand.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SectionHeadersInfo.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/StripSectionsAfter.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AndroidSupportedArchitectures.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IOSMonoSupportedArchitectures.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/IOSIL2CPPSupportedArchitectures.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidBuildFlowChart.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioAndroidProjectStucture.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStuidoAndroidModule.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioAndroidModule.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioAndroidMudleImportCode.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioGradleProjectView.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidStudioGraduleBuildProccess.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidModuleJar.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/UnityAndroidFolderStructure.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/UnityJNICall.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidAAROutput.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Android/AndroidGradleLibsFolderStructure.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/NGUIUIHierachy.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/SpriteControlPanel.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIDrawCall.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/LabelFont.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UICameraPanel.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIEventCall.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/OnSliderChangeBegin.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/OnSliderChangeEnd.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/CheckBoxWithWrongAnswer.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/CheckBoxWithCorrectAnswer.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/InputUsing.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/3DUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AtlasMaker.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIAtlas.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/BMFontMakerFontSetting.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/BMFontExportOptions.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/MyAtlasFont.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/DynamicFont.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/FontMakerProcess.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/LoginScene.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/1024Multiple768.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/800Multiple800.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/960Multiple640.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIRootPanel.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/1024Multiple768SelfAdaption.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/800Multiple800SelfAdaption.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/960Multiple640SelfAdaption.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/960Multiple640BaseOnWidth.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/DOTweenSetting.PNG">
<meta property="og:updated_time" content="2019-04-20T11:18:34.299Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity原生&第三方插件">
<meta name="twitter:description" content="Unity Plugins本章节主要讲解学习Unity Plugins这一部分。这一部分主要分为两个部分来学习:

Plugin(代码插件)
第三方工具插件(比如NGUI，Dotween，2DToolkit……)。

原生知识Plugins分类Unity Plugins主要分为两类：

Managed Plugins
Native Plugins

Managed PluginsManaged p">

    
    <link rel="alternative" href="/atom.xml" title="走停人生路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="走停人生路" title="走停人生路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="走停人生路">走停人生路</a></h1>
				<h2 class="blog-motto">做着独立游戏梦，坚持走在游戏开发道路上的人</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:tonytang1990.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/12/11/Unity原生&第三方插件/" title="Unity原生&amp;第三方插件" itemprop="url">Unity原生&amp;第三方插件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Tony Tang" target="_blank" itemprop="author">Tony Tang</a>
		
  <p class="article-time">
    <time datetime="2016-12-11T15:46:11.000Z" itemprop="datePublished"> 發表於 2016-12-11</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity_Plugins"><span class="toc-number">1.</span> <span class="toc-text">Unity Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#原生知识"><span class="toc-number">1.1.</span> <span class="toc-text">原生知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugins分类"><span class="toc-number">1.1.1.</span> <span class="toc-text">Plugins分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Managed_Plugins"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Managed Plugins</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Natiev_Plugins"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">Natiev Plugins</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugins文件扩展名和支持平台"><span class="toc-number">1.1.2.</span> <span class="toc-text">Plugins文件扩展名和支持平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理器与Plugins"><span class="toc-number">1.1.3.</span> <span class="toc-text">处理器与Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-so文件"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">.so文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-so与ELF"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">.so与ELF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编译和使用-so"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">编译和使用.so</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-so架构的抉择"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">.so架构的抉择</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unity_Android_&_IOS_Plugin"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">Unity Android & IOS Plugin</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android实战"><span class="toc-number">1.1.4.</span> <span class="toc-text">Android实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Android_Studio"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Android Studio</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JNI(Java交互)"><span class="toc-number">1.1.4.1.1.</span> <span class="toc-text">JNI(Java交互)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android项目相关概念"><span class="toc-number">1.1.4.1.2.</span> <span class="toc-text">Android项目相关概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android库模块实战"><span class="toc-number">1.1.4.1.3.</span> <span class="toc-text">Android库模块实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Gradle"><span class="toc-number">1.1.4.1.3.1.</span> <span class="toc-text">Gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Android库模块"><span class="toc-number">1.1.4.1.3.2.</span> <span class="toc-text">Android库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Jar库模块"><span class="toc-number">1.1.4.1.3.3.</span> <span class="toc-text">Jar库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#AAR库模块"><span class="toc-number">1.1.4.1.3.4.</span> <span class="toc-text">AAR库模块</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOS实战"><span class="toc-number">1.1.5.</span> <span class="toc-text">IOS实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Objective-C语法"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">Objective-C语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unity与IOS的交互"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">Unity与IOS的交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#引用"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">引用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三方工具插件"><span class="toc-number">1.2.</span> <span class="toc-text">第三方工具插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NGUI"><span class="toc-number">1.2.1.</span> <span class="toc-text">NGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Tutorials"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Tutorials</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Creating_Your_UI"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">Creating Your UI</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Sprite"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">Sprite</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#9-Sliced_Sprite"><span class="toc-number">1.2.1.1.2.1.</span> <span class="toc-text">9-Sliced Sprite</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tiled_Sprite"><span class="toc-number">1.2.1.1.2.2.</span> <span class="toc-text">Tiled Sprite</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Label"><span class="toc-number">1.2.1.1.3.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Button"><span class="toc-number">1.2.1.1.4.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Slider"><span class="toc-number">1.2.1.1.5.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Checkbox"><span class="toc-number">1.2.1.1.6.</span> <span class="toc-text">Checkbox</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Input"><span class="toc-number">1.2.1.1.7.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3D"><span class="toc-number">1.2.1.1.8.</span> <span class="toc-text">3D</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Atlas_Maker"><span class="toc-number">1.2.1.1.9.</span> <span class="toc-text">Atlas Maker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Font_Maker"><span class="toc-number">1.2.1.1.10.</span> <span class="toc-text">Font Maker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NGUI_2-7屏幕自适应"><span class="toc-number">1.2.1.1.11.</span> <span class="toc-text">NGUI 2.7屏幕自适应</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween"><span class="toc-number">1.2.2.</span> <span class="toc-text">DOTween</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween_Instroduction"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">DOTween Instroduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween_Install"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">DOTween Install</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween_Nomenclature_and_Prefixes"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">DOTween Nomenclature and Prefixes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween使用学习"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">DOTween使用学习</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">2.</span> <span class="toc-text">Reference</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity_Official_Website_Part"><span class="toc-number">2.1.</span> <span class="toc-text">Unity Official Website Part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knowledge_Part"><span class="toc-number">2.2.</span> <span class="toc-text">Knowledge Part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Third_Tool_Part"><span class="toc-number">2.3.</span> <span class="toc-text">Third Tool Part</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="Unity_Plugins">Unity Plugins</h1><p>本章节主要讲解学习Unity Plugins这一部分。<br>这一部分主要分为两个部分来学习:</p>
<ol>
<li>Plugin(代码插件)</li>
<li>第三方工具插件(比如NGUI，Dotween，2DToolkit……)。</li>
</ol>
<h2 id="原生知识">原生知识</h2><h3 id="Plugins分类">Plugins分类</h3><p>Unity Plugins主要分为两类：</p>
<ol>
<li>Managed Plugins</li>
<li>Native Plugins</li>
</ol>
<h4 id="Managed_Plugins">Managed Plugins</h4><p><a href="https://docs.unity3d.com/Manual/Plugins.html" target="_blank" rel="external">Managed plugins are managed .NET assemblies created with tools like Visual Studio or MonoDevelop. They contain only .NET code which means that they can’t access any features that are not supported by the .NET libraries</a><br>可以看出Managed Plugins是基于.NET的，只含有.NET code(因为Unity只支持.net 2.0，所以并非所有的.NET库和特性都支持)。</p>
<h4 id="Natiev_Plugins">Natiev Plugins</h4><p><a href="https://docs.unity3d.com/Manual/Plugins.html" target="_blank" rel="external">Native plugins are platform-specific native code libraries. They can access features like OS calls and third-party code libraries that would otherwise not be available to Unity.</a><br>Native Plugins可以理解成.NET以外的平台相关的本地代码库(比如c++(unmanaged code),java等等编写的库)，通过编译使用这些平台相关的bendi 代码我们可以去得到一些Unity不支持的一些功能特性，同时Native Plugins允许我们去重用那些平台相关的库。</p>
<p>Note:<br><a href="https://docs.unity3d.com/Manual/Plugins.html" target="_blank" rel="external">if you forget to add a managed plugin file to the project, you will get standard compiler error messages. If you do the same with a native plugin, you will only see an error report when you try to run the project.</a>(Managed Plugin是基于.NET的，Unity<br>直接识别，所以在编译时就会报错。而Native Plugin只会在运行时报错。)</p>
<h3 id="Plugins文件扩展名和支持平台">Plugins文件扩展名和支持平台</h3><p>Unity支持的Plugins文件扩展名如下：<br>.dll(这里要分Managed还是Native，支持多个平台)<br>.so(Android上使用的代码库文件类型)<br>.a(IOS上使用的代码库文件类型)<br>.jar(java文件打包(不包含Android资源文件)<br>.swift(IOS上新语言swift)<br>.aar(打包Android包含代码文件和所有Android资源文件)<br>.framework<br>.bundle<br>.plugin<br>……(这里只列举了比较典型的一些插件文件扩展名)</p>
<p>Unity支持的平台：<br>Unity是支持多平台的：</p>
<ol>
<li>Editor(Unity Editor)</li>
<li>Windows</li>
<li>IOS</li>
<li>Android<br>……(上述只列举了一部分)</li>
</ol>
<p>那么为什么需要了解这么多不同扩展名和不同的支持平台了？<br>因为不同的文件扩展名是针对不同的平台而运用的。<br>比较典型的就是:<br>.dll(多平台)<br>.so .jar .aar(Android)<br>.a .m .mm .swift .framework(IOS)</p>
<p>那么是不是只要随便编译一个.so文件就能在所有的Android机器上运行了了？<br>答案是否定的。因为不同的CPU处理器所支持的指令集是不一样的</p>
<h3 id="处理器与Plugins">处理器与Plugins</h3><p>不同的CPU处理器所支持的指令集是不一样的，也就是说要想我们编译的Plugins要在对应机器上运行起来，我们必须确保我们编译的Plugins支持该设备处理器所支持的指令集。</p>
<p>接下来以Android平台.so为例来学习：<br><a href="http://www.jianshu.com/p/cb05698a1968" target="_blank" rel="external">Android系统目前支持以下七种不同的CPU架构：ARMv5，ARMv7 (从2010年起)，x86 (从2011年起)，MIPS (从2012年起)，ARMv8，MIPS64和x86_64 (从2014年起)，每一种都关联着一个相应的ABI。</a><br><a href="http://www.jianshu.com/p/cb05698a1968" target="_blank" rel="external">应用程序二进制接口（Application Binary Interface）定义了二进制文件（尤其是.so文件）如何运行在相应的系统平台上，从使用的指令集，内存对齐到可用的系统函数库。在Android系统上，每一个CPU架构对应一个ABI：armeabi，armeabi-v7a，x86，mips，arm64-v8a，mips64，x86_64。</a></p>
<p>从上面的引用可以看出，要想在编译的.so文件在不同的Android处理器上运行起来，我们必须保证编译的.so支持该设备的指令集。</p>
<p>但有一点要注意，并不是说每一种CPU都只支持一种架构：<br><a href="https://developer.android.com/ndk/guides/abis.html#sa" target="_blank" rel="external">armeabi. By contrast, a typical, ARMv7-based device would define the primary ABI as armeabi-v7a and the secondary one as armeabi, since it can run application native binaries generated for each of them.</a>(ARMv7的机器的第一选择是armabi-v7a,但ARMv7也同时支持armeabi(第二选择))</p>
<p><a href="https://developer.android.com/ndk/guides/abis.html#sa" target="_blank" rel="external">Many x86-based devices can also run armeabi-v7a and armeabi NDK binaries. For such devices, the primary ABI would be x86, and the second one, armeabi-v7a.</a>(大部分x86机器都支持armeabi-v7a和armeabi，但x86的第一选择是x86)</p>
<p>那么接下来我们通过学习编译和使用.so来加深理解。</p>
<h4 id="-so文件">.so文件</h4><p>首先让我们认识一下什么是.so文件？<br><a href="http://linux-wiki.cn/wiki/zh-hans/%E5%8A%A8%E6%80%81%E5%BA%93\(\.so\" target="_blank" rel="external">Linux中的.so文件类似于Windows中的DLL，是动态链接库，也有人译作共享库</a>)</p>
<p>为什么我们需要编译成.so文件？<br><a href="http://linux-wiki.cn/wiki/zh-hans/%E5%8A%A8%E6%80%81%E5%BA%93\(\.so\" target="_blank" rel="external">当多个程序使用同一个动态链接库时，既能节约可执行文件的大小，也能减少运行时的内存占用。</a>)<br><a href="https://developer.android.com/ndk/guides/index.html" target="_blank" rel="external">Squeeze extra performance out of a device to achieve low latency or run computationally intensive applications, such as games or physics simulations. </a>(压榨机器性能)<br><a href="https://developer.android.com/ndk/guides/index.html" target="_blank" rel="external">Reuse your own or other developers’ C or C++ libraries. </a>(重用C和C++库)</p>
<h4 id="-so与ELF">.so与ELF</h4><p>在了解.so文件结构之前，我们需要了解一下什么是ELF文件？<br><a href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html" target="_blank" rel="external">ELF(Executable and Linking Format)是一种对象文件的格式，用于定义不同类型的对象文件(Object files)中都放了什么东西、以及都以什么样的格式去放这些东西。它自最早在 System V 系统上出现后，被 xNIX 世界所广泛接受，作为缺省的二进制文件格式来使用</a></p>
<p>ELF文件主要分为三类：</p>
<ol>
<li>Relocatable file(可重定位对象文件 e.g. 汇编生成的.o文件)</li>
<li>Executable file(可执行文件)</li>
<li>Shared object file(动态库文件 e.g. .so文件)</li>
</ol>
<p>接下来让我们看看ELF Object file的构成：<br><img src="/img/Unity/ELFFileStructure.PNG" alt="ELFFileStructure"><br><a href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html" target="_blank" rel="external">为什么会有左右两个很类似的图来说明ELF的组成格式？这是因为ELF格式需要使用在两种场合：</a><br>a) <a href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html" target="_blank" rel="external">组成不同的可重定位文件，以参与可执行文件或者可被共享的对象文件的链接构建；</a><br>b) <a href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html" target="_blank" rel="external">组成可执行文件或者可被共享的对象文件，以在运行时内存中进程映像的构建。</a></p>
<p>如果想知道ELF文件属于哪一类ELF，并且采用了大端还是小段模式，以及支持的架构等信息的话可以通过fiel命令(貌似属于Linux上的命令，Windows上可以通过Cygwin来模拟Linux环境)<br><img src="/img/Unity/ELFFileCommand.PNG" alt="ELFFileCommand"><br>可以看到libBugly.so是属于shared objectt，target架构是ARM，是小端(LSB)32位结构</p>
<p>接下来我们关注一下ELF文件具体的组成部分：<br><img src="/img/Unity/ELFFileStructureDetail.PNG" alt="ELFFileStructureDetail"></p>
<p>主要由三部分组成：</p>
<ol>
<li>the ELF header</li>
<li>the Program Header Table</li>
<li>the Section Header Table</li>
</ol>
<p>ELF header除了包含前面file命令打印出的一些信息外，还包括更多描述ELF各文件部分的相关信息。<br>我们可以通过readelf命令来查看(Windows上除了通过Cygwin，这里我们还可以使用NDK里的arm-linux-androideabi-readelf.exe来查看ELF Header信息)<br><img src="/img/Unity/ELFHeaderReadelfCommand.PNG" alt="ELFHeaderReadelfCommand"><br>具体每一个字段的含义可以查看<a href="http://man7.org/linux/man-pages/man5/elf.5.html" target="_blank" rel="external">ELF</a><br>这里我比较关注的是：<br>Machine  — 表示当前的ELF文件支持的架构。从上面可以看出libBugly.so支持ARM架构<br>Entry point address — 描述程序入口的虚拟地址，如果没有入口则为0x0(这里因为libBugly.so是提供再链接，所以不存在入口点)<br>Start of <strong><em> — 描述了特定headers内容的内存偏移<br>Size of </em></strong> — 描述了特定header所占字节大小<br>……</p>
<p>从上面的readelf输出结果可以看出libBugly.so包含了9个program headers，25个section headers。</p>
<p>这里暂时不深入去了解ELF文件了，如需了解，可以查看下面给出的链接。<br><a href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html" target="_blank" rel="external">可执行文件（ELF）格式的理解</a>:</p>
<p>这里因为我在Android 7.0(API 24)遇到了一个问题：<br>Missing Section Headers<br>后来了解到在Android 7.0开始，Google做了很多改动和要求，包括下面这一项：<br>Missing Section Headers (Enforced since API 24)<br>而因为Section Headers在.so中被移除了所以报出了这个问题。(好像是为了增加破解难度)</p>
<p>这里让我们来了解一个命令工具strip — 用于移除ELF文件中一些不必要的信息。(比如 debug symbol, section headers……)</p>
<p>首先让我们通过readelf —section-headers查看section headers的信息：<br><img src="/img/Unity/SectionHeadersInfo.PNG" alt="SectionHeadersInfo"><br>可以看到libSubly.so有24个section headers</p>
<p>然后通过strip —remove-sections=.* libBugly.so尝试移除所有sections(这里注意Cygwin strip无法识别.so，但NDK strip却可以，不知道是不是需要)<br><img src="/img/Unity/StripSectionsAfter.PNG" alt="StripSectionsAfter"><br>可以看到我们成功的移除了所有section header(除了.shstrtab)。</p>
<p>我想这应该就是前面遇到Missing Section Headers的原因，Android 7.0上强制要求不能Missing Section Header。(待确认)</p>
<p>这里主要知道如何去查看.so文件的架构等信息以及ELF文件的大概组成以及如何通过strip命令去移除一些ELF文件里不必要的信息即可。</p>
<h4 id="编译和使用-so">编译和使用.so</h4><p>结合以前学习的一些知识：<br><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v7t7.html" target="_blank" rel="external">JNI和NDK交叉编译进阶学习</a><br><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102vazu.html" target="_blank" rel="external">NDK&amp;JNI&amp;Java&amp;Android初步学习总结归纳</a></p>
<p>要想在Windows上编译出在Android处理器使用的.so文件，我需要通过<a href="https://developer.android.com/ndk/downloads/index.html" target="_blank" rel="external">NDK</a>(一系列工具的集合，帮助开发者快速开发C(或C++)的动态库。集成了交叉编译器)或者Android Studio配合CMake进行编译。</p>
<p>待续…..</p>
<h4 id="-so架构的抉择">.so架构的抉择</h4><p>还记得前面提到的关于.so架构兼容的问题吗。<br>按照前面的理论是不是说我们只需要支持armeabi或者armeabi-v7架构，就能在大部分机器上跑了了？<br>答案是肯定的，这也是为什么有些人通过减少.so的种类来达到减少APK大小。但值得注意的一点是兼容并不是说100%不会出问题，同时兼容的.so并不一定能使使用性能达到最佳。</p>
<p>所以最好的方法还是通过想办法使用正确架构的.so才是上上之策。</p>
<p>至于即想减少APK大小又想完美使用正确的.so架构的方式，可以参考下面这位博主的一些提议：<br><a href="https://segmentfault.com/a/1190000005646078" target="_blank" rel="external">ANDROID动态加载 使用SO库时要注意的一些问题</a></p>
<h4 id="Unity_Android_&amp;_IOS_Plugin">Unity Android &amp; IOS Plugin</h4><p>接下来让我们结合Unity对Android和IOS平台架构的支持来学习理解CPU架构与Unity之间的关系。<br>Android:<br><img src="/img/Unity/AndroidSupportedArchitectures.PNG" alt="AndroidSupportedArchitectures"></p>
<p>IOS(mono):<br><img src="/img/Unity/IOSMonoSupportedArchitectures.PNG" alt="IOSMonoSupportedArchitectures"></p>
<p>IOS(IL2CPP):<br><img src="/img/Unity/IOSIL2CPPSupportedArchitectures.PNG" alt="IOSIL2CPPSupportedArchitectures"></p>
<p>可以看到Android上只支持ARMv7和x86<br>IOS上支持的情况要根据编译后端设置而定(这里提一下Mac上查看.a文件架构的命令是lipo)：<br>Mono只支持IOS ARMv7<br>IL2CPP支持IOS ARMv7和ARM64</p>
<p>Android因为前面提到的armeabi-v7和x86几乎兼容了所有Android机器，所以只支持这两个是说的过去的。</p>
<p>armv7支持了IOS 4 - 5的大部分机器<br>但IOS 5之后基本都要求arm64，也就是说要支持IOS新机器我们必须使用IL2CPP作为后端编译工具(Unity 4.6之后开始支持的)</p>
<p>对应平台的Plugin需要放到对应文件目录下。<br>Android:<br>Assets/Plugins/Android<br>IOS:<br>Assets/Plugins/IOS<br>Windows:<br>Assets/Plugins</p>
<h3 id="Android实战">Android实战</h3><p>实战Android前，让我们先了解下Android重要的IDE以及代码相关知识。</p>
<h4 id="Android_Studio">Android Studio</h4><p>以前设计到Android开发的时候，都是使用的Eclipse配合ADT插件来弄得。但Eclipse已经被Google放弃了，Google推出了Android Studio作为新一代Android的IDE，所以学习Android Studio用于Android开发是有必要的。</p>
<p>先让我们来了解下什么是Android Studio:<br><a href="https://developer.android.com/studio/intro/" target="_blank" rel="external">Android Studio 是基于 IntelliJ IDEA 的官方 Android 应用开发集成开发环境 (IDE)。</a></p>
<p>这里本人使用Android Studio的需求是为了做移动平台游戏开发时用于Android原生开发。<br>接下来以使用Android Studio配合Unity开发Android为例来学习。</p>
<p>这里放一张Android官网的Android构建流程图加深印象:<br><img src="/img/Android/AndroidBuildFlowChart.png" alt="AndroidBuildFlowChart"></p>
<h5 id="JNI(Java交互)">JNI(Java交互)</h5><p>Unity开发搞Android原生开发，主要是通过JNI(Java Native Interface)去访问JVM和Java代码交互。(更多内容见后面的实战学习)<br>详细的JNI，JVM，Java，Android，NDK等概念学习，参考以前的学习:<br><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v7t7.html" target="_blank" rel="external">JNI和NDK交叉编译进阶学习</a><br><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102vazu.html" target="_blank" rel="external">NDK&amp;JNI&amp;Java&amp;Android初步学习总结归纳</a></p>
<h5 id="Android项目相关概念">Android项目相关概念</h5><p>接下来让我们看看Android Studio创建Android工程之后的基本结构:<br><img src="/img/Android/AndroidStudioAndroidProjectStucture.png" alt="AndroidStudioAndroidProjectStucture"></p>
<p>接下来我们需要理解一个Android Studio里很重要的同一个概念:<br><strong>模块</strong><br><a href="https://developer.android.com/studio/projects/" target="_blank" rel="external">模块是源文件和构建设置的集合，允许您将项目分成不同的功能单元。您的项目可以包含一个或多个模块，并且一个模块可以将其他模块用作依赖项。每个模块都可以独立构建、测试和调试。</a></p>
<p>Android Studio提供了一下集中不同类型的模块：</p>
<ol>
<li>Android应用模块(就是上面我们创建Android Project时看到的app就是我们的Android应用模块)</li>
<li>库模块(unityandroidlib就是我单独创建的Android库模块—目的是为了单独导出jar或者aar)</li>
<li>Google Cloud模块</li>
</ol>
<h5 id="Android库模块实战">Android库模块实战</h5><p>在通过Android库模块导出AAR或者Jar前，我们需要弄学习了解一个自动化构建工具：Gradle</p>
<h6 id="Gradle">Gradle</h6><p><a href="https://docs.gradle.org/current/userguide/userguide.html" target="_blank" rel="external">Gradle is an open-source build automation tool focused on flexibility and performance. Gradle build scripts are written using a Groovy or Kotlin DSL.</a></p>
<p><a href="https://zh.wikipedia.org/wiki/Gradle" target="_blank" rel="external">Gradle是一个基于Apache Ant和Apache Maven概念的项目自动化建构工具。</a></p>
<p>这里直接引用别人的对Gradle的总结，来简单了解下Gradle:<br><a href="https://www.zhihu.com/question/30432152" target="_blank" rel="external">Gradle是一种构建工具,它可以帮你管理项目中的差异,依赖,编译,打包,部署……,你可以定义满足自己需要的构建逻辑,写入到build.gradle中供日后复用.</a></p>
<p>这里暂时需要了解知道的是，Gradle有两大概念:</p>
<ol>
<li>Project<br><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" target="_blank" rel="external">Every Gradle build is made up of one or more projects. What a project represents depends on what it is that you are doing with Gradle. For example, a project might represent a library JAR or a web application. It might represent a distribution ZIP assembled from the JARs produced by other projects. </a></li>
<li>Tasks<br><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" target="_blank" rel="external">Each project is made up of one or more tasks. A task represents some atomic piece of work which a build performs. This might be compiling some classes, creating a JAR, generating Javadoc, or publishing some archives to a repository.</a></li>
</ol>
<p>详细的Gradle学习，参考官网内容:<br><a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" target="_blank" rel="external">Build Script Basics</a></p>
<h6 id="Android库模块">Android库模块</h6><p><a href="https://developer.android.com/studio/projects/android-library" target="_blank" rel="external">Android 库在结构上与 Android 应用模块相同。它可以提供构建应用所需的一切内容，包括源代码、资源文件和 Android 清单。不过，Android 库将编译到您可以用作 Android 应用模块依赖项的 Android 归档 (AAR) 文件，而不是在设备上运行的 APK。</a></p>
<p>这里简单理解下aar和jar的区别就是，AAR是带了所有资源(包括res，AndroidManifest.xml等APK需要的资源+代码Jar的集合)。</p>
<h6 id="Jar库模块">Jar库模块</h6><p>Studio如何导出库模块作为学习对象，因为我们的目标就是通过Android Studio导出AAR或者Jar给Unity使用:<br>来看看Android库模块是如何新建的：<br>Project右键-&gt;New-&gt;Module-&gt;Android Library<br><img src="/img/Android/AndroidStuidoAndroidModule.png" alt="AndroidStuidoAndroidModule"></p>
<p>通过查看Android应用模块和Android库模块的build.gradle，我们可以通过Gradle是如何定义的：<br>Android应用模块:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br></pre></td></tr></table></figure></p>
<p>Android库模块:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.library'</span></span><br></pre></td></tr></table></figure></p>
<p>接下来我们目标是在如何把我们想要的java代码通过Android模块导出成Jar：<br>让我们看下Android模块的结构：<br><img src="/img/Android/AndroidStudioAndroidModule.png" alt="AndroidStudioAndroidModule"><br>把相关jar和java代码导入到我们的：<br><img src="/img/Android/AndroidStudioAndroidMudleImportCode.png" alt="AndroidStudioAndroidMudleImportCode"></p>
<p>我们现在需要做的就是通过编写我们unityandroidlib这个Android库模块下的build.gradle去支持导出我们想要的jar:<br>在写出我们需要的Android模块build.gradle构建文件之前，我们先来了解下Android模块构建的build.gradle里每一个标签的意义：<br><a href="https://developer.android.com/studio/build/#module-level" target="_blank" rel="external">详细的Android模块构建gradle标签学习</a><br><a href="http://google.github.io/android-gradle-dsl/current/index.html" target="_blank" rel="external">详细的Android DSL标签参考</a><br><a href="https://guides.gradle.org/building-android-apps/?_ga=2.32380022.931589262.1533988091-1402562034.1533988091" target="_blank" rel="external">Android Gradle的详细学习参考Building Android Apps</a></p>
<p>实战Android模块的build.gradle：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * 表示使用Android插件进行gradle的Android自动化构建</span><br><span class="line"> * com.android.library表示是构建成一个Android模块</span><br><span class="line"> */</span></span><br><span class="line">apply plugin: <span class="string">'com.android.library'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// android &#123;&#125;指定如何配置android相关编译构建</span></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">// 指定Android API编译版本</span></span><br><span class="line">    compileSdkVersion <span class="number">27</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//defaultConfig &#123;&#125;指定Android部分默认设置，可以通过这里的指定覆盖AndroidManifest.xml里的部分内容</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion <span class="number">15</span>            <span class="comment">// 最低支持的Android API版本</span></span><br><span class="line">        targetSdkVersion <span class="number">27</span>         <span class="comment">// 目标Android API版本</span></span><br><span class="line">        versionCode <span class="number">1</span>               <span class="comment">// App的version number</span></span><br><span class="line">        versionName <span class="string">"1.0"</span>           <span class="comment">// App的version name</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// buildTypes &#123;&#125;指定编译类型的详细信息，比如release和debug的详细编译设定</span></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        <span class="comment">// release的编译设定</span></span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span>                                                                         <span class="comment">// 是否开启代码精简</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span>    <span class="comment">// 代码混淆相关设置</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dependencies &#123;&#125;指定编译依赖信息(比如我们的项目需要依赖unity的classes.jar库)</span></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// fileTree - 指定目录(libs)下符合条件(*.jar)的文件添加到编译路径下</span></span><br><span class="line">    implementation <span class="keyword">fileTree</span>(<span class="keyword">include</span>: [<span class="string">'*.jar'</span>], dir: <span class="string">'libs'</span>)</span><br><span class="line">    <span class="comment">// com.android.support:appcompat-v7:27.1.1 - 添加Android兼容模式库到项目，用于支持更多的theme和兼容老的部分功能</span></span><br><span class="line">    implementation <span class="string">'com.android.support:appcompat-v7:27.1.1'</span></span><br><span class="line">    testImplementation <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    androidTestImplementation <span class="string">'com.android.support.test:runner:1.0.2'</span></span><br><span class="line">    androidTestImplementation <span class="string">'com.android.support.test.espresso:espresso-core:3.0.2'</span></span><br><span class="line">    <span class="comment">// files - 猜测是指定需要依赖的jar库(没找到官方解释)</span></span><br><span class="line">    implementation files(<span class="string">'libs/classes.jar'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// task - 添加自定义的构建任务</span></span><br><span class="line"><span class="comment">// 这里是增加一个删除旧的jar的任务</span></span><br><span class="line"><span class="comment">// type:指定任务的类型delete删除</span></span><br><span class="line"><span class="keyword">task</span> deleteOldJar(type: <span class="keyword">Delete</span>) &#123;</span><br><span class="line">    <span class="comment">// 指定删除release/AndroidPlugin.jar文件</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="string">'build/libs/classes.jar'</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="string">'release/AndroidPlugin.jar'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// task - 添加自定义的构建任务</span></span><br><span class="line"><span class="comment">// 这里增加一个从新打包jar的任务，目的是为了去除默认build里打包的BuildConfig.class(会导致Unity使用jar时报错)</span></span><br><span class="line"><span class="comment">// type: 指定任务类型是Jar打包</span></span><br><span class="line"><span class="keyword">task</span> makeJar(type: Jar) &#123;</span><br><span class="line">    <span class="comment">// 指定jar来源(文件或者目录)</span></span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">file</span>(<span class="string">'build/intermediates/classes/release'</span>)</span><br><span class="line">    <span class="comment">// 指定需要重新打包后的jar名字</span></span><br><span class="line">    archiveName = <span class="string">'classes.jar'</span></span><br><span class="line">    <span class="comment">// 输出目录</span></span><br><span class="line">    <span class="keyword">destinationDir</span> = <span class="keyword">file</span>(<span class="string">'build/libs/'</span>)</span><br><span class="line">    <span class="comment">// 过滤不需要的class文件</span></span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">'com/tonytang/unityandroidproject/BuildConfig.class'</span>)</span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">'com/tonytang/unityandroidproject/BuildConfig\$*.class'</span>)</span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">'com/tonytang/unityandroidproject/R.class'</span>)</span><br><span class="line">    <span class="keyword">exclude</span>(<span class="string">'com/tonytang/unityandroidproject/R\$*.class'</span>)</span><br><span class="line">    <span class="comment">// 需要包含打包到jar中的文件</span></span><br><span class="line">    <span class="keyword">include</span>(<span class="string">'com/tonytang/unityandroidproject/**'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定makeJar任务依赖的任务build(依赖的任务先执行)</span></span><br><span class="line">makeJar.dependsOn(build)</span><br><span class="line"></span><br><span class="line"><span class="comment">// task - 添加自定义的构建任务</span></span><br><span class="line"><span class="comment">// 这里是增加一个到处jar的任务</span></span><br><span class="line"><span class="comment">// type:指定任务类型为Copy复制</span></span><br><span class="line"><span class="keyword">task</span> exportJar(type: <span class="keyword">Copy</span>) &#123;</span><br><span class="line">    <span class="comment">// 从哪里复制</span></span><br><span class="line">    <span class="keyword">from</span>(<span class="string">'build/libs/'</span>)</span><br><span class="line">    <span class="comment">// 复制到哪里</span></span><br><span class="line">    <span class="keyword">into</span>(<span class="string">'release/'</span>)</span><br><span class="line">    <span class="comment">/// 重命名文件</span></span><br><span class="line">    rename(<span class="string">'classes.jar'</span>, <span class="string">'AndroidPlugin.jar'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定exportJar任务依赖的任务deleteOldJar,build,makeJar(依赖的任务先执行)</span></span><br><span class="line">exportJar.dependsOn(deleteOldJar, makeJar)</span><br></pre></td></tr></table></figure></p>
<p>完成build.gradle编写后，我们打开Gradle Project就可以选中我们新写的exportJar任务，双击执行:<br><img src="/img/Android/AndroidStudioGradleProjectView.png" alt="AndroidStudioGradleProjectView"><br><img src="/img/Android/AndroidStudioGraduleBuildProccess.png" alt="AndroidStudioGraduleBuildProccess"></p>
<p>上面的注释很详细了，就不过多描述了，直接来看下我们在release下生成的新得AndroidPlugin.jar吧：<br><img src="/img/Android/AndroidModuleJar.png" alt="AndroidModuleJar"><br>我们成功得到了过滤掉BuildConfig.class,R.class等文件的jar代码包。<br>得到jar包后，我们还需要把我们的Android相关的资源以及jar包放到我们的Unity对应项目目录才行（Plugins/Android/）:<br><img src="/img/Android/UnityAndroidFolderStructure.png" alt="UnityAndroidFolderStructure"></p>
<p>接下来我们需要的是通过Unity封装的JNI去访问Java代码：<br>AndroidNativeManager.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             AndroidNativeManager.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2018/08/10</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> UNITY_ANDROID</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> AndroidNativeManager.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Android原生管理类</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AndroidNativeManager</span> : <span class="title">NativeManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> Android主Activity对象</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> AndroidJavaObject mAndroidActivity;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 初始化</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">init</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.init();</span><br><span class="line">        Debug.Log(<span class="string">"init()"</span>);</span><br><span class="line">        <span class="keyword">if</span> (Application.platform == RuntimePlatform.Android)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里使用using的目的是确保AndroidJavaClass对象尽快被删除</span></span><br><span class="line">            <span class="keyword">using</span> (AndroidJavaClass jc = <span class="keyword">new</span> AndroidJavaClass(<span class="string">"com.unity3d.player.UnityPlayer"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//获得当前Activity(这里是为了获得MainActivity)</span></span><br><span class="line">                mAndroidActivity = jc.GetStatic&lt;AndroidJavaObject&gt;(<span class="string">"currentActivity"</span>);</span><br><span class="line">                <span class="keyword">if</span> (mAndroidActivity == <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.Log(<span class="string">"获取UnityMainActivity::mAndroidActivity成员失败！"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.Log(<span class="string">"获取UnityMainActivity::mAndroidActivity成员成功!"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 调用原生方法</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">callNativeMethod</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.callNativeMethod();</span><br><span class="line">        Debug.Log(<span class="string">"callNativeMethod()"</span>);</span><br><span class="line">        <span class="keyword">if</span> (mAndroidActivity != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mAndroidActivity.Call(<span class="string">"javaMethod"</span>, <span class="string">"cs param"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p>NativeMessageHandler.cs<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             NativeMessageHandler.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2018/08/10</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> NativeMessageHandler.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 原生消息相应处理器</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NativeMessageHandler</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 接收原生消息</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="msg"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resUnityMsg</span>(<span class="params"><span class="keyword">string</span> msg</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Debug.Log(<span class="keyword">string</span>.Format(<span class="string">"resUnityMsg : &#123;0&#125;"</span>, msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MainActivity.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tonytang.unityandroidproject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.res.Configuration;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.DisplayMetrics;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.unity3d.player.UnityPlayer;</span><br><span class="line"><span class="keyword">import</span> com.unity3d.player.UnityPlayerActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">UnityPlayerActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Unity那一侧相应Java回调的GameObject名字</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String mUnityCallBackHandler = <span class="string">"GameLauncher"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Android上下文</span></span><br><span class="line">    <span class="keyword">public</span> Context mContext = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主Activity</span></span><br><span class="line">    <span class="keyword">public</span> Activity mCurrentActivity = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        Log.d(<span class="string">"JNI"</span>, <span class="string">"onCreate()"</span>);</span><br><span class="line">        mContext = <span class="keyword">this</span>.getApplicationContext();</span><br><span class="line">        mCurrentActivity = <span class="keyword">this</span>;</span><br><span class="line">        ******</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ******</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Unity call part</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">javaMethod</span><span class="params">(String csparam)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"JNI"</span>, <span class="string">"javaMethod() with parameter:"</span> + csparam);</span><br><span class="line">        UnityPlayer.UnitySendMessage(mUnityCallBackHandler,<span class="string">"resUnityMsg"</span>, <span class="string">"java param"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Android/UnityJNICall.png" alt="UnityJNICall"></p>
<p>至此我们成功完成了使用Android Studio通过编写Gradule导出我们需要的jar代码包，然后通过Unity封装的JNI访问java方法并通过Unity的方法UnityPlayer.UnitySendMessage()方法成功返回调用了CS代码。</p>
<p>关于Unity使用AAR的学习:<br>待续……</p>
<p>详细的Android DSL标签学习:<br><a href="http://google.github.io/android-gradle-dsl/current/index.html" target="_blank" rel="external">Android Plugin DSL Reference</a><br>详细的Gradle task学习：<br><a href="https://docs.gradle.org/current/dsl/org.gradle.api.Task.html" target="_blank" rel="external">Gradle Task</a></p>
<p>待续……</p>
<h6 id="AAR库模块">AAR库模块</h6><p>这里再次说一下AAR和Jar的区别：<br>AAR是带了所有资源(包括res，AndroidManifest.xml等APK需要的资源+代码Jar的集合)。</p>
<p>Unity是可以使用AAR作为资源的使用的，导出AAR和Jar没有太多区别，这里注重讲下Unity使用Android Studio导出的Jar需要注意的地方和坑点。</p>
<p>导出Jar的同时其实已经导出了AAR，AAR存在下面这个目录:<br><img src="/img/Android/AndroidAAROutput.png" alt="AndroidAAROutput"></p>
<p>但如果我们直接把res和aar以及AndroidManifest拷贝到Plugins插件目下，打包会发现报错：<br>错误的意思大致是classes.jar代码已存在有重复。</p>
<p>classes.jar代码重复是因为我们前面导出jar的build.gradle配置了:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dependencies &#123;&#125;指定编译依赖信息(比如我们的项目需要依赖unity的classes.jar库)</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// fileTree - 指定目录(libs)下符合条件(*.jar)的文件添加到编译路径下</span></span><br><span class="line">    <span class="function">implementation <span class="title">fileTree</span>(<span class="params">include: [<span class="string">'*.jar'</span>], dir: <span class="string">'libs'</span></span>)</span><br><span class="line">    ******</span><br><span class="line">    <span class="comment">// files - 指定需要依赖的库文件(没找到官方解释)</span></span><br><span class="line">    implementation <span class="title">files</span>(<span class="params"><span class="string">'libs/classes.jar'</span></span>)</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>这里的两句implementation，前者是表示libs下的jar作为引用并一起打包输出到aar里，后者表示要引用并一起打包classes.jar库。</p>
<p>所以这里就是导致我们的AAR里有一份classes.jar库代码存在的原因。</p>
<p>改写build.gradle避免classes.jar被一起打包到AAR里:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dependencies &#123;&#125;指定编译依赖信息(比如我们的项目需要依赖unity的classes.jar库)</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// fileTree - 指定目录(libs)下符合条件(*.jar)的文件添加到编译路径下</span></span><br><span class="line">    <span class="comment">// 因为项目依赖了Unity的class.jar但又不希望classes.jar跟着aar一起导出(会导致unity打包报错 -- classes.jar包重复问题)</span></span><br><span class="line">    <span class="comment">// 所以这里不能使用fileTree包含lib目录下所有jar，需要修改成不包含classes.jar的形式</span></span><br><span class="line">    <span class="function">implementation <span class="title">fileTree</span>(<span class="params">include: [<span class="string">'*.jar'</span>], dir: <span class="string">'libs/include'</span></span>)</span><br><span class="line">    ******</span><br><span class="line">    <span class="comment">// files - 猜测是显示指定依赖文件(没找到官方解释)</span></span><br><span class="line">    <span class="comment">// 这里专门用compileOnly是为了避免classes.jar进aar包</span></span><br><span class="line">    compileOnly <span class="title">files</span>(<span class="params"><span class="string">'libs/exclude/classes.jar'</span></span>)</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>implementation — Gradle 会将依赖项添加到编译类路径，并将依赖项打包到构建输出<br>compileOnly — Gradle 只会将依赖项添加到编译类路径（即不会将其添加到构建输出）<br>通过修改build.gradle和调整目录：<br><img src="/img/Android/AndroidGradleLibsFolderStructure.png" alt="AndroidGradleLibsFolderStructure"><br>我们避免了classes.jar被打进AAR里，这样一来就不会在Unity打包时有classes.jar代码重复的问题了。</p>
<p>Note:<br><strong>AAR可以通过修改后缀成.zip通过解压软件插件内部详情</strong><br><a href="https://developer.android.com/studio/build/dependencies" target="_blank" rel="external">dependencies模块详细说明参考</a></p>
<h3 id="IOS实战">IOS实战</h3><p>IOS实战学习前，我们需要了解IOS的开发语言，以前是Objective-C，后来苹果推出了switf。<br>这里针对Unity而言，我们主要用到的还是以Objective-C为主。</p>
<h4 id="Objective-C语法">Objective-C语法</h4><p>*.h<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&#25152;&#38656;&#20854;&#20182;&#22836;&#25991;&#20214;&#10;#import &#34;*.h&#34;&#10;&#10;//&#60;Protocol&#62; OC&#37324;&#30340;Protocol&#30456;&#24403;&#20110;Interface&#65292;&#38656;&#35201;&#23454;&#29616;&#25509;&#21475;&#26041;&#27861;&#10;//&#20294;&#26377;&#19968;&#28857;&#19981;&#21516;&#30340;&#26159;Protocol&#37324;&#24182;&#19981;&#26159;&#25152;&#26377;&#30340;&#25509;&#21475;&#26041;&#27861;&#37117;&#24517;&#39035;&#23454;&#29616;&#10;//@required -- &#24517;&#39035;&#23454;&#29616;&#30340;&#37096;&#20998;&#10;//@optional -- &#21487;&#36873;&#23454;&#29616;&#30340;&#37096;&#20998;&#10;@interface *:NSObject&#60;*&#62;&#123;&#10;&#10;    // &#31867;&#21464;&#37327;&#22768;&#26126;&#10;    //......&#10;&#125;&#10;&#10;//&#31867;&#23646;&#24615;&#22768;&#26126;&#10;@property (nonatomic, strong) * *&#23646;&#24615;&#21517;;&#10;//Unity&#22238;&#35843;GameObject&#21517;&#23383;&#10;@property (nonatomic, strong) NSString *mGameObjectHandler;&#10;&#10;//&#31867;&#26041;&#27861;&#22768;&#26126;&#10;//+&#20195;&#34920;&#23646;&#20110;&#31867;&#26041;&#27861;&#65292;&#30456;&#24403;&#20110;&#38745;&#24577;&#10;//-&#20195;&#34920;&#23646;&#20110;&#23545;&#35937;&#65292;&#30456;&#24403;&#20110;&#31867;&#25104;&#21592;&#10;//&#26041;&#27861;&#23450;&#20041;&#26684;&#24335;&#22914;&#19979;:&#10;//(+ or -)(return &#36820;&#22238;&#31867;&#22411;)&#26041;&#27861;&#21517;:(&#21442;&#25968;1&#31867;&#22411;) &#21442;&#25968;1&#21517; : (&#21442;&#25968;2&#31867;&#22411;) &#21442;&#25968;2&#21517;;&#10;+(&#31867;&#22411;*) Instance;&#10;&#10;-(void)&#26041;&#27861;&#21517;;&#10;&#10;-(void)&#26041;&#27861;&#21517;:(&#21442;&#25968;&#31867;&#22411; *)&#21442;&#25968;&#21517;;&#10;@end</span><br></pre></td></tr></table></figure></p>
<p>*.mm<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &#34;*.h&#34;&#10;&#10;//&#23450;&#20041;&#20840;&#23616;&#30340;&#38745;&#24577;&#21464;&#37327;&#10;static &#31867;&#22411;&#21517;* &#21464;&#37327;&#21517; = nil;&#10;&#10;//&#22768;&#26126;UnitySendMessage&#20026;&#22806;&#37096;&#26041;&#27861;&#65292;&#29992;&#20110;native code&#21644;C&#65283;&#21457;&#28040;&#24687;&#20132;&#20114;&#10;#if defined(__cpluscplus)&#10;//&#30830;&#20445;&#20989;&#25968;&#30340;&#32534;&#35793;&#26041;&#24335;&#10;//&#30830;&#20445;&#25214;&#21040;&#27491;&#30830;&#30340;&#20989;&#25968;&#21517;&#10;//&#36825;&#19968;&#28857;&#22909;&#27604;C++&#25351;&#23450;&#19981;&#21516;&#30340;&#35843;&#29992;&#32422;&#23450;(stdcall(C++&#40664;&#35748;&#20351;&#29992;)&#21644;cdecl(C&#40664;&#35748;&#20351;&#29992;))&#10;//&#20250;&#20915;&#23450;&#20989;&#25968;&#21517;&#29983;&#25104;&#65292;&#21442;&#25968;&#20837;&#26632;&#39034;&#24207;&#65292;&#22534;&#26632;&#32500;&#25252;&#31561;&#10;//&#22312;&#35835;&#21462;&#30340;&#26102;&#20505;&#20063;&#38656;&#35201;&#25351;&#23450;&#21516;&#26679;&#32534;&#35793;&#26041;&#24335;&#10;extern &#34;C&#34;&#123;&#10;#endif  &#10;    extern void UnitySendMessage(const char *, const char *, const char *);&#10;&#10;#if defined(__cpluscplus)&#10;&#125;&#10;#endif&#10;&#10;//&#25351;&#23450;&#23454;&#29616;&#30340;&#31867;&#22411;&#10;@implementation &#31867;&#22411;&#21517;&#10;&#10;//&#33719;&#21462;&#21333;&#20363;&#23545;&#35937;&#10;+(&#36820;&#22238;&#31867;&#22411;*) Instance&#10;&#123;&#10;    return *;&#10;&#125;&#10;&#10;-(void)&#26041;&#27861;&#21517;&#10;&#123;&#10;    //&#26041;&#27861;&#23454;&#29616;&#10;    NSLog(@&#34;initSDK&#34;);&#10;    self.mGameObjectHandler = @&#34;&#21709;&#24212;&#21407;&#29983;&#28040;&#24687;&#30340;GameObejct&#21517;&#23383;&#34;;&#10;&#125;&#10;&#10;-(void)&#26041;&#27861;&#21517;:(&#21442;&#25968;1&#31867;&#22411; *)key value:(&#21442;&#25968;2&#31867;&#22411; *)value&#10;&#123;&#10;    //Log&#25171;&#21360;&#26041;&#24335;&#10;    NSLog(@&#34;&#21442;&#25968;&#35774;&#32622;&#65306;key = %@ value = %@&#34;, key,value);&#10;    //&#23383;&#31526;&#20018;&#25340;&#25509;&#26041;&#24335;&#10;    NSString *msg = [NSString stringWithFormat:@&#34;%@ %@ %s&#34;, key, value, issuccess ? &#34;true&#34; : &#34;false&#34;];&#10;    //&#21407;&#29983;&#21457;&#36865;&#28040;&#24687;&#32473;CS&#19968;&#20391;&#10;    UnitySendMessage([self.mGameObjectHandler UTF8String], &#34;CS&#22238;&#35843;&#21709;&#24212;&#26041;&#27861;&#21517;&#34;, [msg UTF8String]);&#10;&#125;&#10;&#10;//&#29992;&#20110;C#&#21644;Objective C&#20132;&#20114;&#30340;&#20195;&#30721;&#10;extern &#34;C&#34;&#123;&#10;    void CS&#26041;&#27861;&#21517;()&#10;    &#123;&#10;        [[&#31867;&#22411;&#21517; &#31867;&#22411;&#38745;&#24577;&#21464;&#37327;] &#25104;&#21592;&#26041;&#27861;];&#10;    &#125;&#10;&#10;    void CS&#26041;&#27861;&#21517;(char* key, char* value)&#10;    &#123;&#10;        //CS char*&#21040;NSString&#36716;&#25442;&#26041;&#24335;&#10;        NSString* parameterkey = [NSString stringWithUTF8String:key];&#10;        NSString* parametervalue = [NSString stringWithUTF8String:value];&#10;        [[&#31867;&#22411;&#21517; &#31867;&#22411;&#38745;&#24577;&#21464;&#37327;] &#25104;&#21592;&#26041;&#27861;:&#21442;&#25968;1&#20540; &#21442;&#25968;2&#21517;&#23383;:&#21442;&#25968;2&#20540;];&#10;    &#125;&#10;&#125;&#10;@end</span><br></pre></td></tr></table></figure></p>
<h4 id="Unity与IOS的交互">Unity与IOS的交互</h4><p>了解Unity与IOS交互前，让我们先了解部分IOS相关概念：<br><a href="https://www.cnblogs.com/lixiaojian/p/3336653.html" target="_blank" rel="external">UIView是一个视图,UIViewController是一个控制器,每一个viewController管理着一个view。</a></p>
<p>IOS和UIViewController的交互就好比Android里和Activity的交互。</p>
<p>结合Unity官方讲解:<br><a href="https://docs.unity3d.com/2017.4/Documentation/Manual/StructureOfXcodeProject.html" target="_blank" rel="external">Customizing an iOS Splash Screen Other Versions Leave feedback Structure of a Unity XCode Project</a></p>
<p>我们可以知道IOS里，UnityAppController.mm是整个程序的入口。如果我们想要自定义入口，我们需要继承至UnityAppController。<br>AppController.h<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#33258;&#23450;&#20041;Unity AppCOntroller&#10;//&#23548;&#20837;Unity&#30340;UnityAppController.h&#65292;&#33258;&#23450;&#20041;AppController&#38656;&#35201;&#32487;&#25215;&#33267;UnityAppController&#10;#import &#34;UnityAppController.h&#34;&#10;&#10;@interface AppController : UnityAppController&#10;@property(nonatomic,strong) UINavigationController *naVC;&#10;-(void) createUI;&#10;@end</span><br></pre></td></tr></table></figure></p>
<p>AppController.mm<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#33258;&#36523;&#30340;&#22836;&#25991;&#20214;&#10;#import &#34;AppController.h&#34;&#10;//&#23548;&#20837;&#25105;&#20204;&#33258;&#24049;&#20889;&#25509;&#21475;&#30340;&#31867;&#30340;.h&#25991;&#20214;&#65292;&#29992;&#20110;&#23454;&#29616;&#33258;&#23450;&#20041;&#30340;UIViewController&#10;#import &#34;UnityViewController.h&#34;&#10;//&#20854;&#20182;&#25991;&#20214;&#10;#import &#60;Foundation/Foundation.h&#62;&#10;&#10;@implementation AppController&#10;-(void) createUI&#10;&#123;&#10;    NSLog(@&#34;AppController:createUI()&#34;);&#10;    _rootController = [[UIViewController alloc]init];&#10;    _rootView = [[UIView alloc]initWithFrame:[UIScreen mainScreen].bounds];&#10;    _rootController.view = _rootView;&#10;        &#10;    //&#33258;&#23450;&#20041;viewcontroller&#28155;&#21152;&#21040;&#29616;&#26377;&#30340;viewcontroller&#19978;&#10;    UnityViewController *vc = [[UnityViewController alloc]init];&#10;    self.naVC =[[UINavigationController alloc]initWithRootViewController:vc];&#10;    &#10;    //&#28155;&#21152;&#33258;&#23450;&#20041;view&#21040;rootView&#19978;&#10;    [_rootView addSubview:self.naVC.view];&#10;&#10;    _window.rootViewController = _rootController;&#10;    [_window bringSubviewToFront:_rootView];&#10;    [_window makeKeyAndVisible];&#10;&#125;&#10;@end&#10;&#10;//&#36825;&#26159;&#19968;&#20010;&#22266;&#23450;&#20889;&#27861;&#65292;&#22240;&#20026;&#36825;&#20010;&#20195;&#30721;&#65292;&#25152;&#20197;&#21551;&#21160;&#30028;&#38754;&#26159;&#20174;&#36825;&#37324;&#21551;&#21160;&#10;IMPL_APP_CONTROLLER_SUBCLASS(AppController);</span><br></pre></td></tr></table></figure></p>
<p>通过上面的代码，我们完成了下面两件事：</p>
<ol>
<li>自定义Unity IOS程序入口</li>
<li>添加了自定义的View(绑定到自定义UIViewController上)到rootView上</li>
</ol>
<p>成功绑定到自定义UIViewController上后，我们就能通过自定义的UIViewController去和IOS打交道了。<br>接下来看看自定义的UIViewController是如何定义的，结合权限申请实战学习：<br>UnityViewController.h<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#33258;&#23450;&#20041;&#30340;UIViewController&#10;#import &#34;UnityAppController.h&#34;&#10;&#10;@interface UnityViewController : UIViewController&#10;//&#26435;&#38480;&#30003;&#35831;&#10;- (void)audioAuthAction;&#10;@end</span><br></pre></td></tr></table></figure></p>
<p>UnityViewController.mm<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#21253;&#21547;&#33258;&#36523;&#22836;&#25991;&#20214;&#10;#import &#34;UnityViewController.h&#34;&#10;&#10;//&#20854;&#20182;&#22836;&#25991;&#20214;&#10;#import &#34;UnityAppController+ViewHandling.h&#34;&#10;#import &#60;UI/UnityView.h&#62;&#10;#import &#60;Foundation/Foundation.h&#62;&#10;#import &#60;AVFoundation/AVFoundation.h&#62;&#10;&#10;@implementation UnityViewController&#10;&#10;- (void)viewDidLoad&#10;&#123;&#10;    NSLog(@&#34;UnityViewController:viewDidLoad()&#34;);&#10;    [super viewDidLoad];&#10;    [self.view addSubview:GetAppController().unityView];&#10;    GetAppController().unityView.frame = self.view.frame;&#10;    &#10;    // Do any additional setup after loading the view.&#10;    // &#26435;&#38480;&#30003;&#35831;&#30456;&#20851;&#10;    [self audioAuthAction];&#10;&#125;&#10;&#10;//&#26435;&#38480;&#30003;&#35831;&#10;- (void)audioAuthAction&#10;&#123;&#10;    //&#40614;&#20811;&#39118;&#26435;&#38480;&#30003;&#35831;&#10;    NSLog(@&#34;UnityViewController:audioAuthAction()&#34;);&#10;    [AVCaptureDevice requestAccessForMediaType:AVMediaTypeAudio completionHandler:^(BOOL granted) &#123;&#10;       NSLog(@&#34;%@&#34;,granted ? @&#34;&#40614;&#20811;&#39118;&#20934;&#35768;&#34;:@&#34;&#40614;&#20811;&#39118;&#19981;&#20934;&#35768;&#34;);&#10;    &#125;];&#10;&#125;&#10;&#10;-(void)viewWillAppear:(BOOL)animated&#123;&#10;    //&#38544;&#34255;&#23548;&#33322;&#26465;view&#10;    NSLog(@&#34;UnityViewController:viewWillAppear()&#34;);&#10;    self.navigationController.navigationBar.hidden = YES;&#10;&#125;&#10;&#10;-(void)viewDidDisappear:(BOOL)animated&#10;&#123;&#10;    NSLog(@&#34;UnityViewController:viewDidDisappear()&#34;);&#10;    self.navigationController.navigationBar.hidden = NO;&#10;&#125;&#10;@end</span><br></pre></td></tr></table></figure></p>
<p>可以看到通过自定义的UIViewController，我们就可以直接编写对应原生功能(e.g. 权限申请)代码了。</p>
<h4 id="引用">引用</h4><p><a href="https://docs.unity3d.com/2017.4/Documentation/Manual/StructureOfXcodeProject.html" target="_blank" rel="external">Customizing an iOS Splash Screen Other Versions Leave feedback Structure of a Unity XCode Project</a><br><a href="https://www.cnblogs.com/vsirWaiter/p/8383408.html" target="_blank" rel="external">Unity-IOS交互整理</a><br><a href="https://www.jianshu.com/p/bd944258105f" target="_blank" rel="external">iOS 系统权限</a></p>
<p>待续……</p>
<h2 id="第三方工具插件">第三方工具插件</h2><h3 id="NGUI">NGUI</h3><p>NGUI是C#写的第三方插件，堪称Unity 4.6之前最完美的GUI解决方案(NGUI 2.7及之前貌似是免费)，复杂的UI都能在一个Draw Call完成渲染。<br>出于学习目的下载NGUI 2.7试试：<br><a href="http://forum.unity3d.com/threads/ngui-free-edition.124032/" target="_blank" rel="external">NGUI 2.7 Download</a><br>一下学习都是基于NGUI 2.7版本学习的，新的版本特性这里没有涉及到。</p>
<h4 id="Tutorials">Tutorials</h4><p><a href="http://www.tasharen.com/?page_id=197" target="_blank" rel="external">以下学习参考</a></p>
<h5 id="Creating_Your_UI">Creating Your UI</h5><p>这里就不再一一讲述步骤了，主要记录一些重要的概念。<br>先来看看我们创建出UI之后的UI层次结构：<br><img src="/img/Unity/NGUIUIHierachy.PNG" alt="NGUIUIHierachy"><br>看看各组成部分的作用：</p>
<ol>
<li>UI Root<br>上面挂载UIRoot Script，这个脚本的主要目的是把所有挂载在UI Root下的object 所在屏幕比例根据屏幕大小变化而变化<br><a href="http://www.tasharen.com/?page_id=619" target="_blank" rel="external">When attached to the root object of the UI, it will scale that object by the inverse of the screen’s height, thus maintaining a 1 pixel = 1 unit ratio, ensuring pixel-perfect UIs.</a><br>UIStretch — <a href="http://www.tasharen.com/?page_id=619" target="_blank" rel="external">This script is capable of stretching the widget relative to the size of the screen (or, if specified — panel or widget size).</a><br>UIStretch是自适应的关键，根据屏幕或特定panel长宽变化去做适应。但后来的NGUI版本好像对自适应这一块做了很大修改，UIStretch貌似不再支持。</li>
<li>Camera<br>上面挂载了UICamera Script，这个脚本的主要目的是”contains NGUI’s event system”，至于消息是如何传递的这里先暂时不管，以后会深入学习。</li>
<li>Anchor<br>上面挂载了UIAnchor Script，这个脚本的主要目的是”apply a half-pixel offset on Windows machines, for pixel-perfect results.”(把UI限定在窗口特定位置，当窗口变化的时候会依然处于相对窗口的位置)</li>
<li>Panel<br>上面挂载了UIPanel，这个脚本的主要目的是”container that will collect all UI widgets under it and will combine them into as few draw calls as possible.”(这里相当于UI的管理容器，负责以最少的draw call去管理UI)</li>
</ol>
<h5 id="Sprite">Sprite</h5><p>创建了UI，那么接下来就是增加我们的UI组件。<br>通过Widget Tool可以创建一系列不同类型的组件，这里有两个概念比较重要。<br>Atlas(图集) — Atlas好比我们的图片库，因为组件会需要选择图案，而Atlas定义了切割好的图集可供选择<br>Font(字体库) — 正如其名，字体库，至于字体库是怎么制作的这里暂时不得而知(待学习)<br>让我们简单看一下创建一个Sprite后的显示面板：<br><img src="/img/Unity/SpriteControlPanel.PNG" alt="SpriteControlPanel"><br>这里Sprite有深度的概念，通过调节Depth我们可以实现层次排序。<br>还值得注意的一点是Sprite有个属性Sprite Type，这里的Sprite Type不仅可以决定Sprite如何显示，还会影响Sprite如何去适应显示区域。</p>
<h6 id="9-Sliced_Sprite">9-Sliced Sprite</h6><p>Sliced技术会决定如何去拉伸图案去适应显示区域而不至于看起来变形。<br><a href="http://www.unityrealm.com/unity-9-slice-advantages/" target="_blank" rel="external">9-Sliced详解</a></p>
<h6 id="Tiled_Sprite">Tiled Sprite</h6><p>Tiled Sprite是用原始sprite大小去铺满显示区域</p>
<p>Note:<br>这里有一个官网说是显示Debug Info的东西，通过把Panel的Debug Info设置成Geometry，场景里会增加一个叫_UIDrawCall的对象。<br><img src="/img/Unity/UIDrawCall.PNG" alt="UIDrawCall"><br>(这里还不太明白是什么，但看起来是把UI更新整合到一个Draw Call里了)</p>
<h5 id="Label">Label</h5><p>Lable里的字来源于我们之前选的字库。<br>在Label里填写文本有个比较方便的设定，可以通过[hex color]改变后续文本的颜色e.g. [FF0000]代表红色。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FF0000]NGUI's [FFFFFF]lables can have [00FF00]embedded </span><br><span class="line">[0000FF]colors.</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/LabelFont.PNG" alt="LabelFont"></p>
<h5 id="Button">Button</h5><p>当我们添加了Button后，如何响应事件了？<br>“anything with a collider on it will receive all of the events.”</p>
<p>还记得之前说UICamera负责发送所有事件吗？所有在Camera(绑定了UICamera)下的UI都会接受到Event(前提是设置了event发送到UI层)。<br>让我们来看下UICamera的一些public可控变量：<br><img src="/img/Unity/UICameraPanel.PNG" alt="UICameraPanel"><br>让我们关注一些比较重要的点：<br>Event Receive Mask — 控制了接受events的layer层<br>Debug — debug模式下可以让我们看到哪一个game objec<br>t接收到了event<br>Range Distance — 控制raycast的有效范围<br>Scroll Axis Name — 设定横向控制来源<br>Vertical Axis Name — 设定纵向控制来源<br>……</p>
<p>接下来让我们看看UICamera都负责发送哪些事件？(具体可以参见UICamera源码)<br>    OnHover (isOver) is sent when the mouse hovers over a collider or moves away.<br>    OnPress (isDown) is sent when a mouse button gets pressed on the collider.<br>    OnSelect (selected) is sent when a mouse button is first pressed on a game object. Repeated presses on the same object won’t result in a new OnSelect.<br>    OnClick () is sent with the same conditions as OnSelect, with the added check to see if the mouse has not moved much. UICamera.currentTouchID tells you which button was clicked.<br>    OnDoubleClick () is sent when the click happens twice within a fourth of a second. UICamera.currentTouchID tells you which button was clicked.<br>    OnDragStart () is sent to a game object under the touch just before the OnDrag() notifications begin.<br>    OnDrag (delta) is sent to an object that’s being dragged.<br>    OnDragOver (draggedObject) is sent to a game object when another object is dragged over its area.<br>    OnDragOut (draggedObject) is sent to a game object when another object is dragged out of its area.<br>    OnDragEnd () is sent to a dragged object when the drag event finishes.<br>    OnInput (text) is sent when typing (after selecting a collider by clicking on it).<br>    OnTooltip (show) is sent when the mouse hovers over a collider for some time without moving.<br>    OnScroll (float delta) is sent out when the mouse scroll wheel is moved.<br>    OnKey (KeyCode key) is sent when keyboard or controller input is used.</p>
<p>那么知道了发送哪些事件，那么我们如何通过添加的控件去响应事件了？</p>
<ol>
<li>控件要处于Camera(含UICamera脚本)之下</li>
<li>Layer处于UICamera的Event Receiver Mask</li>
<li>接受事件的控件必须包含Collider</li>
<li><p>自定义响应方法</p>
<ol>
<li><p>定义对应事件响应的方法并挂载到需要响应的Game Object上</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnPress</span>(<span class="params"><span class="keyword">bool</span> isPressed</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"Exit button is pressed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">"Exit button is unpressed!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过UIListener，直接添加delegate去监听事件<br>首先现在需要实现delegate监听事件的控件上添加一个UIListener脚本(Component -&gt; NGUI -&gt; Internal -&gt; Event Listener)。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIListener Soure Code</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"><span class="comment">//            NGUI: Next-Gen UI kit</span></span><br><span class="line"><span class="comment">// Copyright © 2011-2013 Tasharen Entertainment</span></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Event Hook class lets you easily add remote event listener functions to an object.</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> Example usage: UIEventListener.Get(gameObject).onClick += MyClickFunction;</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"></span><br><span class="line">[AddComponentMenu(<span class="string">"NGUI/Internal/Event Listener"</span>)]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIEventListener</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">VoidDelegate</span> (<span class="params">GameObject go</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">BoolDelegate</span> (<span class="params">GameObject go, <span class="keyword">bool</span> state</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">FloatDelegate</span> (<span class="params">GameObject go, <span class="keyword">float</span> delta</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">VectorDelegate</span> (<span class="params">GameObject go, Vector2 delta</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">StringDelegate</span> (<span class="params">GameObject go, <span class="keyword">string</span> text</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">ObjectDelegate</span> (<span class="params">GameObject go, GameObject draggedObject</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">KeyCodeDelegate</span> (<span class="params">GameObject go, KeyCode key</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">object</span> parameter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> VoidDelegate onSubmit;</span><br><span class="line">    <span class="keyword">public</span> VoidDelegate onClick;</span><br><span class="line">    <span class="keyword">public</span> VoidDelegate onDoubleClick;</span><br><span class="line">    <span class="keyword">public</span> BoolDelegate onHover;</span><br><span class="line">    <span class="keyword">public</span> BoolDelegate onPress;</span><br><span class="line">    <span class="keyword">public</span> BoolDelegate onSelect;</span><br><span class="line">    <span class="keyword">public</span> FloatDelegate onScroll;</span><br><span class="line">    <span class="keyword">public</span> VectorDelegate onDrag;</span><br><span class="line">    <span class="keyword">public</span> ObjectDelegate onDrop;</span><br><span class="line">    <span class="keyword">public</span> StringDelegate onInput;</span><br><span class="line">    <span class="keyword">public</span> KeyCodeDelegate onKey;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnSubmit</span> (<span class="params"></span>)                </span>&#123; <span class="keyword">if</span> (onSubmit != <span class="keyword">null</span>) onSubmit(gameObject); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnClick</span> (<span class="params"></span>)                 </span>&#123; <span class="keyword">if</span> (onClick != <span class="keyword">null</span>) onClick(gameObject); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDoubleClick</span> (<span class="params"></span>)           </span>&#123; <span class="keyword">if</span> (onDoubleClick != <span class="keyword">null</span>) onDoubleClick(gameObject); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnHover</span> (<span class="params"><span class="keyword">bool</span> isOver</span>)      </span>&#123; <span class="keyword">if</span> (onHover != <span class="keyword">null</span>) onHover(gameObject, isOver); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnPress</span> (<span class="params"><span class="keyword">bool</span> isPressed</span>)   </span>&#123; <span class="keyword">if</span> (onPress != <span class="keyword">null</span>) onPress(gameObject, isPressed); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnSelect</span> (<span class="params"><span class="keyword">bool</span> selected</span>)   </span>&#123; <span class="keyword">if</span> (onSelect != <span class="keyword">null</span>) onSelect(gameObject, selected); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnScroll</span> (<span class="params"><span class="keyword">float</span> delta</span>)     </span>&#123; <span class="keyword">if</span> (onScroll != <span class="keyword">null</span>) onScroll(gameObject, delta); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDrag</span> (<span class="params">Vector2 delta</span>)     </span>&#123; <span class="keyword">if</span> (onDrag != <span class="keyword">null</span>) onDrag(gameObject, delta); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDrop</span> (<span class="params">GameObject go</span>)     </span>&#123; <span class="keyword">if</span> (onDrop != <span class="keyword">null</span>) onDrop(gameObject, go); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnInput</span> (<span class="params"><span class="keyword">string</span> text</span>)      </span>&#123; <span class="keyword">if</span> (onInput != <span class="keyword">null</span>) onInput(gameObject, text); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnKey</span> (<span class="params">KeyCode key</span>)        </span>&#123; <span class="keyword">if</span> (onKey != <span class="keyword">null</span>) onKey(gameObject, key); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> Get or add an event listener to the specified game object.</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">public</span> UIEventListener <span class="title">Get</span> (<span class="params">GameObject go</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        UIEventListener listener = go.GetComponent&lt;UIEventListener&gt;();</span><br><span class="line">        <span class="keyword">if</span> (listener == <span class="keyword">null</span>) listener = go.AddComponent&lt;UIEventListener&gt;();</span><br><span class="line">        <span class="keyword">return</span> listener;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<p>可以看出通过UIListener，该控件已经具备了响应UI Event的能力，而且每一个UI Event都定义了对应的delegate，这样一来我们就可以通过动态的添加修改每一个UI event的delegate实现控制UI Event响应了。<br>那么接下来我们只需在任何一个Game Object挂载下列代码就能响应特定控件的特定UI事件了。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RemoveExitButtonListener</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        GameObject exitbutton = GameObject.Find(<span class="string">"UI Root (2D)/Camera/Anchor/Panel/Exit"</span>);</span><br><span class="line">        <span class="comment">// 这里的回调方法要和delegate签名一致</span></span><br><span class="line">        UIEventListener.Get(exitbutton).onPress = RemoteExitButtonClick;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RemoteExitButtonClick</span>(<span class="params">GameObject go, <span class="keyword">bool</span> state</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"RemoteExitButtonClick button is pressed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"RemoteExitButtonClick button is unpressed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/UIEventCall.PNG" alt="UIEventCall"><br>同时NGUI还为Button控制添加了很多可自定义的脚本：</p>
<ol>
<li>UIButton — 自定义控件被点击或处于控件之上等颜色信息</li>
<li>UIButtonScale — 自定义焦点处于控件之上时的scale变换</li>
<li>UIButtonOffset — 自定义控件被点击后的位移</li>
<li>UIButtonSound — 自定义控件被点击时播放的声音</li>
<li>UIButtonMessage — 自定义控件触发事件</li>
<li>UIButtonTween — 自定义控件触发tween</li>
<li>UIButtonPlayAnimation — 自定义控件触发动画</li>
</ol>
<h5 id="Slider">Slider</h5><p>通过传递接受Slider Event的Game Object，我们可以去对应物体上定义OnSliderChange(float stepvalue)去响应slider事件，这样一来响应了Slider Event的物体就可以根据Slider的拖拽去做对应的事情了。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DisplayTextListener</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector3 m_OriginalPosition;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 这里获取的postion不是世界坐标系的，不知道为什么</span></span><br><span class="line">        m_OriginalPosition = transform.position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnSliderChange</span>(<span class="params"><span class="keyword">float</span> stepvalue</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Vector3 temp = m_OriginalPosition;</span><br><span class="line">        temp.y *= stepvalue;</span><br><span class="line">        transform.position = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Unity/OnSliderChangeBegin.PNG" alt="OnSliderChangeBegin"><br><img src="/img/Unity/OnSliderChangeEnd.PNG" alt="OnSliderChangeEnd"></p>
<h5 id="Checkbox">Checkbox</h5><p>通过把一组Checkbox放到同一个Game Object，然后设定所有UICheckbox的Radio Button Root到同一个Game Object可以实现一组单选按钮。<br>然后通过添加UICheckboxControlledComponent到Checkbox上，我们可以指定当该Checkbox激活或未激活时去enable的Game Object(做到根据Checkbox状态响应)。<br><img src="/img/Unity/CheckBoxWithWrongAnswer.PNG" alt="CheckBoxWithWrongAnswer"><br><img src="/img/Unity/CheckBoxWithCorrectAnswer.PNG" alt="CheckBoxWithCorrectAnswer"></p>
<h5 id="Input">Input</h5><p>Label要具有而输入的特性需要确保以下几点：</p>
<ol>
<li>父节点或自身包含Box Collider</li>
<li>父节点或自身包含UIInput Script(所有的Input相关的东西都抽象到这里了e.g. IME，键盘弹出，平台相关输入等)</li>
<li>指定需要增加Input功能的Laybel到UIInput的Laybel属性<br>Note：<br>两者必须都在同一个Game Object上才能起作用，因为UIInput要通过Box Collider去接收OnSelect等事件。</li>
</ol>
<p>NGUI为我们提供了方便的控件类，Input — 直接用于创建可接收输入的Laybel模板<br><img src="/img/Unity/InputUsing.PNG" alt="InputUsing"></p>
<h5 id="3D">3D</h5><p>将2D UI变换到3D UI很容易。<br>步骤如下：</p>
<ol>
<li>去掉Anchor，直接把panel挂载在UIRoot(2D)上<br>还记得最初创建NGUI UI的时候Anchor上面挂载的UIAnchor Script的作用吗？因为变换到3D后我们不需要在控制相对窗口的位置，所以不需要UIAnchor了。</li>
<li>设置Camera的投影方式到Perspective(为了3D显示)<br>就这么简单，通过这样设置后，UI就完全当做3D Game Object显示在scene里了。<br><img src="/img/Unity/3DUI.PNG" alt="3DUI"></li>
</ol>
<h5 id="Atlas_Maker">Atlas Maker</h5><p>声明：后续用到的UI素材来源于COC，仅用于学习目的。<br>首先要知道为什么要使用图集？<br>减少纹理的使用，比如当多个材质只是纹理不同的时候，我们可以合并纹理到一个大的纹理，给材质指定对应的UV坐标即可。另外合并多个小的纹理到大的纹理图集也可以减少Memory使用。详情见<a href="https://en.wikipedia.org/wiki/Texture_atlas" target="_blank" rel="external">Texture atlas</a>。<br>这一节讲一下图集的制作。</p>
<ol>
<li>准备好所有图片素材(可以通过PS等工具制作)</li>
<li>打开NGUI Atlas Maker<br>NGUI -&gt; Open the Altas Maker</li>
<li>设置一个Atlas名字，点击Create，选中要放到一张图集里的所有纹理图片，然后等Altas Maker切割完成后点击Add/Update All<br><img src="/img/Unity/AtlasMaker.PNG" alt="AtlasMaker"><br><img src="/img/Unity/UIAtlas.PNG" alt="UIAtlas"><br>Note:<br>NGUI也支持导入Texture Packer导出的文件<br>NGUI Atlas Maker支持多种图片格式(e.g. PNG, psd……)<br>一旦Sprite导入并生成UI Atlas后，我们可以直接在Atlas Maker里添加并更新该Atlas即可。</li>
</ol>
<h5 id="Font_Maker">Font Maker</h5><p>Font Maker里的字体是由什么制作而来的了？<br>“All fonts are created using the free BMFont program, or the more advanced Glyph Designer.”(NGUI使用的Font是由BMFont program或Glyph Designer制作的)</p>
<p>那么BMFont program又是什么了？<br><a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="external">This program will allow you to generate bitmap fonts from TrueType fonts. The application generates both image files and character descriptions that can be read by a game for easy rendering of fonts.</a>BMFont program通过TrueType fonts生成bitmap fonts(一个是Font的image file文件，一个是描述了每一个字符渲染所需的信息文件))</p>
<p>那么这里提到了两个概念：</p>
<ol>
<li><p>TrueType Font<br><a href="https://en.wikipedia.org/wiki/TrueType" target="_blank" rel="external">TrueType is an outline font</a><br><a href="https://en.wikipedia.org/wiki/Computer_font#OUTLINE" target="_blank" rel="external">Outline fonts (also called vector fonts) use Bézier curves, drawing instructions and mathematical formulae to describe each glyph, which make the character outlines scalable to any size.</a><br>可以看出TrueType是outline font，outline font是一种vector font(可以理解成矢量字体，放大缩小不会出现锯齿和模糊。之所以称作vector font是因为TrueType记录每一个字符的轮廓信息，通过这些信息可以计算出如何绘制字符)<br>以下引用至<a href="http://computer.howstuffworks.com/question460.htm" target="_blank" rel="external">What are TrueType fonts?</a><br>TrueType technology actually involves two parts:<br>The TrueType Rasterizer<br>TrueType fonts — “The fonts themselves contain data that describes the outline of each character in the typeface. “</p>
</li>
<li><p>Bitmap Font<br><a href="https://en.wikipedia.org/wiki/Computer_font#OUTLINE" target="_blank" rel="external">Bitmap fonts consist of a matrix of dots or pixels representing the image of each glyph in each face and size.</a><br>可以看出Bitmap Font是记录的每一个字符的像素和位置等信息。<br>以下引用至<a href="https://71squared.com/blog/what-is-a-bitmap-font" target="_blank" rel="external">What is a Bitmap Font?</a><br>A bitmap font is essentially an image file containing a bunch of characters and a control file detailing the size and location of each character within the image. Each character is represented by a number of dots or pixels, rendered in a particular font and size.<br>可以看出Bitmap Font包含两部分：</p>
</li>
<li>Image file — 包含了所有文字的纹理图片</li>
<li>Control file — 包含了字体大小，每一个字符所在位置等信息<br>Bitmap Font因为不是outline font(vector font)，所以在字体拉伸变换的时候会出现失真的情况。<br>既然这样我们为什么还要使用Bitmap Font了？<br><a href="https://71squared.com/blog/what-is-a-bitmap-font" target="_blank" rel="external">OpenGL itself doesn’t even understand fonts(e.g. vector font), so in order to display text in your game you would need to use whats known as a bitmap font.</a><br>当计算去利用vector font渲染字体的时候，不会失真。但是在游戏里，如果我们还想对vector font做进一步的处理就显得心有余而力不足了。<br><a href="https://71squared.com/blog/what-is-a-bitmap-font" target="_blank" rel="external">The major benefit of using bitmap fonts is that each character can be pre-rendered using multiple effects, loaded into OpenGL as a texture, and rendered to the screen using very little resources.</a><br>但Bitmap Font不一样，Bitmap Font存储的就是字体的纹理图片，纹理图片在OpenGL里做额外的效果处理就容易的多了。</li>
</ol>
<p>说了这么多让我们看看BMFon program是如何制作Bitmap Font的？</p>
<ol>
<li>下载BitMap Font Program<br><a href="http://www.angelcode.com/products/bmfont/" target="_blank" rel="external">Bitmap Font Program Download Link</a></li>
<li>通过Font Settings我可以选择我们要导入的ttf字库，是否采用unicode编码等。</li>
<li>然后选中我们要导出的字符集(这里主要选择了英文和中文字符集)<br><img src="/img/Unity/BMFontMakerFontSetting.PNG" alt="BMFontMakerFontSetting"></li>
<li>设置export option，为导出的文件设置相关配置<br><img src="/img/Unity/BMFontExportOptions.PNG" alt="BMFontExportOptions"><br>Note：<br><a href="http://www.angelcode.com/products/bmfont/doc/export_options.html" target="_blank" rel="external">If you’re importing colored icons, or planning on using post processing to add colors to the characters, then you’ll want to choose the 32bit format, otherwise the 8bit format may be sufficient.</a><br>官网提到如果要后期再对字符做颜色等处理，需要选择32bit的存储模式(应该是为了能存储颜色信息)<br>同时File Format会决定我们导出的字符集纹理图片和Font descriptor的格式。<br>为了将字符都导出到一张纹理图片我们需要定义合适的Texture Size。</li>
<li>最后点击存储为Bitmap导出字符集(Option -&gt; Save Bitmap Font As)<br>这里就会生成对应的字符集纹理图片和Font Descriptor文件。<br><img src="/img/Unity/MyAtlasFont.PNG" alt="MyAtlasFont"><br>Note:<br>但我发现由于包含了大量中文字符，字符纹理比较大，包括中文和英文就有10M了，如果文字比较多比如做本地化，静态字体(我们这里提前生成字符集纹理就是静态字体)不适合。</li>
</ol>
<p>NGUI支持动态字体的生成：<br>让我们先看看什么是动态字体？<br>“When you set the Characters drop-down in the Import Settings to Dynamic, Unity will not pre-generate a texture with all font characters. Instead, it will use the FreeType font rendering engine to create the texture on the fly.”(<a href="https://docs.unity3d.com/Manual/class-Font.html" target="_blank" rel="external">https://docs.unity3d.com/Manual/class-Font.html</a>)<br>可以看出动态字体不需提前生成字符集纹理，而是通过导入的ttf动态的在游戏里生成对应字体纹理。这样做的好处就是减少了像静态字体这样的纹理内存开销，我们只需指定使用哪些ttf并确保用户包含了该ttf就能正确显示所有语言。<br>个人认为动态字体是本地化的一个解决方案。<br>动态字体直接从ttf文件生成。<br><img src="/img/Unity/DynamicFont.PNG" alt="DynamicFont"><br>Note:<br>值得注意的是动态字体下写的那个警告”Please note that dynamic fonts can’t be made a part of an atlas, and they will always be draw in a speparate draw call. You will need to adjust transform position’s Z rather than depth.”<br>使用动态字体后会增加一个draw call，而且动态字体的深度不再是有depth来控制而是z值。</p>
<p>Bitmap Font制作好了，那么接下来我就应该用制作好的Bitmap Font去通过Font Maker制作我们的字符集(Atlas)了。</p>
<ol>
<li>打开Font Maker</li>
<li>选定我们刚才制作的Font Texture和Font Descriptor作为输入，指定生成的字符集名字</li>
<li>点击创建<br><img src="/img/Unity/FontMakerProcess.PNG" alt="FontMakerProcess"></li>
</ol>
<p>这里看一下用自己制作的字体集和UI图片集做的登陆界面：<br><img src="/img/Unity/LoginScene.PNG" alt="LoginScene"></p>
<h5 id="NGUI_2-7屏幕自适应">NGUI 2.7屏幕自适应</h5><p>下文主要参考：<br><a href="http://dsqiu.iteye.com/blog/1964679" target="_blank" rel="external">NGUI所见即所得之UIRoot</a><br><a href="http://www.cnblogs.com/cqgreen/p/3348154.html" target="_blank" rel="external">Unity3d + NGUI 的多分辨率适配</a><br><a href="http://blog.csdn.net/onerain88/article/details/11713299" target="_blank" rel="external">Unity3D开发（一）：NGUI之UIRoot屏幕分辨率自适应 </a><br><a href="http://www.xuanyusong.com/archives/2536" target="_blank" rel="external">NGUI研究院之自适应屏幕（十）</a><br><a href="http://www.cnblogs.com/cqgreen/p/3348154.html" target="_blank" rel="external">Unity3d + NGUI 的多分辨率适配</a><br>屏幕自适应是UI在所难免会遇到的问题。<br>那么为什么需要做屏幕自适应了？<br>美术在做UI的时候，程序需要确定我们资源的最基本的分辨率，比如我们是基于1024 <em> 768（1.3333比例）。<br>在屏幕分辨率为1024 </em> 768(1.333比例)的时候完美显示如下：<br><img src="/img/Unity/1024Multiple768.PNG" alt="1024Multiple768"><br>当我们把屏幕分辨率设置成800 <em> 800(1.0比例)的时候显示如下：<br><img src="/img/Unity/800Multiple800.PNG" alt="800Multiple800"><br>当我们把屏幕分辨率设置成960 </em> 640(1.5比例)的时候显示如下：<br><img src="/img/Unity/960Multiple640.PNG" alt="960Multiple640"><br>Note:<br>UIRoot的Manual Height设置为768，Scaling Stype为FixedSize(后续会讲到UIRoot的缩放自适应原理)<br>从上面可以看出当分辨率比例降低的时候，会出现图像显示不全，这是因为NGUI是基于高度去缩放的。(后续会详细讲解)<br>所以当比例从1.33变到1.0的时候，768/800=0.96的缩放比例，宽度应该是1024/0.96=1066.66大于800这也就是为什么会出现图像显示不全的原因了。<br>再来看看从1.33变到1.5的时候，同理768/640=1.2缩放比例，宽度应该是1024/1.2=853.33小于960这也就是为什么会出现宽度铺不满的情况。<br>所以在这个时候为了不去做多套不同分辨率的资源去适应各种分辨率的机型，我们需要使用NGUII里的自适应。<br>当下移动设备的主流分辨率，数据来源<a href="http://djt.qq.com/article/view/399" target="_blank" rel="external">腾讯分析移动设备屏幕分辨率分析报告</a>：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">iOS设备的分辨率主要有：</span><br><span class="line">宽　  高   宽高比</span><br><span class="line"><span class="number">960</span>     <span class="number">640</span>     <span class="number">1.5</span></span><br><span class="line"><span class="number">1136</span>    <span class="number">640</span>     <span class="number">1.775</span></span><br><span class="line"><span class="number">1024</span>    <span class="number">768</span>     <span class="number">1.3333</span></span><br><span class="line"><span class="number">2048</span>    <span class="number">1536</span>    <span class="number">1.3333</span></span><br><span class="line"> </span><br><span class="line">Android设备的分辨率则相对纷杂，主流的分辨率有：</span><br><span class="line">宽   高   宽高比</span><br><span class="line"><span class="number">800</span>     <span class="number">480</span>     <span class="number">1.6667</span></span><br><span class="line"><span class="number">854</span>     <span class="number">480</span>     <span class="number">1.7792</span></span><br><span class="line"><span class="number">1280</span>    <span class="number">720</span>     <span class="number">1.7778</span></span><br><span class="line"><span class="number">960</span>     <span class="number">540</span>     <span class="number">1.7778</span></span><br><span class="line"><span class="number">1280</span>    <span class="number">800</span>     <span class="number">1.6</span></span><br><span class="line"><span class="number">960</span>     <span class="number">640</span>     <span class="number">1.5</span></span><br><span class="line"><span class="number">1184</span>    <span class="number">720</span>     <span class="number">1.6444</span></span><br><span class="line"><span class="number">1920</span>    <span class="number">1080</span>    <span class="number">1.7778</span></span><br></pre></td></tr></table></figure></p>
<p>那么让我们进入正题，NGUI是如何实现屏幕自适应的了？<br>这里有三个最重要的脚本需要学习：</p>
<ol>
<li>UIRoot</li>
<li>UIStretch</li>
<li>Anchor<br>让我们先来看看UIRoot的界面：<br><img src="/img/Unity/UIRootPanel.PNG" alt="UIRootPanel"><br>还记得之前提到UIRoot的功能吗？<br><a href="http://www.tasharen.com/?page_id=185" target="_blank" rel="external">This script rescales the object it’s on to be 2/ScreenHeight in size, letting you specify widget coordinates in pixels and still have them be relatively small when compared to the rest of your game world.</a><br>可以看出UIRoot通过scale UIRoot到2/ScreenHeight比例后，使得所有控件的坐标与像素一一对应。那么为什么这样能实现控件坐标与像素一一对应了？这个问题后面会讲到。<br>让我们先分别看看具体参数的含义:<br>Scaling Style<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Scaling</span><br><span class="line">&#123;</span><br><span class="line">    PixelPerfect,</span><br><span class="line">    FixedSize,</span><br><span class="line">    FixedSizeOnMobiles,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>而已看出NGUI 2.7给我们提供了3种scale方式。<br>那么三种方式是如何起作用的了？<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> activeHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> height = Mathf.Max(<span class="number">2</span>, Screen.height);</span><br><span class="line">        <span class="keyword">if</span> (scalingStyle == Scaling.FixedSize) <span class="keyword">return</span> manualHeight;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> UNITY_IPHONE || UNITY_ANDROID</span></span><br><span class="line">        <span class="keyword">if</span> (scalingStyle == Scaling.FixedSizeOnMobiles)</span><br><span class="line">            <span class="keyword">return</span> manualHeight;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">if</span> (height &lt; minimumHeight) <span class="keyword">return</span> minimumHeight;</span><br><span class="line">        <span class="keyword">if</span> (height &gt; maximumHeight) <span class="keyword">return</span> maximumHeight;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mTrans != <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">float</span> calcActiveHeight = activeHeight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (calcActiveHeight &gt; <span class="number">0</span>f )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">float</span> size = <span class="number">2</span>f / calcActiveHeight;</span><br><span class="line">            </span><br><span class="line">            Vector3 ls = mTrans.localScale;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!(Mathf.Abs(ls.x - size) &lt;= <span class="keyword">float</span>.Epsilon) ||</span><br><span class="line">                !(Mathf.Abs(ls.y - size) &lt;= <span class="keyword">float</span>.Epsilon) ||</span><br><span class="line">                !(Mathf.Abs(ls.z - size) &lt;= <span class="keyword">float</span>.Epsilon))</span><br><span class="line">            &#123;</span><br><span class="line">                mTrans.localScale = <span class="keyword">new</span> Vector3(size, size, size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面可以看出PixelPerfect，FixedSize(FixedSizeOnMobile是移动平台的FixedSize设置)主要是缩放标准的选取。<br>当设置为PixelPerfect的时候会根据ScreenHeight与minmumHeight和maxmumHeight的比较来决定是以ScreenHeight为基准按2/ScreenHeight比例缩放还是2/minmumHeight or 2/maxmumHeight为比例缩放。<br>当设置FixedSize的时候只根据我们设定的manualHeight作为参考标准去缩放UIRoot，缩放比例为2/manualHeight。<br>根据缩放标准的选取去设定UIRoot localScale的值以实现UI缩放。<br>那么这里就有个疑问，为什么是2/manualHeight而不是1/manualHeight了？<br>要明白2这个常数的含义，我们先要看看Camera设定为Orthographic类型中的Orthographic Size的含义。<br><a href="https://docs.unity3d.com/ScriptReference/Camera-orthographicSize.html" target="_blank" rel="external">Camera’s half-size when in orthographic mode. This is half of the vertical size of the viewing volume. Horizontal viewing size varies depending on viewport’s aspect ratio. Orthographic size is ignored when camera is not orthographic (see orthographic). See Also: camera component.</a><br>可以看出Orthographic Size是指摄像机所观察垂直区域的一半。(前提是设置了orthographic camera)。如果Size设置为1，那么Camera所看到的高度为2 Unit。摄像机所看到的垂直区域一半也就是屏幕高度的一半,Orthographic Size所指示的1个Unit的高度为Screen.Height/2。(结合Orthographic Size和Pixel Per Unit设置，我们可以实现Sprite的Pixels Perfect显示)<br><a href="http://dsqiu.iteye.com/blog/1964679" target="_blank" rel="external">如果屏幕高度为1000个像素，Size设置的值为1表示1000/2=500个像素。所以，我们通过整个关系计算UIRoot下的GameObject的实际对应屏幕的高度：从GameObject向上一直到UIRoot，将它们的loaclScal相乘得到的乘积除以Size乘以屏幕高度的一半，即（localScale<em>….localScale)/Size</em>Screen.height/2。</a><br>如果屏幕分辨率为1024 <em> 768，那么如果我们把Size设置为1，那么1 Unit就对应屏幕分辩率高度的一半即384，也就是说UIRoot下Gameobject实际对应屏幕的高度应该按照384来计算即Screen.height/2来计算，因为Size的大小会使物体所占比例成倍缩小，所以我们还需要除以Size。<br>最终得出UIRoot下GameObject的实际对应屏幕的高度计算如下：<br>(localScale </em>…….<em>localScale)</em>Screen.height/2/Size<br>(这也就是为什么UIRoot缩放比例是2/manuaHeight里常数为2的原因，这样一来localScale的值就和屏幕所占比例一一对应了(前提是Size为1))<br><a href="http://dsqiu.iteye.com/blog/1964679" target="_blank" rel="external">这可以解释UIRoot的localStyle为啥都是很小的小数，因为这样可以保证UIRoot的子节点都可以以原来的大小作为localScale，比如一张图片是20*20的，我们可以直接设置localScale为（20,20,1）不用进行换算，直观方便。（NGUI3.0（or 2.7)以后的版本已经不再使用localScale来表示UISprite ，UILable（UIWidget的子类）的大小了，而是在UIWidget的width和height来设置，这样做的好处就是一个gameObject节点可以挂多个UISprite或UILabel了，而不会受localScale的冲突影响    2013/11/16增补）。</a><br>这样一来控件坐标与像素一一对应了。这也就是为什么在缩放UIRoot的时候采用2f / calcActiveHeight的原因。<br>那么如何让我们的制作的Sprite的像素完美一一对应显示在屏幕上了？<br>我们知道了屏幕分辨率为1024*768且Orthographic Size设置为1时，1个Unit对应的高度是384，那么也就是说要想让Sprite像素完美一一对应屏幕显示，我们要确保Sprite的Pixel Per Unit设定为Screen.height/2/Size。<br>之前提到当我们的常数是2来除以Screen.height的时候需要把Camera的Orthographic Size设置成1才能实现控件坐标与像素的一一对应，让我们看看UIRoot的源码：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>)  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    UIOrthoCamera oc = GetComponentInChildren&lt;UIOrthoCamera&gt;();  </span><br><span class="line">    <span class="keyword">if</span> (oc != <span class="keyword">null</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">        Debug.LogWarning(<span class="string">"UIRoot should not be active at the same time as UIOrthoCamera. Disabling UIOrthoCamera."</span>, oc);  </span><br><span class="line">        Camera cam = oc.gameObject.GetComponent&lt;Camera&gt;();  </span><br><span class="line">        oc.enabled = <span class="keyword">false</span>;  </span><br><span class="line">        <span class="keyword">if</span> (cam != <span class="keyword">null</span>) cam.orthographicSize = <span class="number">1</span>f;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">else</span> <span class="title">Update</span>(<span class="params"></span>)</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>看得出NGUI并没有为我们强制设置为1，只是警告我们不能把UIRoot和UIOrthoCamera一起使用，如果使用了会自动剔除UIOrthoCamera，并设置orthographicSize为1。我们可以去设置orthographicSize实现不同的效果。<br>了解了UIRoot的实现，那么回到我们原始的话题，如何通过UIRoot实现屏幕自适应了？<br>当屏幕分辨率变化的时候UIRoot下的UI会出现显示不全或者两边有黑边的问题，因为FixedSize结合Manual Height而已控制UIRoot的按比例缩放，所以我们只需把两边未能显示全的UI以宽为基准按比例缩放即可(通过动态计算Manual Height的值)。<br><a href="http://www.ceeger.com/forum/read.php?tid=9230&amp;ds=1" target="_blank" rel="external">UIRoot分辨率自适应代码</a><br>ManualWidth和ManualHeight是我们最初美术设计所针对的分辨率，修改到对应的即可。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIRootExtend</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ManualWidth = <span class="number">640</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ManualHeight = <span class="number">960</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> UIRoot _UIRoot;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        _UIRoot = <span class="keyword">this</span>.GetComponent&lt;UIRoot&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (System.Convert.ToSingle(Screen.height) / Screen.width &gt; System.Convert.ToSingle(ManualHeight) / ManualWidth)</span><br><span class="line">            _UIRoot.manualHeight = Mathf.RoundToInt(System.Convert.ToSingle(ManualWidth) / Screen.width * Screen.height);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            _UIRoot.manualHeight = ManualHeight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>自适应后在屏幕分辨率为1024<em>768(1.333比例)的时候完美显示如下：<br><img src="/img/Unity/1024Multiple768SelfAdaption.PNG" alt="1024Multiple768SelfAdaption"><br>自适应后在屏幕分辨率为800</em>800(1.0比例)的时候显示如下：<br><img src="/img/Unity/800Multiple800SelfAdaption.PNG" alt="800Multiple800SelfAdaption"><br>自适应后在屏幕分辨率设置为960*640(1.5比例)的时候显示如下：<br><img src="/img/Unity/960Multiple640SelfAdaption.PNG" alt="960Multiple640SelfAdaption"><br>这样一来就实现了保持比例自适应。因为UIRoot是基于高度来缩放的，所以在低分辨率变到高分辨率的时候会出现左右黑边，这在横版游戏里是肯定不行的，所以我们需要做到以宽为基准的自适应。<br>那么基于宽度缩放的代码如下：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> activeHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> height = Mathf.Max(<span class="number">2</span>, Screen.height);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Base on width instead of height</span></span><br><span class="line">        manualHeight = Screen.height * UIRootExtend.ManualWidth / Screen.width;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (scalingStyle == Scaling.FixedSize) <span class="keyword">return</span> manualHeight;</span><br><span class="line"></span><br><span class="line">        <span class="preprocessor">#<span class="keyword">if</span> UNITY_IPHONE || UNITY_ANDROID</span></span><br><span class="line">        <span class="keyword">if</span> (scalingStyle == Scaling.FixedSizeOnMobiles)</span><br><span class="line">            <span class="keyword">return</span> manualHeight;</span><br><span class="line">        <span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="keyword">if</span> (height &lt; minimumHeight) <span class="keyword">return</span> minimumHeight;</span><br><span class="line">        <span class="keyword">if</span> (height &gt; maximumHeight) <span class="keyword">return</span> maximumHeight;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但上述在低分辨率变到高分辨率的时候会因为以宽为基准导致高度的自适应超出范围，见下图：<br><img src="/img/Unity/960Multiple640BaseOnWidth.PNG" alt="960Multiple640BaseOnWidth"><br>这种情况只能通过拉伸背景来铺满屏幕，但会失去原始比例(UIStretch可以实现基于屏幕或容器的自适应，不建议使用，后续NGUI都放弃了)。<br>我们肯定不希望我们的主要的UI都被拉伸变形，所以这里需要提到的是UIAnchor，<br>让我们在回忆下UIAnchor的作用：<br>“apply a half-pixel offset on Windows machines, for pixel-perfect results.”(把UI限定在窗口特定位置，当窗口变化的时候会依然处于相对窗口的位置)<br>待续……</p>
<p>关于UI制作尺寸的选择以及UI自适应相关设置：<br>前面的学习结合<a href="">Unity Unit Pixel Per Unit</a>的学习，可以看出，UI自适应和Pixel显示我們需要考虑的点有以下几个:<br>UI需要考虑的点：</p>
<ol>
<li>Canvas Render Mode(Canvas) — Screen Space Camera(一般来说不是作为3D UI摄像机的话，都会选择Screen Space Camera去自己指定一個UI Camera)</li>
<li>UI Scale Mode(Canvas Scaler) — Scale With Screen Size(一般来说为了根据不同设备分辨率进行自适应，我們都会选择这种模式(跟物理size无关))</li>
<li>Project(Camera) — 不是用于3D UI的话，一般来说UI Camera都是设置成Orthographic(正交投影)</li>
<li>Screen Match Mode(Canvas Scaler) — 一般都选择Match Width Or Height指定是以宽为主还是以高为主(影响最终黑边情况 — 是上下黑边还是左右黑边)</li>
<li>Reference Size(Canvas Scaler) — 影响不同机器上的自适应情况(分辨率降低或者升高会影响自适应结果 — 比如居中满屏显示的UI，以高分辨Reference Size在低分辨率Screen Size上以高度自适应会导致左右两侧的UI超出显示范围)(主流手机分辨率比例都在1.333 - 1.778，大部分是1.778)</li>
<li>UI Anchors — 主要影響UI的自適應佈局方式(是自适应缩放还是相对位置)</li>
</ol>
<p>Note:<br>横版2D和竖版2D游戏选择时，主要要考虑Screen Match Mode和Reference Size的选择，因为前者是不允许左右黑边，后者是不允许上下黑边的，两者同时也不允许超出的情况，所以个人认为横版2D应该选择Match Width Or Height值为0(以宽为主不让左右有黑边)，同时Reference Size选择高分辨率，在低分辨率机器上显示时不至于超出高度(只是上下有黑边，这个问题可以通过用背景结合UI Anchors自适应的方式避免)。普通的2D UI，我们最主要要考虑的是Refrence Size的选择(选择高分辨率Reference Size和以宽度为基准自适应，然后结合UI Anchor<br>s布局和拉升背景即可)，这样居中的物体不会被切割显示不全，在低分辨率Screen Size上只是显示高度缩小而已，UI Anchor靠边布局的UI依然正常显示。</p>
<p>Pixel Perfect显示考虑的点：</p>
<ol>
<li>Reference Size(Canvas Scaler) — 我们作为基准计算PPU的分辨率</li>
<li>Orthographic Size(Camera) — 参与Pixel Perfect显示计算，同时把屏幕划分成Orthographci Size * 2个高Unit</li>
<li>Reference Pixels Per Unit(Canvas Scaler) — 参与SpriteRectSize显示计算的参数(SpriteRectSize = SpriteSize * SpritePPU / CanvaReferencePPU)，一般设置跟Sprite PPU一样保证Sprite按原始大小显示即可</li>
<li>Pixels Per Unit(Asset) — Asset相对一个屏幕Unit显示的Pixels，用于确保Asset Pixel Perfect显示</li>
</ol>
<p>Pixel Perfect显示公式：<br>Orthographic Size = Screen.height / 2 / PPU;<br>从前面的学习我们知道了，要想Pixel Perfect显示，除了动态修正Orthographic Size以外就是针对不同分辨率机器做多套PPU的资源去使用。<br>如果想Pixel Perfect显示，那么UI尺寸的选择就要参考计算出的PPU来设计。</p>
<h3 id="DOTween">DOTween</h3><h4 id="DOTween_Instroduction">DOTween Instroduction</h4><p><a href="http://dotween.demigiant.com/" target="_blank" rel="external">DOTween is a fast, efficient, fully type-safe object-oriented animation engine for Unity, optimized for C# users, free and open-source, with tons of advanced features</a></p>
<p>简单看一下官网提到的Features(这里只Copy一部分)：<br>Speed and efficiency:<br>    Not only very fast, but also very efficient: everything is cached and reused to avoid useless GC allocations.<br>Shortcuts:<br>    Shortcut extensions that directly extend common objects<br>Extremely accurate:<br>    Time is calculated in a very precise way. This means that 1000 loops of 1 second each will play exactly as long as a single loop of 1000 seconds.<br>Animate everything (almost)<br>    DOTween can animate every numeric value and also some non-numeric ones. It can even animate strings, with support for rich-text.<br>Full control<br>    Play, Pause, Rewind, Restart, Complete, Goto and tons of other useful methods to control your tweens.<br>Grouping<br>    Combine tweens into Sequences to create complex animations (which don’t need to be in a, uh, sequence: they can also overlap each other).<br>Blendable tweens<br>    Some tweens can blend between each other in realtime, thanks to powerful DOBlendable shortcuts.<br>Paths<br>    Animate stuff along both linear and curved paths, with additional options for the orientation of your traveling agents.<br>Change values and duration while playing<br>    Change a tween’s start/end values or duration at any moment, even while playing.<br>Yield for coroutines<br>    Various “WaitFor…” methods to use inside coroutines, that allow you to wait for a tween to be completed, killed, started, or for it to reach a given position or loops.<br>Plugins<br>    DOTween is built with an extensible architecture in mind, which allows you to create your own tween plugins as separate files.<br>Extras<br>    Extra virtual methods to do stuff like calling a function after a given delay.<br>…….<br>总的来说DOTween可以满足我们做动画的任何要求且高效快速方便使用。</p>
<h4 id="DOTween_Install">DOTween Install</h4><p>看得出DOTween的定位是一个动画引擎。<br>首先是<a href="http://dotween.demigiant.com/download.php#download" target="_blank" rel="external">DOTween下载</a><br>其次是DOTween加入到我们的工程项目里(Assets下)，然后DOTween被自动加载。<br>DOTween加载进来后会弹出设置界面：<br><img src="/img/Unity/DOTweenSetting.PNG" alt="DOTweenSetting"><br>点击Setup DOTween进行设置，设置DOTween好使DOTween根据我们的Unity版本去导入一些特定库。<br>接下来我们就可以使用DOTween里的库函数做动画了。</p>
<h4 id="DOTween_Nomenclature_and_Prefixes">DOTween Nomenclature and Prefixes</h4><p>深入学习DOTween之前，让我们先了解下DOTween里的命名方式和一些关键术语：<br>以下学习源于<a href="http://dotween.demigiant.com/documentation.php#globalSettings" target="_blank" rel="external">DOTween官网</a><br><strong>Nomenclature</strong>:<br><em>Tweener</em> — A tween that takes control of a value and animates it.(Tweener是控制动画细节参数和播放的)<br><em>Sequence</em> — A special tween that, instead of taking control of a value, takes control of other tweens and animates them as a group.(Sequence可以理解成负责对tweens进行动画而非对属性比如position做动画)<br><em>Tween</em> — A generic word that indicates both a Tweener and a Sequence.<br><em>Nested tween</em> — A tween contained inside a Sequence.</p>
<p><strong>Prefixes</strong>:<br><em>DO</em> — Prefix for all tween shortcuts (operations that can be started directly from a known object, like a transform or a material). Also the prefix of the main DOTween class.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">transform.DOMoveX(<span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line">transform.DORestart();</span><br><span class="line">DOTween.Play();</span><br></pre></td></tr></table></figure></p>
<p><em>Set</em> — Prefix for all settings that can be chained to a tween (except for From, since it’s applied as a setting but is not really a setting).(tween的setting函数)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myTween.SetLoops(<span class="number">4</span>, LoopType.Yoyo).SetSpeedBased();</span><br></pre></td></tr></table></figure></p>
<p><em>On</em> — Prefix for all callbacks that can be chained to a tween.(tween的一些回调设定函数)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myTween.OnStart(myStartFunction).OnComplete(myCompleteFunction);</span><br></pre></td></tr></table></figure></p>
<h4 id="DOTween使用学习">DOTween使用学习</h4><p>在使用DOTween之前，我们需要在项目添加命名空间并对DOTween的初始化(初始化这一步不是必须的，不手动初始化也会自动初始化，官网推荐手动初始化设定)：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> DG.Tweening;</span><br><span class="line"></span><br><span class="line">DOTween.Init();</span><br></pre></td></tr></table></figure></p>
<p>让我们来看看DOTween里的函数定义：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Tweener <span class="title">DOMove</span>(<span class="params"><span class="keyword">this</span> Transform target, Vector3 endValue, <span class="keyword">float</span> duration, <span class="keyword">bool</span> snapping = <span class="keyword">false</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sequence <span class="title">DOJump</span>(<span class="params"><span class="keyword">this</span> Transform target, Vector3 endValue, <span class="keyword">float</span> jumpPower, <span class="keyword">int</span> numJumps, <span class="keyword">float</span> duration, <span class="keyword">bool</span> snapping = <span class="keyword">false</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">DOKill</span>(<span class="params"><span class="keyword">this</span> Component target, <span class="keyword">bool</span> complete = <span class="keyword">false</span></span>)</span>;</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>可以看出DOTween里面的大量方法都是通过C#里extend method的方式添加进去的。<br>所以我们要使用特定DOTween方法，我只需要在对应类的实例调用扩展方法即可。<br>接下来看看我们如何创建自定义的Tween。<br>有三中方式可供选择：</p>
<ol>
<li><p>The generic way<br> DOTween.TO(getter, setter, to float duration)<br> Changes the given property from its current value to the given one.<br> getter A delegate that returns the value of the property to tween. Can be written as a lambda like this: ()=&gt; myValue<br> where myValue is the name of the property to tween.<br> setter A delegate that sets the value of the property to tween. Can be written as a lambda like this: x=&gt; myValue = x<br> where myValue is the name of the property to tween.<br> to The end value to reach.<br> duration The duration of the tween. </p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tween a Vector3 called myVector to 3,4,8 in 1 second</span></span><br><span class="line">DOTween.To(()=&gt; myVector, x=&gt; myVector = x, <span class="keyword">new</span> Vector3(<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>), <span class="number">1</span>);</span><br><span class="line"><span class="comment">// Tween a float called myFloat to 52 in 1 second</span></span><br><span class="line">DOTween.To(()=&gt; myFloat, x=&gt; myFloat = x, <span class="number">52</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>The shortcuts way(Extension method)</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>), <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p> 在shortcuts方法后面调用From()的话，就会初始位置当做dest，把dest当做初始绘制来做动画。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform.DOMove(<span class="keyword">new</span> Vector3(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>), <span class="number">1</span>).From();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Additional generic ways<br>这种没太看明白</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> DOTween.Punch(getter, setter, Vector3 direction, <span class="keyword">float</span> duration, <span class="keyword">int</span> vibrato, <span class="keyword">float</span> elasticity)</span><br><span class="line"><span class="keyword">static</span> DOTween.Shake(getter, setter, <span class="keyword">float</span> duration, <span class="keyword">float</span>/Vector3 strength, <span class="keyword">int</span> vibrato, <span class="keyword">float</span> randomness, <span class="keyword">bool</span> ignoreZAxis)</span><br><span class="line"><span class="keyword">static</span> DOTween.ToAlpha(getter, setter, <span class="keyword">float</span> to, <span class="keyword">float</span> duration)</span><br><span class="line"><span class="keyword">static</span> DOTween.ToArray(getter, setter, <span class="keyword">float</span> to, <span class="keyword">float</span> duration)</span><br><span class="line"><span class="keyword">static</span> DOTween.ToAxis(getter, setter, <span class="keyword">float</span> to, <span class="keyword">float</span> duration, AxisConstraint axis)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>貌似是会对Tween做特殊的限制，比如DOTween.Shake延axis轴变化vector3。</p>
<p>接下来让我们看看如何使用Sequence：<br>The sequenced tweens don’t have to be one after each other. You can overlap tweens with the Insert method.(sequence可包含其他sequence，可以通过Insert把tween插入到特定时间执行)<br>A tween (Sequence or Tweener) can be nested only inside a single other Sequence, meaning you can’t reuse the same tween in multiple Sequences. (同一个tween不能被多个sequence使用)<br>创建一个Sequence:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOTween.Sequence();</span><br></pre></td></tr></table></figure></p>
<p>我们可以通过添加tweens，callback到sequence里去做一些特别的动画。<br>Note:<br>“ all these methods need to be applied before the Sequence starts (usually the next frame after you create it, unless it’s paused), or they won’t have any effect.”(添加tweens，callback这些都必须在Sequence开始之前，可以理解为同一帧里)</p>
<p>接下来我们看看Tween的一些设置：<br>这些设置分为针对全局，tweens，sequence，tweener设置。<br>举个简单的例子，比如我们在初始化DOTween的时候设置了tween在同一时刻激活的最大数量。我超过这个数量后想要修改，我们可以通过:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOTween.SetTweensCapacity(***);</span><br></pre></td></tr></table></figure></p>
<p>上述这个方法就是针对全局设置的</p>
<p>接下来我们看看如何动态的控制tween动画的：<br>有三种方式：</p>
<ol>
<li><p>Via Static methods and filters<br>DOTween class给我们提供了大量的静态方法去控制tween动画。<br>比如我们想暂停某个tween动画或暂停所有tween：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DOTween.Pause(tweenname);</span><br><span class="line">DOTween.PauseAll();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Directly from the tween<br>我们也可以通过保存的tween动画引用去调用控制相关的动画</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myTween.Pause();</span><br></pre></td></tr></table></figure>
</li>
<li><p>From a shortcut-enhanced reference<br>直接通过扩展方法去停止对应的物体上的tween(这里要注意的是，所有控制tween的扩展方法都带DO前缀)</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transfrom.DOPause();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Note:<br>“IMPORTANT: remember that to use these methods on a tween after it has ended, you have to disable its autoKill behaviour, otherwise a tween is automatically killed at completion.”(对tween设置的时候一定要disable automatically kill，否则在tween完成的时候tween会被销毁)<br>同时DOTween还给我们提供了很多静态方法去获取tween的信息(比如Delay(),Duration()等)</p>
<p>Tween结合Coroutines的使用：<br>Tween提供了一些YieldInstructions的方法，可以让我们结合Coroutines去方便快速的实现一些对调用时机有讲究的动画:<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要等到tween结束</span></span><br><span class="line"><span class="function">IEnumerator <span class="title">SomeCoroutine</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    Tween myTween = transform.DOMoveX(<span class="number">45</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> myTween.WaitForCompletion();</span><br><span class="line">    <span class="comment">// This log will happen after the tween has completed</span></span><br><span class="line">    Debug.Log(<span class="string">"Tween completed!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>总结：<br>给我的感觉，DOTween是一个基于Unity扩展的强大的数学动画库。<br>通过DOTween我们可以快速的去针对Unity里的一些属性比如位置，材质，UI等做动画，可以说是属于程序员的动画制作工具。</p>
<p><a href="https://www.codeandweb.com/texturepacker" target="_blank" rel="external">TexturePacker官网</a></p>
<p>待续……</p>
<h1 id="Reference">Reference</h1><h2 id="Unity_Official_Website_Part">Unity Official Website Part</h2><p><a href="https://docs.unity3d.com/Manual/Plugins.html" target="_blank" rel="external">Unity Plugin</a></p>
<h2 id="Knowledge_Part">Knowledge Part</h2><p><a href="http://www.jianshu.com/p/cb05698a1968" target="_blank" rel="external">关于Android的.so文件你所需要知道的</a><br><a href="http://linux-wiki.cn/wiki/zh-hans/%E5%8A%A8%E6%80%81%E5%BA%93(.so" target="_blank" rel="external">动态库(.so)</a>)<br><a href="https://developer.android.com/ndk/guides/index.html" target="_blank" rel="external">Getting Started with the NDK</a><br><a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/readelf.html" target="_blank" rel="external">readelf elf文件格式分析</a><br><a href="https://developer.android.com/ndk/guides/abis.html" target="_blank" rel="external">ABI Management</a><br><a href="https://android-developers.googleblog.com/2016/06/android-changes-for-ndk-developers.html" target="_blank" rel="external">Android changes for NDK developers </a><br><a href="http://www.cnblogs.com/xmphoenix/archive/2011/10/23/2221879.html" target="_blank" rel="external">可执行文件（ELF）格式的理解</a><br><a href="http://infocenter.arm.com/help/topic/com.arm.doc.dui0101a/DUI0101A_Elf.pdf" target="_blank" rel="external">ARM ELF File Format</a></p>
<h2 id="Third_Tool_Part">Third Tool Part</h2><p><a href="https://www.codeandweb.com/texturepacker" target="_blank" rel="external">TexturePacker官网</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://tonytang1990.github.io/2016/12/11/Unity原生&第三方插件/" data-title="Unity原生&amp;第三方插件 | 走停人生路" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/12/20/Unity-Shader/" title="Unity_Shader">
  <strong>上一篇：</strong><br/>
  <span>
  Unity_Shader</span>
</a>
</div>


<div class="next">
<a href="/2016/10/21/数据结构与算法/"  title="数据结构与算法">
 <strong>下一篇：</strong><br/> 
 <span>数据结构与算法
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/12/11/Unity原生&第三方插件/" data-title="Unity原生&第三方插件" data-url="http://tonytang1990.github.io/2016/12/11/Unity原生&第三方插件/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity_Plugins"><span class="toc-number">1.</span> <span class="toc-text">Unity Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#原生知识"><span class="toc-number">1.1.</span> <span class="toc-text">原生知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugins分类"><span class="toc-number">1.1.1.</span> <span class="toc-text">Plugins分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Managed_Plugins"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Managed Plugins</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Natiev_Plugins"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">Natiev Plugins</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugins文件扩展名和支持平台"><span class="toc-number">1.1.2.</span> <span class="toc-text">Plugins文件扩展名和支持平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理器与Plugins"><span class="toc-number">1.1.3.</span> <span class="toc-text">处理器与Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-so文件"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">.so文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-so与ELF"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">.so与ELF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编译和使用-so"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">编译和使用.so</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-so架构的抉择"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">.so架构的抉择</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unity_Android_&_IOS_Plugin"><span class="toc-number">1.1.3.5.</span> <span class="toc-text">Unity Android & IOS Plugin</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android实战"><span class="toc-number">1.1.4.</span> <span class="toc-text">Android实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Android_Studio"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">Android Studio</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JNI(Java交互)"><span class="toc-number">1.1.4.1.1.</span> <span class="toc-text">JNI(Java交互)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android项目相关概念"><span class="toc-number">1.1.4.1.2.</span> <span class="toc-text">Android项目相关概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Android库模块实战"><span class="toc-number">1.1.4.1.3.</span> <span class="toc-text">Android库模块实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Gradle"><span class="toc-number">1.1.4.1.3.1.</span> <span class="toc-text">Gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Android库模块"><span class="toc-number">1.1.4.1.3.2.</span> <span class="toc-text">Android库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Jar库模块"><span class="toc-number">1.1.4.1.3.3.</span> <span class="toc-text">Jar库模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#AAR库模块"><span class="toc-number">1.1.4.1.3.4.</span> <span class="toc-text">AAR库模块</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOS实战"><span class="toc-number">1.1.5.</span> <span class="toc-text">IOS实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Objective-C语法"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">Objective-C语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unity与IOS的交互"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">Unity与IOS的交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#引用"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">引用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三方工具插件"><span class="toc-number">1.2.</span> <span class="toc-text">第三方工具插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NGUI"><span class="toc-number">1.2.1.</span> <span class="toc-text">NGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Tutorials"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Tutorials</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Creating_Your_UI"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">Creating Your UI</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Sprite"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">Sprite</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#9-Sliced_Sprite"><span class="toc-number">1.2.1.1.2.1.</span> <span class="toc-text">9-Sliced Sprite</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Tiled_Sprite"><span class="toc-number">1.2.1.1.2.2.</span> <span class="toc-text">Tiled Sprite</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Label"><span class="toc-number">1.2.1.1.3.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Button"><span class="toc-number">1.2.1.1.4.</span> <span class="toc-text">Button</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Slider"><span class="toc-number">1.2.1.1.5.</span> <span class="toc-text">Slider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Checkbox"><span class="toc-number">1.2.1.1.6.</span> <span class="toc-text">Checkbox</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Input"><span class="toc-number">1.2.1.1.7.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3D"><span class="toc-number">1.2.1.1.8.</span> <span class="toc-text">3D</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Atlas_Maker"><span class="toc-number">1.2.1.1.9.</span> <span class="toc-text">Atlas Maker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Font_Maker"><span class="toc-number">1.2.1.1.10.</span> <span class="toc-text">Font Maker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NGUI_2-7屏幕自适应"><span class="toc-number">1.2.1.1.11.</span> <span class="toc-text">NGUI 2.7屏幕自适应</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOTween"><span class="toc-number">1.2.2.</span> <span class="toc-text">DOTween</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween_Instroduction"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">DOTween Instroduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween_Install"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">DOTween Install</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween_Nomenclature_and_Prefixes"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">DOTween Nomenclature and Prefixes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOTween使用学习"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">DOTween使用学习</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">2.</span> <span class="toc-text">Reference</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity_Official_Website_Part"><span class="toc-number">2.1.</span> <span class="toc-text">Unity Official Website Part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knowledge_Part"><span class="toc-number">2.2.</span> <span class="toc-text">Knowledge Part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Third_Tool_Part"><span class="toc-number">2.3.</span> <span class="toc-text">Third Tool Part</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Automation/" title="Automation">Automation<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Editor/" title="Editor">Editor<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Game-Engine/" title="Game_Engine">Game_Engine<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Language/" title="Programming Language">Programming Language<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Rendering/" title="Rendering">Rendering<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Unity/" title="Unity">Unity<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/OpenGL/" title="OpenGL">OpenGL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Resource/" title="Resource">Resource<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Rendering/" title="Rendering">Rendering<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Sort/" title="Sort">Sort<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Art/" title="Art">Art<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/VersionControl/" title="VersionControl">VersionControl<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/GameDesignPattern/" title="GameDesignPattern">GameDesignPattern<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Editor/" title="Editor">Editor<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Shader/" title="Shader">Shader<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Programming/" title="Programming">Programming<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Tony Tang. <br/>
			This is my new blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2019 
		
		<a href="/about" target="_blank" title="Tony Tang">Tony Tang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"TonyTang1990"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
