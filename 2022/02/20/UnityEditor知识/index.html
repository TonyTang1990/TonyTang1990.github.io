
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>UnityEditor知识 | 走停人生路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Tony Tang">
    

    
    <meta name="description" content="IntroductionUnity游戏开发过程中我会需要通过Editor相关工具来编写一些工具和可视化显示工等，用于辅助完成特定的功能和编辑器开发，本章节用于整理和学习Unity相关的Editor知识，好让自己对于Editor的相关知识有一个系统的学习和整理。
Editor绘制分类Unity里的UI包含多种UI:

UI Toolkit(最新一代的UI系统框架，高性能跨平台，基础Web技术)
UG">
<meta property="og:type" content="article">
<meta property="og:title" content="UnityEditor知识">
<meta property="og:url" content="http://tonytang1990.github.io/2022/02/20/UnityEditor知识/index.html">
<meta property="og:site_name" content="走停人生路">
<meta property="og:description" content="IntroductionUnity游戏开发过程中我会需要通过Editor相关工具来编写一些工具和可视化显示工等，用于辅助完成特定的功能和编辑器开发，本章节用于整理和学习Unity相关的Editor知识，好让自己对于Editor的相关知识有一个系统的学习和整理。
Editor绘制分类Unity里的UI包含多种UI:

UI Toolkit(最新一代的UI系统框架，高性能跨平台，基础Web技术)
UG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/GUIEditorOrRuntime.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/GUIRolesAndSkillSets.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/UnityEditorStudyiEntryUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/FixLayoutGUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/AutoLayoutGUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/GUIStyleViewer.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/GUIEventGUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/CustomCoordinatesGUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/GizmoGUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AssetBundle-Framework/AssetBundleCollectWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/AssetBundle-Framework/AssetBundleLoadManagerUIAfterDestroyWindow.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/CustomVariableNodes.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/CustomVariableInspector.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/AllCustomVariableInspector.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/GenericMenu.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/BTOperationPanel.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/GenericMenu.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/BTEditorNode.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/BTNodeConnectLine.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/AI/BehaviourTree/BTNodeEditor.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/CustomInspectorGUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/CustomInspectorDraw.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/CustomInspectorPropertyDraw.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/TreeViewFlowChart.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/MessageStatisticUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/MessagePreviewUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/MessageSimulationUI.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/EditorUIStudy/MessageTreeAssetEditorUI.PNG">
<meta property="og:updated_time" content="2022-07-31T07:17:20.377Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UnityEditor知识">
<meta name="twitter:description" content="IntroductionUnity游戏开发过程中我会需要通过Editor相关工具来编写一些工具和可视化显示工等，用于辅助完成特定的功能和编辑器开发，本章节用于整理和学习Unity相关的Editor知识，好让自己对于Editor的相关知识有一个系统的学习和整理。
Editor绘制分类Unity里的UI包含多种UI:

UI Toolkit(最新一代的UI系统框架，高性能跨平台，基础Web技术)
UG">

    
    <link rel="alternative" href="/atom.xml" title="走停人生路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="走停人生路" title="走停人生路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="走停人生路">走停人生路</a></h1>
				<h2 class="blog-motto">做着独立游戏梦，坚持走在游戏开发道路上的人</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:tonytang1990.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/02/20/UnityEditor知识/" title="UnityEditor知识" itemprop="url">UnityEditor知识</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Tony Tang" target="_blank" itemprop="author">Tony Tang</a>
		
  <p class="article-time">
    <time datetime="2022-02-20T14:37:00.000Z" itemprop="datePublished"> 發表於 2022-02-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor绘制分类"><span class="toc-number">2.</span> <span class="toc-text">Editor绘制分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IMGUI"><span class="toc-number">2.1.</span> <span class="toc-text">IMGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GUI"><span class="toc-number">2.1.1.</span> <span class="toc-text">GUI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUI_Layout"><span class="toc-number">2.1.2.</span> <span class="toc-text">GUI Layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUISkin和GUIStyle"><span class="toc-number">2.1.3.</span> <span class="toc-text">GUISkin和GUIStyle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UIEvent"><span class="toc-number">2.1.4.</span> <span class="toc-text">UIEvent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IMGUI实战"><span class="toc-number">2.1.5.</span> <span class="toc-text">IMGUI实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Scene辅助GUI绘制"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">Scene辅助GUI绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实战"><span class="toc-number">2.1.5.1.1.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Editor窗口绘制"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">Editor窗口绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实战-1"><span class="toc-number">2.1.5.2.1.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Inspector面板绘制"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">Inspector面板绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实战-2"><span class="toc-number">2.1.5.3.1.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TreeView绘制"><span class="toc-number">2.1.5.4.</span> <span class="toc-text">TreeView绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#基础知识"><span class="toc-number">2.1.5.4.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#深入学习"><span class="toc-number">2.1.5.4.2.</span> <span class="toc-text">深入学习</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#实战实现"><span class="toc-number">2.1.5.4.3.</span> <span class="toc-text">实战实现</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI_Toolkit"><span class="toc-number">2.2.</span> <span class="toc-text">UI Toolkit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UGUI"><span class="toc-number">2.3.</span> <span class="toc-text">UGUI</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor工具分类"><span class="toc-number">3.</span> <span class="toc-text">Editor工具分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor数据存储"><span class="toc-number">4.</span> <span class="toc-text">Editor数据存储</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor常用标签"><span class="toc-number">5.</span> <span class="toc-text">Editor常用标签</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#学习总结"><span class="toc-number">6.</span> <span class="toc-text">学习总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Github"><span class="toc-number">7.</span> <span class="toc-text">Github</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">8.</span> <span class="toc-text">Reference</span></a></li></ol>
		
		</div>
		
		<h1 id="Introduction">Introduction</h1><p>Unity游戏开发过程中我会需要通过Editor相关工具来编写一些工具和可视化显示工等，用于辅助完成特定的功能和编辑器开发，本章节用于整理和学习Unity相关的Editor知识，好让自己对于Editor的相关知识有一个系统的学习和整理。</p>
<h1 id="Editor绘制分类">Editor绘制分类</h1><p>Unity里的UI包含多种UI:</p>
<ol>
<li><strong>UI Toolkit</strong>(最新一代的UI系统框架，高性能跨平台，基础Web技术)</li>
<li><strong>UGUI</strong>(老版的UI系统，2022年为止用的最多的官方UI系统)</li>
<li><strong>IMGUI</strong>(Immediate Mode Graphical User Interface，code-Driven的GUI系统)</li>
</ol>
<p>而我们现在主要Editor用到的GUI暂时是指<strong>IMGUI</strong>，未来更多的学习中心是<strong>UI Toolkit</strong>(通吃Editor和运行时开发的新一代UI框架)。</p>
<p>这里UGUI在Editor篇章就不重点讲述，本文重点学习IMGUI和UI Toolkit(TODO)。</p>
<p>上述三中UI适用场景和适用人群，这里放两张官方的图片用于有个基础认知:</p>
<p><img src="/img/Unity/EditorUIStudy/GUIEditorOrRuntime.PNG" alt="GUIEditorOrRuntime"></p>
<p><img src="/img/Unity/EditorUIStudy/GUIRolesAndSkillSets.PNG" alt="GUIRolesAndSkillSets"></p>
<p>详细的对比参考:</p>
<p><a href="https://docs.unity3d.com/Manual/UI-system-compare.html" target="_blank" rel="external">UI-system-compare</a></p>
<p>Note:</p>
<ol>
<li><strong>UI Toolkit是官方主推的未来用于Editor和Runtime的新UI框架</strong></li>
</ol>
<h2 id="IMGUI">IMGUI</h2><p>IMGUI主要用于绘制我们Editor的自定义UI(比如自定义窗口UI，自定义面板UI，自定义场景UI等)</p>
<h3 id="GUI">GUI</h3><p>GUI主要由Type,Position和Content组成</p>
<ol>
<li>Type标识了GUI是什么类型的GUI(比如GUI.Label表示是一个标签)</li>
<li>Position标识了GUI的显示位置和大小等信息(Rect)</li>
<li>Content标识了GUI显示的内容(可以是一个文本可以使一个图片)</li>
</ol>
<p><strong>Type</strong>:</p>
<p>我们常用的GUI类型比如Lable(标签),Button(按钮),TextField(输入文本),Toggle(选择按钮)等</p>
<p><strong>Position</strong>:</p>
<p>位置和大小信息主要通过Rect结构来表示位置和大小信息</p>
<p><strong>Content</strong>:</p>
<p>GUI内容显示比如常用的文本和图标等形式</p>
<p>这里实现了一个简单的纯GUI的Unity学习项目:</p>
<p><img src="/img/Unity/EditorUIStudy/UnityEditorStudyiEntryUI.PNG" alt="UnityEditorStudyiEntryUI"></p>
<p><strong>Git地址见文章最后</strong></p>
<p>Note:</p>
<ol>
<li><strong>GUI的坐标系是左上角0,0</strong></li>
</ol>
<h3 id="GUI_Layout">GUI Layout</h3><p>GUI的排版分为两类:</p>
<ol>
<li><strong>固定排版</strong></li>
<li><strong>自动排版</strong></li>
</ol>
<p><strong>固定排版</strong>:</p>
<p>固定排版是指我通过调用构建传递Rect信息的方式，显示的指明GUI的显示位置和大小信息。但这样的方式在我们不知道UI布局(比如动态布局动态大小)的时候就很难实现完美的UI布局。</p>
<p>接下来我们直接实战看下效果:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             FixLayoutDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/03/06</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> FixLayoutDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 固定排版绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FixLayoutDraw</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        GUI.Label(<span class="keyword">new</span> Rect(<span class="number">0</span>f, <span class="number">0</span>f, <span class="number">300</span>f, <span class="number">100</span>f), $<span class="string">"固定排版文本位置信息:(0, 0)大小:(300, 100)"</span>);</span><br><span class="line"></span><br><span class="line">        GUI.BeginGroup(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">100</span>, Screen.height / <span class="number">2</span> - <span class="number">100</span>, <span class="number">300</span>f, <span class="number">200</span>f));</span><br><span class="line">        GUI.Box(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">25</span>, <span class="number">300</span>, <span class="number">50</span>), <span class="string">"GUI组里的Box位置:(0, 25)大小:(300, 50)"</span>);</span><br><span class="line">        <span class="keyword">if</span>(GUI.Button(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">50</span>), <span class="string">"GUI组里的按钮位置:(0, 100)大小:(300, 50)"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"点击的GUI组里的按钮"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        GUI.EndGroup();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/Unity/EditorUIStudy/FixLayoutGUI.PNG" alt="FixLayoutGUI"></p>
<p>Note:</p>
<ol>
<li><strong>GUI Group可以实现GUI按组控制显示的功能</strong></li>
</ol>
<p><strong>自动排版</strong>:</p>
<p>自动排版顾名思义不再需要向固定排版一样对于每一个组件都写死位置和大小信息，自动排版的组件(Type)会根据设置的相关信息进行自动适配。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             AutoLayoutDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/03/06</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> AutoLayoutDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 自动排版绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AutoLayoutDraw</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// 自动排版</span></span><br><span class="line">        <span class="keyword">if</span>(GUILayout.Button(<span class="string">"自动排版的第一个按钮"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"点击了自动排版的第一个按钮!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 带自动排版的自定义绘制区域1</span></span><br><span class="line">        GUILayout.BeginArea(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">150</span>, Screen.height / <span class="number">2</span> - <span class="number">150</span>, <span class="number">300</span>, <span class="number">300</span>));</span><br><span class="line">        <span class="keyword">if</span>(GUILayout.Button(<span class="string">"自动排版中心区域内的按钮1"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"点击了自动排版中心区域内的按钮1!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (GUILayout.Button(<span class="string">"自动排版中心区域内的按钮2"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"点击了自动排版中心区域内的按钮2!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        GUILayout.EndArea();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 带自动排版的自定义绘制区域2</span></span><br><span class="line">        GUILayout.BeginArea(<span class="keyword">new</span> Rect(Screen.width - <span class="number">300</span>, Screen.height - <span class="number">100</span>, <span class="number">300</span>, <span class="number">100</span>));</span><br><span class="line">        <span class="comment">// 指定右下角区域采用纵向自动布局</span></span><br><span class="line">        GUILayout.BeginVertical();</span><br><span class="line">        <span class="comment">// 指定GUI按钮的宽度固定200</span></span><br><span class="line">        <span class="keyword">if</span> (GUILayout.Button(<span class="string">"自动排版右下角区域内的按钮1"</span>, GUILayout.Width(<span class="number">200</span>f)))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"点击了自动排版右下角区域内的按钮1!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 指定GUI按钮的宽度自适应</span></span><br><span class="line">        <span class="keyword">if</span> (GUILayout.Button(<span class="string">"自动排版右下角区域内的按钮2"</span>, GUILayout.ExpandWidth(<span class="keyword">true</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"点击了自动排版右下角区域内的按钮2!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        GUILayout.EndVertical();</span><br><span class="line">        GUILayout.EndArea();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/Unity/EditorUIStudy/AutoLayoutGUI.PNG" alt="AutoLayoutGUI"></p>
<p>Note:</p>
<ol>
<li><strong>自动布局可以帮我们方便快速的完成UI布局适配而不需要写死所有组件的大小和位置</strong></li>
<li><p><strong>GUILayout主要用于GUI的自动排版，而EditorGUILayout主要用于Edtior的GUI自动排版</strong></p>
</li>
<li><p><strong>GUI.BeginChange()和GUI.EndChange()的配套使用可以检测指定GUI的值是否变化，做到检测变化响应后做指定的事情</strong></p>
</li>
</ol>
<h3 id="GUISkin和GUIStyle">GUISkin和GUIStyle</h3><p><a href="https://docs.unity3d.com/Manual/gui-Customization.html" target="_blank" rel="external">GUISkins are a collection of GUIStyles. Styles define the appearance of a GUI Control. You do not have to use a Skin if you want to use a Style.</a></p>
<p>从介绍可以看出GUISkins是GUIStyls的合集，GUIStyles定义了我们GUI的样式。</p>
<p>但如何得知Unity支持哪些GUIStyle了？</p>
<p>GUIStyle查看器工具(网上搜索到别人写的):</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EditorStyleViewer</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Vector2 scrollPosition = Vector2.zero;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> search = <span class="keyword">string</span>.Empty;</span><br><span class="line">    [MenuItem(<span class="string">"Tools/GUI样式查看器"</span>)]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        EditorWindow.GetWindow(<span class="keyword">typeof</span>(EditorStyleViewer));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        GUILayout.BeginHorizontal(<span class="string">"HelpBox"</span>);</span><br><span class="line">        GUILayout.Label(<span class="string">"单击示例将复制其名到剪贴板"</span>, <span class="string">"label"</span>);</span><br><span class="line">        GUILayout.FlexibleSpace();</span><br><span class="line">        GUILayout.Label(<span class="string">"查找:"</span>);</span><br><span class="line">        search = EditorGUILayout.TextField(search);</span><br><span class="line">        GUILayout.EndHorizontal();</span><br><span class="line">        scrollPosition = GUILayout.BeginScrollView(scrollPosition);</span><br><span class="line">        <span class="keyword">foreach</span> (GUIStyle style <span class="keyword">in</span> GUI.skin)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (style.name.ToLower().Contains(search.ToLower()))</span><br><span class="line">            &#123;</span><br><span class="line">                GUILayout.BeginHorizontal(<span class="string">"PopupCurveSwatchBackground"</span>);</span><br><span class="line">                GUILayout.Space(<span class="number">7</span>);</span><br><span class="line">                <span class="keyword">if</span> (GUILayout.Button(style.name, style))</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorGUIUtility.systemCopyBuffer = <span class="string">"\""</span> + style.name + <span class="string">"\""</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                GUILayout.FlexibleSpace();</span><br><span class="line">                EditorGUILayout.SelectableLabel(<span class="string">"\""</span> + style.name + <span class="string">"\""</span>);</span><br><span class="line">                GUILayout.EndHorizontal();</span><br><span class="line">                GUILayout.Space(<span class="number">11</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        GUILayout.EndScrollView();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/Unity/EditorUIStudy/GUIStyleViewer.PNG" alt="GUIStyleViewer"></p>
<p>Note:</p>
<ol>
<li><strong>我们可以右键创建一个GUISkin资源后加载指定GUISkin来控制我们的GUI显示风格</strong></li>
</ol>
<h3 id="UIEvent">UIEvent</h3><p>这里说的UIEvent主要是指玩家操作触发的一些事件信息，只有有了这些事件信息的我们才能编写对应的交互反馈。</p>
<p>Unity的事件信息统一由<strong>Event</strong>这个类封装，我们通过访问Event可以实现自定义的按钮响应和交互。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             EventDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/03/06</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> EventDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 事件响应绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventDraw</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 事件信息</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> mEventInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 键盘按下事件</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> mKeyDownEvent;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 鼠标点击事件</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> mMouseDownEvent;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mEventInfo = <span class="keyword">string</span>.Empty;</span><br><span class="line">        mEventInfo = $<span class="string">"当前事件类型:&#123;Event.current.type&#125;"</span>;</span><br><span class="line">        <span class="keyword">if</span>(Event.current.type == EventType.KeyDown &amp;&amp; Event.current.keyCode != KeyCode.None)</span><br><span class="line">        &#123;</span><br><span class="line">            mKeyDownEvent = $<span class="string">"按下过按键码:&#123;Event.current.keyCode&#125;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Event.current.type == EventType.MouseDown)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Event.current.button == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mMouseDownEvent = $<span class="string">"按下过鼠标:左键"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Event.current.button == <span class="number">1</span></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                mMouseDownEvent = $<span class="string">"按下过鼠标:右键"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        GUILayout.BeginArea(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">200</span>, Screen.height / <span class="number">2</span> - <span class="number">200</span>, <span class="number">400</span>, <span class="number">400</span>));</span><br><span class="line">        GUILayout.Label($<span class="string">"&#123;mEventInfo&#125;"</span>, GUILayout.Width(<span class="number">400</span>), GUILayout.Height(<span class="number">20</span>));</span><br><span class="line">        GUILayout.Label($<span class="string">"&#123;mKeyDownEvent&#125;"</span>, GUILayout.Width(<span class="number">400</span>), GUILayout.Height(<span class="number">20</span>));</span><br><span class="line">        GUILayout.Label($<span class="string">"&#123;mMouseDownEvent&#125;"</span>, GUILayout.Width(<span class="number">400</span>), GUILayout.Height(<span class="number">20</span>));</span><br><span class="line">        GUILayout.EndArea();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/Unity/EditorUIStudy/GUIEventGUI.PNG" alt="GUIEventGUI"></p>
<h3 id="IMGUI实战">IMGUI实战</h3><p>了解了GUI相关的基础知识后，让我们来深入学习了解下GUI在Editor里的运用。</p>
<p>Editor个人接触到的按显示区域来分类的话，个人接触过以下几类：</p>
<ol>
<li>Scene场景辅助GUI绘制</li>
<li>Editor纯工具窗口绘制</li>
<li>Inspector面板绘制</li>
<li>其他Editor功能</li>
</ol>
<h4 id="Scene辅助GUI绘制">Scene辅助GUI绘制</h4><p>Scene的GUI绘制主要分为两种：</p>
<ol>
<li>Gizmos</li>
<li>Handles</li>
</ol>
<p>Gizmos</p>
<p><strong>Gizmos主要用于绘制Scene场景里的可视化调试(比如绘制线，图标，cube等)，不支持交互。</strong></p>
<p>Note:</p>
<ol>
<li><strong>Gizmos的代码需要卸载OnDrawGizmos()或OnDrawGizmosSelected()方法内，区别是前者是Scene场景一直显示，后者是只有包含该脚本的指定对象被选中时显示。</strong></li>
</ol>
<p>Handles</p>
<p><strong>Handles主要用于绘制Scene场景里3D可交互UI(比如可拉伸坐标轴，按钮等)。</strong></p>
<p>Note:</p>
<ol>
<li><strong>Handles的绘制代码需要卸载OnSceneGUI()方法内</strong></li>
<li>Handles里依然支持GUI的2D GUI绘制，但需要把代码写在Hanldes.BeginGUI和Handles.EndGUI内。</li>
</ol>
<h5 id="实战">实战</h5><ol>
<li>Gizmos+Handles绘制Scene场景里的坐标系</li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             CoordinateSystemDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/20</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CoordinateSystemDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 坐标系Gizmo绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoordinateSystemDraw</span> : <span class="title">MonoBehaviour</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 坐标系原点</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"坐标系原点"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Vector3 CoordinateCenterPoint = Vector3.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 坐标系长度</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"坐标系长度"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> CoordinateSystemLength = <span class="number">1.0</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> Z轴颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"Z轴颜色"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Color ForwardAxisColor = Color.blue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> X轴颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"X轴颜色"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Color RightAxisColor = Color.red;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> Y轴颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"Y轴颜色"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Color UpAxisColor = Color.green;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> XY平面颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"XY平面颜色"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Color ForwardPlaneColor = <span class="keyword">new</span> Color(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">48</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> ZY平面颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"ZY平面颜色"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Color RightPlaneColor = <span class="keyword">new</span> Color(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">48</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> XZ平面颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"XZ平面颜色"</span>)]</span><br><span class="line">    <span class="keyword">public</span> Color UpPlaneColor = <span class="keyword">new</span> Color(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">48</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> XY轴平面大小</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> Vector3 ForwardPlaneSize = <span class="keyword">new</span> Vector3(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0.001</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> ZY轴平面大小</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> Vector3 RightPlaneSize = <span class="keyword">new</span> Vector3(<span class="number">0.001</span>f, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> XZ轴平面大小</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> Vector3 UpPlaneSize = <span class="keyword">new</span> Vector3(<span class="number">1</span>, <span class="number">0.001</span>f, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 原始颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> Color mOriginalColor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDrawGizmos</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        DrawForwardPlane();</span><br><span class="line">        DrawRightPlane();</span><br><span class="line">        DrawUpPlane();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 绘制XY平面</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawForwardPlane</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mOriginalColor = GUI.color;</span><br><span class="line">        Gizmos.color = ForwardPlaneColor;</span><br><span class="line">        ForwardPlaneSize.x = CoordinateSystemLength;</span><br><span class="line">        ForwardPlaneSize.y = CoordinateSystemLength;</span><br><span class="line">        Gizmos.DrawCube(CoordinateCenterPoint, ForwardPlaneSize);</span><br><span class="line">        Gizmos.color = mOriginalColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 绘制ZY平面</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawRightPlane</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mOriginalColor = GUI.color;</span><br><span class="line">        Gizmos.color = RightPlaneColor;</span><br><span class="line">        RightPlaneSize.y = CoordinateSystemLength;</span><br><span class="line">        RightPlaneSize.z = CoordinateSystemLength;</span><br><span class="line">        Gizmos.DrawCube(CoordinateCenterPoint, RightPlaneSize);</span><br><span class="line">        Gizmos.color = mOriginalColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 绘制XZ平面</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawUpPlane</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mOriginalColor = GUI.color;</span><br><span class="line">        Gizmos.color = UpPlaneColor;</span><br><span class="line">        UpPlaneSize.x = CoordinateSystemLength;</span><br><span class="line">        UpPlaneSize.z = CoordinateSystemLength;</span><br><span class="line">        Gizmos.DrawCube(CoordinateCenterPoint, UpPlaneSize);</span><br><span class="line">        Gizmos.color = mOriginalColor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             CoordinateSystemDrawEditor.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/20</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CoordinateSystemDrawEditor.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CoordinateSystemDraw的Editor绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">[CustomEditor(<span class="keyword">typeof</span>(CoordinateSystemDraw))]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoordinateSystemDrawEditor</span> : <span class="title">Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 坐标系原点属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty mCoordinateCenterPointProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 坐标系长度属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty mCoordinateSystemLengthProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> Z轴颜色属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty mForwardAxisColorProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> X轴颜色属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty mRightAxisColorProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> Y轴颜色</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty mUpAxisColorProperty;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mCoordinateCenterPointProperty = serializedObject.FindProperty(<span class="string">"CoordinateCenterPoint"</span>);</span><br><span class="line">        mCoordinateSystemLengthProperty = serializedObject.FindProperty(<span class="string">"CoordinateSystemLength"</span>);</span><br><span class="line">        mForwardAxisColorProperty = serializedObject.FindProperty(<span class="string">"ForwardAxisColor"</span>);</span><br><span class="line">        mRightAxisColorProperty = serializedObject.FindProperty(<span class="string">"RightAxisColor"</span>);</span><br><span class="line">        mUpAxisColorProperty = serializedObject.FindProperty(<span class="string">"UpAxisColor"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnSceneGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(Event.current.type == EventType.Repaint)</span><br><span class="line">        &#123;</span><br><span class="line">            Handles.color = mForwardAxisColorProperty.colorValue;</span><br><span class="line">            Handles.ArrowHandleCap(<span class="number">1</span>, mCoordinateCenterPointProperty.vector3Value,</span><br><span class="line">                                    Quaternion.LookRotation(Vector3.forward),</span><br><span class="line">                                    mCoordinateSystemLengthProperty.floatValue, EventType.Repaint);</span><br><span class="line"></span><br><span class="line">            Handles.color = mRightAxisColorProperty.colorValue;</span><br><span class="line">            Handles.ArrowHandleCap(<span class="number">1</span>, mCoordinateCenterPointProperty.vector3Value,</span><br><span class="line">                                    Quaternion.LookRotation(Vector3.right),</span><br><span class="line">                                    mCoordinateSystemLengthProperty.floatValue, EventType.Repaint);</span><br><span class="line"></span><br><span class="line">            Handles.color = mUpAxisColorProperty.colorValue;</span><br><span class="line">            Handles.ArrowHandleCap(<span class="number">1</span>, mCoordinateCenterPointProperty.vector3Value,</span><br><span class="line">                                    Quaternion.LookRotation(Vector3.up),</span><br><span class="line">                                    mCoordinateSystemLengthProperty.floatValue, EventType.Repaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示:</p>
<p><img src="/img/Unity/EditorUIStudy/CustomCoordinatesGUI.PNG" alt="CustomCoordinatesGUI"></p>
<ol>
<li>Gizmos绘制物体的标签和2D可交互按钮显示</li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             TagAndButtonDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> TagAndButtonDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 物体标签和交互按钮显示</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TagAndButtonDraw</span> : <span class="title">MonoBehaviour</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 物体名</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"物体名"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Name = <span class="string">"GUI测试物体"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 物体标签名</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"物体标签名"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> TagName = <span class="string">"sv_icon_name3"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDrawGizmos</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        DrawTag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 绘制物体标签</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawTag</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Gizmos.DrawIcon(transform.position, TagName, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             TagAndButtonDrawEditor.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> TagAndButtonDrawEditor.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 物体也签和交互按钮显示的Editor绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">[CustomEditor(<span class="keyword">typeof</span>(TagAndButtonDraw))]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TagAndButtonDrawEditor</span> : <span class="title">Editor</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 物体名属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty mNameProperty;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        mNameProperty = serializedObject.FindProperty(<span class="string">"Name"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnSceneGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tagAndButtonDraw = (TagAndButtonDraw)target;</span><br><span class="line">        <span class="keyword">if</span>(tagAndButtonDraw == <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Handles.Label(tagAndButtonDraw.transform.position, mNameProperty.stringValue);</span><br><span class="line">        <span class="comment">// Handles里绘制2D GUI需要在Handles.BeginGUI()和Handles.EndGUI()内</span></span><br><span class="line">        Handles.BeginGUI();</span><br><span class="line">        <span class="keyword">if</span>(GUILayout.Button(<span class="string">"测试按钮"</span>, GUILayout.Width(<span class="number">200</span>f), GUILayout.Height(<span class="number">40</span>f)))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log($<span class="string">"物体按钮被点击!"</span>);</span><br><span class="line">            Selection.activeGameObject = tagAndButtonDraw.gameObject;</span><br><span class="line">        &#125;</span><br><span class="line">        Handles.EndGUI();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示:</p>
<p><img src="/img/Unity/EditorUIStudy/GizmoGUI.PNG" alt="GizmoGUI"></p>
<p>关于GUI的Icon详细列表可以查询这里:</p>
<p><a href="https://unitylist.com/p/5c3/Unity-editor-icons" target="_blank" rel="external">Unity Editor Built-in Icons</a></p>
<h4 id="Editor窗口绘制">Editor窗口绘制</h4><p>Editor的窗口绘制需要继承至<strong>EditorWindow</strong>类，然后在<strong>OnGUI()</strong>方法内利用GUI相关接口编写UI排版代码。</p>
<p>这一类代码工具代码写的比较多就不详细介绍了，主要是使用<strong>GUILayout</strong>和<strong>EditorGUILayout</strong>以及<strong>GUI</strong>相关的接口编写，使用<strong>MenuItem</strong>定义窗口UI入口，<strong>GenericMenu</strong>编写自定义菜单，<strong>Handles</strong>编写一些可视化线等。然后结合Event模块编写一些自定义的操作控制。</p>
<h5 id="实战-1">实战</h5><p>典型例子1-资源打包工具窗口的编写:</p>
<p>效果展示:</p>
<p><img src="/img/Unity/AssetBundle-Framework/AssetBundleCollectWindow.PNG" alt="AssetBundleCollectWindow"></p>
<p><img src="/img/Unity/AssetBundle-Framework/AssetBundleLoadManagerUIAfterDestroyWindow.png" alt="AssetBundleLoadManagerUIAfterDestroyWindow"></p>
<p>详情参见:</p>
<p><a href="https://github.com/TonyTang1990/AssetBundleLoadManager" target="_blank" rel="external">AssetBundleManager</a></p>
<p>典型例子2-行为树编辑器编写:</p>
<p><img src="/img/AI/BehaviourTree/CustomVariableNodes.png" alt="自定义变量节点"><br><img src="/img/AI/BehaviourTree/CustomVariableInspector.png" alt="自定义变量参数面板"><br><img src="/img/AI/BehaviourTree/AllCustomVariableInspector.png" alt="所有自定义变量展示面板"></p>
<p><img src="/img/AI/BehaviourTree/GenericMenu.png" alt="节点编辑器操作响应"></p>
<p><img src="/img/AI/BehaviourTree/BTOperationPanel.png" alt="节点编辑器操作面板"></p>
<p><img src="/img/AI/BehaviourTree/GenericMenu.png" alt="行为树编辑器菜单"></p>
<p><img src="/img/AI/BehaviourTree/BTEditorNode.png" alt="行为树节点窗口"></p>
<p><img src="/img/AI/BehaviourTree/BTNodeConnectLine.png" alt="行为树节点连线"></p>
<p><img src="/img/AI/BehaviourTree/BTNodeEditor.png" alt="行为树节点编辑器效果展示"></p>
<p>详情参见:</p>
<p><a href="https://github.com/TonyTang1990/BehaviourTreeForLua" target="_blank" rel="external">BehaviourTreeForLua</a></p>
<p>Note:</p>
<ol>
<li><strong>主要注意GUI和GUILayout或EditorGUILayout在自动排版上有区分，前者通过自定义布局实现排版布局，后者通过自动排版实现排版布局。</strong></li>
</ol>
<h4 id="Inspector面板绘制">Inspector面板绘制</h4><p>Inspector的面板绘制跟Unity序列化相关，常规的Inspector默认显示是通过继承<strong>Monobehaviour</strong>或<strong>ScriptableObject</strong>结合标记<strong>Serializable</strong>(标记类或结构体需要序列化),<strong>SerializedFied</strong>(标记成员需要序列化),<strong>NonSerialized</strong>(标记成员不需要序列化)和<strong>HideInInspector</strong>(标记成员不显示在面板上)来实现字段序列化和显示控制。</p>
<p>详细的序列化支持规则参考:</p>
<p><a href="https://docs.unity3d.com/Manual/script-Serialization.html" target="_blank" rel="external">Serialization rules</a></p>
<h5 id="实战-2">实战</h5><p>基础版的序列化事例:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             CustomInspectorDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CustomInspectorDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 自定义Inspector面板绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomInspectorDraw</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Serializable]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SerilizableClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        [Header(<span class="string">"类的整形数据"</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> ClassIntValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> 类隐藏不显示的字符串数据</span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        [HideInInspector]</span><br><span class="line">        [Header(<span class="string">"类隐藏不显示的字符串数据"</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> ClassHideInspectorStringValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> 类不序列化的布尔数据</span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        [NonSerialized]</span><br><span class="line">        [Header(<span class="string">"类不序列化的布尔数据"</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> ClassNonSerializedBoolValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 字符串数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"字符串数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> StringValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 布尔数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"布尔数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> BoolValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> GameObject对象数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"GameObject对象数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> GameObject GoValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 整形数组数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"整形数组数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] IntArrayValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类成员</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"序列化类成员"</span>)]</span><br><span class="line">    <span class="keyword">public</span> SerilizableClass SerilizabledClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示:</p>
<p><img src="/img/Unity/EditorUIStudy/CustomInspectorGUI.PNG" alt="CustomInspectorGUI"></p>
<p>如果我们需要自定义Inspector的面板显示，我们需要<strong>继承Editor</strong>类然后重写<strong>OnInspectorGUI</strong>接口进行自定义UI的代码编写，主要使用GUI，EditorGUI相关接口。</p>
<p>自定义Inspector事例:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             CustomInspectorDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CustomInspectorDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 自定义Inspector面板绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomInspectorDraw</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Serializable]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SerilizableClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        [Header(<span class="string">"类的整形数据"</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> ClassIntValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> 类隐藏不显示的字符串数据</span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        [HideInInspector]</span><br><span class="line">        [Header(<span class="string">"类隐藏不显示的字符串数据"</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> ClassHideInspectorStringValue;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> 类不序列化的布尔数据</span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        [NonSerialized]</span><br><span class="line">        [Header(<span class="string">"类不序列化的布尔数据"</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> ClassNonSerializedBoolValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 字符串数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"字符串数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> StringValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 布尔数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"布尔数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> BoolValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> GameObject对象数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"GameObject对象数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> GameObject GoValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 整形数组数据</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"整形数组数据"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] IntArrayValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类成员</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"序列化类成员"</span>)]</span><br><span class="line">    <span class="keyword">public</span> SerilizableClass SerilizabledClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             CustomInspectorDrawEditor.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CustomInspectorDrawEditor.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> CustomInspectorDraw自定义Inspector</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">[CustomEditor(<span class="keyword">typeof</span>(CustomInspectorDraw))]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomInspectorDrawEditor</span> : <span class="title">Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 字符串数据属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty StringValueProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 布尔数据属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty BoolValueProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> GameObject对象数据属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty GoValueProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 整形数组数据属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty IntArrayValueProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类成员属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty SerilizabledClassProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类成员属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty ClassIntValueProperty;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 序列化类成员属性</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    SerializedProperty ClassHideInspectorStringValueProperty;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        StringValueProperty = serializedObject.FindProperty(<span class="string">"StringValue"</span>);</span><br><span class="line">        BoolValueProperty = serializedObject.FindProperty(<span class="string">"BoolValue"</span>);</span><br><span class="line">        GoValueProperty = serializedObject.FindProperty(<span class="string">"GoValue"</span>);</span><br><span class="line">        IntArrayValueProperty = serializedObject.FindProperty(<span class="string">"IntArrayValue"</span>);</span><br><span class="line">        SerilizabledClassProperty = serializedObject.FindProperty(<span class="string">"SerilizabledClass"</span>);</span><br><span class="line">        ClassIntValueProperty = SerilizabledClassProperty.FindPropertyRelative(<span class="string">"ClassIntValue"</span>);</span><br><span class="line">        ClassHideInspectorStringValueProperty = SerilizabledClassProperty.FindPropertyRelative(<span class="string">"ClassHideInspectorStringValue"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInspectorGUI</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// 确保对SerializedObject和SerializedProperty的数据修改每帧同步</span></span><br><span class="line">        serializedObject.Update();</span><br><span class="line"></span><br><span class="line">        EditorGUILayout.BeginVertical();</span><br><span class="line">        <span class="keyword">if</span>(GUILayout.Button(<span class="string">"重置所有值"</span>, GUILayout.ExpandWidth(<span class="keyword">true</span>), GUILayout.Height(<span class="number">20</span>f)))</span><br><span class="line">        &#123;</span><br><span class="line">            StringValueProperty.stringValue = <span class="keyword">string</span>.Empty;</span><br><span class="line">            BoolValueProperty.boolValue = <span class="keyword">false</span>;</span><br><span class="line">            GoValueProperty.objectReferenceValue = <span class="keyword">null</span>;</span><br><span class="line">            IntArrayValueProperty.arraySize = <span class="number">0</span>;</span><br><span class="line">            ClassIntValueProperty.intValue = <span class="number">0</span>;</span><br><span class="line">            ClassHideInspectorStringValueProperty.stringValue = <span class="keyword">string</span>.Empty;</span><br><span class="line">        &#125;</span><br><span class="line">        EditorGUILayout.PropertyField(StringValueProperty);</span><br><span class="line">        EditorGUILayout.PropertyField(BoolValueProperty);</span><br><span class="line">        EditorGUILayout.PropertyField(GoValueProperty);</span><br><span class="line">        EditorGUILayout.PropertyField(IntArrayValueProperty);</span><br><span class="line">        EditorGUILayout.PropertyField(SerilizabledClassProperty, <span class="keyword">true</span>);</span><br><span class="line">        EditorGUILayout.EndVertical();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 确保对SerializedObject和SerializedProperty的数据修改写入生效</span></span><br><span class="line">        serializedObject.ApplyModifiedProperties();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示:</p>
<p><img src="/img/Unity/EditorUIStudy/CustomInspectorDraw.PNG" alt="CustomInspectorDraw"></p>
<p><strong>如果想实现通用的属性重置，可以参考SerializedObject(比如GetIteractor())和SerializedProperty(比如propertyType和propertyPath以及XXXValue等)相关接口实现遍历重置。</strong></p>
<p>通过重写Editor的OnInspectorGUI()方法确实实现了自定义Inspector显示，但每一个属性的显示都要通过编写自定义UI代码的方式去展示重用率低同时重复劳动多。</p>
<p>接下来这里要讲的是通过<strong>自定义属性标签实现面向标签的自定义Inspector绘制控制，从而实现高度的可重用属性标签</strong>。</p>
<p>自定义Inspector属性绘制标签由两部分组成:</p>
<ol>
<li><strong>自定义标签继承至PropertyAttribute(控制自定义属性标签的值)</strong></li>
<li><strong>自定义标签绘制继承至PropertyDrawer(控制自定义属性标签的显示绘制)</strong></li>
</ol>
<p>比如我们想实现一个类似Range标签和纹理Preview显示的标签功能:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             TRangeAttribute.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> TRangeAttribute.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 数值范围属性标签</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TRangeAttribute</span> : <span class="title">PropertyAttribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 最小值</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="keyword">float</span> MinValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 最大值</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">readonly</span> <span class="keyword">float</span> MaxValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TRangeAttribute</span>(<span class="params"><span class="keyword">float</span> minValue, <span class="keyword">float</span> maxValue</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        MinValue = minValue;</span><br><span class="line">        MaxValue = maxValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             TRangeDrawer.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> IntRangeDrawer.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 数值范围绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">[CustomPropertyDrawer(<span class="keyword">typeof</span>(TRangeAttribute))]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TRangeDrawer</span> : <span class="title">PropertyDrawer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params">Rect position, SerializedProperty property, GUIContent label</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tRangeAttribute = (TRangeAttribute)attribute;</span><br><span class="line">        <span class="keyword">if</span>(property.propertyType == SerializedPropertyType.Integer)</span><br><span class="line">        &#123;</span><br><span class="line">            EditorGUI.IntSlider(position, property, (<span class="keyword">int</span>)tRangeAttribute.MinValue, (<span class="keyword">int</span>)tRangeAttribute.MaxValue, label);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">else</span> <span class="title">if</span>(<span class="params">property.propertyType == SerializedPropertyType.Float</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            EditorGUI.Slider(position, property, tRangeAttribute.MinValue, tRangeAttribute.MaxValue, label);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            EditorGUILayout.LabelField(label, <span class="string">"请使用TRange到float或int上!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             TPreviewAttribute.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> TPreviewAttribute.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 可预览的标签</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TPreviewAttribute</span> : <span class="title">PropertyAttribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TPreviewAttribute</span>(<span class="params"></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             TPreviewDrawer.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> TPreviewDrawer.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 预览绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">[CustomPropertyDrawer(<span class="keyword">typeof</span>(TPreviewAttribute))]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TPreviewDrawer</span> : <span class="title">PropertyDrawer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 调整整体高度</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="property"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="label"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">float</span> <span class="title">GetPropertyHeight</span>(<span class="params">SerializedProperty property, GUIContent label</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">base</span>.GetPropertyHeight(property, label) + <span class="number">64</span>f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params">Rect position, SerializedProperty property, GUIContent label</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        EditorGUI.BeginProperty(position, label, property);</span><br><span class="line">        EditorGUI.PropertyField(position, property, label);</span><br><span class="line"></span><br><span class="line">        Texture2D previewTexture = GetAssetPreview(property);</span><br><span class="line">        <span class="keyword">if</span> (previewTexture != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Rect previewRect = <span class="keyword">new</span> Rect()</span><br><span class="line">            &#123;</span><br><span class="line">                x = position.x + GetIndentLength(position),</span><br><span class="line">                y = position.y + EditorGUIUtility.singleLineHeight,</span><br><span class="line">                width = position.width,</span><br><span class="line">                height = <span class="number">64</span></span><br><span class="line">            &#125;;</span><br><span class="line">            GUI.Label(previewRect, previewTexture);</span><br><span class="line">        &#125;</span><br><span class="line">        EditorGUI.EndProperty();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 获取显示缩进间隔</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="sourceRect"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">float</span> <span class="title">GetIndentLength</span>(<span class="params">Rect sourceRect</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        Rect indentRect = EditorGUI.IndentedRect(sourceRect);</span><br><span class="line">        <span class="keyword">float</span> indentLength = indentRect.x - sourceRect.x;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> indentLength;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 获取Asset预览显示纹理</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="property"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Texture2D <span class="title">GetAssetPreview</span>(<span class="params">SerializedProperty property</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (property.propertyType == SerializedPropertyType.ObjectReference)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (property.objectReferenceValue != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Texture2D previewTexture = AssetPreview.GetAssetPreview(property.objectReferenceValue);</span><br><span class="line">                <span class="keyword">return</span> previewTexture;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             InspectorPropertyDraw.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/02/21</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> InspectorPropertyDraw.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 自定义属性标签绘制</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InspectorPropertyDraw</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 整形数值</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [TRange(<span class="number">0</span>, <span class="number">100</span>)]</span><br><span class="line">    [Header(<span class="string">"整形数值"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> IntValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> float数值</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [TRange(<span class="number">0</span>, <span class="number">100</span>)]</span><br><span class="line">    [Header(<span class="string">"float数值"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> FloatValue;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 预览的预制件</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [TPreview]</span><br><span class="line">    [Header(<span class="string">"预览的预制件"</span>)]</span><br><span class="line">    <span class="keyword">public</span> GameObject PreviewPrefab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果展示:</p>
<p><img src="/img/Unity/EditorUIStudy/CustomInspectorPropertyDraw.PNG" alt="CustomInspectorPropertyDraw"></p>
<p>以上两个自定义属性显示标签主要参考:</p>
<p><a href="https://docs.unity3d.com/Manual/editor-PropertyDrawers.html" target="_blank" rel="external">Property Drawers</a></p>
<p><a href="https://indienova.com/indie-game-development/extending-unity-for-beginners/" target="_blank" rel="external">Unity 拓展编辑器入门指南</a></p>
<p>通过上面的基础学习，我们对于自定义Inspector面板的绘制就有基础的了解了，详细深入的学习在实战中进一步学习了解，这里就不再一一赘述。</p>
<p>Note:</p>
<ol>
<li><strong>Unity默认不支持序列化Dictionary和多维数组等，需要自己通过ISerializationCallbackReceiver接口进行自定义序列化支持</strong></li>
<li><strong>Unity不支持序列化null以及多态的数据</strong></li>
<li><strong>尽量使用SerializedObject和SerializedProperty(泛型设计支持)进行Inspector编写，支持Undo系统，不会有嵌套预制件保存问题</strong></li>
<li><strong>SerializedObject.Update()的调用是为了确保数据修改同步，SerializedObject.ApplyModifiedProperties()是为了对于数据的修改写入生效。总结在OnInspectorGUI()方法最前面调用serializedObject.Update()在最后调用serializedObject.ApplyModifiesdProperties()确保对于SerializedObject和SerializedProperty的修改和读取正确。</strong></li>
</ol>
<h4 id="TreeView绘制">TreeView绘制</h4><h5 id="基础知识">基础知识</h5><p>TreeView是一个比较特殊的绘制UI，他可以以树状结构来显示我们的指定数据信息(这个个人平时用的不多作为学习了解)</p>
<p>首先让我们看下官网对TreeView的介绍:<br><a href="https://docs.unity3d.com/Manual/TreeViewAPI.html" target="_blank" rel="external">TreeView is an IMGUI control used to display hierarchical data that you can expand and collapse. Use TreeView to create highly customizable list views and multi-column tables for Editor windows, which you can use alongside other IMGUI controls and components.</a><br>可以看到TreeView主要用于实现可以自定义快捷操作的多行多列窗口显示的组件。</p>
<p>让我们先了解一下TreeView里几个重要的类，方法和相关概念:</p>
<ul>
<li><p><strong>TreeViewState</strong><br><a href="https://docs.unity3d.com/Manual/TreeViewAPI.html" target="_blank" rel="external">TreeViewState contains state information that is changed when interacting with TreeView fields in the Editor, such as selection state, expanded state, navigation state, and scroll state. TreeViewState is the only state that is serializable. The TreeView itself is not serializable - it is reconstructed from the data that it represents when it is constructed or reloaded. </a>(TreeViewState是用于序列化网格列表的一些操作信息，TreeView自身是不序列化的，但TreeViewState是支持序列化的，用于记录所有相关操作信息(e.g. 比如选择状态，展开状态，滚动状态等))</p>
</li>
<li><p><strong>TreeViewItem</strong><br><a href="https://docs.unity3d.com/Manual/TreeViewAPI.html" target="_blank" rel="external">TreeViewItem contains data about an individual TreeView item, and is used to build the representation of the tree structure in the Editor. Each TreeViewItem must be constructed with a unique integer ID (unique among all the items in the TreeView). The ID is used for finding items in the tree for the selection state, expanded state, and navigation. All TreeViewItems have a depth property, which indicates the visual indentation.</a>(TreeViewItem表示TreeView里的单个单元，包含了单个单元里的数据，每一个TreeViewItem必须要有一个唯一ID(用于查询每一个TreeViewItem的TreeViewState数据。每一个TreeViewItems必须要有depth属性来标识树状深度。))</p>
</li>
<li><p><strong>BuildRoot</strong><br><a href="https://docs.unity3d.com/Manual/TreeViewAPI.html" target="_blank" rel="external">BuildRoot is the single abstract method of the TreeView class that must be implemented to create a TreeView. Use this method to handle creating the root item of the tree. This is called every time Reload is called on the tree. </a>(BuildRoot是一个必须实现的用于构建TreeView根节点的抽象方法，每一次编辑器Reload都会触发调用构建最新的TreeView。)</p>
</li>
<li><p><strong>BuildRows</strong><br><a href="https://docs.unity3d.com/Manual/TreeViewAPI.html" target="_blank" rel="external">BuildRows is a virtual method where the default implementation handles building the rows list based on the full tree created in BuildRoot. If only the root was created in BuildRoot, this method should be overridden to handle the expanded rows. </a>(BuildRows是用于根据BuildRoot构建的TreeView进行自定义行显示的虚方法流程。可以支持我们自定义搜索以及只构建可见行展示等自定义行显示功能。适用于大数据自定义构建显示的情况。)</p>
</li>
<li><p><strong>RowGUI</strong></p>
<p><a href="https://docs.unity3d.com/ScriptReference/IMGUI.Controls.TreeView.RowGUI.html" target="_blank" rel="external">Override this method to add custom GUI content for the rows in the TreeView.</a>(自定义每行单元格的显示接口)</p>
</li>
<li><p><strong>MultiColumnHeader</strong><br><a href="https://docs.unity3d.com/ScriptReference/IMGUI.Controls.MultiColumnHeader.html" target="_blank" rel="external">The MultiColumnHeader is a general purpose class that e.g can be used with the TreeView to create multi-column tree views and list views. It supports resizing of columns widths by dragging and provides useful callbacks for reacting to user input.</a>(MultiColumnHeader用于定义多列数据显示相关数据，用于支持多列的TreeView显示和拖拽列宽度以及响应玩家操作等。)</p>
</li>
<li><p><strong>MultiColumnHeaderState</strong></p>
<p>跟TreeViewState类似，是用于构建MultiColumnHeader的状态数据。</p>
</li>
</ul>
<p><strong>TreeView构建流程图</strong>:<br><img src="/img/Unity/EditorUIStudy/TreeViewFlowChart.png" alt="TreeViewFlowChart"></p>
<p>在了解官方更多抽象之前，让我们先了解几个TreeView里的基本但很重要的概念。</p>
<ul>
<li><p>TreeView表示我们想要构建树状网格结构显示的基类抽象。</p>
</li>
<li><p>TreeView里的单元格由TreeViewItem定义，TreeViewItem表里树状结构里的每一条单元数据。</p>
</li>
<li><p>TreeViewItem里的id必须唯一，用于查询TreeViewItem的状态数据(TreeViewState)，depth标识着单条数据在树状结构里的第几层(同时也标识这TreeViewItem之间的深度即父子关系)，displayName标识着TreeViewItem的显示名字。</p>
</li>
<li><p>TreeViewState记录着TreeViewItem的一些操作序列化数据(e.g. 比如选择状态，展开状态，滚动状态等)。</p>
</li>
<li>MultiColumnHeader是TreeView支持多列显示的抽象类。</li>
<li>MultiColumnHeaderState跟TreeViewState类似，是用于构建MultiColumnHeader的状态数据。</li>
</ul>
<p>从上面的基础介绍可以看出，简单的TreeView对于数据单元的构建是通过TreeViewItem封装而来，而TreeViewItem能封装的数据仅限于id和displayName，这样对于我们快速访问自定义数据并不友好，个人猜测这也是为什么官方为设计泛型TreeView的原因。</p>
<p>Note:</p>
<ol>
<li><strong>BuildRoot在编辑器每次Reload时会调用。BuildRows在每次BuildRoot调用后以及发生折叠展开操作时。</strong></li>
<li><strong>TreeView的初始化发生在每次调用TreeView的Reload方法时。</strong></li>
</ol>
<h5 id="深入学习">深入学习</h5><p>接下来让我们看看官方事例是如何抽象泛型TreeView的。</p>
<p>让我们先来简单理解下各个抽象类的含义：</p>
<ul>
<li><p>TreeElement — 自定义TreeViewItem的数据定义基类抽象，负责抽象需要序列化的数据以及TreeViewItem所需的父子概念。</p>
</li>
<li><p>TreeModel — 泛型定义，用于封装所有的TreeElement数据，抽象出跟节点数据概念以及唯一ID获取以及数据添加删除等接口。</p>
</li>
<li>TreeElementUtility — TreeElement数据相关操作辅助方法(e.g. 从数据列表构建TreeElement树状结构或从根节点反向构建数据列表等)。</li>
<li>TreeViewItem<t> — 泛型定义，抽象不同数据类型的TreeElement封装访问。</t></li>
<li>TreeViewWithTreeModel<t> — 泛型定义，抽象不同数据类型的TreeModel的TreeView封装访问以及通用的数据添加以及搜索等功能。</t></li>
</ul>
<h5 id="实战实现">实战实现</h5><p>以下代码根据官方TreeView多列事例(MultiColumnWindow)代码学习编写，但部分类名有所更改，请自行对上官方定义。</p>
<p>接下来看下实战我们怎么基于官方的泛型抽象，实现自定义一个消息统计树状结构展示以及增删改查的。</p>
<p>先看下本人的类定义:</p>
<ul>
<li>MessageAsset(继承至ScriptableObject) — 消息统计基础数据定义，用于填充一些基础的消息统计数据(e.g. 消息黑名单，消息介绍等)。</li>
<li>MessageTreeAsset(继承至ScriptableObject) — 消息TreeView的原始数据Asset结构定义。</li>
<li>MessageTreeAssetEditor(继承至Editor) — 自定义MessageTreeAsset的Inspector面板显示(支持增删以及查看基础数据等操作)。</li>
<li>MessageTreeViewElement(继承至TreeViewElement) — 消息TreeView的单条数据结构定义。</li>
<li>MessageWindow(继承至EditorWindow) — 消息辅助窗口的窗口实现。</li>
<li>MessageTreeView(继承至TreeViewWithModel) — 实现泛型的TreeView定义，将MessageTreeViewElement作为自定义数据结构。</li>
</ul>
<p>先直接放几张效果图:</p>
<p><img src="/img/Unity/EditorUIStudy/MessageStatisticUI.PNG" alt="MessageStatisticUI"></p>
<p><img src="/img/Unity/EditorUIStudy/MessagePreviewUI.PNG" alt="MessagePreviewUI"></p>
<p><img src="/img/Unity/EditorUIStudy/MessageSimulationUI.PNG" alt="MessageSimulationUI"></p>
<p><img src="/img/Unity/EditorUIStudy/MessageTreeAssetEditorUI.PNG" alt="MessageTreeAssetEditorUI"></p>
<p>TreeView的泛型实现和自定义Inspector是第二张和第四张效果图。</p>
<p>本人实现了自定义MessageTreeeViewElement数据结构的TreeView展示。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Description:             MessageTreeViewElement.cs</span><br><span class="line"> * Author:                  TONYTANG</span><br><span class="line"> * Create Date:             2022/04/22</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> MessageTreeViewElement.cs</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 消息树形数据结构</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">[Serializable]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessageTreeViewElement</span> : <span class="title">TreeViewElement</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 消息类型</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> MessageType</span><br><span class="line">    &#123;</span><br><span class="line">        Request = <span class="number">0</span>,</span><br><span class="line">        Push,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 消息名</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"消息名"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> MsgName;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 消息类型</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"消息类型"</span>)]</span><br><span class="line">    <span class="keyword">public</span> MessageTreeViewElement.MessageType MsgType;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 消息内容</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"消息内容"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> MsgContent;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 消息注释</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    [Header(<span class="string">"消息注释"</span>)]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> MsgAnnotation;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 带参构造函数</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="id"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="depth"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="name"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageTreeViewElement</span>(<span class="params"><span class="keyword">int</span> id, <span class="keyword">int</span> depth, <span class="keyword">string</span> name</span>) : <span class="title">base</span>(<span class="params">id, depth, name</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        MsgName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> 带参构造函数</span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="id"&gt;</span>唯一id<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="depth"&gt;</span>深度值<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="name"&gt;</span>显示名字<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="msgType"&gt;</span>消息类型<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="msgContent"&gt;</span>消息内容<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="msgAnnotation"&gt;</span>消息注释<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageTreeViewElement</span>(<span class="params"><span class="keyword">int</span> id, <span class="keyword">int</span> depth, <span class="keyword">string</span> name, MessageType msgType, <span class="keyword">string</span> msgContent, <span class="keyword">string</span> msgAnnotation</span>) : <span class="title">base</span>(<span class="params">id, depth, name</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        MsgName = name;</span><br><span class="line">        MsgType = msgType;</span><br><span class="line">        MsgContent = msgContent;</span><br><span class="line">        MsgAnnotation = msgAnnotation;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过使MessageTreeView继承TreeViewWithTreeModel<messagetreeviewelement>实现泛型的TreeView自定义构建和行列展示以及搜索排序等功能。</messagetreeviewelement></p>
<p>接下来我将细节展示我是如何实现TreeView的自定义数据构建和行列展示以及搜索排序等功能的。</p>
<p>为了支持多列显示，我们必须传递MultiColumnHeader来构建MessageTreeView:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 带参构造函数</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="state"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="multicolumnHeader"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="model"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MessageTreeView</span>(<span class="params">TreeViewState state, MultiColumnHeader multicolumnHeader, TreeModel&lt;MessageTreeViewElement&gt; model</span>) : <span class="title">base</span>(<span class="params">state, multicolumnHeader, model</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    columnIndexForTreeFoldouts = <span class="number">0</span>;</span><br><span class="line">    showAlternatingRowBackgrounds = <span class="keyword">true</span>;</span><br><span class="line">    showBorder = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">// 监听排序设置变化</span></span><br><span class="line">    multicolumnHeader.sortingChanged += OnSortingChanged;</span><br><span class="line"></span><br><span class="line">    Reload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多列的数据状态MultiColumnHeaderState通过自定义方法构建返回:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 创建默认的多列显示状态数据</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MultiColumnHeaderState <span class="title">CreateDefaultMultiColumnHeaderState</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> columns = <span class="keyword">new</span>[]</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> MultiColumnHeaderState.Column</span><br><span class="line">        &#123;</span><br><span class="line">            headerContent = <span class="keyword">new</span> GUIContent(<span class="string">"消息名"</span>, <span class="string">"消息名"</span>),</span><br><span class="line">            contextMenuText = <span class="string">"消息名"</span>,</span><br><span class="line">            headerTextAlignment = TextAlignment.Center,</span><br><span class="line">            sortedAscending = <span class="keyword">true</span>,</span><br><span class="line">            sortingArrowAlignment = TextAlignment.Right,</span><br><span class="line">            width = <span class="number">200</span>,</span><br><span class="line">            minWidth = <span class="number">200</span>,</span><br><span class="line">            maxWidth = <span class="number">250</span>,</span><br><span class="line">            autoResize = <span class="keyword">false</span>,</span><br><span class="line">            allowToggleVisibility = <span class="keyword">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> MultiColumnHeaderState.Column</span><br><span class="line">        &#123;</span><br><span class="line">            headerContent = <span class="keyword">new</span> GUIContent(EditorGUIUtility.FindTexture(<span class="string">"FilterByLabel"</span>), <span class="string">"消息类型"</span>),</span><br><span class="line">            contextMenuText = <span class="string">"消息类型"</span>,</span><br><span class="line">            headerTextAlignment = TextAlignment.Center,</span><br><span class="line">            sortedAscending = <span class="keyword">true</span>,</span><br><span class="line">            sortingArrowAlignment = TextAlignment.Right,</span><br><span class="line">            width = <span class="number">40</span>,</span><br><span class="line">            minWidth = <span class="number">40</span>,</span><br><span class="line">            maxWidth = <span class="number">60</span>,</span><br><span class="line">            autoResize = <span class="keyword">false</span>,</span><br><span class="line">            allowToggleVisibility = <span class="keyword">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> MultiColumnHeaderState.Column</span><br><span class="line">        &#123;</span><br><span class="line">            headerContent = <span class="keyword">new</span> GUIContent(<span class="string">"消息注释"</span>, <span class="string">"消息注释"</span>),</span><br><span class="line">            contextMenuText = <span class="string">"消息介绍"</span>,</span><br><span class="line">            headerTextAlignment = TextAlignment.Center,</span><br><span class="line">            sortingArrowAlignment = TextAlignment.Right,</span><br><span class="line">            width = <span class="number">200</span>,</span><br><span class="line">            minWidth = <span class="number">200</span>,</span><br><span class="line">            maxWidth = <span class="number">250</span>,</span><br><span class="line">            autoResize = <span class="keyword">false</span>,</span><br><span class="line">            allowToggleVisibility = <span class="keyword">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> MultiColumnHeaderState.Column</span><br><span class="line">        &#123;</span><br><span class="line">            headerContent = <span class="keyword">new</span> GUIContent(<span class="string">"消息内容"</span>, <span class="string">"消息内容"</span>),</span><br><span class="line">            contextMenuText = <span class="string">"消息内容"</span>,</span><br><span class="line">            headerTextAlignment = TextAlignment.Center,</span><br><span class="line">            sortingArrowAlignment = TextAlignment.Right,</span><br><span class="line">            width = <span class="number">120</span>,</span><br><span class="line">            minWidth = <span class="number">120</span>,</span><br><span class="line">            maxWidth = <span class="number">150</span>,</span><br><span class="line">            autoResize = <span class="keyword">false</span>,</span><br><span class="line">            allowToggleVisibility = <span class="keyword">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">new</span> MultiColumnHeaderState.Column</span><br><span class="line">        &#123;</span><br><span class="line">            headerContent = <span class="keyword">new</span> GUIContent(<span class="string">"删除"</span>, <span class="string">"删除"</span>),</span><br><span class="line">            contextMenuText = <span class="string">"删除"</span>,</span><br><span class="line">            headerTextAlignment = TextAlignment.Center,</span><br><span class="line">            sortingArrowAlignment = TextAlignment.Right,</span><br><span class="line">            width = <span class="number">80</span>,</span><br><span class="line">            minWidth = <span class="number">80</span>,</span><br><span class="line">            maxWidth = <span class="number">80</span>,</span><br><span class="line">            autoResize = <span class="keyword">false</span>,</span><br><span class="line">            allowToggleVisibility = <span class="keyword">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> state = <span class="keyword">new</span> MultiColumnHeaderState(columns);</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MessageTreeView通过重写BuildRoot,BuildRows和RowGUI接口实现根节点构建以及只构建可见的行数据和显示:</p>
<p>TreeViewWithModel.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 构建TreeView根节点</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> TreeViewItem <span class="title">BuildRoot</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TreeViewItemGeneric&lt;T&gt;(TreeModel.Root.ID, -<span class="number">1</span>, TreeModel.Root.Name, TreeModel.Root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 构建TreeView单行数据节点</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IList&lt;TreeViewItem&gt; <span class="title">BuildRows</span>(<span class="params">TreeViewItem root</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (TreeModel.Root == <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogError(<span class="string">"TreeModel Root is null. Did you call SetData()?"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    RowList.Clear();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(searchString))</span><br><span class="line">    &#123;</span><br><span class="line">        Search(TreeModel.Root, searchString, RowList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (TreeModel.Root.HasChild())</span><br><span class="line">        &#123;</span><br><span class="line">            AddChildrenRecursive(TreeModel.Root, <span class="number">0</span>, RowList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自动构建节点深度信息</span></span><br><span class="line">    SetupParentsAndChildrenFromDepths(root, RowList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RowList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 递归添加子节点</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="parent"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="depth"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="newRows"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AddChildrenRecursive</span>(<span class="params">T parent, <span class="keyword">int</span> depth, IList&lt;TreeViewItem&gt; newRows</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (T child <span class="keyword">in</span> parent.ChildList)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> item = <span class="keyword">new</span> TreeViewItemGeneric&lt;T&gt;(child.ID, depth, child.Name, child);</span><br><span class="line">        newRows.Add(item);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (child.HasChild())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (IsExpanded(child.ID))</span><br><span class="line">            &#123;</span><br><span class="line">                AddChildrenRecursive(child, depth + <span class="number">1</span>, newRows);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                item.children = CreateChildListForCollapsedParent();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MessageTreeView.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 自定义构建行显示</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IList&lt;TreeViewItem&gt; <span class="title">BuildRows</span>(<span class="params">TreeViewItem root</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> rows = <span class="keyword">base</span>.BuildRows(root);</span><br><span class="line">    SortIfNeeded(root, rows);</span><br><span class="line">    <span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 自定义TreeView每行显示</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="args"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RowGUI</span>(<span class="params">RowGUIArgs args</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> item = (TreeViewItemGeneric&lt;MessageTreeViewElement&gt;)args.item;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只构建可见的TreeView Row</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.GetNumVisibleColumns(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        CellGUI(args.GetCellRect(i), item, (MessageTreeColumns)args.GetColumn(i), <span class="keyword">ref</span> args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 单行显示</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="cellRect"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="item"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="column"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="args"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CellGUI</span>(<span class="params">Rect cellRect, TreeViewItemGeneric&lt;MessageTreeViewElement&gt; item, MessageTreeColumns column, <span class="keyword">ref</span> RowGUIArgs args</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// Center cell rect vertically (makes it easier to place controls, icons etc in the cells)</span></span><br><span class="line">    CenterRectUsingSingleLineHeight(<span class="keyword">ref</span> cellRect);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (column)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> MessageTreeColumns.MessageName:</span><br><span class="line">            <span class="comment">// 显示初始折叠和描述信息</span></span><br><span class="line">            <span class="keyword">base</span>.RowGUI(args);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MessageTreeColumns.MessageType:</span><br><span class="line">            <span class="keyword">var</span> iconTexture = item.Data.MsgType == MessageTreeViewElement.MessageType.Push ? PushIconTexture : PullIconTexture;</span><br><span class="line">            GUI.DrawTexture(cellRect, iconTexture, ScaleMode.ScaleToFit);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MessageTreeColumns.MessageAnnotation:</span><br><span class="line">            item.Data.MsgAnnotation = EditorGUI.TextField(cellRect, item.Data.MsgAnnotation);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MessageTreeColumns.MessageContent:</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(cellRect, <span class="string">"编辑消息内容"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> messageWindow = MessageWindow.OpenMessageWindow();</span><br><span class="line">                messageWindow.SetSelectedMessageSimulation(item.Data);</span><br><span class="line">                messageWindow.SelectMessageTag(MessageWindow.MessageTag.MessageSimulation);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MessageTreeColumns.MessageDelete:</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(cellRect, <span class="string">"-"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                TreeModel.RemoveElementByID(item.Data.ID);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面构建自定义行数据和展示用到了几个比较重要的接口:</p>
<p>IsExpanded() — 判定指定数据ID节点是否展开</p>
<p>CreateChildListForCollapsedParent() — 为没展开的数据节点创建一个假的子节点，避免构建所有子数据节点</p>
<p>SetupParentsAndChildrenFromDepths() — 通过根节点和自定义构建的行数据节点，自动进行深度以及父子关系关联。</p>
<p>为了支持列排序设置，通过在MessageTreeView构造函数里监听MultiColumnHeader.sortingChanged接口实现自定义排序:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听排序设置变化</span></span><br><span class="line">multicolumnHeader.sortingChanged += OnSortingChanged;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 排序回调</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="multiColumnHeader"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnSortingChanged</span>(<span class="params">MultiColumnHeader multiColumnHeader</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    SortIfNeeded(rootItem, GetRows());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 排序</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="rows"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SortIfNeeded</span>(<span class="params">TreeViewItem root, IList&lt;TreeViewItem&gt; rows</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rows.Count &lt;= <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有设置排序的列</span></span><br><span class="line">    <span class="keyword">if</span> (multiColumnHeader.sortedColumnIndex == -<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SortByMultipleColumns();</span><br><span class="line">    TreeToList(root, rows);</span><br><span class="line">    Repaint();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 根据多列设置排序</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SortByMultipleColumns</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sortedColumns = multiColumnHeader.state.sortedColumns;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sortedColumns.Length == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 暂时只根据单个设置排序</span></span><br><span class="line">    SortByColumnIndex(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 根据指定列索引排序</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="index"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SortByColumnIndex</span>(<span class="params"><span class="keyword">int</span> index</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sortedColumns = multiColumnHeader.state.sortedColumns;</span><br><span class="line">    <span class="keyword">if</span> (sortedColumns.Length == <span class="number">0</span> || sortedColumns.Length &lt;= index)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!mSortOptionsMap.ContainsKey(sortedColumns[index]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> childTreeViewItems = rootItem.children.Cast&lt;TreeViewItemGeneric&lt;MessageTreeViewElement&gt;&gt;();</span><br><span class="line">    SortOption sortOption = mSortOptionsMap[sortedColumns[index]];</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">ascending</span> = multiColumnHeader.IsSortedAscending(sortedColumns[index]);</span><br><span class="line">    <span class="keyword">switch</span> (sortOption)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> SortOption.MsgName:</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">ascending</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                childTreeViewItems = childTreeViewItems.OrderBy(treeViewItemGeneric =&gt; treeViewItemGeneric.Data.MsgName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                childTreeViewItems = childTreeViewItems.OrderByDescending(treeViewItemGeneric =&gt; treeViewItemGeneric.Data.MsgName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> SortOption.MsgType:</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">ascending</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                childTreeViewItems = childTreeViewItems.OrderBy(treeViewItemGeneric =&gt; treeViewItemGeneric.Data.MsgType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                childTreeViewItems = childTreeViewItems.OrderByDescending(treeViewItemGeneric =&gt; treeViewItemGeneric.Data.MsgType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    rootItem.children = childTreeViewItems.Cast&lt;TreeViewItem&gt;().ToList();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 构建</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="result"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">TreeToList</span>(<span class="params">TreeViewItem root, IList&lt;TreeViewItem&gt; result</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullReferenceException(<span class="string">"不能传空根节点!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullReferenceException(<span class="string">"不能传空结果列表!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result.Clear();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (root.children == <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Stack&lt;TreeViewItem&gt; stack = <span class="keyword">new</span> Stack&lt;TreeViewItem&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = root.children.Count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        stack.Push(root.children[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (stack.Count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        TreeViewItem current = stack.Pop();</span><br><span class="line">        result.Add(current);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (current.hasChildren &amp;&amp; current.children[<span class="number">0</span>] != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = current.children.Count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            &#123;</span><br><span class="line">                stack.Push(current.children[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了支持树状消息自定义搜索展示，构建SearchField并绑定TreeView的SetFocusAndEnsureSelectedItem接口:</p>
<p>MessageWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mSearchField = <span class="keyword">new</span> SearchField();</span><br><span class="line"><span class="comment">// 将搜索栏的输入回调和TreeView关联方便搜索检测</span></span><br><span class="line">mSearchField.downOrUpArrowKeyPressed += mMessageTreeView.SetFocusAndEnsureSelectedItem;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 绘制搜索区域</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span><span class="xmlDocTag">&lt;param name="rect"&gt;</span>绘制区域信息<span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DrawSearchBarArea</span>(<span class="params">Rect rect</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(mMessageTreeView != <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 显示关联TreeView的搜索栏</span></span><br><span class="line">        mMessageTreeView.searchString = mSearchField.OnGUI(rect, mMessageTreeView.searchString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TreeViewWithTreeModel.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 构建TreeView单行数据节点</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IList&lt;TreeViewItem&gt; <span class="title">BuildRows</span>(<span class="params">TreeViewItem root</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">   ***</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 支持搜索功能</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(searchString))</span><br><span class="line">    &#123;</span><br><span class="line">        Search(TreeModel.Root, searchString, RowList);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ***</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了操作方便，我还监听了MessageTreeAsset的双击打开操作，快速打开窗口进行消息预览:</p>
<p>MessageWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 监听Asset双击打开</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="instanceID"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="line"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line">[OnOpenAsset]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">OnOpenAsset</span>(<span class="params"><span class="keyword">int</span> instanceID, <span class="keyword">int</span> line</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> treeAsset = EditorUtility.InstanceIDToObject(instanceID) <span class="keyword">as</span> MessageTreeAsset;</span><br><span class="line">    <span class="keyword">if</span> (treeAsset != <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> window = OpenMessageWindow();</span><br><span class="line">        window.SetTreeAsset(treeAsset);</span><br><span class="line">        window.SelectMessageTag(MessageTag.MessagePreview);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TreeElementUtility.cs负责实现二楼TreeViewElement相关的几个比较重要的方法接口:</p>
<p>TreeElementUtility.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 将树形根节点转换到数据列表</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;typeparam name="T"&gt;</span><span class="xmlDocTag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="result"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> TreeToList&lt;T&gt;(T root, IList&lt;T&gt; result) <span class="keyword">where</span> T : TreeViewElement</span><br><span class="line">&#123;</span><br><span class="line">	******</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 从数据列表里生成TreeView</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;typeparam name="T"&gt;</span><span class="xmlDocTag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="list"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span>返回根节点<span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> T ListToTree&lt;T&gt;(IList&lt;T&gt; list) <span class="keyword">where</span> T : TreeViewElement</span><br><span class="line">&#123;</span><br><span class="line">	******</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 检查数据列表信息</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;typeparam name="T"&gt;</span><span class="xmlDocTag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="list"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> ValidateDepthValues&lt;T&gt;(IList&lt;T&gt; list) <span class="keyword">where</span> T : TreeViewElement</span><br><span class="line">&#123;</span><br><span class="line">	******</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 查找TreeView列表的根数据</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="treeViewElementList"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocTag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> T FindRootTreeViewElement&lt;T&gt;(IList&lt;T&gt; treeViewElementList) <span class="keyword">where</span> T : TreeViewElement</span><br><span class="line">&#123;</span><br><span class="line">	******</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> 更新节点深度信息</span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;typeparam name="T"&gt;</span><span class="xmlDocTag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name="root"&gt;</span><span class="xmlDocTag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> UpdateDepthValues&lt;T&gt;(T root) <span class="keyword">where</span> T : TreeViewElement</span><br><span class="line">&#123;</span><br><span class="line">	******</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完整代码链接:</p>
<p><a href="https://github.com/TonyTang1990/EditorUIStudy" target="_blank" rel="external">EditorUIStudy</a></p>
<p>上述Git还包含了其他Editor相关GUI学习的代码，TreeView的入口为Tools-&gt;消息辅助窗口。</p>
<h2 id="UI_Toolkit">UI Toolkit</h2><p>待添加……</p>
<h2 id="UGUI">UGUI</h2><p>UGUI是UIToolkit之前出的一套用于运行时的UI框架，本篇章主要学习Editor相关的GUI，这里就深入学习讲解了。</p>
<h1 id="Editor工具分类">Editor工具分类</h1><p>待添加……</p>
<h1 id="Editor数据存储">Editor数据存储</h1><p>待添加……</p>
<h1 id="Editor常用标签">Editor常用标签</h1><p>待添加……</p>
<h1 id="学习总结">学习总结</h1><ol>
<li><strong>Gizmos主要用于绘制Scene场景里的可视化调试(比如绘制线，图标，cube等)，不支持交互。</strong></li>
<li><strong>Handles主要用于绘制Scene场景里3D可交互UI(比如可拉伸坐标轴，按钮等)。</strong></li>
<li><strong>GUI的坐标系是左上角0,0</strong></li>
<li><strong>GUISkins是GUIStyls的合集，GUIStyles定义了我们GUI的样式</strong></li>
</ol>
<h1 id="Github">Github</h1><p>参考学习Github:</p>
<p><a href="https://github.com/seyedmoeinsaadati/ThreeDDrawing" target="_blank" rel="external"> ThreeDDrawing</a></p>
<p>个人Github:</p>
<p>待添加……</p>
<h1 id="Reference">Reference</h1><p><a href="https://indienova.com/indie-game-development/extending-unity-for-beginners/" target="_blank" rel="external">Unity 拓展编辑器入门指南</a></p>
<p><a href="https://docs.unity3d.com/Manual/UIToolkits.html" target="_blank" rel="external">Creating user interfaces (UI)</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Editor/">Editor</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Editor/">Editor</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://tonytang1990.github.io/2022/02/20/UnityEditor知识/" data-title="UnityEditor知识 | 走停人生路" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2022/02/21/数学知识/" title="数学知识">
  <strong>上一篇：</strong><br/>
  <span>
  数学知识</span>
</a>
</div>


<div class="next">
<a href="/2022/01/21/碰撞检测/"  title="碰撞检测">
 <strong>下一篇：</strong><br/> 
 <span>碰撞检测
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2022/02/20/UnityEditor知识/" data-title="UnityEditor知识" data-url="http://tonytang1990.github.io/2022/02/20/UnityEditor知识/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor绘制分类"><span class="toc-number">2.</span> <span class="toc-text">Editor绘制分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IMGUI"><span class="toc-number">2.1.</span> <span class="toc-text">IMGUI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GUI"><span class="toc-number">2.1.1.</span> <span class="toc-text">GUI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUI_Layout"><span class="toc-number">2.1.2.</span> <span class="toc-text">GUI Layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GUISkin和GUIStyle"><span class="toc-number">2.1.3.</span> <span class="toc-text">GUISkin和GUIStyle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UIEvent"><span class="toc-number">2.1.4.</span> <span class="toc-text">UIEvent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IMGUI实战"><span class="toc-number">2.1.5.</span> <span class="toc-text">IMGUI实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Scene辅助GUI绘制"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">Scene辅助GUI绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实战"><span class="toc-number">2.1.5.1.1.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Editor窗口绘制"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">Editor窗口绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实战-1"><span class="toc-number">2.1.5.2.1.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Inspector面板绘制"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">Inspector面板绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实战-2"><span class="toc-number">2.1.5.3.1.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TreeView绘制"><span class="toc-number">2.1.5.4.</span> <span class="toc-text">TreeView绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#基础知识"><span class="toc-number">2.1.5.4.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#深入学习"><span class="toc-number">2.1.5.4.2.</span> <span class="toc-text">深入学习</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#实战实现"><span class="toc-number">2.1.5.4.3.</span> <span class="toc-text">实战实现</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI_Toolkit"><span class="toc-number">2.2.</span> <span class="toc-text">UI Toolkit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UGUI"><span class="toc-number">2.3.</span> <span class="toc-text">UGUI</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor工具分类"><span class="toc-number">3.</span> <span class="toc-text">Editor工具分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor数据存储"><span class="toc-number">4.</span> <span class="toc-text">Editor数据存储</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Editor常用标签"><span class="toc-number">5.</span> <span class="toc-text">Editor常用标签</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#学习总结"><span class="toc-number">6.</span> <span class="toc-text">学习总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Github"><span class="toc-number">7.</span> <span class="toc-text">Github</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">8.</span> <span class="toc-text">Reference</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Art/" title="Art">Art<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Automation/" title="Automation">Automation<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Collision/" title="Collision">Collision<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Database/" title="Database">Database<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Editor/" title="Editor">Editor<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Excel/" title="Excel">Excel<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/HotUpdate/" title="HotUpdate">HotUpdate<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Math/" title="Math">Math<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Native/" title="Native">Native<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Network/" title="Network">Network<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Optimization/" title="Optimization">Optimization<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Other/" title="Other">Other<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Plugin/" title="Plugin">Plugin<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Language/" title="Programming Language">Programming Language<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Rendering/" title="Rendering">Rendering<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Resource/" title="Resource">Resource<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Unity/" title="Unity">Unity<sup>7</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Unity/" title="Unity">Unity<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/OpenGL/" title="OpenGL">OpenGL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Other/" title="Other">Other<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Math/" title="Math">Math<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Resource/" title="Resource">Resource<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Editor/" title="Editor">Editor<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Excel/" title="Excel">Excel<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Art/" title="Art">Art<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Collision/" title="Collision">Collision<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/VersionControl/" title="VersionControl">VersionControl<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/HotUpdate/" title="HotUpdate">HotUpdate<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Algorithm/" title="Algorithm">Algorithm<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Network/" title="Network">Network<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Sort/" title="Sort">Sort<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/GameDesignPattern/" title="GameDesignPattern">GameDesignPattern<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Optimization/" title="Optimization">Optimization<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Time/" title="Time">Time<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Plugin/" title="Plugin">Plugin<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Prefab/" title="Prefab">Prefab<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Tony Tang. <br/>
			This is my new blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2022 
		
		<a href="/about" target="_blank" title="Tony Tang">Tony Tang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"TonyTang1990"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
