
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>UIToolkit | 走停人生路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Tony Tang">
    

    
    <meta name="description" content="Introduction之前有一篇学习Unity Editor相关的知识:UnityEditor知识 UIToolkit作为Unity最新一代UI系统，这里准备单独用篇来学习记录，通过深入学习UIToolkit，为后续编写一套节点系统做准备(用于AI系统，剧情系统和引导系统实现)。 Note:  本章节重点是UIToolkit在Editor上的学习使用，Runtime目前看来UIToolkit还不">
<meta property="og:type" content="article">
<meta property="og:title" content="UIToolkit">
<meta property="og:url" content="http://tonytang1990.github.io/2023/05/20/UIToolkit%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="走停人生路">
<meta property="og:description" content="Introduction之前有一篇学习Unity Editor相关的知识:UnityEditor知识 UIToolkit作为Unity最新一代UI系统，这里准备单独用篇来学习记录，通过深入学习UIToolkit，为后续编写一套节点系统做准备(用于AI系统，剧情系统和引导系统实现)。 Note:  本章节重点是UIToolkit在Editor上的学习使用，Runtime目前看来UIToolkit还不">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIToolkitDrawingOrder.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/USSBoxModel.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/EventPropagation.png">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIToolkitDebuggerPreview.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIBuilder.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIToolkitSampleWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIToolkitEditorWindowCreator.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UICreateUIByCodeEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIChangeUSSByCodeEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIUseUSSEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIPositionAndLayoutEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UICustomUSSVariableEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIEventHandleEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/ToolbarMenuPreview.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/ToolbarMenuLog.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/PopupFieldPreview.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/PopupFieldLog.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/ButtonPreview.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/FolderChosenButtonClickPreview.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/FoldoutPreivew.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/ListViewPreview.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/ListViewButtonClickLog.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/PropertyBindSOEditorWindow.PNG">
<meta property="og:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/PropertyBindCBSOEditorWindow.PNG">
<meta property="article:published_time" content="2023-05-20T00:43:00.000Z">
<meta property="article:modified_time" content="2025-03-30T09:18:57.055Z">
<meta property="article:author" content="Tony Tang">
<meta property="article:tag" content="Editor">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tonytang1990.github.io/img/Unity/UIToolkit/UIToolkitDrawingOrder.png">

    
    <link rel="alternative" href="/atom.xml" title="走停人生路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="走停人生路" title="走停人生路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="走停人生路">走停人生路</a></h1>
				<h2 class="blog-motto">做着独立游戏梦，坚持走在游戏开发道路上的人</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:tonytang1990.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2023/05/20/UIToolkit学习/" title="UIToolkit" itemprop="url">UIToolkit</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Tony Tang" target="_blank" itemprop="author">Tony Tang</a>
		
  <p class="article-time">
    <time datetime="2023-05-20T00:43:00.000Z" itemprop="datePublished"> 发表于 2023-05-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UIToolkit"><span class="toc-number">2.</span> <span class="toc-text">UIToolkit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-system"><span class="toc-number">2.1.</span> <span class="toc-text">UI  system</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Visual-tree"><span class="toc-number">2.1.1.</span> <span class="toc-text">Visual tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layout-Engine"><span class="toc-number">2.1.2.</span> <span class="toc-text">Layout Engine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UXML-format"><span class="toc-number">2.1.3.</span> <span class="toc-text">UXML format</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Uity-style-sheets-USS"><span class="toc-number">2.1.4.</span> <span class="toc-text">Uity style sheets(USS)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#USS-Selector"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">USS Selector</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Type-selector"><span class="toc-number">2.1.4.1.1.</span> <span class="toc-text">Type selector</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Class-selector"><span class="toc-number">2.1.4.1.2.</span> <span class="toc-text">Class selector</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Name-selector"><span class="toc-number">2.1.4.1.3.</span> <span class="toc-text">Name selector</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Universal-selector"><span class="toc-number">2.1.4.1.4.</span> <span class="toc-text">Universal selector</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USS-properties"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">USS properties</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#USS-data-types"><span class="toc-number">2.1.4.2.1.</span> <span class="toc-text">USS data types</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#USS-common-properties"><span class="toc-number">2.1.4.2.2.</span> <span class="toc-text">USS common properties</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%BD%E9%AB%98%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.1.</span> <span class="toc-text">宽高属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%B9%E7%BC%98-Margins-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.2.</span> <span class="toc-text">边缘(Margins)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C-Border-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.3.</span> <span class="toc-text">边界(Border)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%85%E8%BE%B9%E8%B7%9D-Padding-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.4.</span> <span class="toc-text">内边距(Padding)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8E%92%E7%89%88%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.5.</span> <span class="toc-text">排版属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.6.</span> <span class="toc-text">位置属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.7.</span> <span class="toc-text">背景属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B9%9D%E5%AE%AB%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.8.</span> <span class="toc-text">九宫属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Appearance-%E5%A4%96%E8%A7%82-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.9.</span> <span class="toc-text">Appearance(外观)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.10.</span> <span class="toc-text">文本属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USS-custom-properties"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">USS custom properties</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Best-practices-for-USS"><span class="toc-number">2.1.4.4.</span> <span class="toc-text">Best practices for USS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Theme-Style-Sheet-TSS"><span class="toc-number">2.1.4.5.</span> <span class="toc-text">Theme Style Sheet(TSS)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-Elements"><span class="toc-number">2.1.5.</span> <span class="toc-text">Query Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-System"><span class="toc-number">2.1.6.</span> <span class="toc-text">Event System</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dispatch-Events"><span class="toc-number">2.1.6.1.</span> <span class="toc-text">Dispatch Events</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Handle-Events"><span class="toc-number">2.1.6.2.</span> <span class="toc-text">Handle Events</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SerializedObject-Data-Binding"><span class="toc-number">2.1.7.</span> <span class="toc-text">SerializedObject Data Binding</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Assets"><span class="toc-number">2.2.</span> <span class="toc-text">UI Assets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Tools-and-resources"><span class="toc-number">2.3.</span> <span class="toc-text">UI Tools and resources</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">2.4.</span> <span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.4.1.</span> <span class="toc-text">基础学习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-USS%E5%88%9B%E5%BB%BAUI"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">代码+USS创建UI</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%9B%E5%BB%BAUI"><span class="toc-number">2.4.1.1.1.</span> <span class="toc-text">代码创建UI</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9USS"><span class="toc-number">2.4.1.1.2.</span> <span class="toc-text">代码修改USS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8USS%E6%8C%87%E5%AE%9AUI%E9%A3%8E%E6%A0%BC"><span class="toc-number">2.4.1.1.3.</span> <span class="toc-text">使用USS指定UI风格</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%92%8C%E6%8E%92%E7%89%88"><span class="toc-number">2.4.1.1.4.</span> <span class="toc-text">位置和排版</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89USS%E5%8F%98%E9%87%8F"><span class="toc-number">2.4.1.1.5.</span> <span class="toc-text">自定义USS变量</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UXML%E5%88%9B%E5%BB%BAUI"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">UXML创建UI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VisualElement-Query"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">VisualElement Query</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Inspector"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">自定义Inspector</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UI%E4%BA%8B%E4%BB%B6%E5%93%8D%E5%BA%94"><span class="toc-number">2.4.1.5.</span> <span class="toc-text">UI事件响应</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ToolbarMenu-%E8%8F%9C%E5%8D%95%E6%A0%8F"><span class="toc-number">2.4.1.5.1.</span> <span class="toc-text">ToolbarMenu(菜单栏)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PopupField-%E4%B8%8B%E6%8B%89%E6%A1%86"><span class="toc-number">2.4.1.5.2.</span> <span class="toc-text">PopupField(下拉框)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Button-%E6%8C%89%E9%92%AE"><span class="toc-number">2.4.1.5.3.</span> <span class="toc-text">Button(按钮)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Foldout-%E6%8A%98%E5%8F%A0"><span class="toc-number">2.4.1.5.4.</span> <span class="toc-text">Foldout(折叠)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ListView-%E5%88%97%E8%A1%A8"><span class="toc-number">2.4.1.5.5.</span> <span class="toc-text">ListView(列表)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">2.4.1.6.</span> <span class="toc-text">数据绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E7%BB%84%E4%BB%B6"><span class="toc-number">2.4.1.6.1.</span> <span class="toc-text">数据绑定组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9AUI%E5%8F%98%E5%8C%96%E5%9B%9E%E8%B0%83"><span class="toc-number">2.4.1.6.2.</span> <span class="toc-text">数据绑定UI变化回调</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">2.4.1.7.</span> <span class="toc-text">知识点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E6%A0%91%E8%8A%82%E7%82%B9%E7%BC%96%E8%BE%91%E5%99%A8%E5%AE%9E%E6%88%98"><span class="toc-number">2.5.</span> <span class="toc-text">行为树节点编辑器实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Github"><span class="toc-number">3.</span> <span class="toc-text">Github</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol>
		
		</div>
		
		<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>之前有一篇学习Unity Editor相关的知识:<a href="http://tonytang1990.github.io/2022/02/20/UnityEditor%E7%9F%A5%E8%AF%86">UnityEditor知识</a></p>
<p>UIToolkit作为Unity最新一代UI系统，这里准备单独用篇来学习记录，通过深入学习UIToolkit，为后续编写一套节点系统做准备(用于AI系统，剧情系统和引导系统实现)。</p>
<p>Note:</p>
<ol>
<li><strong>本章节重点是UIToolkit在Editor上的学习使用，Runtime目前看来UIToolkit还不够成熟，不适合用到Runtime(2023&#x2F;5&#x2F;20)</strong></li>
</ol>
<h1 id="UIToolkit"><a href="#UIToolkit" class="headerlink" title="UIToolkit"></a>UIToolkit</h1><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIToolkits.html">UI Toolkit is the newest UI system in Unity. It’s designed to optimize performance across platforms, and is based on standard web technologies. You can use UI Toolkit to create extensions for the Unity Editor, and to create runtime UI for games and applications (when you install the UI Toolkit package.</a></p>
<p>看官方介绍可以看出，UI Toolkit是官方推的新一代UI系统，基于Web技术概念的一套UI系统，可用于Editor和运行时通吃。</p>
<p>UI Toolkit由三大部分组成:</p>
<ol>
<li>UI system(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Contains the core features and functionality required to create user interfaces.</a>)</li>
<li>UI Assets(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Asset types inspired by standard web formats. Use them to structure and style UI.</a>)(个人理解类似UI布局文件Asset)</li>
<li>Tools and resources(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Create and debug your interfaces, and learn how to use UI toolkit.</a>)</li>
</ol>
<h2 id="UI-system"><a href="#UI-system" class="headerlink" title="UI  system"></a>UI  system</h2><p>UI系统由以下部分组成:</p>
<ol>
<li>Visual tree(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Defines every user interface you build with the UI Toolkit. A visual tree is an object graph, made of lightweight nodes, that holds all the elements in a window or panel.</a>)(定义UI界面的数据，包含了所有组成UI显示的成员节点信息)</li>
<li>Controls(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">A library of standard UI controls such as buttons, popups, list views, and color pickers. You can use them as-is, customize them, or create your own controls.</a>)(UI组件)</li>
<li>Data binding system(<a href="">Links properties to the controls that modify their values.</a>)(关联数据属性到UI组件)</li>
<li>Layout Engine(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">A layout system based on the CSS Flexbox model. It positions elements based on layout and styling properties.</a>)(类似CSS的UI布局系统)</li>
<li>Event System(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Communicates user interactions to elements; for example, input, touch and pointer interactions, drag and drop operations, and other event types. The system includes a dispatcher, a handler, a synthesizer, and a library of event types.</a>)(UI事件系统，负责事件的分发等)</li>
<li>UI Renderer(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">A <strong>rendering</strong> system built directly on top of Unity’s graphics device layer.</a>)(在Unity基础上设计的UI渲染系统)</li>
<li>UI Toolkit Runtime Support(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Contains the components required to create runtime UI. The UI Toolkit package is currently in preview.</a>)</li>
</ol>
<h3 id="Visual-tree"><a href="#Visual-tree" class="headerlink" title="Visual tree"></a>Visual tree</h3><p>Visual tree由VisualElement组成，VisualElement是所有UI Toolkit的节点基类，VisualElment包含了所有UI组件，排版，UI风格，UI事件处理等数据信息。</p>
<p>UI元素绘制顺序树广度扩展:</p>
<p><img src="/img/Unity/UIToolkit/UIToolkitDrawingOrder.png" alt="UIToolkitDrawingOrder"></p>
<p>UIToolkit里的坐标系分为两种：</p>
<ol>
<li>Relative(position: relative相对坐标系)</li>
<li>Absolute(position: absolute绝对坐标系)</li>
</ol>
<p>上面两个坐标系和Unity里的相对位置和世界位置的概念差不多。</p>
<p>Note:</p>
<ol>
<li><strong>坐标原点在左上角</strong></li>
<li><strong>VisualElementExtensions的扩展方法里提供了坐标系转换相关的方法和接口</strong></li>
</ol>
<h3 id="Layout-Engine"><a href="#Layout-Engine" class="headerlink" title="Layout Engine"></a>Layout Engine</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIE-LayoutEngine.html">UI Toolkit includes a layout engine that positions visual elements based on layout and styling properties.</a>(UI Toolkit的排版系统是基于VisualElement的排版和Styling属性设置决定的)</p>
<h3 id="UXML-format"><a href="#UXML-format" class="headerlink" title="UXML format"></a>UXML format</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIE-UXML.html">Unity Extensible Markup Language (UXML) files are text files that define the structure of the user interface. </a>(Unity支持用UXML来描述UI界面组件数据)</p>
<p><strong>可以使用<a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIBuilder.html">UI Builder</a>实现可视化布局编辑。</strong></p>
<p><strong>UXML通过代码动态创建的数据对象类为VisualElementAssets。</strong></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-ElementRef.html">UXML现有可用Element查询</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uxml-examples.html">UXML布局构建事例</a></p>
<p>深入使用，待学习……</p>
<p>Note:</p>
<ol>
<li><strong>You can’t generate a VisualTreeAsset from raw UXML at runtime.</strong></li>
</ol>
<h3 id="Uity-style-sheets-USS"><a href="#Uity-style-sheets-USS" class="headerlink" title="Uity style sheets(USS)"></a>Uity style sheets(USS)</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIE-USS.html">Style properties are either set in C# or from a style sheet. Style properties have their own data structure (<code>IStyle</code> interface). UI Toolkit supports style sheets written in USS (Unity style sheet).</a>(Unity支持定义类似CSS的USS文件来定义UI界面使用的Style属性设置)</p>
<p><strong>USS通过代码动态创建的数据对象类为StyleSheet</strong></p>
<p>USS包含以下部分:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-about-uss.html">Style rules that include a selector and a declaration block.</a>(个人理解Style定义包含选择器和内容定义)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-about-uss.html">Selectors that identify which visual element the style rule affects.</a>(选择器用于匹配Element的Style使用)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-about-uss.html">A declaration block, inside curly braces, that has one or more style declarations. Each style declaration has a property and a value. Each style declaration ends with a semi-colon.</a>(内容定义Style的详细配置)</li>
</ol>
<h4 id="USS-Selector"><a href="#USS-Selector" class="headerlink" title="USS Selector"></a>USS Selector</h4><p>Style选择器分有很多种，简单的选择器有:</p>
<h5 id="Type-selector"><a href="#Type-selector" class="headerlink" title="Type selector"></a>Type selector</h5><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-Selectors-type.html">type selectors match elements based on their element types.</a>(通过类型名字匹配)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Button &#123;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  width: 100px;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button name=&quot;Cancel&quot; text=&quot;Cancel&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>Note:</p>
<ul>
<li><strong>type selector的名字不允许包含命名空间</strong></li>
</ul>
<h5 id="Class-selector"><a href="#Class-selector" class="headerlink" title="Class selector"></a>Class selector</h5><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-Selectors-class.html">class selectors match elements that have specific USS classes assigned. </a>(通过定义类名匹配)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.yellow &#123;</span><br><span class="line">    background-color: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button name=&quot;OK&quot; class=&quot;yellow&quot; text=&quot;OK&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>Note:</p>
<ul>
<li><strong>calss selector大小写敏感且不允许带数字</strong></li>
</ul>
<h5 id="Name-selector"><a href="#Name-selector" class="headerlink" title="Name selector"></a>Name selector</h5><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-Selectors-name.html">name selectors match elements based on the name of an element.</a>(通过名字匹配)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#Cancel &#123;</span><br><span class="line">    border-width: 2px;</span><br><span class="line">    border-color: DarkRed;</span><br><span class="line">    background-color: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button name=&quot;Cancel&quot; text=&quot;Cancel&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>Note:</p>
<ul>
<li><strong>代码里可以通过VisualElement.name修改去匹配Name Selector</strong></li>
</ul>
<h5 id="Universal-selector"><a href="#Universal-selector" class="headerlink" title="Universal selector"></a>Universal selector</h5><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-Selectors-universal.html">universal selector, also called the wildcard selector, matches any element.</a>(通过通配符(正则)去匹配)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    background-color: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;VisualElement name=&quot;container1&quot;&gt;</span><br><span class="line">    &lt;VisualElement name=&quot;container2&quot; class=&quot;yellow&quot;&gt;</span><br><span class="line">      &lt;Button name=&quot;OK&quot; class=&quot;yellow&quot; text=&quot;OK&quot; /&gt;</span><br><span class="line">      &lt;Button name=&quot;Cancel&quot; text=&quot;Cancel&quot; /&gt;</span><br><span class="line">&lt;/VisualElement&gt;</span><br></pre></td></tr></table></figure>

<p>更多复杂的选择器参考:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-about-uss.html">Complex selectors</a></p>
<h4 id="USS-properties"><a href="#USS-properties" class="headerlink" title="USS properties"></a>USS properties</h4><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uss-properties.html">USS property assigns a style or behavior to a VisualElement. </a>(USS的内容属性用于给VisualElement指定具体显示配置)</p>
<h5 id="USS-data-types"><a href="#USS-data-types" class="headerlink" title="USS data types"></a>USS data types</h5><p>Syntax - auto, <legnth>,<color>等。</p>
<p>​	如果一个属性有多个值，可以如下方式表达不同含义：</p>
<ul>
<li><p>Side-by-side表示全部都必须按顺序出现</p>
</li>
<li><p>|表示多个选择里必须出现一个</p>
</li>
<li><p>||表示1个或多个必须按顺序出现</p>
</li>
<li><p>&amp;&amp;表示所有都必须出现</p>
</li>
<li><p>[]表示一个选择组(类似正则里[]的概念)</p>
<p>上面提到的属性多个值都支持类似正则里*,+,?,{A,B}的后缀描述，表达的含义也就是类似正则里的出现次数控制。</p>
</li>
</ul>
<p>Length - 支持像素(px)和百分比(%)两种长度单位</p>
<p>initial - 全局关键词，标识重置属性到初始默认值</p>
<p>Color - 支持16进制(#FFFFFF)和rgb表达方式(rgba(255, 255, 255, 1))</p>
<p>​	Color关键词详情查看:</p>
<p>​	<a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uss-color-keywords.html">USS color keywords</a></p>
<p>Assets - 支持引用项目里的资源，resource()(标识使用Resources目录资源)，url()(标识使用项目Asset资源，支持相对USS所在目录的相对路径和项目相对路径)</p>
<h5 id="USS-common-properties"><a href="#USS-common-properties" class="headerlink" title="USS common properties"></a>USS common properties</h5><p>在了解一些常规布局属性概念前，让我们先来看看官网给的一张示意图:</p>
<p><img src="/img/Unity/UIToolkit/USSBoxModel.png" alt="USSBoxModel"></p>
<h6 id="宽高属性"><a href="#宽高属性" class="headerlink" title="宽高属性"></a>宽高属性</h6><p>width(宽度)，height(高度)，min-width(最小宽度)，min-height(最小高度)，max-width(最大宽度)，max-height(最大高度)……</p>
<h6 id="边缘-Margins-属性"><a href="#边缘-Margins-属性" class="headerlink" title="边缘(Margins)属性"></a>边缘(Margins)属性</h6><p>margin-left(左侧边缘)，margin-top(顶部边缘)，margin-right(右侧边缘)，margin-bottom(底部边缘)……</p>
<h6 id="边界-Border-属性"><a href="#边界-Border-属性" class="headerlink" title="边界(Border)属性"></a>边界(Border)属性</h6><p>border-left-width(左侧边界)，border-top-width(顶部边界)，border-right-width(右侧边界)，border-bottom-width(底部边界)，border-color(边界颜色)……</p>
<h6 id="内边距-Padding-属性"><a href="#内边距-Padding-属性" class="headerlink" title="内边距(Padding)属性"></a>内边距(Padding)属性</h6><p>padding-left(左侧内边距)，padding-top(顶部内边距)，padding-right(右侧内边距)，padding-bottom(底部内边距)……</p>
<h6 id="排版属性"><a href="#排版属性" class="headerlink" title="排版属性"></a>排版属性</h6><ul>
<li>Items<ul>
<li>flex-grow(排版放大设置)</li>
<li>flex-shrink(排版缩小设置)</li>
<li>flex-basic(排版大小设置)</li>
<li>align-self(自身对齐设置)</li>
<li>……</li>
</ul>
</li>
<li>Containers<ul>
<li>flex-direction(子成员排版对齐方向)</li>
<li>flex-wrap(子成员放不下是否多行显示排版)</li>
<li>align-content(子成员在排版方向上的对齐方式)</li>
<li>……</li>
</ul>
</li>
</ul>
<h6 id="位置属性"><a href="#位置属性" class="headerlink" title="位置属性"></a>位置属性</h6><p>position(位置坐标系-绝对|相对)，left(距离父容器左测距离)，top(距离父容器顶部距离)，right(距离父容器右侧距离)，bottom(距离父容器底部距离)……</p>
<p>UIToolkit里的坐标属性有两种坐标系:</p>
<ol>
<li>绝对坐标</li>
<li>相对坐标</li>
</ol>
<p>Note:</p>
<ol>
<li><strong>设置了Left,Top,Right,Bottom后，Width属性相关设置会被忽略。</strong></li>
<li><strong>绝对坐标适合一些固定位置的弹窗，绝对坐标确定位置后，内部用局部坐标排版UI显示</strong></li>
</ol>
<h6 id="背景属性"><a href="#背景属性" class="headerlink" title="背景属性"></a>背景属性</h6><p>background-color(背景颜色)，backtground-image(背景图片)，-unity-background-scale-mode(背景图片缩放模式)，-unity-background-image-tint-color(背景图片色调?)……</p>
<h6 id="九宫属性"><a href="#九宫属性" class="headerlink" title="九宫属性"></a>九宫属性</h6><p>-unity-slice-left(左侧切割数值)，-unity-slice-top(顶部切割数值)，-unity-slice-right(右侧切割数值)，-unity-slice-bottom(底部切割数值)，-unity-slice-scale(九宫缩放值?)……</p>
<h6 id="Appearance-外观-属性"><a href="#Appearance-外观-属性" class="headerlink" title="Appearance(外观)属性"></a>Appearance(外观)属性</h6><p>overflow(溢出显示设置),-unity-overflow-clip-box(溢出裁剪box设置),-unity-paragraph-spacing(段落间隔设置),opacity(透明度显示设置),visibility(可见性设置),display(排版显示设置)……</p>
<h6 id="文本属性"><a href="#文本属性" class="headerlink" title="文本属性"></a>文本属性</h6><p>color(绘制颜色设置),-unity-font(绘制文本字体设置),-unity-font-definition(?),font-size(字体大小设置),-unity-font-style(字体风格设置),-unity-text-align(字体对齐设置),-unity-text-overflow-position(?),white-space(空格处理方式设置),-unity-text-outline-width(描边宽度设置),-unity-text-outline-color(描边颜色设置)……</p>
<p>详细USS properties查看:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uss-properties.html">USS properties reference</a></p>
<p>W3C CSS的详细属性效果查看:</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS</a></p>
<p>Note:</p>
<ol>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-PropertyTypes.html">USS properties use the same syntax as W3C CSS documents</a>(USS的内容属性采用W3C CSS相关文档规则)</strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-SupportedProperties.html">The USS display property supports only a small subset of the CSS <code>display</code> property’s available keyword values.</a>(USS的属性支持只是CSS的很小部分子集)</strong></li>
</ol>
<h4 id="USS-custom-properties"><a href="#USS-custom-properties" class="headerlink" title="USS custom properties"></a>USS custom properties</h4><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-variables.html">USS variables, also called custom properties, define values that you can reuse in other USS rules. You can create variables for any type of USS property.</a></p>
<p>可以看到USS支持在USS文件里自定义变量，然后像编程里的变量一样，一处定义多处使用。</p>
<p>USS自定义变量规则如下:</p>
<p><strong>–变量名:值</strong></p>
<p>USS自定义变量在其他USS文件访问规则:</p>
<p><strong>var(–变量名, 默认值(可选))</strong></p>
<p>内置自定义变量查询:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uss-built-in-variable-reference.html">USS built-in variable references</a></p>
<h4 id="Best-practices-for-USS"><a href="#Best-practices-for-USS" class="headerlink" title="Best practices for USS"></a>Best practices for USS</h4><p>官方关于使用USS Style的建议:</p>
<ol>
<li><strong>Avoid inline styles(个人理解是使用全局USS File，避免对单个Visual Element设置Styles(会导致耗费更多内存))</strong></li>
<li><strong>Selector architecture consideration(选择合适的selector方案，过多或过于复杂的selector方案会导致运行时选择style开销更大)</strong></li>
</ol>
<p>更多建议参考:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-USS-WritingStyleSheets.html">Best practices for USS</a></p>
<h4 id="Theme-Style-Sheet-TSS"><a href="#Theme-Style-Sheet-TSS" class="headerlink" title="Theme Style Sheet(TSS)"></a>Theme Style Sheet(TSS)</h4><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-tss.html">Theme Style Sheet (TSS) files are regular USS files. UI Toolkit treats TSS as a distinct asset type and uses it for management purposes.</a></p>
<p>更多学习，待添加……</p>
<h3 id="Query-Elements"><a href="#Query-Elements" class="headerlink" title="Query Elements"></a>Query Elements</h3><p><strong>Unity提供了Query功能(类似Linq)，方便用户快速从VisualTree或Elements里查找符合条件的Element。</strong></p>
<ul>
<li><p>UQuery</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/ScriptReference/UIElements.UQuery.html">UQuery is a set of extension methods allowing you to select individual or collection of visualElements inside a complex hierarchy.</a>(一系列扩展方法用于查询指定VisualElements)</p>
</li>
<li><p>UQueryBuilder</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/ScriptReference/UIElements.UQueryBuilder_1.html">Utility Object that contructs a set of selection rules to be ran on a root visual element.</a>(工具类，辅助UQuery构建一系列查询规则)</p>
</li>
<li><p>Q</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-UQuery.html">Q is the shorthand for Query<T>.First(). It returns the first element that matches the selection rules.</a>(Q是查询首个符合规则的Element的缩写)</p>
</li>
</ul>
<h3 id="Event-System"><a href="#Event-System" class="headerlink" title="Event System"></a>Event System</h3><h4 id="Dispatch-Events"><a href="#Dispatch-Events" class="headerlink" title="Dispatch Events"></a>Dispatch Events</h4><p>UIToolkit Event System监听系统事件，然后通过EventDispatcher派发事件给Visual Element。</p>
<p>所有的事件派发都会经历以下三个阶段：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Dispatching.html">Trickles down: Events sent to elements during the trickle down phase.</a>(个人没太理解这个阶段，感觉是一个事件捕获<strong>从上往下</strong>派发事件的过程(<strong>不含响应事件的最里层Visual Element</strong>)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Dispatching.html">Bubbles up: Events sent to elements during the bubble-up phase.</a>(事件从目标节点向上冒泡派发给Visual Element的，即最里层符合的Visual Element最先派发(<strong>从下往上</strong>)(<strong>含响应事件最里层Visual Element</strong>))</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Dispatching.html">Cancellable: Events that can have their default action execution cancelled, stopped, or prevented.</a>(事件是可取消的，比如一般的事件冒泡为了不继续想外层冒泡，我们会设置事件阻断防止继续冒泡)</li>
</ol>
<p><img src="/img/Unity/UIToolkit/EventPropagation.png" alt="EventPropagation"></p>
<p><strong>通过上面的介绍可以了解到，事件派发有两个流程(Trickles down &amp; Bubbles up)，在不打断事件派发的前提下，最里层响应Visual Element只会派发一次，其他外层传递路线上的Visual Element会派发两次事件。</strong></p>
<p>事件基类为EventBase，所有相关事件介绍参考:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Reference.html">Event reference</a></p>
<p>Note:</p>
<ol>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events.html">The UI Toolkit event system shares the same terminology and event naming as HTML events</a>(UIToolkit采用和HTML一样的事件名和术语)</strong></li>
</ol>
<h4 id="Handle-Events"><a href="#Handle-Events" class="headerlink" title="Handle Events"></a>Handle Events</h4><p>事件处理顺序如下：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Handling.html">Execute event callbacks on elements from the root element down to the parent of the event target. This is the <strong>trickle-down phase</strong> of the dispatch process.</a>(事件捕获阶段从上往下触发事件)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Handling.html">Execute event callbacks on the event target. This is the <strong>target phase</strong> of the dispatch process.</a>(在目标响应Visual Element上触发事件)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Handling.html">Call ExecuteDefaultActionAtTarget() on the event target.</a>(在目标响应Visual Element上触发ExecuteDefaultActionAtTarget()方法)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Handling.html">Execute event callbacks on elements from the event target parent up to the root. This is the <strong>bubble-up phase</strong> of the dispatch process.</a>(从目标Visual Element开始向上冒泡触发事件)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Handling.html">Call ExecuteDefaultAction() on the event target.</a>(在目标响应Visual Element上触发ExecuteDefaultAction()方法)</li>
</ol>
<p>事件响应里有两个重要的概念:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Dispatching.html">Event.currentTarget is the visual element on which the callback was registered.</a>(当前注册响应事件的Visual Element)</li>
<li><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Dispatching.html">Event.target is the element where the event occurs, for example the element directly under the mouse.</a>(当前事件发生的Visual Element)</li>
</ul>
<p><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Handling.html">By default, a registered callback executes during the target phase and the bubble-up phase. This default behavior ensures that a parent element reacts after its child element.</a>(默认状态下，我们注册的事件回调是在target phase和bubble-up phase阶段执行。这是为了确保事件回调触发是从下往上)</strong></p>
<p>如果我们想在指定阶段(e.g. tickle-down phase或bubble-up phase)触发注册事件回调，我们需要在注册事件回调处，显示传参说明响应阶段:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VisualElement myElement = <span class="keyword">new</span> VisualElement();</span><br><span class="line"></span><br><span class="line">myElement.RegisterCallback&lt;MouseDownEvent&gt;(MyCallback, TrickleDown.TrickleDown);</span><br></pre></td></tr></table></figure>

<p>如果我们想事件传递自定义数据，我们需要自定义一个含自带数据的方法回调并监听事件：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myElement.RegisterCallback&lt;MouseDownEvent, MyType&gt;(MyCallbackWithData, myData);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyCallbackWithData</span>(<span class="params">MouseDownEvent evt, MyType data</span>)</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br></pre></td></tr></table></figure>

<p>相关事件信息查询:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Reference.html">Event Reference</a></p>
<h3 id="SerializedObject-Data-Binding"><a href="#SerializedObject-Data-Binding" class="headerlink" title="SerializedObject Data Binding"></a>SerializedObject Data Binding</h3><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Binding.html">A binding refers to the link between the property and the visual control that modifies it.</a>(数据绑定是用于快速关联UI组件和数据属性，实现UI组件快速修改数据属性)</p>
<p>数据绑定要求:</p>
<ol>
<li><p><strong>数据绑定只支持可序列化的属性或类(e.g. ScriptableObject, MonoBehaviour, int, bool, float, Vector3, Color, Object……)</strong></p>
</li>
<li><p><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Binding.html">You can only bind the value property of visual elements that implement the INotifyValueChanged interface.</a> (值绑定Visual Element只在实现了INotifyValueChanged接口的组件允许)</strong></p>
</li>
<li><p><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Binding.html">You can bind between an object and any visual element that either derives from BindableElement or implements the IBindable interface.</a>(object绑定Visual Element只在继承BindableElement或实现了IBindable接口的组件允许)</strong></p>
</li>
</ol>
<p>数据绑定接口:</p>
<ol>
<li><p><strong>Bind() - 绑定VisualElement到指定ScriptableObject</strong></p>
<p><strong>调用Bind前需要设置bindingPath指定哪些属性需要绑定</strong></p>
</li>
<li><p><strong>Unbind() - 解绑VisualElement(含子VisualElement)</strong></p>
<p><strong>EditorWindow关闭会自动解绑，我们只需要在绑定不同数据来源时调用Unbind</strong></p>
</li>
<li><p><strong>bindingPath - 给VisualElement指定需要绑定的属性</strong></p>
<p><strong>bindingPath就是绑定属性的名字</strong></p>
</li>
<li><p><strong>BindProperty() - 绑定VisualElement到制定SerializedProperty</strong></p>
<p><strong>需要自定义哪些属性需要绑定显示的时候</strong></p>
</li>
<li><p><strong>TrackPropertyValue() - 检查指定VisualElement绑定的属性是否变化，变化后触发回调通知</strong></p>
</li>
<li><p><strong>TrackSerializedObjectValue() - 任何VisualElement绑定的属性变化时触发回调通知</strong></p>
</li>
</ol>
<p>官方建议:</p>
<ol>
<li><strong>自定义Editor或PropertyDrawer，建议使用bindingPath而非Bind()和BindProperty()</strong></li>
<li><strong>尽量避免多次对相同VisualElement调用Bind()，为性能考虑</strong></li>
</ol>
<p>Note:</p>
<ol>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Binding.html">SerializedObject data binding only works in the Editor, not at runtime.</a>(SerializedObject的数据绑定只支持Editor模式不支持Runtime模式)</strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Binding.html">bind a visual element to nested properties in the source object</a>(VisualElement支持绑定到嵌套属性)</strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Binding.html">Don’t call Bind() from the Editor.CreateInspectorGUI() or PropertyDrawer.CreatePropertyGUI() override. These overrides are called automatically on the visual elements that these methods return.</a>(Editor.CreateInspectorGUI()和 PropertyDrawer.CreatePropertyGUI()里要调用Bind，在这两个方法返回后会自动Bind所有返回的Visual Elements)</strong></li>
</ol>
<h2 id="UI-Assets"><a href="#UI-Assets" class="headerlink" title="UI Assets"></a>UI Assets</h2><p>Unity提供了两种Asset用于布局系统</p>
<ol>
<li>UXML documents(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Unity eXtensible Markup Language (UXML) is an HTML and XML inspired markup language that you use to define the structure of user interfaces and reusable UI templates.</a>)(类似HTML和XML的标记性语言，用于定义UI布局)</li>
<li>Unity Style Sheets(USS)(<a target="_blank" rel="noopener" href="https://docs.unity3d.com/2020.3/Documentation/Manual/UIElements.html">Style sheets allow you to apply visual styles and behaviors to user interfaces. They’re similar to Cascading Style Sheets (CSS) used on the web, and support a subset of standard CSS properties. </a>)(类似CSS用于定义UI风格)</li>
</ol>
<h2 id="UI-Tools-and-resources"><a href="#UI-Tools-and-resources" class="headerlink" title="UI Tools and resources"></a>UI Tools and resources</h2><p>Unity提供了几个辅助工具，帮助我们学习和调试UI Toolkit</p>
<ol>
<li><p><strong>UI Debugger(UI调试器–可视化查看UI节点详细数据)</strong></p>
<p><img src="/img/Unity/UIToolkit/UIToolkitDebuggerPreview.PNG" alt="UIToolkitDebuggerPreview"></p>
</li>
<li><p><strong>UI Builder(UI布局可视化编辑器(预览版本))</strong></p>
<p><img src="/img/Unity/UIToolkit/UIBuilder.PNG" alt="UIBuilder"></p>
</li>
<li><p><strong>UI Samples(UI事例)</strong></p>
<p><img src="/img/Unity/UIToolkit/UIToolkitSampleWindow.PNG" alt="UIToolkitSampleWindow"></p>
</li>
</ol>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>接下来通过实战学习，进一步了解UIToolkit的使用和设计。</p>
<h3 id="基础学习"><a href="#基础学习" class="headerlink" title="基础学习"></a>基础学习</h3><h4 id="代码-USS创建UI"><a href="#代码-USS创建UI" class="headerlink" title="代码+USS创建UI"></a>代码+USS创建UI</h4><h5 id="代码创建UI"><a href="#代码创建UI" class="headerlink" title="代码创建UI"></a>代码创建UI</h5><p>UIToolkit为了帮助我们快速创建Editor UI窗口，提供了快捷创建入口:</p>
<p>Asset-&gt;Create-&gt;UI Toolkit-&gt;Editor Window</p>
<p><img src="/img/Unity/UIToolkit/UIToolkitEditorWindowCreator.PNG" alt="UIToolkitEditorWindowCreator"></p>
<p>考虑到不适用UXML作为UI布局，使用纯代码写Editor UI，这里就不勾选UXML了。</p>
<p>创建完会看到生成一个*.cs文件和一个*.uss文件，这是因为我们勾选了C#和USS，接下来我们打开UICreateUIByCodeEditorWindow.cs开始我们的Editor UI代码编写，后续会讲到如何利用*.uss文件来指定UI风格。</p>
<p>UICreateUIByCodeEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UICreateUIByCodeEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/UIToolkitStudy/UICreateUIByCodeEditorWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowUICodeStyleEditorWindow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UICreateUIByCodeEditorWindow wnd = GetWindow&lt;UICreateUIByCodeEditorWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;UICreateUIByCodeEditorWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> UIToolkit的rootVisualElement绘制方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreateUIByCode();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 通过代码创建UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateUIByCode</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建一个ui容器，用于管理我们新增的ui组件</span></span><br><span class="line">        VisualElement uiContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        <span class="comment">// 添加一个标题作为ui容器标题组件显示</span></span><br><span class="line">        Label uiTitleLable = <span class="keyword">new</span> Label(<span class="string">&quot;代码创建UI容器&quot;</span>);</span><br><span class="line">        uiContainer.Add(uiTitleLable);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加按钮组件</span></span><br><span class="line">        Button btn1 = <span class="keyword">new</span> Button();</span><br><span class="line">        btn1.text = <span class="string">&quot;代码创建按钮1&quot;</span>;</span><br><span class="line">        uiContainer.Add(btn1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 必须将需要显示的组件添加到根节点才能显示</span></span><br><span class="line">        <span class="comment">// 将ui容器添加到根节点作为需要显示的UIElement</span></span><br><span class="line">        rootVisualElement.Add(uiContainer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/UICreateUIByCodeEditorWindow.PNG" alt="UICreateUIByCodeEditorWindow"></p>
<p>可以看到编写基于UIToolkit的Editor Window还是和以往一样，要继承EditorWindow，但实现GUI绘制的接口不是<strong>OnGUI()<strong>而是</strong>CreateGUI()</strong>。</p>
<p>正如前面提到的UIToolkit里绘制的对象Visual Tree是由Visual Element组成的树状结构。而<strong>EditorWindow.rootVisualElement正是UIToolkit绘制EditorWindow的根VisualElement</strong>，我们所有的UIToolkit元素都是添加到此EditorWindow.rootVisualElement实现排版绘制的。</p>
<h5 id="代码修改USS"><a href="#代码修改USS" class="headerlink" title="代码修改USS"></a>代码修改USS</h5><p>所有的UIToolkit组件都继承至VisualElement，想通过代码修改UIToolkit组件的Style很简单，直接访问VisualElement.style即可。</p>
<p>UIChangeUSSByCodeEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 通过代码修改USS创建UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateStyleUIByCode</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    ******</span><br><span class="line">    <span class="comment">// 给Label指定不同的Color Style</span></span><br><span class="line">    uiTitleLable.style.color = Color.red;</span><br><span class="line">    <span class="comment">// 设置Label居中显示Style</span></span><br><span class="line">    uiTitleLable.style.alignSelf = Align.Center;</span><br><span class="line">    ******</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/UIChangeUSSByCodeEditorWindow.PNG" alt="UIChangeUSSByCodeEditorWindow"></p>
<p>可以看到通过访问style属性并修改其中的color属性，我成功的修改了标题文本的颜色显示风格。更多的属性修改参考文档:</p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/ScriptReference/UIElements.IStyle.html">IStyle</a></p>
<h5 id="使用USS指定UI风格"><a href="#使用USS指定UI风格" class="headerlink" title="使用USS指定UI风格"></a>使用USS指定UI风格</h5><p>第一步依然是使用Create-&gt;UI Toolkit-&gt;Editor WIndow</p>
<p>去掉UXML勾选，这里依然只通过代码和USS文件创建UI显示。</p>
<p>UIUseUSSEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIUseUSSEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/UIToolkitStudy/UIUseUSSEditorWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowUIUseUSSEditorWidnow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UIUseUSSEditorWindow wnd = GetWindow&lt;UIUseUSSEditorWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;UIUseUSSEditorWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreateUIByUseUSS();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 使用USS创建UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateUIByUseUSS</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        VisualElement root = rootVisualElement;</span><br><span class="line">        <span class="comment">// 加载并指定USS的使用</span></span><br><span class="line">        <span class="keyword">var</span> styleSheet = AssetDatabase.LoadAssetAtPath&lt;StyleSheet&gt;(<span class="string">&quot;Assets/Scripts/Editor/UIToolkitStudy/UIUseUSSEditorWindow/UIUseUSSEditorWindow.uss&quot;</span>);</span><br><span class="line">        root.styleSheets.Add(styleSheet);</span><br><span class="line">        </span><br><span class="line">        VisualElement smallLabelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using SmallLabel Class Selector!&quot;</span>);</span><br><span class="line">        smallLabelWithStyle.AddToClassList(<span class="string">&quot;SmallLabel&quot;</span>);</span><br><span class="line">        VisualElement bigLabelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using BigLabel Class Selector!&quot;</span>);</span><br><span class="line">        smallLabelWithStyle.AddToClassList(<span class="string">&quot;BigLabel&quot;</span>);</span><br><span class="line">        VisualElement labelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using Label Type Selector!&quot;</span>);</span><br><span class="line">        VisualElement boldLabelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using BoldLabel Class Selector!&quot;</span>);</span><br><span class="line">        boldLabelWithStyle.AddToClassList(<span class="string">&quot;BoldLabel&quot;</span>);</span><br><span class="line">        root.Add(smallLabelWithStyle);</span><br><span class="line">        root.Add(bigLabelWithStyle);</span><br><span class="line">        root.Add(labelWithStyle);</span><br><span class="line">        root.Add(boldLabelWithStyle);</span><br><span class="line">        </span><br><span class="line">        Button ussCenterButton = <span class="keyword">new</span> Button();</span><br><span class="line">        ussCenterButton.name = <span class="string">&quot;CenterButton&quot;</span>;</span><br><span class="line">        ussCenterButton.text = <span class="string">&quot;Center USS Button Name Selector&quot;</span>;</span><br><span class="line">        root.Add(ussCenterButton);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UIUseUSSEditorWindow.uss</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Label &#123;</span><br><span class="line">	font-size: 20px;</span><br><span class="line">	color: rgb(68, 138, 255);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.SmallLabel &#123;</span><br><span class="line">	font-size: 10px;</span><br><span class="line">	color: rgb(68, 138, 255);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.BigLabel &#123;</span><br><span class="line">	font-size: 40px;</span><br><span class="line">	color: rgb(68, 138, 255);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.BoldLabel &#123;</span><br><span class="line">	font-size: 20px;</span><br><span class="line">	-unity-font-style: bold;</span><br><span class="line">	color: rgb(68, 138, 255);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#CenterButton &#123;</span><br><span class="line">	align-self: center;</span><br><span class="line">	-unity-text-align: middle-center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/UIUseUSSEditorWindow.PNG" alt="UIUseUSSEditorWindow"></p>
<p>可以看到我们在UIUseUSSEditorWindow.uss里分别定义了，<strong>Type Selector(Label)</strong>，<strong>Class Selector(.SmallLabel, .BigLabel, .BoldLabel)</strong>,<strong>Name Selector(CenterButton)</strong>。</p>
<p>对应的我们在代码里通过以下三种方式分别指定了Selector：</p>
<ol>
<li><p>Type Selector</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VisualElement labelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using Label Type Selector!&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Class Selctor</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">VisualElement smallLabelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using SmallLabel Class Selector!&quot;</span>);</span><br><span class="line">smallLabelWithStyle.AddToClassList(<span class="string">&quot;SmallLabel&quot;</span>);</span><br><span class="line">VisualElement bigLabelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using BigLabel Class Selector!&quot;</span>);</span><br><span class="line">smallLabelWithStyle.AddToClassList(<span class="string">&quot;BigLabel&quot;</span>);</span><br><span class="line">VisualElement labelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using Label Type Selector!&quot;</span>);</span><br><span class="line">VisualElement boldLabelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;USS Using BoldLabel Class Selector!&quot;</span>);</span><br><span class="line">boldLabelWithStyle.AddToClassList(<span class="string">&quot;BoldLabel&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Name Selector</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Button ussCenterButton = <span class="keyword">new</span> Button();</span><br><span class="line">ussCenterButton.name = <span class="string">&quot;CenterButton&quot;</span>;</span><br><span class="line">ussCenterButton.text = <span class="string">&quot;Center USS Button Name Selector&quot;</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="位置和排版"><a href="#位置和排版" class="headerlink" title="位置和排版"></a>位置和排版</h5><p>第一步依然是使用Create-&gt;UI Toolkit-&gt;Editor WIndow</p>
<p>去掉UXML勾选，这里依然只通过代码和USS文件创建UI显示。</p>
<p>UIPositionAndLayoutEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 位置和排版EditorWindow</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIPositionAndLayoutEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 竖向相对位置根组件</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> VisualElement mRootVerticalRelativePosContainer;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/UIToolkitStudy/UIPositionAndLayoutEditorWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowUIPositionAndLayoutEditorWindow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UIPositionAndLayoutEditorWindow wnd = GetWindow&lt;UIPositionAndLayoutEditorWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;UIPositionAndLayoutEditorWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreatePositionAndLayoutUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建位置和排版UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreatePositionAndLayoutUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreateRootRelativePosVerticalContainer();</span><br><span class="line">        CreateHorizontalRelativePosContainer();</span><br><span class="line">        CreateHorzintalLayoutContainer();</span><br><span class="line">        CreateVerticalAbsolutePosContainer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建竖向相对位置根组件</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateRootRelativePosVerticalContainer</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 竖向相对位置排版容器</span></span><br><span class="line">        mRootVerticalRelativePosContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        <span class="comment">// 设置竖向排版</span></span><br><span class="line">        mRootVerticalRelativePosContainer.style.flexDirection = FlexDirection.Column;</span><br><span class="line">        <span class="comment">// 设置相对位置</span></span><br><span class="line">        mRootVerticalRelativePosContainer.style.position = Position.Relative;</span><br><span class="line">        <span class="comment">// 指定竖向容器Style</span></span><br><span class="line">        mRootVerticalRelativePosContainer.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置竖向容器大小位置</span></span><br><span class="line">        mRootVerticalRelativePosContainer.style.marginLeft = <span class="number">10</span>;</span><br><span class="line">        mRootVerticalRelativePosContainer.style.marginRight = <span class="number">10</span>;</span><br><span class="line">        mRootVerticalRelativePosContainer.style.marginTop = <span class="number">10</span>;</span><br><span class="line">        mRootVerticalRelativePosContainer.style.marginBottom = <span class="number">10</span>;</span><br><span class="line">        <span class="comment">// 设置竖向容器自适应大小</span></span><br><span class="line">        mRootVerticalRelativePosContainer.style.flexGrow = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加竖向排版标签</span></span><br><span class="line">        Label verticalLabel = <span class="keyword">new</span> Label();</span><br><span class="line">        verticalLabel.text = <span class="string">&quot;竖向相对位置排版容器标题&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置文本居中显示</span></span><br><span class="line">        verticalLabel.style.alignSelf = Align.Center;</span><br><span class="line">        mRootVerticalRelativePosContainer.Add(verticalLabel);</span><br><span class="line">        rootVisualElement.Add(mRootVerticalRelativePosContainer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建横向相对位置容器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateHorizontalRelativePosContainer</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 横向相对位置容器</span></span><br><span class="line">        <span class="keyword">var</span> horizontalRelativePosContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        <span class="comment">// 设置横向排版</span></span><br><span class="line">        horizontalRelativePosContainer.style.flexDirection = FlexDirection.Row;</span><br><span class="line">        <span class="comment">// 设置相对位置</span></span><br><span class="line">        horizontalRelativePosContainer.style.position = Position.Relative;</span><br><span class="line">        <span class="comment">// 指定横向相对位置容器Style</span></span><br><span class="line">        horizontalRelativePosContainer.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line">        <span class="comment">// 添加横向相对位置标签</span></span><br><span class="line">        Label horizontalRelativePosLabel = <span class="keyword">new</span> Label();</span><br><span class="line">        horizontalRelativePosLabel.text = <span class="string">&quot;横向相对位置排版容器标题&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置文本居中显示</span></span><br><span class="line">        horizontalRelativePosLabel.style.alignSelf = Align.Center;</span><br><span class="line">        horizontalRelativePosContainer.Add(horizontalRelativePosLabel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置横向容器多个按钮</span></span><br><span class="line">        Button horizontalButton1 = <span class="keyword">new</span> Button();</span><br><span class="line">        horizontalButton1.text = <span class="string">&quot;横向按钮1&quot;</span>;</span><br><span class="line">        horizontalButton1.style.marginLeft = <span class="number">25</span>;</span><br><span class="line">        Button horizontalButton2 = <span class="keyword">new</span> Button();</span><br><span class="line">        horizontalButton2.text = <span class="string">&quot;横向按钮2&quot;</span>;</span><br><span class="line">        horizontalButton2.style.marginLeft = <span class="number">50f</span>;</span><br><span class="line">        horizontalRelativePosContainer.Add(horizontalButton1);</span><br><span class="line">        horizontalRelativePosContainer.Add(horizontalButton2);</span><br><span class="line"></span><br><span class="line">        mRootVerticalRelativePosContainer.Add(horizontalRelativePosContainer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建横向排版容器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateHorzintalLayoutContainer</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 横向排版容器</span></span><br><span class="line">        <span class="keyword">var</span> horizontalLayoutContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        <span class="comment">// 设置横向排版</span></span><br><span class="line">        horizontalLayoutContainer.style.flexDirection = FlexDirection.Row;</span><br><span class="line">        <span class="comment">// 设置内容超出后排版Style</span></span><br><span class="line">        horizontalLayoutContainer.style.flexWrap = Wrap.Wrap;</span><br><span class="line">        <span class="comment">// 指定横向排版容器Style</span></span><br><span class="line">        horizontalLayoutContainer.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line">        <span class="comment">// 添加横向排版标签</span></span><br><span class="line">        Label horizontalLayoutLabel = <span class="keyword">new</span> Label();</span><br><span class="line">        horizontalLayoutLabel.text = <span class="string">&quot;横向排版容器标题&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置文本居中显示</span></span><br><span class="line">        horizontalLayoutLabel.style.alignSelf = Align.Center;</span><br><span class="line">        horizontalLayoutContainer.Add(horizontalLayoutLabel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置横向容器多个按钮</span></span><br><span class="line">        Button horizontalButton1 = <span class="keyword">new</span> Button();</span><br><span class="line">        horizontalButton1.text = <span class="string">&quot;横向按钮1&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置自动扩展系数</span></span><br><span class="line">        horizontalButton1.style.flexGrow = <span class="number">1</span>;</span><br><span class="line">        Button horizontalButton2 = <span class="keyword">new</span> Button();</span><br><span class="line">        horizontalButton2.text = <span class="string">&quot;横向按钮2&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置自动扩展系数</span></span><br><span class="line">        horizontalButton2.style.flexGrow = <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// 设置偏移间隔</span></span><br><span class="line">        horizontalButton2.style.marginLeft = <span class="number">10</span>;</span><br><span class="line">        Button horizontalButton3 = <span class="keyword">new</span> Button();</span><br><span class="line">        horizontalButton3.text = <span class="string">&quot;横向按钮3&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置自动扩展系数</span></span><br><span class="line">        horizontalButton3.style.flexGrow = <span class="number">3</span>;</span><br><span class="line">        <span class="comment">// 设置偏移间隔</span></span><br><span class="line">        horizontalButton3.style.marginLeft = <span class="number">10</span>;</span><br><span class="line">        Button horizontalButton4 = <span class="keyword">new</span> Button();</span><br><span class="line">        horizontalButton4.text = <span class="string">&quot;横向按钮4&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置自动扩展系数</span></span><br><span class="line">        horizontalButton4.style.flexGrow = <span class="number">4</span>;</span><br><span class="line">        <span class="comment">// 设置偏移间隔</span></span><br><span class="line">        horizontalButton4.style.marginLeft = <span class="number">10</span>;</span><br><span class="line">        horizontalLayoutContainer.Add(horizontalButton1);</span><br><span class="line">        horizontalLayoutContainer.Add(horizontalButton2);</span><br><span class="line">        horizontalLayoutContainer.Add(horizontalButton3);</span><br><span class="line">        horizontalLayoutContainer.Add(horizontalButton4);</span><br><span class="line"></span><br><span class="line">        mRootVerticalRelativePosContainer.Add(horizontalLayoutContainer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建竖向绝对位置容器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateVerticalAbsolutePosContainer</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 竖向绝对坐标容器</span></span><br><span class="line">        <span class="keyword">var</span> verticalAbsolutePosContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        <span class="comment">// 设置竖向排版</span></span><br><span class="line">        verticalAbsolutePosContainer.style.flexDirection = FlexDirection.Column;</span><br><span class="line">        <span class="comment">// 设置绝对坐标</span></span><br><span class="line">        verticalAbsolutePosContainer.style.position = Position.Absolute;</span><br><span class="line">        <span class="comment">// 指定竖向绝对位置容器Style</span></span><br><span class="line">        verticalAbsolutePosContainer.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置竖向容器大小位置</span></span><br><span class="line">        verticalAbsolutePosContainer.style.left = <span class="number">100</span>;</span><br><span class="line">        verticalAbsolutePosContainer.style.right = <span class="number">100</span>;</span><br><span class="line">        verticalAbsolutePosContainer.style.top = <span class="number">100</span>;</span><br><span class="line">        verticalAbsolutePosContainer.style.bottom = <span class="number">100</span>;</span><br><span class="line">        <span class="comment">// 设置竖向绝对位置容器自适应</span></span><br><span class="line">        verticalAbsolutePosContainer.style.flexGrow = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加竖向排版标签</span></span><br><span class="line">        Label verticalAbsolutePosLabel = <span class="keyword">new</span> Label();</span><br><span class="line">        verticalAbsolutePosLabel.text = <span class="string">&quot;竖向绝对位置标题&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置文本居中显示</span></span><br><span class="line">        verticalAbsolutePosLabel.style.alignSelf = Align.Center;</span><br><span class="line">        verticalAbsolutePosContainer.Add(verticalAbsolutePosLabel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置竖向容器多个按钮</span></span><br><span class="line">        Button verticalButton1 = <span class="keyword">new</span> Button();</span><br><span class="line">        verticalButton1.text = <span class="string">&quot;竖向按钮1&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置按钮高度和位置</span></span><br><span class="line">        verticalButton1.style.height = <span class="number">20</span>;</span><br><span class="line">        verticalButton1.style.marginLeft = <span class="number">20</span>;</span><br><span class="line">        verticalButton1.style.marginRight = <span class="number">20</span>;</span><br><span class="line">        Button verticalButton2 = <span class="keyword">new</span> Button();</span><br><span class="line">        verticalButton2.text = <span class="string">&quot;竖向按钮2&quot;</span>;</span><br><span class="line">        <span class="comment">// 设置按钮高度</span></span><br><span class="line">        verticalButton2.style.height = <span class="number">20</span>;</span><br><span class="line">        verticalButton2.style.marginLeft = <span class="number">20</span>;</span><br><span class="line">        verticalButton2.style.marginRight = <span class="number">20</span>;</span><br><span class="line">        verticalAbsolutePosContainer.Add(verticalButton1);</span><br><span class="line">        verticalAbsolutePosContainer.Add(verticalButton2);</span><br><span class="line"></span><br><span class="line">        mRootVerticalRelativePosContainer.Add(verticalAbsolutePosContainer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/UIPositionAndLayoutEditorWindow.PNG" alt="UIPositionAndLayoutEditorWindow"></p>
<p>可以看到通过不断创建需要排版的容器设置对应排版和大小属性，我们成功的创建出了各种排版方向以及相对位置和绝对位置的显示UI。</p>
<h5 id="自定义USS变量"><a href="#自定义USS变量" class="headerlink" title="自定义USS变量"></a>自定义USS变量</h5><p>在创建USS文件时，我们很多时候会填充相同值给不同的Selector，而修改时并不想一个一个去修改，这个时候就需要用到类似编程上定义变量公用同一个变量的方式。</p>
<p>第一步依然是使用Create-&gt;UI Toolkit-&gt;Editor WIndow</p>
<p>去掉UXML勾选，这里依然只通过代码和USS文件创建UI显示。</p>
<p>UICustomUSSVariableEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建自定义USS变量的Editor Window</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UICustomUSSVariableEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/UIToolkitStudy/UICustomUSSVariableEditorWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowUICustomUSSVariableEditorWindow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UICustomUSSVariableEditorWindow wnd = GetWindow&lt;UICustomUSSVariableEditorWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;UICustomUSSVariableEditorWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreateCustomUSSVariableUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建自定义USS变量的UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateCustomUSSVariableUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 加载并指定USS的使用</span></span><br><span class="line">        <span class="keyword">var</span> customUSSVariable1StyleSheet1 = AssetDatabase.LoadAssetAtPath&lt;StyleSheet&gt;(<span class="string">&quot;Assets/Scripts/Editor/UIToolkitStudy/UICustomUSSVariableEditorWindow/UICustomUSSVariableEditorWindow1.uss&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> customUSSVariable1StyleSheet2 = AssetDatabase.LoadAssetAtPath&lt;StyleSheet&gt;(<span class="string">&quot;Assets/Scripts/Editor/UIToolkitStudy/UICustomUSSVariableEditorWindow/UICustomUSSVariableEditorWindow2.uss&quot;</span>);</span><br><span class="line">        rootVisualElement.styleSheets.Add(customUSSVariable1StyleSheet1);</span><br><span class="line">        rootVisualElement.styleSheets.Add(customUSSVariable1StyleSheet2);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用UICustomUSSVariableEditorWindow1里的NormalLabel</span></span><br><span class="line">        Label normalLabel = <span class="keyword">new</span> Label();</span><br><span class="line">        normalLabel.AddToClassList(<span class="string">&quot;NormalLabel&quot;</span>);</span><br><span class="line">        normalLabel.text = <span class="string">&quot;NormalLabel1&quot;</span>;</span><br><span class="line">        normalLabel.style.left = <span class="number">10</span>;</span><br><span class="line">        normalLabel.style.right = <span class="number">10</span>;</span><br><span class="line">        normalLabel.style.height = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用UICustomUSSVariableEditorWindow2里的NormalLabel2</span></span><br><span class="line">        Label normalLabel2 = <span class="keyword">new</span> Label();</span><br><span class="line">        normalLabel2.AddToClassList(<span class="string">&quot;NormalLabel2&quot;</span>);</span><br><span class="line">        normalLabel2.text = <span class="string">&quot;NormalLabel2&quot;</span>;</span><br><span class="line">        normalLabel2.style.left = <span class="number">10</span>;</span><br><span class="line">        normalLabel2.style.right = <span class="number">10</span>;</span><br><span class="line">        normalLabel2.style.height = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">        rootVisualElement.Add(normalLabel);</span><br><span class="line">        rootVisualElement.Add(normalLabel2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UICustomUSSVariableEditorWindow1.uss</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">:root &#123;</span><br><span class="line">	--text-color: red;</span><br><span class="line">	--background-color: green;</span><br><span class="line">	--text-color2: yellow;</span><br><span class="line">	--background-color2: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.NormalLabel &#123;</span><br><span class="line">	color: red;</span><br><span class="line">	background-color: var(--background-color);</span><br><span class="line">	align-self: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UICustomUSSVariableEditorWindow2.uss</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.NormalLabel2 &#123;</span><br><span class="line">	color: var(--text-color2);</span><br><span class="line">	background-color: var(--background-color2);</span><br><span class="line">	align-self: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/UICustomUSSVariableEditorWindow.PNG" alt="UICustomUSSVariableEditorWindow"></p>
<p>可以看到我们在USS文件里自定义了变量并在Class Selector里使用，通过加载多个USS文件，我们实现了跨USS文件的变量定义访问使用。</p>
<h4 id="UXML创建UI"><a href="#UXML创建UI" class="headerlink" title="UXML创建UI"></a>UXML创建UI</h4><p>待添加……</p>
<h4 id="VisualElement-Query"><a href="#VisualElement-Query" class="headerlink" title="VisualElement Query"></a>VisualElement Query</h4><p>VisualElement查询的核心是通过<strong>UQuery和Q相关接口进行对象查询(内部是通过UQueryBuilder构建查询条件)</strong></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建菜单区域</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateToolbarUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> menuHorizontalContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">    *******</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建toolbar</span></span><br><span class="line">    <span class="keyword">var</span> menuToolbar = <span class="keyword">new</span> Toolbar();</span><br><span class="line">    menuToolbar.name = EventHandleElementNames.MenuToolBarName;</span><br><span class="line">    ******</span><br><span class="line">    menuHorizontalContainer.Add(menuToolbar);</span><br><span class="line">    rootVisualElement.Add(menuHorizontalContainer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建Toolbar菜单UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateToolbarMenuUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建菜单组件</span></span><br><span class="line">    SelectedMenuData = mToolbarMenuDatas[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> toolbarMenu = <span class="keyword">new</span> ToolbarMenu();</span><br><span class="line">    toolbarMenu.name = EventHandleElementNames.ToolBarMenuName;</span><br><span class="line">    ******</span><br><span class="line">    <span class="keyword">var</span> menuToolbar = rootVisualElement.Q&lt;Toolbar&gt;(EventHandleElementNames.MenuToolBarName);</span><br><span class="line">    menuToolbar.Add(toolbarMenu);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看到，我们创建了一个Toolbar并赋值name为EventHandleElementNames.MenuToolBarName，并将Toolbar组件添加到舞台显示。</p>
<p>接着我们创建菜单组件ToolbarMenu，此时想要把ToolbarMenu加到Toolbar里，这个时候我们需要通过rootVisualElement.Q<Toolbar>(EventHandleElementNames.MenuToolBarName);的方式查询到Toolbar组件，然后添加到Toolbar作为子组件显示(Toolbar.Add(ToolbarMenu))即可。</p>
<h4 id="自定义Inspector"><a href="#自定义Inspector" class="headerlink" title="自定义Inspector"></a>自定义Inspector</h4><p>待学习</p>
<p>Note:</p>
<ol>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-HowTo-CreateCustomInspector.html">Unity does not support the use of custom property drawers within default inspectors, as Unity makes default inspectors with IMGUI. If you wish to create a custom property drawer, you must also create a custom inspector for the class that uses that property.</a>(Unity不支持自定义属性绘制使用默认Inspector，因为默认Inspector是用得IMGUI实现。如果编写了Custom Property Drawer，那么也必须编写Custom Inspector)</strong></li>
</ol>
<h4 id="UI事件响应"><a href="#UI事件响应" class="headerlink" title="UI事件响应"></a>UI事件响应</h4><p>UI事件监听核心是通过VisualElement.RegisterCallback<T>()方式去监听不同的事件类型来实现事件响应的。</p>
<p>接下来以节点编辑器左侧配置面板的实现为例，让我们看看，我是如何通过构建不同的VisualElement并且监听不同的事件类型来实现不同事件监听响应的。</p>
<p>这里先直接放一张效果图:</p>
<p><img src="/img/Unity/UIToolkit/UIEventHandleEditorWindow.PNG" alt="UIEventHandleEditorWindow"></p>
<h5 id="ToolbarMenu-菜单栏"><a href="#ToolbarMenu-菜单栏" class="headerlink" title="ToolbarMenu(菜单栏)"></a>ToolbarMenu(菜单栏)</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 菜单栏信息数据列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> List&lt;KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;&gt; mToolbarMenuDatas = <span class="keyword">new</span> List&lt;KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;&gt;()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">new</span> KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;(<span class="string">&quot;界面1&quot;</span>, ToolbarMenuType.PANEL1),</span><br><span class="line">    <span class="keyword">new</span> KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;(<span class="string">&quot;界面2&quot;</span>, ToolbarMenuType.PANEL2),</span><br><span class="line">    <span class="keyword">new</span> KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;(<span class="string">&quot;界面3&quot;</span>, ToolbarMenuType.PANEL3),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 选择菜单数据</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt; SelectedMenuData;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建Toolbar菜单UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateToolbarMenuUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建菜单组件</span></span><br><span class="line">    SelectedMenuData = mToolbarMenuDatas[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> toolbarMenu = <span class="keyword">new</span> ToolbarMenu();</span><br><span class="line">    toolbarMenu.name = EventHandleElementNames.ToolBarMenuName;</span><br><span class="line">    toolbarMenu.text = SelectedMenuData.Key;</span><br><span class="line">    toolbarMenu.variant = ToolbarMenu.Variant.Popup;</span><br><span class="line">    toolbarMenu.style.width = <span class="number">100f</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> toolbarData <span class="keyword">in</span> mToolbarMenuDatas)</span><br><span class="line">    &#123;</span><br><span class="line">        toolbarMenu.menu.AppendAction(toolbarData.Key, OnToolbarMenuChoice, OnToolbarStatusObtain, toolbarData);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> menuToolbar = rootVisualElement.Q&lt;Toolbar&gt;(EventHandleElementNames.MenuToolBarName);</span><br><span class="line">    menuToolbar.Add(toolbarMenu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应菜单栏选择事件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;menuAction&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnToolbarMenuChoice</span>(<span class="params">DropdownMenuAction menuAction</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> menuData = (KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;)menuAction.userData;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;菜单显示名:<span class="subst">&#123;menuData.Key&#125;</span> 菜单类型:<span class="subst">&#123;menuData.Value&#125;</span>选中！&quot;</span>);</span><br><span class="line">    SelectedMenuData = menuData;</span><br><span class="line">    <span class="keyword">var</span> toolbarMenu = rootVisualElement.Q&lt;ToolbarMenu&gt;(EventHandleElementNames.ToolBarMenuName);</span><br><span class="line">    toolbarMenu.text = SelectedMenuData.Key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应菜单状态获取</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> DropdownMenuAction.<span class="function">Status <span class="title">OnToolbarStatusObtain</span>(<span class="params">DropdownMenuAction menuAction</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> menuData = (KeyValuePair&lt;<span class="built_in">string</span>, ToolbarMenuType&gt;)menuAction.userData;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;菜单显示名:<span class="subst">&#123;menuData.Key&#125;</span> 菜单类型:<span class="subst">&#123;menuData.Value&#125;</span>响应菜单状态获取！&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (SelectedMenuData.Value == menuData.Value)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> DropdownMenuAction.Status.Checked;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DropdownMenuAction.Status.Normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​	<img src="/img/Unity/UIToolkit/ToolbarMenuPreview.PNG" alt="ToolbarMenuPreview"></p>
<p>​	<img src="/img/Unity/UIToolkit/ToolbarMenuLog.PNG" alt="ToolbarMenuLog"></p>
<p>ToolbarMenu使用流程：</p>
<ol>
<li>创建ToolbarMenu组件</li>
<li>通过ToolbarMenu.menu.AppendAction(***)传递ToolbarMenu显示内容，菜单选中以及菜单状态获取回调</li>
<li>菜单选中以及菜单状态获取回调里编写菜单的选中以及显示数据处理</li>
</ol>
<h5 id="PopupField-下拉框"><a href="#PopupField-下拉框" class="headerlink" title="PopupField(下拉框)"></a>PopupField(下拉框)</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Popup弹窗枚举类型</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> PopupMenuType</span><br><span class="line">&#123;</span><br><span class="line">    POPUP_1,</span><br><span class="line">    POPUP_2,</span><br><span class="line">    POPUP_3,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建弹出下拉菜单UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreatePopupMenuUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建下拉框菜单组件</span></span><br><span class="line">    <span class="keyword">var</span> popupMenu = <span class="keyword">new</span> PopupField&lt;PopupMenuType&gt;(mPopupMenuDatas, mPopupSelectedIndex);</span><br><span class="line">    popupMenu.style.width = <span class="number">100f</span>;</span><br><span class="line">    popupMenu.RegisterCallback&lt;ChangeEvent&lt;PopupMenuType&gt;&gt;(OnPopupMenuChange);</span><br><span class="line">    <span class="keyword">var</span> menuToolbar = rootVisualElement.Q&lt;Toolbar&gt;(EventHandleElementNames.MenuToolBarName);</span><br><span class="line">    menuToolbar.Add(popupMenu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应弹出菜单变化</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;evt&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnPopupMenuChange</span>(<span class="params">ChangeEvent&lt;PopupMenuType&gt; evt</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;弹出菜单选中:<span class="subst">&#123;evt.newValue&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> popupMenu = evt.target <span class="keyword">as</span> PopupField&lt;PopupMenuType&gt;;</span><br><span class="line">    popupMenu.<span class="keyword">value</span> = evt.newValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​		<img src="/img/Unity/UIToolkit/PopupFieldPreview.PNG" alt="PopupFieldPreview"></p>
<p>​		<img src="/img/Unity/UIToolkit/PopupFieldLog.PNG" alt="PopupFieldLog"></p>
<p>ToolbarMenu使用流程：</p>
<ol>
<li>创建PopupField组件</li>
<li>通过PopupMenu.RegisterCallback&lt;ChangeEvent<T>&gt;(***)注册下拉框切换回调</li>
<li>在下拉框切换回调里处理下拉框切换数据处理</li>
</ol>
<h5 id="Button-按钮"><a href="#Button-按钮" class="headerlink" title="Button(按钮)"></a>Button(按钮)</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建保存路径内容</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateSavePathContent</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> leftVerticalContentContainer = rootVisualElement.Q&lt;VisualElement&gt;(EventHandleElementNames.LeftVerticalContentContainerName);</span><br><span class="line">    <span class="keyword">var</span> savePathHorizontalContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">    savePathHorizontalContainer.style.left = <span class="number">0</span>;</span><br><span class="line">    savePathHorizontalContainer.style.right = <span class="number">0</span>;</span><br><span class="line">    savePathHorizontalContainer.style.height = <span class="number">20</span>;</span><br><span class="line">    savePathHorizontalContainer.style.flexDirection = FlexDirection.Row;</span><br><span class="line">    savePathHorizontalContainer.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> savePathLabelTitle = <span class="keyword">new</span> Label();</span><br><span class="line">    savePathLabelTitle.style.width = <span class="number">60</span>;</span><br><span class="line">    savePathLabelTitle.text = <span class="string">&quot;保存路径:&quot;</span>;</span><br><span class="line">    savePathHorizontalContainer.Add(savePathLabelTitle);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> savePathTextField = <span class="keyword">new</span> TextField();</span><br><span class="line">    savePathTextField.name = EventHandleElementNames.SavePathTextFieldName;</span><br><span class="line">    savePathTextField.style.flexGrow = <span class="number">1</span>;</span><br><span class="line">    savePathTextField.style.flexShrink = <span class="number">1</span>;</span><br><span class="line">    savePathTextField.<span class="keyword">value</span> = GraphSavePath;</span><br><span class="line">    savePathHorizontalContainer.Add(savePathTextField);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> savePathButton = <span class="keyword">new</span> Button();</span><br><span class="line">    savePathButton.style.width = <span class="number">60</span>;</span><br><span class="line">    savePathButton.text = <span class="string">&quot;修改&quot;</span>;</span><br><span class="line">    savePathHorizontalContainer.Add(savePathButton);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册按钮点击</span></span><br><span class="line">    savePathButton.RegisterCallback&lt;ClickEvent&gt;(OnSavePathButtonClick);</span><br><span class="line">    leftVerticalContentContainer.Add(savePathHorizontalContainer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 相应保存路径按钮点击</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;clickEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSavePathButtonClick</span>(<span class="params">ClickEvent clickEvent</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;保存路径按钮点击！&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> newSavePath = EditorUtility.OpenFolderPanel(<span class="string">&quot;保存路径&quot;</span>, GraphSavePath, <span class="built_in">string</span>.Empty);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">string</span>.IsNullOrEmpty(newSavePath))</span><br><span class="line">    &#123;</span><br><span class="line">        GraphSavePath = newSavePath;</span><br><span class="line">        Debug.Log(<span class="string">$&quot;更新保存路径:<span class="subst">&#123;newSavePath&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> savePathTextField = rootVisualElement.Q&lt;TextField&gt;(EventHandleElementNames.SavePathTextFieldName);</span><br><span class="line">        savePathTextField.<span class="keyword">value</span> = GraphSavePath;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​		<img src="/img/Unity/UIToolkit/ButtonPreview.PNG" alt="ButtonPreview"><br>​		<img src="/img/Unity/UIToolkit/FolderChosenButtonClickPreview.PNG" alt="FolderChosenButtonClickPreview"></p>
<p>Button使用流程：</p>
<ol>
<li>创建Button组件</li>
<li>通过Button.RegisterCallback<ClickEvent>(***)注册下按钮点击回调</li>
<li>在按钮点击回调处理点击后的响应逻辑</li>
</ol>
<h5 id="Foldout-折叠"><a href="#Foldout-折叠" class="headerlink" title="Foldout(折叠)"></a>Foldout(折叠)</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建条件节点UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateConditionNodeUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> conditionNodeFoldOut = <span class="keyword">new</span> Foldout();</span><br><span class="line">    conditionNodeFoldOut.name = EventHandleElementNames.ConditionNodeFoldOutName;</span><br><span class="line">    conditionNodeFoldOut.viewDataKey = EventHandleViewDataKeys.ConditionNodeFoldOutViewDataKeyName;</span><br><span class="line">    conditionNodeFoldOut.text = <span class="string">&quot;条件节点&quot;</span>;</span><br><span class="line">    conditionNodeFoldOut.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    ******</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册条件节点FoldOut值变化回调</span></span><br><span class="line">    conditionNodeFoldOut.RegisterValueChangedCallback(OnConditionNodeFoldOutValueChange);</span><br><span class="line">    <span class="keyword">var</span> nodeVerticalContainer = rootVisualElement.Q&lt;VisualElement&gt;(EventHandleElementNames.NodeVerticalContainerName);</span><br><span class="line">    nodeVerticalContainer.Add(conditionNodeFoldOut);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建行为节点UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateActionNodeUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> actionNodeFoldOut = <span class="keyword">new</span> Foldout();</span><br><span class="line">    actionNodeFoldOut.name = EventHandleElementNames.ActionNodeFoldOutName;</span><br><span class="line">    actionNodeFoldOut.viewDataKey = EventHandleViewDataKeys.ActionNodeFoldOutViewDataKeyName;</span><br><span class="line">    actionNodeFoldOut.text = <span class="string">&quot;行为节点&quot;</span>;</span><br><span class="line">    actionNodeFoldOut.AddToClassList(<span class="string">&quot;unity-box&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    ******</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册行为节点FoldOut值变化回调</span></span><br><span class="line">    actionNodeFoldOut.RegisterValueChangedCallback(OnActionNodeFoldOutValueChange);</span><br><span class="line">    <span class="keyword">var</span> nodeVerticalContainer = rootVisualElement.Q&lt;VisualElement&gt;(EventHandleElementNames.NodeVerticalContainerName);</span><br><span class="line">    nodeVerticalContainer.Add(actionNodeFoldOut);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应条件节点FoldOut值变化</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;changeEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnConditionNodeFoldOutValueChange</span>(<span class="params">ChangeEvent&lt;<span class="built_in">bool</span>&gt; changeEvent</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;响应条件节点折叠值更新：<span class="subst">&#123;changeEvent.newValue&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应行为节点FoldOut值变化</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;changeEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnActionNodeFoldOutValueChange</span>(<span class="params">ChangeEvent&lt;<span class="built_in">bool</span>&gt; changeEvent</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;响应行为节点折叠值更新：<span class="subst">&#123;changeEvent.newValue&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​		<img src="/img/Unity/UIToolkit/FoldoutPreivew.PNG" alt="FoldoutPreivew"></p>
<p>Foldout使用流程：</p>
<ol>
<li>创建Foldout组件</li>
<li>通过FoldOut.RegisterValueChangedCallback(***)注册折叠变化回调</li>
<li>在折叠变化回调处理折叠变化响应逻辑</li>
</ol>
<h5 id="ListView-列表"><a href="#ListView-列表" class="headerlink" title="ListView(列表)"></a>ListView(列表)</h5><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 行为类型</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> ActionType</span><br><span class="line">&#123;</span><br><span class="line">    ACTION1,</span><br><span class="line">    ACTION2,</span><br><span class="line">    ******,</span><br><span class="line">    ACTION20,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 条件类型</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> ConditionType</span><br><span class="line">&#123;</span><br><span class="line">    CONDITION1,</span><br><span class="line">    CONDITION2,</span><br><span class="line">    ******,</span><br><span class="line">    CONDITION20,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 行为类型列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> List&lt;ActionType&gt; mActionTypeList = <span class="keyword">new</span> List&lt;ActionType&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 条件类型列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> List&lt;ConditionType&gt; mConditionTypeList = <span class="keyword">new</span> List&lt;ConditionType&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 初始化节点数据</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitNodeDatas</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    mActionTypeList.Clear();</span><br><span class="line">    <span class="keyword">var</span> actionTypes = Enum.GetValues(<span class="keyword">typeof</span>(ActionType));</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> actionType <span class="keyword">in</span> actionTypes)</span><br><span class="line">    &#123;</span><br><span class="line">        mActionTypeList.Add((ActionType)actionType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mConditionTypeList.Clear();</span><br><span class="line">    <span class="keyword">var</span> conditionTypes = Enum.GetValues(<span class="keyword">typeof</span>(ConditionType));</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> conditionType <span class="keyword">in</span> conditionTypes)</span><br><span class="line">    &#123;</span><br><span class="line">        mConditionTypeList.Add((ConditionType)conditionType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建条件节点UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateConditionNodeUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> conditionNodeFoldOut = <span class="keyword">new</span> Foldout();</span><br><span class="line">    ******</span><br><span class="line">    <span class="keyword">var</span> conditionListView = <span class="keyword">new</span> ListView(mConditionTypeList, <span class="number">20</span>, OnMakeNodeItem, OnBindConditionItem);</span><br><span class="line">    conditionListView.style.height = <span class="number">300</span>;</span><br><span class="line">    conditionNodeFoldOut.Add(conditionListView);</span><br><span class="line">	******</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 创建行为节点UI</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateActionNodeUI</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> actionNodeFoldOut = <span class="keyword">new</span> Foldout();</span><br><span class="line">    ******</span><br><span class="line">    <span class="keyword">var</span> actionListView = <span class="keyword">new</span> ListView(mConditionTypeList, <span class="number">20</span>, OnMakeNodeItem, OnBindActionItem);</span><br><span class="line">    actionListView.style.height = <span class="number">300</span>;</span><br><span class="line">    actionNodeFoldOut.Add(actionListView);</span><br><span class="line">    ******</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应绑定条件节点</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;conditionItem&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;index&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnBindConditionItem</span>(<span class="params">VisualElement conditionItem, <span class="built_in">int</span> index</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> conditionButton = conditionItem <span class="keyword">as</span> Button;</span><br><span class="line">    conditionButton.name = GetConditionItemNameByIndex(index);</span><br><span class="line">    conditionButton.text = mConditionTypeList[index].ToString();</span><br><span class="line">    conditionButton.userData = mConditionTypeList[index];</span><br><span class="line">    conditionButton.RegisterCallback&lt;ClickEvent&gt;(OnBindConditionItemButtonClick);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应绑定行为节点</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;conditionItem&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;index&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnBindActionItem</span>(<span class="params">VisualElement conditionItem, <span class="built_in">int</span> index</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> actionButton = conditionItem <span class="keyword">as</span> Button;</span><br><span class="line">    actionButton.name = GetActionItemNameByIndex(index);</span><br><span class="line">    actionButton.text = mActionTypeList[index].ToString();</span><br><span class="line">    actionButton.userData = mActionTypeList[index];</span><br><span class="line">    actionButton.RegisterCallback&lt;ClickEvent&gt;(OnBindActionItemButtonClick);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应节点Item构建</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> VisualElement <span class="title">OnMakeNodeItem</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Button();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应Condition按钮点击</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;clickEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnBindConditionItemButtonClick</span>(<span class="params">ClickEvent clickEvent</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> conditionItemButton = clickEvent.target <span class="keyword">as</span> Button;</span><br><span class="line">    <span class="keyword">var</span> clickConditionType = (ConditionType)conditionItemButton.userData;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;点击了ConditionType:<span class="subst">&#123;clickConditionType&#125;</span>按钮！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 响应Action按钮点击</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;clickEvent&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnBindActionItemButtonClick</span>(<span class="params">ClickEvent clickEvent</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> actionItemButton = clickEvent.target <span class="keyword">as</span> Button;</span><br><span class="line">    <span class="keyword">var</span> clickActionType = (ActionType)actionItemButton.userData;</span><br><span class="line">    Debug.Log(<span class="string">$&quot;点击了ActionType:<span class="subst">&#123;clickActionType&#125;</span>按钮！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取制定索引的Condition Item名</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;index&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">GetConditionItemNameByIndex</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">$&quot;<span class="subst">&#123;EventHandleElementNames.ConditionItemPrefixName&#125;</span><span class="subst">&#123;mConditionTypeList[index]&#125;</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取制定索引的Action Item名</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;index&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">string</span> <span class="title">GetActionItemNameByIndex</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">$&quot;<span class="subst">&#123;EventHandleElementNames.ActionItemPrefixName&#125;</span><span class="subst">&#123;mActionTypeList[index]&#125;</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​		<img src="/img/Unity/UIToolkit/ListViewPreview.PNG" alt="ListViewPreview"></p>
<p>​		<img src="/img/Unity/UIToolkit/ListViewButtonClickLog.PNG" alt="ListViewButtonClickLog"></p>
<p>ListView使用流程：</p>
<ol>
<li>创建ListView组件</li>
<li>创建ListView组件时传递需要显示的数据，高度，列表组件构造回调以及列表组件绑定回调</li>
<li>在列表组件构造回调里构建我们列表里需要显示的VisualElement</li>
<li>在列表组件绑定回调里处理列表组件的详细逻辑处理</li>
</ol>
<p>更多的事件响应待添加……</p>
<h4 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h4><h5 id="数据绑定组件"><a href="#数据绑定组件" class="headerlink" title="数据绑定组件"></a>数据绑定组件</h5><p>通过前面对于属性绑定的基础学习:</p>
<p><a href="">SerializedObject Data Binding</a></p>
<p>可以知道，对于VisualElement和属性的绑定核心通过以下几个接口:</p>
<ol>
<li><strong>Bind()</strong></li>
<li><strong>Unbind()</strong></li>
<li><strong>bindingPath</strong></li>
<li><strong>BindProperty()</strong></li>
</ol>
<p>UIPropertyBindEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 属性绑定Editor Window</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIPropertyBindEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 选中的ScriptableObject</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> ScriptableObject mSelectedScriptableObject;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/UIToolkitStudy/UIPropertyBindEditorWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowUIPropertyBindEditorWindow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UIPropertyBindEditorWindow wnd = GetWindow&lt;UIPropertyBindEditorWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;UIPropertyBindEditorWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreatePropertyBindUI();</span><br><span class="line">        OnSelectionChange();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 选中Asset变化回调</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSelectionChange</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        mSelectedScriptableObject = Selection.activeObject <span class="keyword">as</span> ScriptableObject;</span><br><span class="line">        <span class="keyword">var</span> propertyBindAssetNameTextField = rootVisualElement.Q&lt;TextField&gt;(PropertyBindElementNames.PropertyBindTextFieldName);</span><br><span class="line">        <span class="keyword">var</span> propertyBindInfoContentContainer = rootVisualElement.Q&lt;VisualElement&gt;(PropertyBindElementNames.PropertyBindInfoContentContainerName);</span><br><span class="line">        <span class="keyword">if</span>(mSelectedScriptableObject != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> selectedSerializedObject = <span class="keyword">new</span> SerializedObject(mSelectedScriptableObject);</span><br><span class="line">            <span class="keyword">if</span>(propertyBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> nameProperty = selectedSerializedObject.FindProperty(<span class="string">&quot;m_Name&quot;</span>);</span><br><span class="line">                propertyBindAssetNameTextField.BindProperty(nameProperty);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(propertyBindInfoContentContainer != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> propertyIterator = selectedSerializedObject.GetIterator();</span><br><span class="line">                propertyIterator.NextVisible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">while</span>(propertyIterator.NextVisible(<span class="literal">false</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> propertyField = <span class="keyword">new</span> PropertyField();</span><br><span class="line">                    propertyField.name = propertyIterator.name;</span><br><span class="line">                    propertyField.style.height = <span class="number">20</span>;</span><br><span class="line">                    propertyField.BindProperty(propertyIterator);</span><br><span class="line">                    propertyBindInfoContentContainer.Add(propertyField);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(propertyBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                propertyBindAssetNameTextField.Unbind();</span><br><span class="line">                propertyBindAssetNameTextField.<span class="keyword">value</span> = <span class="built_in">string</span>.Empty;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(propertyBindInfoContentContainer != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                propertyBindInfoContentContainer.Clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建属性绑定UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreatePropertyBindUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreatePropertyBindAssetInfoUI();</span><br><span class="line">        CreatePropertyBindPropertyUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建属性绑定Asset信息UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreatePropertyBindAssetInfoUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> propertyBindAssetInfoHContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        propertyBindAssetInfoHContainer.style.flexDirection = FlexDirection.Row;</span><br><span class="line">        propertyBindAssetInfoHContainer.style.height = <span class="number">20</span>;</span><br><span class="line">        rootVisualElement.Add(propertyBindAssetInfoHContainer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> propertyBindLabelTitle = <span class="keyword">new</span> Label();</span><br><span class="line">        propertyBindLabelTitle.text = <span class="string">&quot;绑定Asset名&quot;</span>;</span><br><span class="line">        propertyBindLabelTitle.style.width = <span class="number">80</span>;</span><br><span class="line">        propertyBindAssetInfoHContainer.Add(propertyBindLabelTitle);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> propertyBindAssetNameTextField = <span class="keyword">new</span> TextField();</span><br><span class="line">        propertyBindAssetNameTextField.name = PropertyBindElementNames.PropertyBindTextFieldName;</span><br><span class="line">        propertyBindAssetNameTextField.style.flexGrow = <span class="number">1</span>;</span><br><span class="line">        propertyBindAssetNameTextField.<span class="keyword">value</span> = <span class="built_in">string</span>.Empty;</span><br><span class="line">        propertyBindAssetInfoHContainer.Add(propertyBindAssetNameTextField);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建属性绑定属性UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreatePropertyBindPropertyUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> propertyBindInfoVContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        propertyBindInfoVContainer.style.flexDirection = FlexDirection.Column;</span><br><span class="line">        propertyBindInfoVContainer.style.left = <span class="number">0</span>;</span><br><span class="line">        propertyBindInfoVContainer.style.right = <span class="number">0</span>;</span><br><span class="line">        propertyBindInfoVContainer.style.top = <span class="number">0</span>;</span><br><span class="line">        propertyBindInfoVContainer.style.bottom = <span class="number">0</span>;</span><br><span class="line">        propertyBindInfoVContainer.style.flexGrow = <span class="number">1</span>;</span><br><span class="line">        propertyBindInfoVContainer.AddToClassList(<span class="string">&quot;unity-rect-field&quot;</span>);</span><br><span class="line">        rootVisualElement.Add(propertyBindInfoVContainer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> propertyBindInfoLabelTitle = <span class="keyword">new</span> Label();</span><br><span class="line">        propertyBindInfoLabelTitle.text = <span class="string">&quot;绑定Assets绑定属性显示&quot;</span>;</span><br><span class="line">        propertyBindInfoLabelTitle.style.alignSelf = Aligh.Center;</span><br><span class="line">        propertyBindInfoLabelTitle.style.height = <span class="number">20</span>;</span><br><span class="line">        propertyBindInfoVContainer.Add(propertyBindInfoLabelTitle);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> propertyBindInfoContentContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        propertyBindInfoContentContainer.name = PropertyBindElementNames.PropertyBindInfoContentContainerName;</span><br><span class="line">        propertyBindInfoContentContainer.style.flexDirection = FlexDirection.Column;</span><br><span class="line">        propertyBindInfoContentContainer.style.flexGrow = <span class="number">1</span>;</span><br><span class="line">        propertyBindInfoVContainer.Add(propertyBindInfoContentContainer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PropertyBindSO.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> PropertyBindSO.cs</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 属性绑定ScriptableObject</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">CreateAssetMenu(fileName = <span class="string">&quot;PropertyBindSO&quot;</span>, menuName = <span class="string">&quot;ScriptableObjects/DIY/PropertyBindSO&quot;</span>, order = 1)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PropertyBindSO</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 自定义枚举</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> CustomEnum</span><br><span class="line">    &#123;</span><br><span class="line">        ENUM1,</span><br><span class="line">        ENUM2,</span><br><span class="line">        ENUM3,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 名字</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;名字&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 颜色</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;颜色&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> Color Color;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 绑定GameObject</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;绑定GameObject&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> GameObject GO;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 自定义枚举</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;自定义枚举&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> CustonEnum CustonE;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Transform列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;Transform列表&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> List&lt;Transform&gt; TransformList;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 位置数组</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;位置数组&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector3[] Positions;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 自定义Class</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;自定义Class&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> CustomBindClass BindClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/PropertyBindSOEditorWindow.PNG" alt="PropertyBindSOEditorWindow"></p>
<p>从上面截图可以看到，通过Selection.activeObject得到选中的ScriptableObject对象，结合selectedSerializedObject.GetIterator()遍历添加所有可视化属性展示(PropertyField)，同时通过TextField.BindProperty()绑定文本和特定属性显示从而实现属性绑定VisualElement的效果。</p>
<p>当我们未选中任何对象时我们通过Unbind()接口接触VisualElement的属性绑定效果。</p>
<h5 id="数据绑定UI变化回调"><a href="#数据绑定UI变化回调" class="headerlink" title="数据绑定UI变化回调"></a>数据绑定UI变化回调</h5><p>数据绑定变化回调核心通过以下几个接口：</p>
<ol>
<li><strong>TrackPropertyValue()</strong></li>
<li><strong>TrackSerializedObjectValue()</strong></li>
</ol>
<p>UIPropertyBindCBEditorWindow.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> UIPropertyBindCBEditorWindow.cs</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 属性修改绑定窗口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIPropertyBindCBEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 选中的ScriptableObject</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> ScriptableObject mSelectedScriptableObject;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/UIToolkitStudy/UIPropertyBindCBEditorWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowUIPropertyBindCBEditorWindow</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UIPropertyBindCBEditorWindow wnd = GetWindow&lt;UIPropertyBindCBEditorWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;UIPropertyBindCBEditorWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CreatePropertyBindCBUI();</span><br><span class="line">        OnSelectionChange();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 选中Asset变化回调</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnSelectionChange</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        mSelectedScriptableObject = Selection.activeObject <span class="keyword">as</span> ScriptableObject;</span><br><span class="line">        <span class="keyword">var</span> propertyBindAssetNameTextField = rootVisualElement.Q&lt;TextField&gt;(PropertyBindCBElementNames.PropertyBindCBTextFieldName);</span><br><span class="line">        <span class="keyword">var</span> serializedBindAssetNameTextField = rootVisualElement.Q&lt;TextField&gt;(PropertyBindCBElementNames.SerializedBindCBTextFieldName);</span><br><span class="line">        <span class="keyword">if</span>(mSelectedScriptableObject != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> selectedSerializedObject = <span class="keyword">new</span> SerializedObject(mSelectedScriptableObject);</span><br><span class="line">            <span class="keyword">if</span>(propertyBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> nameProperty = selectedSerializedObject.FindProperty(<span class="string">&quot;Name&quot;</span>);</span><br><span class="line">                propertyBindAssetNameTextField.TrackPropertyValue(nameProperty, OnNamePropertyChange);</span><br><span class="line">                propertyBindAssetNameTextField.BindProperty(nameProperty);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(serializedBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                serializedBindAssetNameTextField.TrackSerializedObjectValue(selectedSerializedObject, OnPropertyChange);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(propertyBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                propertyBindAssetNameTextField.Unbind();</span><br><span class="line">                propertyBindAssetNameTextField.<span class="keyword">value</span> = <span class="built_in">string</span>.Empty;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(serializedBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                serializedBindAssetNameTextField.Unbind();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建属性绑定回调UI</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreatePropertyBindCBUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> propertyBindCBAssetInfoHContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        propertyBindCBAssetInfoHContainer.style.flexDirection = FlexDirection.Row;</span><br><span class="line">        propertyBindCBAssetInfoHContainer.style.height = <span class="number">20</span>;</span><br><span class="line">        rootVisualElement.Add(propertyBindCBAssetInfoHContainer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> proeprtyBindLabelTitle = <span class="keyword">new</span> Label();</span><br><span class="line">        proeprtyBindLabelTitle.text = <span class="string">&quot;名字属性值:&quot;</span>;</span><br><span class="line">        proeprtyBindLabelTitle.style.width = <span class="number">160</span>;</span><br><span class="line">        propertyBindCBAssetInfoHContainer.Add(proeprtyBindLabelTitle);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> propertyBindAssetNameTextField = <span class="keyword">new</span> TextField();</span><br><span class="line">        propertyBindAssetNameTextField.name = PropertyBindCBElementNames.PropertyBindCBTextFieldName;</span><br><span class="line">        propertyBindAssetNameTextField.style,flexGrow = <span class="number">1</span>;</span><br><span class="line">        propertyBindAssetNameTextField.<span class="keyword">value</span> = <span class="built_in">string</span>.Empty;</span><br><span class="line">        propertyBindCBAssetInfoHContainer.Add(propertyBindAssetNameTextField);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> serializedObjectBindCBAssetInfoHContainer = <span class="keyword">new</span> VisualElement();</span><br><span class="line">        serializedObjectBindCBAssetInfoHContainer.style.flexDirection = FlexDirection.Row;</span><br><span class="line">        serializedObjectBindCBAssetInfoHContainer.style.height = <span class="number">20</span>;</span><br><span class="line">        rootVisualElement.Add(serializedObjectBindCBAssetInfoHContainer);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> serializedBindLabelTitle = <span class="keyword">new</span> Label();</span><br><span class="line">        serializedBindLabelTitle.text = <span class="string">&quot;属性变化SerializeObject名:&quot;</span>;</span><br><span class="line">        serializedBindLabelTitle.style.width = <span class="number">160</span>;</span><br><span class="line">        serializedObjectBindCBAssetInfoHContainer.Add(serializedBindLabelTitle);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> serializedBindAssetNameTextField = <span class="keyword">new</span> TextField();</span><br><span class="line">        serializedBindAssetNameTextField.name = PropertyBindCBElementNames.SerializedBindCBTextFieldName;</span><br><span class="line">        serializedBindAssetNameTextField.style.flexGrow = <span class="number">1</span>;</span><br><span class="line">        serializedBindAssetNameTextField.<span class="keyword">value</span> = <span class="built_in">string</span>.Empty;</span><br><span class="line">        serializedObjectBindCBAssetInfoHContainer.Add(serializedBindAssetNameTextField);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 响应名字属性变化</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;property&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnNamePropertyChange</span>(<span class="params">SerializedProperty property</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$&quot;名字属性发生变化！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 响应属性变化</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;serializedObject&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnPropertyChange</span>(<span class="params">SerializedObject serializedObject</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$&quot;SerializedObject.name:<span class="subst">&#123;serializedObject.targetObject.name&#125;</span>属性变化！&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> serializedBindAssetNameTextField = rootVisualElement.Q&lt;TextField&gt;(PropertyBindCBElementNames.SerializedBindCBTextFieldName);</span><br><span class="line">        <span class="keyword">if</span>(serializedBindAssetNameTextField != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            serializedBindAssetNameTextField.<span class="keyword">value</span> = serializedObject.targetObject.name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PropertyBindCBSO.cs</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> PropertyBindCBSO.cs</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 属性绑定回调ScriptableObject</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">CreateAssetMenu(fileName = <span class="string">&quot;PropertyBindCBSO&quot;</span>, menuName = <span class="string">&quot;ScriptableObjects/DIY/PropertyBindCBSO&quot;</span>, order = 1)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PropertyBindCBSO</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 名字</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;名字&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 位置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;位置&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> Vector3 Position;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 颜色</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;颜色&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> Color Color;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 绑定GameObject</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;绑定GameObject&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> GameObject GO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/Unity/UIToolkit/PropertyBindCBSOEditorWindow.PNG" alt="PropertyBindCBSOEditorWindow"></p>
<p>从上面代码可以看到我通过TextField绑定指定属性后调用TrackPropertyValue实现指定属性变化回调监听。</p>
<p>通过TextField调用TrackSerializedObjectValue实现对指定SerializedObject所有属性变化的监听。</p>
<h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><ol>
<li><strong>EditorWindow.CreateGUI()方法是用于UIToolkit创建Editor窗口的rootVisualElement显示方法</strong></li>
<li><strong>Editor.CreateInspectorGUI()方法是用于UIToolkit创建自定义Inspector面板的显示方法</strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-support-for-editor-ui.html">UI Toolkit to create Editor UI and synchronize data between a property and a visual element for the Editor UI.</a>(UIToolkit支持在Editor UI上同步属性数据到Visual Element上)</strong></li>
</ol>
<h2 id="行为树节点编辑器实战"><a href="#行为树节点编辑器实战" class="headerlink" title="行为树节点编辑器实战"></a>行为树节点编辑器实战</h2><p>详情参考:<a href="">行为树节点编辑器</a></p>
<h1 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h1><p>个人Github:</p>
<p><a href="http://tonytang1990.github.io/2022/02/20/UnityEditor%E7%9F%A5%E8%AF%86/">UnityEditor知识</a></p>
<p><a href="http://tonytang1990.github.io/2023/05/20/UIToolkit%E5%AD%A6%E4%B9%A0/">UIToolkit</a></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIToolkits.html">Creating user interfaces (UI)</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uss-properties.html">USS properties reference</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/ScriptReference/UIElements.IStyle.html">IStyle</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-ElementRef.html">UXML现有可用Element查询</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-uss-built-in-variable-reference.html">USS built-in variable references</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Manual/UIE-Events-Reference.html">Event Reference</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.unity3d.com/Packages/com.unity.graphtools.foundation@0.11/manual/overview.html">Graph Tools Foundation 0.11</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Editor/">Editor</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Editor/">Editor</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://tonytang1990.github.io/2023/05/20/UIToolkit%E5%AD%A6%E4%B9%A0/" data-title="UIToolkit | 走停人生路" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2024/04/23/地图编辑器/" title="地图编辑器">
  <strong>上一篇：</strong><br/>
  <span>
  地图编辑器</span>
</a>
</div>


<div class="next">
<a href="/2023/04/09/路点编辑和缓动/"  title="路点编辑和缓动">
 <strong>下一篇：</strong><br/> 
 <span>路点编辑和缓动
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UIToolkit"><span class="toc-number">2.</span> <span class="toc-text">UIToolkit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-system"><span class="toc-number">2.1.</span> <span class="toc-text">UI  system</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Visual-tree"><span class="toc-number">2.1.1.</span> <span class="toc-text">Visual tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layout-Engine"><span class="toc-number">2.1.2.</span> <span class="toc-text">Layout Engine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UXML-format"><span class="toc-number">2.1.3.</span> <span class="toc-text">UXML format</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Uity-style-sheets-USS"><span class="toc-number">2.1.4.</span> <span class="toc-text">Uity style sheets(USS)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#USS-Selector"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">USS Selector</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Type-selector"><span class="toc-number">2.1.4.1.1.</span> <span class="toc-text">Type selector</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Class-selector"><span class="toc-number">2.1.4.1.2.</span> <span class="toc-text">Class selector</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Name-selector"><span class="toc-number">2.1.4.1.3.</span> <span class="toc-text">Name selector</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Universal-selector"><span class="toc-number">2.1.4.1.4.</span> <span class="toc-text">Universal selector</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USS-properties"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">USS properties</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#USS-data-types"><span class="toc-number">2.1.4.2.1.</span> <span class="toc-text">USS data types</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#USS-common-properties"><span class="toc-number">2.1.4.2.2.</span> <span class="toc-text">USS common properties</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%BD%E9%AB%98%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.1.</span> <span class="toc-text">宽高属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%B9%E7%BC%98-Margins-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.2.</span> <span class="toc-text">边缘(Margins)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C-Border-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.3.</span> <span class="toc-text">边界(Border)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%85%E8%BE%B9%E8%B7%9D-Padding-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.4.</span> <span class="toc-text">内边距(Padding)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8E%92%E7%89%88%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.5.</span> <span class="toc-text">排版属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.6.</span> <span class="toc-text">位置属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.7.</span> <span class="toc-text">背景属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B9%9D%E5%AE%AB%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.8.</span> <span class="toc-text">九宫属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Appearance-%E5%A4%96%E8%A7%82-%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.9.</span> <span class="toc-text">Appearance(外观)属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.4.2.2.10.</span> <span class="toc-text">文本属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USS-custom-properties"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">USS custom properties</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Best-practices-for-USS"><span class="toc-number">2.1.4.4.</span> <span class="toc-text">Best practices for USS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Theme-Style-Sheet-TSS"><span class="toc-number">2.1.4.5.</span> <span class="toc-text">Theme Style Sheet(TSS)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-Elements"><span class="toc-number">2.1.5.</span> <span class="toc-text">Query Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-System"><span class="toc-number">2.1.6.</span> <span class="toc-text">Event System</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dispatch-Events"><span class="toc-number">2.1.6.1.</span> <span class="toc-text">Dispatch Events</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Handle-Events"><span class="toc-number">2.1.6.2.</span> <span class="toc-text">Handle Events</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SerializedObject-Data-Binding"><span class="toc-number">2.1.7.</span> <span class="toc-text">SerializedObject Data Binding</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Assets"><span class="toc-number">2.2.</span> <span class="toc-text">UI Assets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-Tools-and-resources"><span class="toc-number">2.3.</span> <span class="toc-text">UI Tools and resources</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">2.4.</span> <span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.4.1.</span> <span class="toc-text">基础学习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-USS%E5%88%9B%E5%BB%BAUI"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">代码+USS创建UI</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%9B%E5%BB%BAUI"><span class="toc-number">2.4.1.1.1.</span> <span class="toc-text">代码创建UI</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9USS"><span class="toc-number">2.4.1.1.2.</span> <span class="toc-text">代码修改USS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8USS%E6%8C%87%E5%AE%9AUI%E9%A3%8E%E6%A0%BC"><span class="toc-number">2.4.1.1.3.</span> <span class="toc-text">使用USS指定UI风格</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE%E5%92%8C%E6%8E%92%E7%89%88"><span class="toc-number">2.4.1.1.4.</span> <span class="toc-text">位置和排版</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89USS%E5%8F%98%E9%87%8F"><span class="toc-number">2.4.1.1.5.</span> <span class="toc-text">自定义USS变量</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UXML%E5%88%9B%E5%BB%BAUI"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">UXML创建UI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VisualElement-Query"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">VisualElement Query</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Inspector"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">自定义Inspector</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UI%E4%BA%8B%E4%BB%B6%E5%93%8D%E5%BA%94"><span class="toc-number">2.4.1.5.</span> <span class="toc-text">UI事件响应</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ToolbarMenu-%E8%8F%9C%E5%8D%95%E6%A0%8F"><span class="toc-number">2.4.1.5.1.</span> <span class="toc-text">ToolbarMenu(菜单栏)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PopupField-%E4%B8%8B%E6%8B%89%E6%A1%86"><span class="toc-number">2.4.1.5.2.</span> <span class="toc-text">PopupField(下拉框)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Button-%E6%8C%89%E9%92%AE"><span class="toc-number">2.4.1.5.3.</span> <span class="toc-text">Button(按钮)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Foldout-%E6%8A%98%E5%8F%A0"><span class="toc-number">2.4.1.5.4.</span> <span class="toc-text">Foldout(折叠)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ListView-%E5%88%97%E8%A1%A8"><span class="toc-number">2.4.1.5.5.</span> <span class="toc-text">ListView(列表)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">2.4.1.6.</span> <span class="toc-text">数据绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E7%BB%84%E4%BB%B6"><span class="toc-number">2.4.1.6.1.</span> <span class="toc-text">数据绑定组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9AUI%E5%8F%98%E5%8C%96%E5%9B%9E%E8%B0%83"><span class="toc-number">2.4.1.6.2.</span> <span class="toc-text">数据绑定UI变化回调</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">2.4.1.7.</span> <span class="toc-text">知识点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E6%A0%91%E8%8A%82%E7%82%B9%E7%BC%96%E8%BE%91%E5%99%A8%E5%AE%9E%E6%88%98"><span class="toc-number">2.5.</span> <span class="toc-text">行为树节点编辑器实战</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Github"><span class="toc-number">3.</span> <span class="toc-text">Github</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Art/" title="Art">Art<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Automation/" title="Automation">Automation<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Collision/" title="Collision">Collision<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Database/" title="Database">Database<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Editor/" title="Editor">Editor<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Excel/" title="Excel">Excel<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Game/" title="Game">Game<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/HotUpdate/" title="HotUpdate">HotUpdate<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Lua/" title="Lua">Lua<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Math/" title="Math">Math<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Native/" title="Native">Native<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Network/" title="Network">Network<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Optimization/" title="Optimization">Optimization<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Other/" title="Other">Other<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Plugin/" title="Plugin">Plugin<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming/" title="Programming">Programming<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming-Language/" title="Programming Language">Programming Language<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Rendering/" title="Rendering">Rendering<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Resource/" title="Resource">Resource<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Unity/" title="Unity">Unity<sup>7</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Unity/" title="Unity">Unity<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Editor/" title="Editor">Editor<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Other/" title="Other">Other<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/AI/" title="AI">AI<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Math/" title="Math">Math<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Resource/" title="Resource">Resource<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/OpenGL/" title="OpenGL">OpenGL<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Programming/" title="Programming">Programming<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Art/" title="Art">Art<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/UI/" title="UI">UI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C#">C#<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Database/" title="Database">Database<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Shader/" title="Shader">Shader<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/SubmlineText3/" title="SubmlineText3">SubmlineText3<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Rendering/" title="Rendering">Rendering<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Native/" title="Native">Native<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Prefab/" title="Prefab">Prefab<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Plugin/" title="Plugin">Plugin<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2026 
		
		<a href="/about" target="_blank" title="Tony Tang">Tony Tang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
